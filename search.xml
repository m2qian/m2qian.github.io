<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä½œæ–‡record</title>
      <link href="/posts/3091860034.html"/>
      <url>/posts/3091860034.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Butterflyå¸¸ç”¨å¤–æŒ‚æ ‡ç­¾è¯­æ³•</title>
      <link href="/posts/1007892938.html"/>
      <url>/posts/1007892938.html</url>
      
        <content type="html"><![CDATA[<h1 id="Butterflyå¸¸ç”¨å¤–æŒ‚æ ‡ç­¾è¯­æ³•"><a href="#Butterflyå¸¸ç”¨å¤–æŒ‚æ ‡ç­¾è¯­æ³•" class="headerlink" title="Butterflyå¸¸ç”¨å¤–æŒ‚æ ‡ç­¾è¯­æ³•"></a>Butterflyå¸¸ç”¨å¤–æŒ‚æ ‡ç­¾è¯­æ³•</h1><wavy>è¿™é‡Œæ˜¯çº¯è‡ªç”¨ï¼Œæ–¹ä¾¿è‡ªå·±å†™çš„æ—¶å€™æŸ¥çœ‹è¿™äº›è¯­æ³•ï¼Œéƒ½æ˜¯å¸¸ç”¨çš„ï¼Œä½†æ˜¯ä¸å®Œå…¨</wavy><h2 id="è¡Œå†…æ–‡æœ¬æ ·å¼-text"><a href="#è¡Œå†…æ–‡æœ¬æ ·å¼-text" class="headerlink" title="è¡Œå†…æ–‡æœ¬æ ·å¼ text"></a>è¡Œå†…æ–‡æœ¬æ ·å¼ text</h2><div class="tabs" id="text"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#text-1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#text-2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#text-3">æ¸²æŸ“å®ä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="text-1"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% u æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% emp æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% wavy æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% del æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% kbd æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% psw æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-2"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> å¸¦&#123;% u ä¸‹åˆ’çº¿ %&#125;çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">2.</span> å¸¦&#123;% emp ç€é‡ç‚¹ %&#125;çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">3.</span> å¸¦&#123;% wavy æ³¢æµªçº¿ %&#125;çš„æ–‡æœ¬å†…å®¹</span><br><span class="line"><span class="bullet">4.</span> å¸¦ &#123;% del åˆ é™¤çº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">5.</span> é”®ç›˜æ ·å¼çš„æ–‡æœ¬ &#123;% kbd command %&#125; + &#123;% kbd D %&#125;</span><br><span class="line"><span class="bullet">6.</span> å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% psw è¿™é‡Œæ²¡æœ‰éªŒè¯ç  %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-3"><ol><li>å¸¦<u>ä¸‹åˆ’çº¿</u>çš„æ–‡æœ¬</li><li>å¸¦<emp>ç€é‡ç‚¹</emp>çš„æ–‡æœ¬</li><li>å¸¦<wavy>æ³¢æµªçº¿</wavy>çš„æ–‡æœ¬å†…å®¹</li><li>å¸¦ <del>åˆ é™¤çº¿</del> çš„æ–‡æœ¬</li><li>é”®ç›˜æ ·å¼çš„æ–‡æœ¬ <kbd>command</kbd> + <kbd>D</kbd></li><li>å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š<psw>è¿™é‡Œæ²¡æœ‰éªŒè¯ç </psw></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="æ®µè½æ–‡æœ¬-p"><a href="#æ®µè½æ–‡æœ¬-p" class="headerlink" title="æ®µè½æ–‡æœ¬ p"></a>æ®µè½æ–‡æœ¬ p</h2><div class="tabs" id="p"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#p-1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#p-2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#p-3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#p-4">æ¸²æŸ“å®ä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="p-1"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% p æ ·å¼å‚æ•°(å‚æ•°ä»¥ç©ºæ ¼åˆ’åˆ†), æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="p-2"><ol><li>å­—ä½“: logo, code</li><li>é¢œè‰²: red,yellow,green,cyan,blue,gray</li><li>å¤§å°: small, h4, h3, h2, h1, large, huge, ultra</li><li>å¯¹é½æ–¹å‘: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="p-3"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> å½©è‰²æ–‡å­—</span><br><span class="line">åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š&#123;% p red, çº¢è‰² %&#125;ã€&#123;% p yellow, é»„è‰² %&#125;ã€&#123;% p green, ç»¿è‰² %&#125;ã€&#123;% p cyan, é’è‰² %&#125;ã€&#123;% p blue, è“è‰² %&#125;ã€&#123;% p gray, ç°è‰² %&#125;ã€‚</span><br><span class="line"><span class="bullet">-</span> è¶…å¤§å·æ–‡å­—</span><br><span class="line">æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚</span><br><span class="line">&#123;% p center logo large, Volantis %&#125;</span><br><span class="line">&#123;% p center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="p-4"><ul><li>å½©è‰²æ–‡å­—<br>åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š<p class='p red'>çº¢è‰²</p>ã€<p class='p yellow'>é»„è‰²</p>ã€<p class='p green'>ç»¿è‰²</p>ã€<p class='p cyan'>é’è‰²</p>ã€<p class='p blue'>è“è‰²</p>ã€<p class='p gray'>ç°è‰²</p>ã€‚</li><li>è¶…å¤§å·æ–‡å­—<br>æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚<p class='p center logo large'>Volantis</p><p class='p center small'>A Wonderful Theme for Hexo</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="å¼•ç”¨note"><a href="#å¼•ç”¨note" class="headerlink" title="å¼•ç”¨note"></a>å¼•ç”¨note</h2><div class="note orange icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>æœ€æ–°ç‰ˆ butterfly æ ‡ç­¾æ”¯æŒå¼•ç”¨ fontawesome V5 å›¾æ ‡ï¼Œæ•ˆæœä¸Šå·²ç»ä¼˜äº volantis çš„ note æ ‡ç­¾ã€‚æ•…ä¸å†é¢å¤–å¼•å…¥ volantis çš„ note æ ·å¼ã€‚</p></div><div class="tabs" id="text"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#text-1">ç«™ç‚¹é…ç½®</button></li><li class="tab"><button type="button" data-href="#text-2">è¯­æ³•æ ¼å¼</button></li><li class="tab"><button type="button" data-href="#text-3">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#text-4">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#text-5">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="text-1"><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bs-callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bs-callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">simple</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">border_radius:</span> <span class="number">3</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-2"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># è‡ªå¸¦icon</span></span><br><span class="line">&#123;% note [class] [no-icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"><span class="section"># å¤–éƒ¨icon</span></span><br><span class="line">&#123;% note [color] [icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-3"><ol><li>è‡ªå¸¦icon</li></ol><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>class</td><td>ã€å¯é€‰ã€‘æ ‡è¯†ï¼Œä¸åŒçš„æ ‡è¯†æœ‰ä¸åŒçš„é…è‰²ï¼ˆ default / primary / success / info / warning / danger ï¼‰</td></tr><tr><td>no-icon</td><td>ã€å¯é€‰ã€‘ä¸æ˜¾ç¤º icon</td></tr><tr><td>style</td><td>ã€å¯é€‰ã€‘å¯ä»¥è¦†ç›–é…ç½®ä¸­çš„ styleï¼ˆsimple/modern/flat/disabledï¼‰</td></tr></tbody></table></div><ol><li>å¤–éƒ¨icon</li></ol><div class="table-container"><table><thead><tr><th>å‚æ•°</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>class</td><td>ã€å¯é€‰ã€‘æ ‡è¯†ï¼Œä¸åŒçš„æ ‡è¯†æœ‰ä¸åŒçš„é…è‰²ï¼ˆ default / primary / success / info / warning / danger ï¼‰</td></tr><tr><td>no-icon</td><td>ã€å¯é€‰ã€‘å¯é…ç½®è‡ªå®šä¹‰ icon (åªæ”¯æŒ fontawesome å›¾æ ‡ï¼Œä¹Ÿå¯ä»¥é…ç½® no-icon)</td></tr><tr><td>style</td><td>ã€å¯é€‰ã€‘å¯ä»¥è¦†ç›–é…ç½®ä¸­çš„ styleï¼ˆsimple/modern/flat/disabledï¼‰</td></tr></tbody></table></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-4"><details class="folding-tag" blue open><summary> è‡ªå¸¦icon </summary>              <div class='content'>              <details class="folding-tag" green><summary> 1. simple æ ·å¼ </summary>              <div class='content'>              <figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note simple %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default simple %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary simple %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success simple %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info simple %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning simple %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger simple %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" yellow><summary> 2. modern æ ·å¼ </summary>              <div class='content'>              <figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note modern %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default modern %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary modern %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success modern %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info modern %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning modern %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger modern %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" red><summary> 3. flat æ ·å¼ </summary>              <div class='content'>              <figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default flat %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary flat %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success flat %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info flat %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning flat %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger flat %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" yellow><summary> 4. disabled æ ·å¼ </summary>              <div class='content'>              <figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note disabled %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default disabled %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary disabled %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success disabled %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info disabled %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning disabled %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger disabled %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" green><summary> 5. no-icon æ ·å¼ </summary>              <div class='content'>              <figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default no-icon %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary no-icon %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success no-icon %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info no-icon %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning no-icon %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger no-icon %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details>              </div>            </details><details class="folding-tag" red><summary> å¤–éƒ¨icon </summary>              <div class='content'>              <p>è¿™é‡Œæˆ‘ç®€å•åšä¸ªæ¼”ç¤ºï¼Œæ ·å¼å‚ç…§ä¸Šé¢ï¼Œè¿™é‡Œæ¼”ç¤ºå¯¹åº”flatï¼Œæˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢è¿™ç§æ ·å¼<br><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; flat %&#125;2021å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; flat %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; flat%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; flat %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; flat %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></p>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="text-5"><details class="folding-tag" blue open><summary> è‡ªå¸¦icon </summary>              <div class='content'>              <details class="folding-tag" green><summary> 1. simple æ ·å¼ </summary>              <div class='content'>              <div class="note simple"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default simple"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary simple"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success simple"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info simple"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning simple"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger simple"><p>danger æç¤ºå—æ ‡ç­¾</p></div>              </div>            </details><details class="folding-tag" yellow><summary> 2. modern æ ·å¼ </summary>              <div class='content'>              <div class="note modern"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default modern"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary modern"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success modern"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info modern"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning modern"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger modern"><p>danger æç¤ºå—æ ‡ç­¾</p></div>              </div>            </details><details class="folding-tag" red><summary> 3. flat æ ·å¼ </summary>              <div class='content'>              <div class="note flat"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default flat"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary flat"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success flat"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info flat"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning flat"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger flat"><p>danger æç¤ºå—æ ‡ç­¾</p></div>              </div>            </details><details class="folding-tag" yellow><summary> 4. disabled æ ·å¼ </summary>              <div class='content'>              <div class="note disabled"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default disabled"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary disabled"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success disabled"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info disabled"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning disabled"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger disabled"><p>danger æç¤ºå—æ ‡ç­¾</p></div>              </div>            </details><details class="folding-tag" green><summary> 5. no-icon æ ·å¼ </summary>              <div class='content'>              <div class="note no-icon flat"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default no-icon flat"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary no-icon flat"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success no-icon flat"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info no-icon flat"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning no-icon flat"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger no-icon flat"><p>danger æç¤ºå—æ ‡ç­¾</p></div>              </div>            </details>              </div>            </details><details class="folding-tag" red><summary> å¤–éƒ¨icon </summary>              <div class='content'>              <div class="note icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding flat"><i class="note-icon fas fa-bullhorn"></i><p>2021å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink icon-padding flat"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-padding flat"><i class="note-icon fas fa-fan"></i><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding flat"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding flat"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding flat"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="æŠ˜å æ¡†-folding"><a href="#æŠ˜å æ¡†-folding" class="headerlink" title="æŠ˜å æ¡† folding"></a>æŠ˜å æ¡† folding</h2><div class="tabs" id="folding"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#folding-1">è¯­æ³•æ ¼å¼</button></li><li class="tab"><button type="button" data-href="#folding-2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#folding-3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="folding-1"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding å‚æ•°ï¼ˆå¯é€‰ï¼‰, æè¿°æ ‡é¢˜ %&#125;</span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><p>å‚æ•°å¦‚ä¸‹ï¼š</p><ol><li><p>é¢œè‰²ï¼šblue, cyan, green, yellow, red</p></li><li><p>çŠ¶æ€ï¼šçŠ¶æ€å¡«å†™ open ä»£è¡¨é»˜è®¤æ‰“å¼€ã€‚<br><em>å‚æ•°ä¹‹é—´ä½¿ç”¨ç©ºæ ¼éš”å¼€å³å¯</em></p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="folding-2"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding æŸ¥çœ‹å›¾ç‰‡æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding cyan open, æŸ¥çœ‹é»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡† %&#125;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡†ã€‚</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding green, æŸ¥çœ‹ä»£ç æµ‹è¯• %&#125;</span><br><span class="line">å‡è£…è¿™é‡Œæœ‰ä»£ç å—ï¼ˆä»£ç å—æ²¡æ³•åµŒå¥—ä»£ç å—ï¼‰</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding yellow, æŸ¥çœ‹åˆ—è¡¨æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> haha</span><br><span class="line"><span class="bullet">-</span> hehe</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding red, æŸ¥çœ‹åµŒå¥—æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding blue, æŸ¥çœ‹åµŒå¥—æµ‹è¯•2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding æŸ¥çœ‹åµŒå¥—æµ‹è¯•3 %&#125;</span><br><span class="line"></span><br><span class="line">hahaha <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png&#x27;</span> <span class="attr">style</span>=<span class="string">&#x27;height:24px&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="folding-3"><details class="folding-tag" ><summary> æŸ¥çœ‹å›¾ç‰‡æµ‹è¯• </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg" alt=""></p>              </div>            </details><details class="folding-tag" cyan open><summary> æŸ¥çœ‹é»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡† </summary>              <div class='content'>              <p>è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡†ã€‚</p>              </div>            </details><details class="folding-tag" green><summary> æŸ¥çœ‹ä»£ç æµ‹è¯• </summary>              <div class='content'>              <p>å‡è£…è¿™é‡Œæœ‰ä»£ç å—ï¼ˆä»£ç å—æ²¡æ³•åµŒå¥—ä»£ç å—ï¼‰</p>              </div>            </details><details class="folding-tag" yellow><summary> æŸ¥çœ‹åˆ—è¡¨æµ‹è¯• </summary>              <div class='content'>              <ul><li>haha</li><li>hehe</li></ul>              </div>            </details><details class="folding-tag" red><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯• </summary>              <div class='content'>              <details class="folding-tag" blue><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯•2 </summary>              <div class='content'>              <details class="folding-tag" ><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯•3 </summary>              <div class='content'>              <p>hahaha <span><img src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png' style='height:24px'></span></p>              </div>            </details>              </div>            </details>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="åˆ†æ -tab"><a href="#åˆ†æ -tab" class="headerlink" title="åˆ†æ  tab"></a>åˆ†æ  tab</h2><div class="tabs" id="åˆ†æ tab"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ tab-1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ tab-2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ tab-3">æºç ç¤ºä¾‹</button></li><li class="tab"><button type="button" data-href="#åˆ†æ tab-4">æ¸²æŸ“æ¡ˆä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ tab-1"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ tab-2"><p><strong>Unique name :</strong></p><pre><code>é€‰é¡¹å¡å—æ ‡ç­¾çš„å”¯ä¸€åç§°ï¼Œä¸å¸¦é€—å·ã€‚å°†åœ¨ #id ä¸­ç”¨ä½œæ¯ä¸ªæ ‡ç­¾åŠå…¶ç´¢å¼•å·çš„å‰ç¼€ã€‚å¦‚æœåç§°ä¸­åŒ…å«ç©ºæ ¼ï¼Œåˆ™å¯¹äºç”Ÿæˆ #idï¼Œæ‰€æœ‰ç©ºæ ¼å°†ç”±ç ´æŠ˜å·ä»£æ›¿ã€‚ä»…å½“å‰å¸–å­ / é¡µé¢çš„ URL å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼</code></pre><p><strong>[index]:</strong></p><pre><code>æ´»åŠ¨é€‰é¡¹å¡çš„ç´¢å¼•å·ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†é€‰æ‹©ç¬¬ä¸€ä¸ªæ ‡ç­¾ï¼ˆ1ï¼‰ã€‚- å¦‚æœ index ä¸º - 1ï¼Œåˆ™ä¸ä¼šé€‰æ‹©ä»»ä½•é€‰é¡¹å¡ã€‚å¯é€‰å‚æ•°ã€‚</code></pre><p><strong>[Tab caption]:</strong></p><pre><code>- å½“å‰é€‰é¡¹å¡çš„æ ‡é¢˜ã€‚å¦‚æœæœªæŒ‡å®šæ ‡é¢˜ï¼Œåˆ™å¸¦æœ‰åˆ¶è¡¨ç¬¦ç´¢å¼•åç¼€çš„å”¯ä¸€åç§°å°†ç”¨ä½œåˆ¶è¡¨ç¬¦çš„æ ‡é¢˜ã€‚å¦‚æœæœªæŒ‡å®šæ ‡é¢˜ï¼Œä½†æŒ‡å®šäº†å›¾æ ‡ï¼Œåˆ™æ ‡é¢˜å°†ä¸ºç©ºã€‚å¯é€‰å‚æ•°ã€‚</code></pre><p><strong>[@icon]:</strong></p><pre><code>FontAwesome å›¾æ ‡åç§°ï¼ˆå…¨åï¼Œçœ‹èµ·æ¥åƒ â€œfas fa-fontâ€ï¼‰å¯ä»¥æŒ‡å®šå¸¦ç©ºæ ¼æˆ–ä¸å¸¦ç©ºæ ¼ï¼›ä¾‹å¦‚â€™Tab caption @iconâ€™ å’Œ â€˜Tab caption@iconâ€™.å¯é€‰å‚æ•°ã€‚</code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ tab-3"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ tab-4"><div class="tabs" id="test1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test1-1">test1 1</button></li><li class="tab"><button type="button" data-href="#test1-2">test1 2</button></li><li class="tab"><button type="button" data-href="#test1-3">test1 3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="TimeLine"><a href="#TimeLine" class="headerlink" title="TimeLine"></a>TimeLine</h2><div class="tabs" id="timline"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#timline-1">è¯­æ³•æ ¼å¼</button></li><li class="tab"><button type="button" data-href="#timline-2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#timline-3">æ¸²æŸ“å®ä¾‹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="timline-1"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline æ—¶é—´çº¿æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰[,color] %&#125;</span><br><span class="line">&lt;!-- timeline æ—¶é—´èŠ‚ç‚¹ï¼ˆæ ‡é¢˜ï¼‰ --&gt;</span><br><span class="line">æ­£æ–‡å†…å®¹</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&lt;!-- timeline æ—¶é—´èŠ‚ç‚¹ï¼ˆæ ‡é¢˜ï¼‰ --&gt;</span><br><span class="line">æ­£æ–‡å†…å®¹</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="timline-2"><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline ä¸ªäººç¢ç¢å¿µ,blue %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2023-01-25 åˆå››åœ¨å®¶æ‘†çƒ‚å‘¢ --&gt;</span><br><span class="line"></span><br><span class="line">é¦–æ¬¡æ¨ä¸Š</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2023-01-24 å¤§å¹´åˆä¸‰å•¦ --&gt;</span><br><span class="line"></span><br><span class="line">é¦–æ¬¡ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2023-01-22 æ–°å¹´å¥½~ --&gt;</span><br><span class="line"></span><br><span class="line">é¦–æ¬¡è®¤è¯†åˆ°timeLine</span><br><span class="line">è¿‡å¤§å¹´å•¦~</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="timline-3"><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>ä¸ªäººç¢ç¢å¿µ</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-25 åˆå››åœ¨å®¶æ‘†çƒ‚å‘¢</p></div></div><div class='timeline-item-content'><p>é¦–æ¬¡æ¨ä¸Š</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-24 å¤§å¹´åˆä¸‰å•¦</p></div></div><div class='timeline-item-content'><p>é¦–æ¬¡ä½¿ç”¨</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-22 æ–°å¹´å¥½~</p></div></div><div class='timeline-item-content'><p>é¦–æ¬¡è®¤è¯†åˆ°timeLine<br>è¿‡å¤§å¹´å•¦~</p></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="é˜¿é‡Œå›¾æ ‡-icon"><a href="#é˜¿é‡Œå›¾æ ‡-icon" class="headerlink" title="é˜¿é‡Œå›¾æ ‡ icon"></a>é˜¿é‡Œå›¾æ ‡ icon</h2><div class="tabs" id="alicon"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#alicon-1">alicon 1</button></li><li class="tab"><button type="button" data-href="#alicon-2">alicon 2</button></li><li class="tab"><button type="button" data-href="#alicon-3">alicon 3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="alicon-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="alicon-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="alicon-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººä¹¦å•</title>
      <link href="/posts/2533234670.html"/>
      <url>/posts/2533234670.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ªäººä¹¦å•åˆé›†"><a href="#ä¸ªäººä¹¦å•åˆé›†" class="headerlink" title="ä¸ªäººä¹¦å•åˆé›†"></a>ä¸ªäººä¹¦å•åˆé›†</h1><p>è¿™é‡Œæ˜¯æˆ‘ä¸ªäººæœé›†çš„è¾ƒä¸ºæ„Ÿå…´è¶£çš„å¥½ä¹¦ï¼Œè¿™é‡Œåšä¸ªåˆ†ç±»è®°å½•ï¼Œæ–¹ä¾¿æŒ‰ç…§åˆ†ç±»é˜…è¯»ï¼Œä¹Ÿä½œä¸ºä¸ªäººçš„ä¸€ä¸ªé˜…è¯»å¯¼èˆª</p><h2 id="åˆ†ç±»1-ä¸ªäººæˆé•¿ã€æ€è€ƒã€æ€ç»´"><a href="#åˆ†ç±»1-ä¸ªäººæˆé•¿ã€æ€è€ƒã€æ€ç»´" class="headerlink" title="åˆ†ç±»1 ä¸ªäººæˆé•¿ã€æ€è€ƒã€æ€ç»´"></a>åˆ†ç±»1 ä¸ªäººæˆé•¿ã€æ€è€ƒã€æ€ç»´</h2><ol><li><p>å¯Œå…°å…‹æ—è‡ªä¼  ç›¸ä¿¡å‹¤å¥‹å…‹å·±çš„æ„ä¹‰<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301221141043.png" alt=""><br>å¦‚æœä½ æƒ³è®¤çœŸå·¥ä½œï¼Œè·å¾—è€æ¿èµè¯†ï¼›æˆ–è€…ä½ æƒ³è‡ªå·±åˆ›ä¸šï¼Œå¹²å‡ºä¸€ç•ªäº‹ä¸šï¼›åˆæˆ–è€…ä½ æƒ³å­¦ä¼šæŸç§æŠ€èƒ½ï¼Œæˆä¸ºæŸä¸€é¢†åŸŸçš„ä¸“å®¶ã€‚æˆ–è€…ä½ æƒ³å®ç°æ¢¦æƒ³ï¼Œå´ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹ï¼Œéƒ½å¯ä»¥çœ‹çœ‹è¿™æœ¬ä¹¦â€”â€”ã€Šå¯Œå…°å…‹æ—è‡ªä¼ ã€‹ ğŸ‘£<1></p></li><li><p>åŸåˆ™ ç²¾åï¼ğŸ‘£<2></p></li></ol><h2 id="åˆ†ç±»2-å¿ƒç†å±‚é¢ã€ç”Ÿæ´»"><a href="#åˆ†ç±»2-å¿ƒç†å±‚é¢ã€ç”Ÿæ´»" class="headerlink" title="åˆ†ç±»2 å¿ƒç†å±‚é¢ã€ç”Ÿæ´»"></a>åˆ†ç±»2 å¿ƒç†å±‚é¢ã€ç”Ÿæ´»</h2><ol><li>äººæ€§çš„å¼±ç‚¹ æ›´å¥½çš„äº†è§£è‡ªå·±æˆ–è€…ä»–äºº<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301221145003.png" alt=""><br>ğŸ‘£<3></li><li></li></ol><h2 id="åˆ†ç±»3-ä¸“ä¸šç›¸å…³"><a href="#åˆ†ç±»3-ä¸“ä¸šç›¸å…³" class="headerlink" title="åˆ†ç±»3 ä¸“ä¸šç›¸å…³"></a>åˆ†ç±»3 ä¸“ä¸šç›¸å…³</h2><ol><li>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ csç¥ä¹¦ï¼Œå¯¹ä¸ªäººç†è§£è®¡ç®—æœºç»„æˆåŸç†ä»¥åŠç½‘ç»œç¼–ç¨‹æœ‰å¾ˆå¤§ç›Šå¤„ å°½é‡å›¾ä¹¦é¦†å€Ÿä¹¦ ğŸ‘£<4></li></ol><p>å¹´è®¡åˆ’ å‰©ä¸‹æš‚å¾…å®šï¼Œé¢„è®¡å°½é‡è¯»ä¸Š10æœ¬ä¹¦â€¦</p>]]></content>
      
      
      
        <tags>
            
            <tag> ä¹¦ç±æ¨è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç‘å‰å¤–å–</title>
      <link href="/posts/2715921041.html"/>
      <url>/posts/2715921041.html</url>
      
        <content type="html"><![CDATA[<p><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=213091208&&page=1&as_wide=1&high_quality=1&danmaku=0"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     high_quality=1    danmaku=1     allowfullscreen="true">     </iframe></div></p><h1 id="ç‘å‰å¤–å–"><a href="#ç‘å‰å¤–å–" class="headerlink" title="ç‘å‰å¤–å–"></a>ç‘å‰å¤–å–</h1><h2 id="é¡¹ç›®å‰ç½®éƒ¨åˆ†"><a href="#é¡¹ç›®å‰ç½®éƒ¨åˆ†" class="headerlink" title="é¡¹ç›®å‰ç½®éƒ¨åˆ†"></a>é¡¹ç›®å‰ç½®éƒ¨åˆ†</h2><ol><li>åˆ›å»ºmavené¡¹ç›®ï¼ˆåˆ›å»ºç»“æŸåæ³¨æ„æŸ¥çœ‹ä¸‹é¡¹ç›®å¯¹åº”çš„mavenä»¥åŠjreï¼Œjdkéƒ¨åˆ†ï¼‰</li><li>å¯¼å…¥pomåæ ‡ï¼Œé¦–å…ˆparentéƒ¨åˆ†ï¼Œç»§æ‰¿springbootï¼Œä¹‹åæ˜¯ä¸€ä¸ªé¡¹ç›®å¯¹åº”çš„ä¾èµ–</li><li>sqlæ–‡ä»¶å¯¼å…¥ï¼Œå›¾å½¢åŒ–å‘½ä»¤è¡Œéšæ„</li><li>å¯¹åº”å‰ç«¯èµ„æºæ˜ å°„é…ç½®<h3 id="å‰ç«¯èµ„æºé…ç½®"><a href="#å‰ç«¯èµ„æºé…ç½®" class="headerlink" title="å‰ç«¯èµ„æºé…ç½®"></a>å‰ç«¯èµ„æºé…ç½®</h3>ç›®çš„ï¼šä¿®æ”¹èµ„æºæ˜ å°„è·¯å¾„<br>æ­¥éª¤ï¼š</li></ol><ul><li>åˆ›å»ºWebMvcConfigé…ç½®ç±»</li><li>ç»§æ‰¿WebMvcConfigurationSupportç±»å¹¶å®ç°å¯¹åº”æ–¹æ³•è®¾ç½®æ˜ å°„è·¯å¾„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®é™æ€èµ„æºæ˜ å°„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/backend/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/front/&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;é™æ€èµ„æºæ˜ å°„start...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‰ç«¯å¯¹åº”login.html</strong><br>jsä¸­çš„æ–¹æ³•ï¼Œè¿™æ˜¯éœ€è¦æå‰çº¦å®šå¥½çš„ï¼Œåç«¯ä¼ å…¥å‰ç«¯çš„æ•°æ®ï¼š(åˆ†åˆ«æ˜¯ä¸‰ä¸ªæ•°æ®code,data,msg)<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161151578.png" alt=""></p><h2 id="åå°ç™»å½•åŠŸèƒ½å¼€å‘"><a href="#åå°ç™»å½•åŠŸèƒ½å¼€å‘" class="headerlink" title="åå°ç™»å½•åŠŸèƒ½å¼€å‘"></a>åå°ç™»å½•åŠŸèƒ½å¼€å‘</h2><h3 id="é¦–å…ˆåˆ›å»ºå¤§ä½“çš„æ¡†æ¶ï¼ˆä¸‰å±‚ï¼ŒåŸºäºMPçš„è§„èŒƒï¼Œentityï¼Œserviceï¼Œmapperï¼Œcontrollerï¼‰"><a href="#é¦–å…ˆåˆ›å»ºå¤§ä½“çš„æ¡†æ¶ï¼ˆä¸‰å±‚ï¼ŒåŸºäºMPçš„è§„èŒƒï¼Œentityï¼Œserviceï¼Œmapperï¼Œcontrollerï¼‰" class="headerlink" title="é¦–å…ˆåˆ›å»ºå¤§ä½“çš„æ¡†æ¶ï¼ˆä¸‰å±‚ï¼ŒåŸºäºMPçš„è§„èŒƒï¼Œentityï¼Œserviceï¼Œmapperï¼Œcontrollerï¼‰"></a>é¦–å…ˆåˆ›å»ºå¤§ä½“çš„æ¡†æ¶ï¼ˆä¸‰å±‚ï¼ŒåŸºäºMPçš„è§„èŒƒï¼Œentityï¼Œserviceï¼Œmapperï¼Œcontrollerï¼‰</h3><p><strong>æ³¨æ„ï¼š</strong> åœ¨å¯åŠ¨ç±»ä¸­éœ€è¦å¯¹mapperè¿›è¡Œæ‰«æï¼Œä½¿ç”¨MapperScanæ³¨è§£å†™å…¥mapperåŒ…çš„è·¯å¾„ï¼Œä¹‹åå¯¹æ¥å£å¯ä»¥å®ç°è‡ªåŠ¨è£…é…<br>ç»“æ„å¤§ä½“å¦‚ä¸‹ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161237733.png" alt=""></p><h3 id="å¯¼å…¥é€šç”¨è¿”å›ç»“æœç±»"><a href="#å¯¼å…¥é€šç”¨è¿”å›ç»“æœç±»" class="headerlink" title="å¯¼å…¥é€šç”¨è¿”å›ç»“æœç±»"></a>å¯¼å…¥é€šç”¨è¿”å›ç»“æœç±»</h3><p><em>è¿™é‡Œæ˜¯æœåŠ¡ç«¯ç›¸åº”çš„æ•°æ®è¿”å›ä¿¡æ¯ï¼Œå‡å°è£…æˆæ­¤å¯¹è±¡</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šç”¨è¿”å›ç»“æœç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//ç¼–ç ï¼š1æˆåŠŸï¼Œ0å’Œå…¶å®ƒæ•°å­—ä¸ºå¤±è´¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//åŠ¨æ€æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="åå°ç™»å½•åŠŸèƒ½å¼€å‘-1"><a href="#åå°ç™»å½•åŠŸèƒ½å¼€å‘-1" class="headerlink" title="åå°ç™»å½•åŠŸèƒ½å¼€å‘"></a>åå°ç™»å½•åŠŸèƒ½å¼€å‘</h3><p><em>å¼€å‘æµç¨‹</em><br>å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li>å°†é¡µé¢æäº¤çš„å¯†ç passwordè¿›è¡Œmd5åŠ å¯†å¤„ç†</li><li>æ ¹æ®é¡µé¢æäº¤çš„ç”¨æˆ·åusernameæŸ¥è¯¢æ•°æ®åº“</li><li>å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°åˆ™è¿”å›ç™»å½•å¤±è´¥ç»“æœ</li><li>å¯†ç æ¯”å¯¹ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¿”å›ç™»å½•å¤±è´¥ç»“æœ</li><li>æŸ¥çœ‹å‘˜å·¥çŠ¶æ€ï¼Œå¦‚æœä¸ºå·²ç¦ç”¨çŠ¶æ€ï¼Œåˆ™è¿”å›å‘˜å·¥å·²ç¦ç”¨ç»“æœ</li><li>ç™»å½•æˆåŠŸï¼Œå°†å‘˜å·¥idå­˜å…¥Sessionå¹¶è¿”å›ç™»å½•æˆåŠŸç»“æœ<br>æµç¨‹å›¾ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161405357.png" alt=""></li></ol><p>ä¸€ä¸ªå°æ’æ›²</p><h4 id="æ¡ä»¶æ„é€ å™¨"><a href="#æ¡ä»¶æ„é€ å™¨" class="headerlink" title="æ¡ä»¶æ„é€ å™¨"></a><strong>æ¡ä»¶æ„é€ å™¨</strong></h4><p>è¡¥å……ä¸€ä¸ªåœ¨å­¦ä¹ MPä¸­ä¸¢å¤±çš„çŸ¥è¯†ç‚¹ï¼šWrapper<br>æ¡ä»¶æ„é€ å™¨ä¸­é“¾å¼ç»“æ„é»˜è®¤ä½¿ç”¨andï¼Œå¦‚æœæ˜¯æˆ–è€…å°±éœ€è¦æ‰‹åŠ¨æ·»åŠ or()<br>Wrapperæ¡†æ¶ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161719320.png" alt=""></p><ul><li>ç”¨äºæŸ¥è¯¢ï¼Œåˆ é™¤ï¼šqueryWrapper</li><li>ç”¨äºæ›´æ”¹æ•°æ®ä»¥åŠæ•°æ®æ¡ä»¶å°è£…ï¼šupdateWrapper<h5 id="queryWrapper"><a href="#queryWrapper" class="headerlink" title="queryWrapper"></a>queryWrapper</h5></li></ul><ol><li>æ¡ä»¶æ„é€ å™¨ç»„ä»¶æ’åºæ¡ä»¶ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161728066.png" alt=""></li><li>åˆ é™¤æ¡ä»¶ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161735193.png" alt=""></li><li>ä¿®æ”¹åŠŸèƒ½ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161739592.png" alt=""><br>è¿™é‡Œupdateä¸­ä¸¤ä¸ªå‚æ•°ï¼Œå‰è€…æ˜¯è®¾ç½®ä¿®æ”¹çš„å­—æ®µä»¥åŠä¿®æ”¹çš„å€¼ï¼Œåè€…æ˜¯è®¾ç½®ä¿®æ”¹çš„å¯¹è±¡</li><li>æ¡ä»¶ä¼˜å…ˆçº§çš„è®¾å®š<br>consumeræ¶ˆè´¹è€…æ¥å£ä¸­æ˜¯ä¸€å®šè¦æœ‰å‚æ•°çš„ï¼Œè€Œå…¶ä¸­çš„æ–¹æ³•å°±æ˜¯å¯¹å‚æ•°çš„æ“ä½œ<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161749391.png" alt=""><br>è¿™é‡Œçš„paramå°±æ˜¯lambdaä¸­çš„æ¡ä»¶æ„é€ å™¨<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161750613.png" alt=""><br>åœ¨andæ–¹æ³•å’Œoræ–¹æ³•ä¸­å‡æœ‰</li><li>ç»„è£…selectå­—å¥ï¼ˆæŸ¥è¯¢å…¶ä¸­æŸäº›å­—æ®µï¼‰<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161753056.png" alt=""><h5 id="updateWrapper"><a href="#updateWrapper" class="headerlink" title="updateWrapper"></a>updateWrapper</h5>å®ç°ä¿®æ”¹åŠŸèƒ½ï¼šï¼ˆè¾ƒqueryWrapperè¾ƒç®€å•ï¼Œæ— éœ€åˆ›å»ºå®ä½“å¯¹è±¡ï¼‰<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301161759438.png" alt=""></li></ol><p><em>è¡¥å……ç»“æŸï¼Œæ­¤æ—¶å·²ç»æ˜ç™½äº†ä»€ä¹ˆæ˜¯Wrapperæ¡ä»¶æ„é€ ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹å®ç°é¡¹ç›®</em></p><p>åå°ç™»å½•åŠŸèƒ½å®ç°ï¼š</p><ul><li>ç™»å½•åŠŸèƒ½<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EmployeeMapper, Employee&gt; <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">login</span><span class="params">(HttpServletRequest request, Employee employee)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å°†é¡µé¢æäº¤çš„å¯†ç passwordè¿›è¡Œmd5åŠ å¯†å¤„ç†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword();</span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line">        <span class="comment">// 2. æ ¹æ®é¡µé¢æäº¤çš„ç”¨æˆ·åusernameæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Employee::getUsername,employee.getUsername());</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> getOne(queryWrapper);</span><br><span class="line">        <span class="comment">//3. å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°åˆ™è¿”å›ç™»å½•å¤±è´¥ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(emp==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;ä¸å­˜åœ¨è¯¥è´¦æˆ·ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4. å¯†ç æ¯”å¯¹ï¼Œå¦‚æœä¸ä¸€è‡´åˆ™è¿”å›ç™»å½•å¤±è´¥ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(emp.getPassword() != password)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5. æŸ¥çœ‹å‘˜å·¥çŠ¶æ€ï¼Œå¦‚æœä¸ºå·²ç¦ç”¨çŠ¶æ€ï¼Œåˆ™è¿”å›å‘˜å·¥å·²ç¦ç”¨ç»“æœ</span></span><br><span class="line">        <span class="keyword">if</span>(emp.getStatus() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;è´¦æˆ·å·²è¢«ç¦ç”¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6. ç™»å½•æˆåŠŸï¼Œå°†å‘˜å·¥idå­˜å…¥Sessionå¹¶è¿”å›ç™»å½•æˆåŠŸç»“æœ</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>,emp.getId());</span><br><span class="line">        <span class="keyword">return</span> R.success(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>é€€å‡ºåŠŸèƒ½<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    request.getSession().removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;é€€å‡ºæˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><em>é€€å‡ºçš„ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒç®€å•ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ç›´æ¥å†™åœ¨äº†controllerå±‚ï¼Œå»ºè®®è¿˜æ˜¯æ”¾åœ¨serviceå±‚</em></li></ul><h3 id="åå°é¦–é¡µæ„æˆä»¥åŠå±•ç¤ºæ–¹å¼"><a href="#åå°é¦–é¡µæ„æˆä»¥åŠå±•ç¤ºæ–¹å¼" class="headerlink" title="åå°é¦–é¡µæ„æˆä»¥åŠå±•ç¤ºæ–¹å¼"></a>åå°é¦–é¡µæ„æˆä»¥åŠå±•ç¤ºæ–¹å¼</h3><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301181232134.png" alt=""><br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301181233005.png" alt=""><br>è¿™é‡Œè®¾ç½®å¯¹åº”çš„æ˜¯é¦–é¡µå³ä¾§çš„èœå•<br><strong>ä¸ºä»€ä¹ˆæ­¤å¤„ç‚¹å‡»å³å¯åˆ‡æ¢å‘¢ï¼Ÿ</strong><br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301181234851.png" alt=""><br>è¿™ä¸ªæ–¹æ³•æ¯æ¬¡è°ƒç”¨ä¼šåˆ‡æ¢itemå…ƒç´ å¯¹åº”çš„urlå¹¶å±•ç¤ºåœ¨é¡µé¢</p><h3 id="å®Œå–„ç™»å½•åŠŸèƒ½"><a href="#å®Œå–„ç™»å½•åŠŸèƒ½" class="headerlink" title="å®Œå–„ç™»å½•åŠŸèƒ½"></a>å®Œå–„ç™»å½•åŠŸèƒ½</h3><p>äº§ç”Ÿé—®é¢˜ï¼šè¿™é‡Œä½¿ç”¨index.htmlå¯ä»¥ç›´æ¥è¿›å…¥å†…ç½®é¡µé¢ï¼Œä¸ç”¨ç™»å½•ï¼Œè¿™æ˜¯ä¸åˆç†çš„</p><p>ä¸šåŠ¡ä¿®æ”¹ï¼šï¼ˆå¿…é¡»ç™»å½•æ‰èƒ½è¿›å…¥ï¼Œæœªç™»å½•å°†è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼‰<br>é‚£ä¹ˆï¼Œå…·ä½“åº”è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ<br>ç­”æ¡ˆå°±æ˜¯ä½¿ç”¨è¿‡æ»¤å™¨æˆ–è€…æ‹¦æˆªå™¨ï¼Œåœ¨è¿‡æ»¤å™¨æˆ–è€…æ‹¦æˆªå™¨ä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»å®Œæˆç™»å½•ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·è®¿é—®é¡µé¢çš„æ‹¦æˆªå™¨ï¼ŒæŸ¥çœ‹æ˜¯å¦ç™»å½•æˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;LoginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        log.info(<span class="string">&quot;æ‹¦æˆªåˆ°çš„ä¿¡æ¯ï¼š&#123;&#125;&quot;</span>,request.getRequestURL());</span><br><span class="line">        filterChain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><em>è¿™é‡Œæ˜¯æ£€æŸ¥ä¸šåŠ¡ï¼Œè¿˜æœªå®ç°çœŸæ­£çš„æ‹¦æˆªä¸šåŠ¡é€»è¾‘</em><br>è¿˜æœ‰ä¸€å¤„éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯åœ¨å¯åŠ¨ç±»ä¸Šéœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨è§£<code>@ServletComponentScan</code>ï¼Œæ‰èƒ½ä½¿è¿‡æ»¤å™¨è¢«æ‰«æåˆ°<br><strong>ä»£ç å¼€å‘</strong><br>å…·ä½“å¤„ç†é€»è¾‘ï¼š</p><ol><li>è·å–æœ¬æ¬¡è¯·æ±‚çš„URI</li><li>åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç†</li><li>å¦‚æœä¸éœ€è¦å¤„ç†ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</li><li>åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</li><li>å¦‚æœæœªç™»å½•åˆ™è¿”å›æœªç™»å½•ç»“æœï¼Œé€šè¿‡è¾“å‡ºæµæ–¹å¼å…ˆå®¢æˆ·ç«¯(å‰ç«¯)é¡µé¢å“åº”æ•°æ®ï¼Œå‰ç«¯æœ‰åšæ‹¦æˆªå™¨ï¼Œå…¶ä¸­è¿”å›çš„msgéœ€è¦æ˜¯NOTLOGIN<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301201131109.png" alt=""><br>æµç¨‹å›¾ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301201105287.png" alt=""></li></ol><p>ä»£ç å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·è®¿é—®é¡µé¢çš„æ‹¦æˆªå™¨ï¼ŒæŸ¥çœ‹æ˜¯å¦ç™»å½•æˆåŠŸ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;LoginCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        <span class="comment">// 1. è·å–æœ¬æ¬¡è¯·æ±‚çš„URI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        String[] urls = &#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        log.info(<span class="string">&quot;æœ¬æ¬¡æ‹¦æˆª&#123;&#125;è¯·æ±‚&quot;</span>,requestURI);</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç†</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> checkUrl(urls, requestURI);</span><br><span class="line">        <span class="comment">// 3. å¦‚æœä¸éœ€è¦å¤„ç†ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;æœ¬æ¬¡è¯·æ±‚ä¸º&#123;&#125;æ— éœ€è¢«æ‹¦æˆª&quot;</span>,requestURI);</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;ç”¨æˆ·å·²ç™»å½•,ç”¨æˆ·idä¸º&#123;&#125;&quot;</span>,request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            filterChain.doFilter(request,response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5. å¦‚æœæœªç™»å½•åˆ™è¿”å›æœªç™»å½•ç»“æœï¼Œé€šè¿‡è¾“å‡ºæµæ–¹å¼å…ˆå®¢æˆ·ç«¯(å‰ç«¯)é¡µé¢å“åº”æ•°æ®ï¼Œå‰ç«¯æœ‰å•ç‹¬åšæ‹¦æˆªå™¨ï¼Œå…¶ä¸­è¿”å›çš„msgéœ€è¦æ˜¯NOTLOGIN</span></span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·æœªç™»å½•!&quot;</span>);</span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­é¡µé¢æ˜¯å¦å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urls</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestURI</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkUrl</span><span class="params">(String[] urls, String requestURI)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ–°å¢å‘˜å·¥åŠŸèƒ½"><a href="#æ–°å¢å‘˜å·¥åŠŸèƒ½" class="headerlink" title="æ–°å¢å‘˜å·¥åŠŸèƒ½"></a>æ–°å¢å‘˜å·¥åŠŸèƒ½</h2><p><strong>å°æ’æ›²ï¼Œåœ¨å­¦ä¹ å‰åœ¨æ­¤å¤„å¤ä¹ ä¸€ä¸‹ä¹‹å‰å­¦è¿‡çš„æ³¨è§£çŸ¥è¯†</strong></p><ol><li>getå’Œpost</li></ol><p>GETå¯ä»¥æ‹¥æœ‰è¯·æ±‚ä½“ï¼ŒRFC æ–‡æ¡£ä¸­ä»æ¥å°±æ²¡æœ‰è¯´è¿‡ GET æ²¡æœ‰è¯·æ±‚ä½“ï¼ŒRFC åªæ˜¯è¯´GET æ„å‘³ç€é€šè¿‡ URI æ¥è¯†åˆ«èµ„æºã€‚æ‰€ä»¥GETè¯·æ±‚ä½“ä¸­çš„æ•°æ®ä¸€èˆ¬éƒ½æ˜¯ä¸åšå¤„ç†çš„ï¼Œæœ‰äº› http çš„ lib é‡Œä¸è®©ç”šè‡³ç›´æ¥ä¸æä¾› GET æ–¹æ³•è¿½åŠ è¯·æ±‚ä½“çš„æ“ä½œã€‚</p><p>POSTè¯·æ±‚æ‹¥æœ‰è¯·æ±‚ä½“ï¼Œå¹¶ä¸”è¯·æ±‚æ•°æ®ä¸€èˆ¬éƒ½æ˜¯æ”¾åœ¨è¯·æ±‚ä½“å½“ä¸­çš„ã€‚æ‰€ä»¥åœ¨å¤„ç†POSTè¯·æ±‚æ—¶ï¼Œé€šå¸¸éƒ½æ˜¯ä»è¯·æ±‚ä½“ä¸­è·å–æ•°æ®ã€‚</p><ol><li>RequestBodyæ³¨è§£</li></ol><ul><li>ç”¨äºæ¥æ”¶å‰ç«¯å‘é€çš„jsonæ•°æ®ï¼ˆå¤„ç†jsonæ ¼å¼æ•°æ®ï¼‰å‰ç«¯POSTè¿‡æ¥çš„æ•°æ®ä¼šé€šè¿‡ååºåˆ—æ•°æ®åˆ°å®ä½“ç±»ä¸­ï¼Œå¹¶ä¸”åœ¨ååºåˆ—çš„è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œç±»å‹çš„è½¬æ¢</li><li>RequestBodyæ¥æ”¶çš„æ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼Œåªæœ‰è¯·æ±‚ä½“ä¸­èƒ½ä¿å­˜jsonï¼Œæ‰€ä»¥ä½¿ç”¨@RequestBodyæ¥æ”¶æ•°æ®çš„æ—¶å€™å¿…é¡»æ˜¯POSTæ–¹å¼ç­‰æ–¹å¼ã€‚</li><li>å¯ä»¥å’Œå…¶å®ƒæ³¨è§£åŒæ—¶ä½¿ç”¨ï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨ä¸€æ¬¡</li></ul><ol><li>RequestParamæ³¨è§£<br>å¯ä»¥ç”¨äºæ¥æ”¶URLä¸­çš„å‚æ•°å¹¶æ†ç»‘åˆ°æ–¹æ³•çš„å‚æ•°ä¸­ï¼Œä¹Ÿå¯ä»¥æ¥å—postè¯·æ±‚ä½“ä¸­çš„Content-Type ä¸º application/x-www-form-urlencodedçš„æ•°æ®ã€‚ï¼ˆpostæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯jsonæ ¼å¼æ•°æ®ï¼‰<br>ç”¨å¥ç®€å•çš„è¯è¯´å°±æ˜¯ä½¿ç”¨äº†è¿™ä¸ªæ³¨è§£å°±æ˜¯æ·»åŠ äº†ä¸€äº›æ¡ä»¶ï¼Œå‰ç«¯è¦è¿›æ¥çš„æ—¶å€™å¿…é¡»è¦æœ‰è¿™ä¸ªæ¡ä»¶è§„å®šçš„ä¸œè¥¿ï¼Œå¦‚æœæ²¡æœ‰å°±è¿›ä¸æ¥<br>äºŒè€…å¯ä»¥æ··åˆä½¿ç”¨</li></ol><p>ä¸šåŠ¡å¼€å‘ï¼šï¼ˆåå°è¿™é‡Œåªéœ€è¦ç»™å¯¹åº”æ•°æ®é™„ä¸Šåˆå§‹å€¼å³å¯ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(Employee employee, HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// ç»™å‘˜å·¥è®¾ç½®åˆå§‹å¯†ç ï¼ŒåŒæ—¶è¿›è¡Œmd5åŠ å¯†</span></span><br><span class="line">    employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»™å‘˜å·¥æ·»åŠ åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å¾—å½“å‰ç”¨æˆ·çš„id</span></span><br><span class="line">    <span class="comment">// sessionä¸­çš„æ•°æ®å–å‡ºæ¥ä¸€èˆ¬éƒ½æ˜¯objectç±»å‹ï¼Œéœ€è¦åšå¼ºè½¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    employee.setCreateUser(userId);</span><br><span class="line">    employee.setUpdateUser(userId);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜å‘˜å·¥</span></span><br><span class="line">    save(employee);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;å‘˜å·¥æ·»åŠ æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301201326409.png" alt=""><br>çœ‹åˆ°è¿™é‡Œæœ‰æ¡sqlè¯­å¥insertæ‰§è¡ŒæˆåŠŸå³å¯ã€‚</p><p>ä½†æ˜¯å‰é¢çš„ç¨‹åºè¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“æˆ‘ä»¬åœ¨æ–°å¢å‘˜å·¥æ—¶è¾“å…¥çš„è´¦å·å·²ç»å­˜åœ¨ï¼Œç”±äºemployeeè¡¨ä¸­å¯¹è¯¥å­—æ®µåŠ å…¥äº†å”¯ä¸€çº¦æŸï¼Œæ­¤æ—¶ç¨‹åºä¼šæŠ›å‡ºå¼‚å¸¸ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301201328624.png" alt=""></p><p>æ­¤æ—¶éœ€è¦æˆ‘ä»¬çš„ç¨‹åºè¿›è¡Œå¼‚å¸¸æ•è·ï¼Œé€šå¸¸æœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p><ol><li>åœ¨Controlleræ–¹æ³•ä¸­åŠ å…¥tryã€catchè¿›è¡Œå¼‚å¸¸æ•è·</li><li>ä½¿ç”¨å¼‚å¸¸å¤„ç†å™¨è¿›è¡Œå…¨å±€å¼‚å¸¸æ•è·</li></ol><p>ç¬¬ä¸€ç§ä¸å»ºè®®ï¼Œå¦‚æœä½¿ç”¨tryï¼Œcatchçš„æ–¹å¼ï¼ŒåŒæ ·çš„ä»£ç è¦å†™å¾ˆå¤šéï¼Œå†—ä½™æˆåˆ†è¿‡å¤šï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼</p><p>ä»£ç å®ç°ç±»ï¼š<code>GlobalExceptionHandler</code> åœ¨commonåŒ…ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€å¼‚å¸¸æ•è·å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class&#125;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é”®æ˜¯æ­¤å¤„çš„æ³¨è§£</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandle</span><span class="params">(SQLIntegrityConstraintViolationException exception)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> exception.getMessage();</span><br><span class="line"></span><br><span class="line">        log.info(message);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(message.contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] strs = message.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> strs[<span class="number">2</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;ç”¨æˆ·&quot;</span>+ user + <span class="string">&quot;å·²å­˜åœ¨ï¼&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;ç”¨æˆ·&#123;&#125;å·²å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;é”™è¯¯ç±»å‹æœªå®šä¹‰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>å°çŸ¥è¯†ç‚¹ï¼š</strong><br>@ControllerAdviceæ³¨è§£ï¼šæ‰«ææ‰€æœ‰ annotations ä¸­æ‰€è®¾ç½®çš„å«æœ‰è¿™ä¸ªæ³¨è§£çš„ç±»<br>åªæœ‰è®¾ç½®annotationså‚æ•°åæ‰ä¼šç”Ÿæ•ˆã€‚<br>@ExceptionHandleræ³¨è§£ï¼šæ‹¬å·å†…å‚æ•°ä¸ºå¼‚å¸¸çš„ç±»å‹</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301201926154.png" alt=""></p><p>ä¸€èˆ¬ä¸šåŠ¡çš„å®ç°åŸºæœ¬éƒ½æ˜¯è¿™ä¸ªæµç¨‹ï¼Œåªä¸è¿‡æ˜¯æ•°æ®æ ¼å¼ï¼Œè¯·æ±‚åœ°å€ç­‰ä¸åŒï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯è¯·æ±‚å“åº”è¿™æ ·çš„æ¨¡å¼ã€‚</p><h2 id="å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢"><a href="#å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢"></a>å‘˜å·¥ä¿¡æ¯åˆ†é¡µæŸ¥è¯¢</h2><h3 id="å¯¹éœ€æ±‚è¿›è¡Œåˆ†æ"><a href="#å¯¹éœ€æ±‚è¿›è¡Œåˆ†æ" class="headerlink" title="å¯¹éœ€æ±‚è¿›è¡Œåˆ†æ"></a>å¯¹éœ€æ±‚è¿›è¡Œåˆ†æ</h3><p>ç³»ç»Ÿä¸­çš„å‘˜å·¥å¾ˆå¤šçš„æ—¶å€™ï¼Œå¦‚æœåœ¨ä¸€ä¸ªé¡µé¢ä¸­å…¨éƒ¨å±•ç¤ºå‡ºæ¥ä¼šæ˜¾å¾—æ¯”è¾ƒä¹±ï¼Œä¸ä¾¿äºæŸ¥çœ‹ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„ç³»ç»Ÿä¸­éƒ½ä¼šä»¥åˆ†é¡µçš„æ–¹å¼æ¥å±•ç¤ºåˆ—è¡¨æ•°æ®ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301201929617.png" alt=""></p><p>å³ä¸Šè§’å¯ä»¥è®¾ç½®è¿‡æ»¤æ¡ä»¶ï¼Œä¹Ÿæ˜¯éœ€è¦å®ç°éœ€æ±‚ä¹‹ä¸€ã€‚</p><h3 id="ä¸šåŠ¡å¼€å‘"><a href="#ä¸šåŠ¡å¼€å‘" class="headerlink" title="ä¸šåŠ¡å¼€å‘"></a>ä¸šåŠ¡å¼€å‘</h3><p>åœ¨å¼€å‘ä»£ç ä¹‹å‰ï¼Œéœ€è¦æ¢³ç†ä¸€ä¸‹æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><ol><li>é¡µé¢å‘é€ajaxè¯·æ±‚ï¼Œå°†åˆ†é¡µæŸ¥è¯¢å‚æ•°ï¼ˆpageã€pageSizeã€nameï¼‰æäº¤åˆ°æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯Controlleræ¥æ”¶é¡µé¢æäº¤çš„æ•°æ®å¹¶è°ƒç”¨ServiceæŸ¥è¯¢æ•°æ®</li><li>Serviceè°ƒç”¨Mapperæ“ä½œæ•°æ®åº“ï¼ŒæŸ¥è¯¢åˆ†é¡µæ•°æ®</li><li>Controllerå°†æŸ¥è¯¢åˆ°çš„åˆ†é¡µæ•°æ®å“åº”ç»™é¡µé¢</li><li>é¡µé¢æ¥æ”¶åˆ°åˆ†é¡µæ•°æ®å¹¶é€šè¿‡ElementUlçš„Tableç»„ä»¶å±•ç¤ºåˆ°é¡µé¢ä¸Š</li></ol><p><em>è¡¥å……</em> ï¼šMPçš„åˆ†é¡µæ’ä»¶é…ç½®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®MPåˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ä¸šåŠ¡æµç¨‹ï¼š</p><ol><li>å› ä¸ºä½¿ç”¨MPåˆ†é¡µæ’ä»¶ï¼Œé¦–å…ˆåˆ›å»ºåˆ†é¡µæ„é€ å™¨</li><li>å› ä¸ºéœ€è¦æŸ¥è¯¢ï¼Œæ‰€ä»¥è¿™é‡Œå†åˆ›å»ºä¸€ä¸ªæ¡ä»¶æ„é€ å™¨</li><li>æ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;page=&#123;&#125;,pageSize=&#123;&#125;,name=&#123;&#125;&quot;</span>,page,pageSize,name);</span><br><span class="line">    <span class="comment">// 1. å› ä¸ºä½¿ç”¨MPåˆ†é¡µæ’ä»¶ï¼Œé¦–å…ˆåˆ›å»ºåˆ†é¡µæ„é€ å™¨</span></span><br><span class="line">    Page&lt;Employee&gt; employeePage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å› ä¸ºéœ€è¦æŸ¥è¯¢ï¼Œæ‰€ä»¥è¿™é‡Œå†åˆ›å»ºä¸€ä¸ªæ¡ä»¶æ„é€ å™¨ï¼Œè¿™é‡Œä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢</span></span><br><span class="line">    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.like(StringUtils.isNotEmpty(name),Employee::getName,name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ ä¸€ä¸ªæŸ¥è¯¢åˆ°ä¹‹åçš„æ’åºæ¡ä»¶</span></span><br><span class="line">    queryWrapper.orderByDesc(Employee::getUpdateTime);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å›</span></span><br><span class="line">    page(employeePage,queryWrapper); <span class="comment">// æ‰§è¡Œçš„æ¡ä»¶æ˜ å°„</span></span><br><span class="line">    <span class="keyword">return</span> R.success(employeePage); <span class="comment">// è¿”å›ç±»å‹æ˜¯ä¸€ä¸ªåˆ†é¡µæ„é€ å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shiroæ¡†æ¶å¿«é€Ÿå…¥é—¨</title>
      <link href="/posts/3314890146.html"/>
      <url>/posts/3314890146.html</url>
      
        <content type="html"><![CDATA[<p>å®˜ç½‘ä»‹ç»ï¼š<br>Apache Shiroâ„¢æ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶,èƒ½å¤Ÿç”¨äºèº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ‹¥æœ‰æ˜“äºç†è§£çš„API,æ‚¨å¯ä»¥å¿«é€Ÿã€è½»æ¾åœ°è·å¾—ä»»ä½•åº”ç”¨ç¨‹åºâ€”â€”ä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„ç½‘ç»œå’Œä¼ä¸šåº”ç”¨ç¨‹åºã€‚<br>ç®€è€Œè¨€ä¹‹ï¼šå°±æ˜¯ä¸€ä¸ªJavaå®‰å…¨æ¡†æ¶ï¼Œè¿›è¡Œèº«ä»½è®¤è¯æˆæƒç­‰æ“ä½œ</p><p><strong>Shiro æ¶æ„ 3 ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</strong><br>ï¼ˆ1ï¼‰Subjectï¼šæ­£ä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’çš„äºº, æˆ–æŸä¸€ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡ã€‚æ‰€æœ‰ Subject å®ä¾‹éƒ½è¢«ç»‘å®šåˆ°ï¼ˆä¸”è¿™æ˜¯å¿…é¡»çš„ï¼‰ä¸€ä¸ªSecurityManager ä¸Šã€‚<br>ï¼ˆ2ï¼‰SecurityManagerï¼šShiro æ¶æ„çš„å¿ƒè„, ç”¨æ¥åè°ƒå†…éƒ¨å„å®‰å…¨ç»„ä»¶, ç®¡ç†å†…éƒ¨ç»„ä»¶å®ä¾‹, å¹¶é€šè¿‡å®ƒæ¥æä¾›å®‰å…¨ç®¡ç†çš„å„ç§æœåŠ¡ã€‚å½“Shiro ä¸ä¸€ä¸ª Subject è¿›è¡Œäº¤äº’æ—¶, å®è´¨ä¸Šæ˜¯å¹•åçš„ SecurityManager å¤„ç†æ‰€æœ‰ç¹é‡çš„ Subject å®‰å…¨æ“ä½œã€‚<br>ï¼ˆ3ï¼‰Realmsï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹å®šå®‰å…¨çš„ DAOã€‚ å½“é…ç½® Shiro æ—¶, å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª Realm ç”¨æ¥è¿›è¡Œèº«ä»½éªŒè¯å’Œ/æˆ–æˆæƒã€‚Shiro æä¾›äº†å¤šç§å¯ç”¨çš„ Realms æ¥è·å–å®‰å…¨ç›¸å…³çš„æ•°æ®ã€‚å¦‚å…³ç³»æ•°æ®åº“(JDBC), INI åŠå±æ€§æ–‡ä»¶ç­‰ã€‚ å¯ä»¥å®šä¹‰è‡ªå·± Realm å®ç°æ¥ä»£è¡¨è‡ªå®šä¹‰çš„æ•°æ®æºã€‚</p><h2 id="shiroä¸­çš„é‡è¦è§’è‰²"><a href="#shiroä¸­çš„é‡è¦è§’è‰²" class="headerlink" title="shiroä¸­çš„é‡è¦è§’è‰²"></a>shiroä¸­çš„é‡è¦è§’è‰²</h2><p>å…¶ä¸­è¾ƒéš¾ç†è§£çš„ç‚¹</p><p>ç”¨æˆ·ï¼šè§’è‰²ï¼šæƒé™ ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œä½†å®é™…ä¸Šä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å¯¹ç”¨æˆ·èµ‹äºˆè§’è‰²ï¼Œç”¨è§’è‰²ç‰¹å®šçš„æƒé™å»æ‰§è¡Œ</p><p><strong>shiroçš„è¿è¡Œæœºåˆ¶</strong><br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221222224846.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> å®‰å…¨æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisåŸºç¡€</title>
      <link href="/posts/4264158992.html"/>
      <url>/posts/4264158992.html</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºç¡€ç¯‡Redis"><a href="#åŸºç¡€ç¯‡Redis" class="headerlink" title="åŸºç¡€ç¯‡Redis"></a>åŸºç¡€ç¯‡Redis</h1><h2 id="1-Redisç®€å•ä»‹ç»"><a href="#1-Redisç®€å•ä»‹ç»" class="headerlink" title="1.Redisç®€å•ä»‹ç»"></a>1.Redisç®€å•ä»‹ç»</h2><p>Redisæ˜¯ä¸€ç§é”®å€¼å‹çš„NoSqlæ•°æ®åº“ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®å­—ï¼š</p><ul><li>é”®å€¼å‹</li><li>NoSql</li></ul><p>å…¶ä¸­<strong>é”®å€¼å‹</strong>ï¼Œæ˜¯æŒ‡Redisä¸­å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯ä»¥key.valueå¯¹çš„å½¢å¼å­˜å‚¨ï¼Œè€Œvalueçš„å½¢å¼å¤šç§å¤šæ ·ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²,æ•°å€¼,ç”šè‡³json</p><p>è€ŒNoSqlåˆ™æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è€Œè¨€ï¼Œæœ‰å¾ˆå¤§å·®å¼‚çš„ä¸€ç§æ•°æ®åº“ã€‚</p><p>å¯¹äºå­˜å‚¨çš„æ•°æ®ï¼Œæ²¡æœ‰ç±»ä¼¼Mysqlé‚£ä¹ˆä¸¥æ ¼çš„çº¦æŸï¼Œæ¯”å¦‚å”¯ä¸€æ€§ï¼Œæ˜¯å¦å¯ä»¥ä¸ºnullç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ç§æ¾æ•£ç»“æ„çš„æ•°æ®åº“ï¼Œç§°ä¹‹ä¸ºNoSQLæ•°æ®åº“ã€‚</p><h2 id="2-è¯¾ç¨‹ç›®å½•"><a href="#2-è¯¾ç¨‹ç›®å½•" class="headerlink" title="2.è¯¾ç¨‹ç›®å½•"></a>2.è¯¾ç¨‹ç›®å½•</h2><blockquote><ul><li>åˆå§‹Redis<ul><li>è®¤è¯†NoSQL</li><li>è®¤è¯†Redis</li><li>å®‰è£…Redis</li></ul></li><li>Rediså¸¸è§å‘½ä»¤<ul><li>5ç§å¸¸è§æ•°æ®ç»“æ„</li><li>é€šç”¨å‘½ä»¤</li><li>ä¸åŒæ•°æ®ç»“æ„çš„æ“ä½œå‘½ä»¤</li></ul></li><li>Redisçš„Javaå®¢æˆ·ç«¯<ul><li>Jediså®¢æˆ·ç«¯</li><li>SpringDataRediså®¢æˆ·ç«¯</li></ul></li></ul></blockquote><h2 id="3-åˆå§‹Redis"><a href="#3-åˆå§‹Redis" class="headerlink" title="3.åˆå§‹Redis"></a>3.åˆå§‹Redis</h2><h3 id="3-1-è®¤è¯†NoSQL"><a href="#3-1-è®¤è¯†NoSQL" class="headerlink" title="3.1.è®¤è¯†NoSQL"></a>3.1.è®¤è¯†NoSQL</h3><p><strong>NoSql</strong>å¯ä»¥ç¿»è¯‘åšNot Only Sqlï¼ˆä¸ä»…ä»…æ˜¯SQLï¼‰ï¼Œæˆ–è€…æ˜¯No Sqlï¼ˆéSqlçš„ï¼‰æ•°æ®åº“ã€‚æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“è€Œè¨€ï¼Œæœ‰å¾ˆå¤§å·®å¼‚çš„ä¸€ç§ç‰¹æ®Šçš„æ•°æ®åº“ï¼Œå› æ­¤ä¹Ÿç§°ä¹‹ä¸º<strong>éå…³ç³»å‹æ•°æ®åº“</strong>ã€‚</p><h4 id="3-1-1-ç»“æ„åŒ–ä¸éç»“æ„åŒ–"><a href="#3-1-1-ç»“æ„åŒ–ä¸éç»“æ„åŒ–" class="headerlink" title="3.1.1.ç»“æ„åŒ–ä¸éç»“æ„åŒ–"></a>3.1.1.ç»“æ„åŒ–ä¸éç»“æ„åŒ–</h4><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œæ¯ä¸€å¼ è¡¨éƒ½æœ‰ä¸¥æ ¼çš„çº¦æŸä¿¡æ¯ï¼šå­—æ®µå.å­—æ®µæ•°æ®ç±»å‹.å­—æ®µçº¦æŸç­‰ç­‰ä¿¡æ¯ï¼Œæ’å…¥çš„æ•°æ®å¿…é¡»éµå®ˆè¿™äº›çº¦æŸ</p><p>è€ŒNoSqlåˆ™å¯¹æ•°æ®åº“æ ¼å¼æ²¡æœ‰ä¸¥æ ¼çº¦æŸï¼Œå¾€å¾€å½¢å¼æ¾æ•£ï¼Œè‡ªç”±ã€‚</p><p>å¯ä»¥æ˜¯é”®å€¼å‹,ä¹Ÿå¯ä»¥æ˜¯æ–‡æ¡£å‹,ç”šè‡³å¯ä»¥æ˜¯å›¾æ ¼å¼</p><h4 id="3-1-2-å…³è”å’Œéå…³è”"><a href="#3-1-2-å…³è”å’Œéå…³è”" class="headerlink" title="3.1.2.å…³è”å’Œéå…³è”"></a>3.1.2.å…³è”å’Œéå…³è”</h4><p>ä¼ ç»Ÿæ•°æ®åº“çš„è¡¨ä¸è¡¨ä¹‹é—´å¾€å¾€å­˜åœ¨å…³è”ï¼Œæ¯”å¦‚å­˜åœ¨å¤–é”®çš„å½¢å¼</p><p>è€Œéå…³ç³»å‹æ•°æ®åº“ä¸å­˜åœ¨å…³è”å…³ç³»ï¼Œè¦ç»´æŠ¤å…³ç³»è¦ä¹ˆé ä»£ç ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¦ä¹ˆé æ•°æ®ä¹‹é—´çš„è€¦åˆï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  name<span class="punctuation">:</span> <span class="string">&quot;å¼ ä¸‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">  orders<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">       id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">       item<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> id<span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> title<span class="punctuation">:</span> <span class="string">&quot;è£è€€6&quot;</span><span class="punctuation">,</span> price<span class="punctuation">:</span> <span class="number">4999</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">       id<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">       item<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> id<span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> title<span class="punctuation">:</span> <span class="string">&quot;å°ç±³11&quot;</span><span class="punctuation">,</span> price<span class="punctuation">:</span> <span class="number">3999</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤„è¦ç»´æŠ¤â€œå¼ ä¸‰â€çš„è®¢å•ä¸å•†å“â€œè£è€€â€å’Œâ€œå°ç±³11â€çš„å…³ç³»ï¼Œä¸å¾—ä¸å†—ä½™çš„å°†è¿™ä¸¤ä¸ªå•†å“ä¿å­˜åœ¨å¼ ä¸‰çš„è®¢å•æ–‡æ¡£ä¸­ï¼Œä¸å¤Ÿä¼˜é›…ã€‚è¿˜æ˜¯å»ºè®®ç”¨ä¸šåŠ¡æ¥ç»´æŠ¤å…³è”å…³ç³»ã€‚</p><h4 id="3-1-3-æŸ¥è¯¢æ–¹å¼"><a href="#3-1-3-æŸ¥è¯¢æ–¹å¼" class="headerlink" title="3.1.3.æŸ¥è¯¢æ–¹å¼"></a>3.1.3.æŸ¥è¯¢æ–¹å¼</h4><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ä¼šåŸºäºSqlè¯­å¥åšæŸ¥è¯¢ï¼Œè¯­æ³•æœ‰ç»Ÿä¸€æ ‡å‡†ï¼›</p><p>è€Œä¸åŒçš„éå…³ç³»æ•°æ®åº“æŸ¥è¯¢è¯­æ³•å·®å¼‚æå¤§ï¼Œäº”èŠ±å…«é—¨å„ç§å„æ ·ã€‚</p><h4 id="3-1-4-äº‹åŠ¡"><a href="#3-1-4-äº‹åŠ¡" class="headerlink" title="3.1.4.äº‹åŠ¡"></a>3.1.4.äº‹åŠ¡</h4><p>ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“èƒ½æ»¡è¶³äº‹åŠ¡ACIDçš„åŸåˆ™ã€‚</p><p>è€Œéå…³ç³»å‹æ•°æ®åº“å¾€å¾€ä¸æ”¯æŒäº‹åŠ¡ï¼Œæˆ–è€…ä¸èƒ½ä¸¥æ ¼ä¿è¯ACIDçš„ç‰¹æ€§ï¼Œåªèƒ½å®ç°åŸºæœ¬çš„ä¸€è‡´æ€§ã€‚</p><h4 id="3-1-5-æ€»ç»“"><a href="#3-1-5-æ€»ç»“" class="headerlink" title="3.1.5.æ€»ç»“"></a>3.1.5.æ€»ç»“</h4><p>é™¤äº†ä¸Šè¿°å››ç‚¹ä»¥å¤–ï¼Œåœ¨å­˜å‚¨æ–¹å¼.æ‰©å±•æ€§.æŸ¥è¯¢æ€§èƒ½ä¸Šå…³ç³»å‹ä¸éå…³ç³»å‹ä¹Ÿéƒ½æœ‰ç€æ˜¾è‘—å·®å¼‚ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>å­˜å‚¨æ–¹å¼<ul><li>å…³ç³»å‹æ•°æ®åº“åŸºäºç£ç›˜è¿›è¡Œå­˜å‚¨ï¼Œä¼šæœ‰å¤§é‡çš„ç£ç›˜IOï¼Œå¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“</li><li>éå…³ç³»å‹æ•°æ®åº“ï¼Œä»–ä»¬çš„æ“ä½œæ›´å¤šçš„æ˜¯ä¾èµ–äºå†…å­˜æ¥æ“ä½œï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦ä¼šéå¸¸å¿«ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå¥½ä¸€äº›</li></ul></li></ul><ul><li>æ‰©å±•æ€§<ul><li>å…³ç³»å‹æ•°æ®åº“é›†ç¾¤æ¨¡å¼ä¸€èˆ¬æ˜¯ä¸»ä»ï¼Œä¸»ä»æ•°æ®ä¸€è‡´ï¼Œèµ·åˆ°æ•°æ®å¤‡ä»½çš„ä½œç”¨ï¼Œç§°ä¸ºå‚ç›´æ‰©å±•ã€‚</li><li>éå…³ç³»å‹æ•°æ®åº“å¯ä»¥å°†æ•°æ®æ‹†åˆ†ï¼Œå­˜å‚¨åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œå¯ä»¥ä¿å­˜æµ·é‡æ•°æ®ï¼Œè§£å†³å†…å­˜å¤§å°æœ‰é™çš„é—®é¢˜ã€‚ç§°ä¸ºæ°´å¹³æ‰©å±•ã€‚</li><li>å…³ç³»å‹æ•°æ®åº“å› ä¸ºè¡¨ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼Œå¦‚æœåšæ°´å¹³æ‰©å±•ä¼šç»™æ•°æ®æŸ¥è¯¢å¸¦æ¥å¾ˆå¤šéº»çƒ¦</li></ul></li></ul><h3 id="3-2-è®¤è¯†Redis"><a href="#3-2-è®¤è¯†Redis" class="headerlink" title="3.2.è®¤è¯†Redis"></a>3.2.è®¤è¯†Redis</h3><p>Redisè¯ç”Ÿäº2009å¹´å…¨ç§°æ˜¯<strong>Re</strong>mote  <strong>D</strong>ictionary <strong>S</strong>erver è¿œç¨‹è¯å…¸æœåŠ¡å™¨ï¼Œæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é”®å€¼å‹NoSQLæ•°æ®åº“ã€‚</p><p><strong>ç‰¹å¾</strong>ï¼š</p><ul><li>é”®å€¼ï¼ˆkey-valueï¼‰å‹ï¼Œvalueæ”¯æŒå¤šç§ä¸åŒæ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸°å¯Œ</li><li>å•çº¿ç¨‹ï¼Œæ¯ä¸ªå‘½ä»¤å…·å¤‡åŸå­æ€§</li><li>ä½å»¶è¿Ÿï¼Œé€Ÿåº¦å¿«ï¼ˆåŸºäºå†…å­˜.IOå¤šè·¯å¤ç”¨.è‰¯å¥½çš„ç¼–ç ï¼‰ã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ”¯æŒä¸»ä»é›†ç¾¤.åˆ†ç‰‡é›†ç¾¤</li><li>æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯</li></ul><p>Redisçš„å®˜æ–¹ç½‘ç«™åœ°å€ï¼š<a href="https://redis.io/">https://redis.io/</a></p><h3 id="3-3-å®‰è£…Redis"><a href="#3-3-å®‰è£…Redis" class="headerlink" title="3.3.å®‰è£…Redis"></a>3.3.å®‰è£…Redis</h3><p>å¤§å¤šæ•°ä¼ä¸šéƒ½æ˜¯åŸºäºLinuxæœåŠ¡å™¨æ¥éƒ¨ç½²é¡¹ç›®ï¼Œè€Œä¸”Rediså®˜æ–¹ä¹Ÿæ²¡æœ‰æä¾›Windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ã€‚å› æ­¤è¯¾ç¨‹ä¸­æˆ‘ä»¬ä¼šåŸºäºLinuxç³»ç»Ÿæ¥å®‰è£…Redis.</p><p>æ­¤å¤„é€‰æ‹©çš„Linuxç‰ˆæœ¬ä¸ºCentOS 7.</p><h4 id="3-3-1-ä¾èµ–åº“"><a href="#3-3-1-ä¾èµ–åº“" class="headerlink" title="3.3.1.ä¾èµ–åº“"></a>3.3.1.ä¾èµ–åº“</h4><p>Redisæ˜¯åŸºäºCè¯­è¨€ç¼–å†™çš„ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å®‰è£…Redisæ‰€éœ€è¦çš„gccä¾èµ–ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc tcl</span><br></pre></td></tr></table></figure><h4 id="3-3-2-ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹"><a href="#3-3-2-ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹" class="headerlink" title="3.3.2.ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹"></a>3.3.2.ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹</h4><p>ç„¶åå°†è¯¾å‰èµ„æ–™æä¾›çš„Rediså®‰è£…åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•</p><p>å¦‚æœæ²¡æ¸ é“è·å–å¯ä»¥è”ç³»æˆ‘</p><p>è§£å‹ç¼©ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf redis-6.2.6.tar.gz</span><br></pre></td></tr></table></figure><p>è§£å‹åï¼Œè¿›å…¥redisç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis-6.2.6</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><p>é»˜è®¤çš„å®‰è£…è·¯å¾„æ˜¯åœ¨ <code>/usr/local/bin</code>ç›®å½•ä¸‹</p><p>è¯¥ç›®å½•å·²ç»é»˜è®¤é…ç½®åˆ°ç¯å¢ƒå˜é‡ï¼Œå› æ­¤å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹è¿è¡Œè¿™äº›å‘½ä»¤ã€‚å…¶ä¸­ï¼š</p><ul><li>redis-cliï¼šæ˜¯redisæä¾›çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>redis-serverï¼šæ˜¯redisçš„æœåŠ¡ç«¯å¯åŠ¨è„šæœ¬</li><li>redis-sentinelï¼šæ˜¯redisçš„å“¨å…µå¯åŠ¨è„šæœ¬</li></ul><h4 id="3-3-3-å¯åŠ¨"><a href="#3-3-3-å¯åŠ¨" class="headerlink" title="3.3.3.å¯åŠ¨"></a>3.3.3.å¯åŠ¨</h4><p>redisçš„å¯åŠ¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>é»˜è®¤å¯åŠ¨</li><li>æŒ‡å®šé…ç½®å¯åŠ¨</li><li>å¼€æœºè‡ªå¯</li></ul><h4 id="3-3-4-é»˜è®¤å¯åŠ¨"><a href="#3-3-4-é»˜è®¤å¯åŠ¨" class="headerlink" title="3.3.4.é»˜è®¤å¯åŠ¨"></a>3.3.4.é»˜è®¤å¯åŠ¨</h4><p>å®‰è£…å®Œæˆåï¼Œåœ¨ä»»æ„ç›®å½•è¾“å…¥redis-serverå‘½ä»¤å³å¯å¯åŠ¨Redisï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="https://i.imgur.com/v7xWsqC.png" alt=""></p><p>è¿™ç§å¯åŠ¨å±äº<code>å‰å°å¯åŠ¨</code>ï¼Œä¼šé˜»å¡æ•´ä¸ªä¼šè¯çª—å£ï¼Œçª—å£å…³é—­æˆ–è€…æŒ‰ä¸‹<code>CTRL + C</code>åˆ™Redisåœæ­¢ã€‚ä¸æ¨èä½¿ç”¨ã€‚</p><h4 id="3-3-5-æŒ‡å®šé…ç½®å¯åŠ¨"><a href="#3-3-5-æŒ‡å®šé…ç½®å¯åŠ¨" class="headerlink" title="3.3.5.æŒ‡å®šé…ç½®å¯åŠ¨"></a>3.3.5.æŒ‡å®šé…ç½®å¯åŠ¨</h4><p>å¦‚æœè¦è®©Redisä»¥<code>åå°</code>æ–¹å¼å¯åŠ¨ï¼Œåˆ™å¿…é¡»ä¿®æ”¹Redisé…ç½®æ–‡ä»¶ï¼Œå°±åœ¨æˆ‘ä»¬ä¹‹å‰è§£å‹çš„rediså®‰è£…åŒ…ä¸‹ï¼ˆ<code>/usr/local/src/redis-6.2.6</code>ï¼‰ï¼Œåå­—å«redis.confï¼š</p><p><em>æ³¨æ„ï¼šä¸€ä¸ªæ˜¯é…ç½®æ–‡ä»¶åœ¨srcçš„å®‰è£…åŒ…ä¸‹ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯redisæœåŠ¡éƒ½æ˜¯åœ¨binä¸‹</em></p><p>æˆ‘ä»¬å…ˆå°†è¿™ä¸ªé…ç½®æ–‡ä»¶å¤‡ä»½ä¸€ä»½ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf redis.conf.bck</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span></span><br><span class="line"><span class="attr">bind</span> <span class="string">0.0.0.0</span></span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes </span></span><br><span class="line"><span class="comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">123321</span></span><br></pre></td></tr></table></figure><p>Redisçš„å…¶å®ƒå¸¸è§é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›‘å¬çš„ç«¯å£</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br><span class="line"><span class="comment"># å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œredis-serveræ—¶çš„å‘½ä»¤ï¼Œæ—¥å¿—.æŒä¹…åŒ–ç­‰æ–‡ä»¶ä¼šä¿å­˜åœ¨è¿™ä¸ªç›®å½•</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">.</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1ï¼Œä»£è¡¨åªä½¿ç”¨1ä¸ªåº“ï¼Œé»˜è®¤æœ‰16ä¸ªåº“ï¼Œç¼–å·0~15</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">1</span></span><br><span class="line"><span class="comment"># è®¾ç½®redisèƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜</span></span><br><span class="line"><span class="attr">maxmemory</span> <span class="string">512mb</span></span><br><span class="line"><span class="comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;redis.log&quot;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨Redisï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥rediså®‰è£…ç›®å½• </span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/src/redis-6.2.6</span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure><p>åœæ­¢æœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨redis-cliæ¥æ‰§è¡Œ shutdown å‘½ä»¤ï¼Œå³å¯åœæ­¢ Redis æœåŠ¡ï¼Œ</span></span><br><span class="line"><span class="comment"># å› ä¸ºä¹‹å‰é…ç½®äº†å¯†ç ï¼Œå› æ­¤éœ€è¦é€šè¿‡ -u æ¥æŒ‡å®šå¯†ç </span></span><br><span class="line">redis-cli -u 123321 shutdown</span><br></pre></td></tr></table></figure><h4 id="3-3-6-å¼€æœºè‡ªå¯"><a href="#3-3-6-å¼€æœºè‡ªå¯" class="headerlink" title="3.3.6.å¼€æœºè‡ªå¯"></a>3.3.6.å¼€æœºè‡ªå¯</h4><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ¥å®ç°å¼€æœºè‡ªå¯ã€‚</p><p>é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªç³»ç»ŸæœåŠ¡æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/systemd/system/redis.service</span><br></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>ç„¶åé‡è½½ç³»ç»ŸæœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ç»„å‘½ä»¤æ¥æ“ä½œredisäº†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">systemctl start redis</span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">systemctl stop redis</span><br><span class="line"><span class="comment"># é‡å¯</span></span><br><span class="line">systemctl restart redis</span><br><span class="line"><span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">systemctl status redis</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥è®©rediså¼€æœºè‡ªå¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> redis</span><br></pre></td></tr></table></figure><h3 id="3-4-Redisæ¡Œé¢å®¢æˆ·ç«¯"><a href="#3-4-Redisæ¡Œé¢å®¢æˆ·ç«¯" class="headerlink" title="3.4.Redisæ¡Œé¢å®¢æˆ·ç«¯"></a>3.4.Redisæ¡Œé¢å®¢æˆ·ç«¯</h3><p>å®‰è£…å®ŒæˆRedisï¼Œæˆ‘ä»¬å°±å¯ä»¥æ“ä½œRedisï¼Œå®ç°æ•°æ®çš„CRUDäº†ã€‚è¿™éœ€è¦ç”¨åˆ°Rediså®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯</li><li>ç¼–ç¨‹å®¢æˆ·ç«¯</li></ul><h4 id="3-4-1-Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯"><a href="#3-4-1-Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯" class="headerlink" title="3.4.1.Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯"></a>3.4.1.Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</h4><p>Rediså®‰è£…å®Œæˆåå°±è‡ªå¸¦äº†å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šredis-cliï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [options] [commonds]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¸¸è§çš„optionsæœ‰ï¼š</p><ul><li><code>-h 127.0.0.1</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„IPåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1</li><li><code>-p 6379</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6379</li><li><code>-a 123321</code>ï¼šæŒ‡å®šredisçš„è®¿é—®å¯†ç  </li></ul><p>å…¶ä¸­çš„commondså°±æ˜¯Redisçš„æ“ä½œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>ping</code>ï¼šä¸redisæœåŠ¡ç«¯åšå¿ƒè·³æµ‹è¯•ï¼ŒæœåŠ¡ç«¯æ­£å¸¸ä¼šè¿”å›<code>pong</code></li></ul><p>ä¸æŒ‡å®šcommondæ—¶ï¼Œä¼šè¿›å…¥<code>redis-cli</code>çš„äº¤äº’æ§åˆ¶å°ï¼š</p><p><img src="https://i.imgur.com/OYYWPNo.png" alt=""></p><h4 id="3-4-2-å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯"><a href="#3-4-2-å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯" class="headerlink" title="3.4.2.å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯"></a>3.4.2.å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯</h4><p>GitHubä¸Šçš„å¤§ç¥ç¼–å†™äº†Redisçš„å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯ï¼Œåœ°å€ï¼š<a href="https://github.com/uglide/RedisDesktopManager">https://github.com/uglide/RedisDesktopManager</a></p><p>ä¸è¿‡è¯¥ä»“åº“æä¾›çš„æ˜¯RedisDesktopManagerçš„æºç ï¼Œå¹¶æœªæä¾›windowså®‰è£…åŒ…ã€‚</p><p>åœ¨ä¸‹é¢è¿™ä¸ªä»“åº“å¯ä»¥æ‰¾åˆ°å®‰è£…åŒ…ï¼š<a href="https://github.com/lework/RedisDesktopManager-Windows/releases">https://github.com/lework/RedisDesktopManager-Windows/releases</a></p><p>æ¥ä¸‹æ¥ç›´æ¥å®‰è£…å³å¯ï¼Œå‚»ç“œå¼å®‰è£…</p><p>Redisé»˜è®¤æœ‰16ä¸ªä»“åº“ï¼Œç¼–å·ä»0è‡³15.  é€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥è®¾ç½®ä»“åº“æ•°é‡ï¼Œä½†æ˜¯ä¸è¶…è¿‡16ï¼Œå¹¶ä¸”ä¸èƒ½è‡ªå®šä¹‰ä»“åº“åç§°ã€‚</p><p>å¦‚æœæ˜¯åŸºäºredis-cliè¿æ¥RedisæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡selectå‘½ä»¤æ¥é€‰æ‹©æ•°æ®åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€‰æ‹© 0å·åº“</span></span><br><span class="line">select 0</span><br></pre></td></tr></table></figure><h2 id="4-Rediså¸¸è§å‘½ä»¤"><a href="#4-Rediså¸¸è§å‘½ä»¤" class="headerlink" title="4.Rediså¸¸è§å‘½ä»¤"></a>4.Rediså¸¸è§å‘½ä»¤</h2><h3 id="4-1-Redisæ•°æ®ç»“æ„ä»‹ç»"><a href="#4-1-Redisæ•°æ®ç»“æ„ä»‹ç»" class="headerlink" title="4.1 Redisæ•°æ®ç»“æ„ä»‹ç»"></a>4.1 Redisæ•°æ®ç»“æ„ä»‹ç»</h3><p>Redisæ˜¯ä¸€ä¸ªkey-valueçš„æ•°æ®åº“ï¼Œkeyä¸€èˆ¬æ˜¯Stringç±»å‹ï¼Œä¸è¿‡valueçš„ç±»å‹å¤šç§å¤šæ ·ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221215191144.png" alt=""></p><p><strong>å°tipsï¼šå‘½ä»¤ä¸è¦æ­»è®°ï¼Œå­¦ä¼šæŸ¥è¯¢å°±å¥½å•¦</strong></p><h3 id="4-2-Redis-é€šç”¨å‘½ä»¤"><a href="#4-2-Redis-é€šç”¨å‘½ä»¤" class="headerlink" title="4.2 Redis é€šç”¨å‘½ä»¤"></a>4.2 Redis é€šç”¨å‘½ä»¤</h3><p>é€šç”¨æŒ‡ä»¤æ˜¯éƒ¨åˆ†æ•°æ®ç±»å‹çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>KEYSï¼šæŸ¥çœ‹ç¬¦åˆæ¨¡æ¿çš„æ‰€æœ‰key</li><li>DELï¼šåˆ é™¤ä¸€ä¸ªæŒ‡å®šçš„key</li><li>EXISTSï¼šåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</li><li>EXPIREï¼šç»™ä¸€ä¸ªkeyè®¾ç½®æœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°æœŸæ—¶è¯¥keyä¼šè¢«è‡ªåŠ¨åˆ é™¤</li><li>TTLï¼šæŸ¥çœ‹ä¸€ä¸ªKEYçš„å‰©ä½™æœ‰æ•ˆæœŸ</li></ul><p>é€šè¿‡help [command] å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªå‘½ä»¤çš„å…·ä½“ç”¨æ³•ï¼Œä¾‹å¦‚ï¼š</p><ul><li>KEYS</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;age&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥è¯¢ä»¥aå¼€å¤´çš„key</span></span><br><span class="line">127.0.0.1:6379&gt; keys a*</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p><strong>è´´å¿ƒå°æç¤ºï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä¸æ¨èä½¿ç”¨keys å‘½ä»¤ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤åœ¨keyè¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡ä¸é«˜</strong></p><ul><li>DEL</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> del</span><br><span class="line"></span><br><span class="line">  DEL key [key ...]</span><br><span class="line">  summary: Delete a key</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: generic</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; del name <span class="comment">#åˆ é™¤å•ä¸ª</span></span><br><span class="line">(<span class="built_in">integer</span>) 1  <span class="comment">#æˆåŠŸåˆ é™¤1ä¸ª</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;age&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; MSET k1 v1 k2 v2 k3 v3 <span class="comment">#æ‰¹é‡æ·»åŠ æ•°æ®</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) <span class="string">&quot;k3&quot;</span></span><br><span class="line">2) <span class="string">&quot;k2&quot;</span></span><br><span class="line">3) <span class="string">&quot;k1&quot;</span></span><br><span class="line">4) <span class="string">&quot;age&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; del k1 k2 k3 k4</span><br><span class="line">(<span class="built_in">integer</span>) 3   <span class="comment">#æ­¤å¤„è¿”å›çš„æ˜¯æˆåŠŸåˆ é™¤çš„keyï¼Œç”±äºredisä¸­åªæœ‰k1,k2,k3 æ‰€ä»¥åªæˆåŠŸåˆ é™¤3ä¸ªï¼Œæœ€ç»ˆè¿”å›</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys * <span class="comment">#å†æŸ¥è¯¢å…¨éƒ¨çš„key</span></span><br><span class="line">1) <span class="string">&quot;age&quot;</span><span class="comment">#åªå‰©ä¸‹ä¸€ä¸ªäº†</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p><strong>è´´å¿ƒå°æç¤ºï¼šåŒå­¦ä»¬åœ¨æ‹·è´ä»£ç çš„æ—¶å€™ï¼Œåªéœ€è¦æ‹·è´å¯¹åº”çš„å‘½ä»¤å“¦~</strong></p><ul><li>EXISTS</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">help</span> EXISTS</span><br><span class="line"></span><br><span class="line">  EXISTS key [key ...]</span><br><span class="line">  summary: Determine <span class="keyword">if</span> a key exists</span><br><span class="line">  since: 1.0.0</span><br><span class="line">  group: generic</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; exists name</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure><ul><li>EXPIRE </li></ul><p><strong>è´´å¿ƒå°æç¤º</strong>ï¼šå†…å­˜éå¸¸å®è´µï¼Œå¯¹äºä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬åº”å½“ç»™ä»–ä¸€äº›è¿‡æœŸæ—¶é—´ï¼Œå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œä»–å°±ä¼šè‡ªåŠ¨è¢«åˆ é™¤~</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; expire age 10</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -2  <span class="comment">#å½“è¿™ä¸ªkeyè¿‡æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶æŸ¥è¯¢å‡ºæ¥å°±æ˜¯-2 </span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> age 10 <span class="comment">#å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl age</span><br><span class="line">(<span class="built_in">integer</span>) -1  <span class="comment"># ttlçš„è¿”å›å€¼å°±æ˜¯-1</span></span><br></pre></td></tr></table></figure><h3 id="4-3-Rediså‘½ä»¤-Stringå‘½ä»¤"><a href="#4-3-Rediså‘½ä»¤-Stringå‘½ä»¤" class="headerlink" title="4.3 Rediså‘½ä»¤-Stringå‘½ä»¤"></a>4.3 Rediså‘½ä»¤-Stringå‘½ä»¤</h3><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221216212916.png" alt=""></p><p>Stringçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><ul><li>SETï¼šæ·»åŠ æˆ–è€…ä¿®æ”¹å·²ç»å­˜åœ¨çš„ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹</li><li>GETï¼šæ ¹æ®keyè·å–Stringç±»å‹çš„value</li><li>MSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªStringç±»å‹çš„é”®å€¼å¯¹</li><li>MGETï¼šæ ¹æ®å¤šä¸ªkeyè·å–å¤šä¸ªStringç±»å‹çš„value</li><li>INCRï¼šè®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢1</li><li>INCRBY:è®©ä¸€ä¸ªæ•´å‹çš„keyè‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿ï¼Œä¾‹å¦‚ï¼šincrby num 2 è®©numå€¼è‡ªå¢2</li><li>INCRBYFLOATï¼šè®©ä¸€ä¸ªæµ®ç‚¹ç±»å‹çš„æ•°å­—è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</li><li>SETNXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå‰ææ˜¯è¿™ä¸ªkeyä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</li><li>SETEXï¼šæ·»åŠ ä¸€ä¸ªStringç±»å‹çš„é”®å€¼å¯¹ï¼Œå¹¶ä¸”æŒ‡å®šæœ‰æ•ˆæœŸ</li></ul><p><strong>è´´å¿ƒå°æç¤º</strong>ï¼šä»¥ä¸Šå‘½ä»¤é™¤äº†INCRBYFLOAT éƒ½æ˜¯å¸¸ç”¨å‘½ä»¤</p><ul><li>SET å’ŒGET: å¦‚æœkeyä¸å­˜åœ¨åˆ™æ˜¯æ–°å¢ï¼Œå¦‚æœå­˜åœ¨åˆ™æ˜¯ä¿®æ”¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name Rose  <span class="comment">//åŸæ¥ä¸å­˜åœ¨</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name </span><br><span class="line"><span class="string">&quot;Rose&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name Jack <span class="comment">//åŸæ¥å­˜åœ¨ï¼Œå°±æ˜¯ä¿®æ”¹</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name</span><br><span class="line"><span class="string">&quot;Jack&quot;</span></span><br></pre></td></tr></table></figure><ul><li>MSETå’ŒMGET</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; MSET k1 v1 k2 v2 k3 v3</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; MGET name age k1 k2 k3</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Jack&quot;</span> <span class="comment">//ä¹‹å‰å­˜åœ¨çš„name</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;10&quot;</span>   <span class="comment">//ä¹‹å‰å­˜åœ¨çš„age</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;v1&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;v2&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;v3&quot;</span></span><br></pre></td></tr></table></figure><ul><li>INCRå’ŒINCRBYå’ŒDECY</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get age </span><br><span class="line"><span class="string">&quot;10&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incr age <span class="comment">//å¢åŠ 1</span></span><br><span class="line">(integer) <span class="number">11</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get age <span class="comment">//è·å¾—age</span></span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age <span class="number">2</span> <span class="comment">//ä¸€æ¬¡å¢åŠ 2</span></span><br><span class="line">(integer) <span class="number">13</span> <span class="comment">//è¿”å›ç›®å‰çš„ageçš„å€¼</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age <span class="number">2</span></span><br><span class="line">(integer) <span class="number">15</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age -<span class="number">1</span> <span class="comment">//ä¹Ÿå¯ä»¥å¢åŠ è´Ÿæ•°ï¼Œç›¸å½“äºå‡</span></span><br><span class="line">(integer) <span class="number">14</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; incrby age -<span class="number">2</span> <span class="comment">//ä¸€æ¬¡å‡å°‘2ä¸ª</span></span><br><span class="line">(integer) <span class="number">12</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; DECR age <span class="comment">//ç›¸å½“äº incr è´Ÿæ•°ï¼Œå‡å°‘æ­£å¸¸ç”¨æ³•</span></span><br><span class="line">(integer) <span class="number">11</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get age </span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>SETNX</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; help setnx</span><br><span class="line"></span><br><span class="line">  SETNX key value</span><br><span class="line">  summary: Set the value of a key, only <span class="keyword">if</span> the key does not exist</span><br><span class="line">  since: <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  group: string</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; set name Jack  <span class="comment">//è®¾ç½®åç§°</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; setnx name lisi <span class="comment">//å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ æˆåŠŸ</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name <span class="comment">//ç”±äºnameå·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥lisiçš„æ“ä½œå¤±è´¥</span></span><br><span class="line"><span class="string">&quot;Jack&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; setnx name2 lisi <span class="comment">//name2 ä¸å­˜åœ¨ï¼Œæ‰€ä»¥æ“ä½œæˆåŠŸ</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; get name2 </span><br><span class="line"><span class="string">&quot;lisi&quot;</span></span><br></pre></td></tr></table></figure><ul><li>SETEX</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setex name 10 jack</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 8</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure><h3 id="4-4-Rediså‘½ä»¤-Keyçš„å±‚çº§ç»“æ„"><a href="#4-4-Rediså‘½ä»¤-Keyçš„å±‚çº§ç»“æ„" class="headerlink" title="4.4 Rediså‘½ä»¤-Keyçš„å±‚çº§ç»“æ„"></a>4.4 Rediså‘½ä»¤-Keyçš„å±‚çº§ç»“æ„</h3><p>Redisæ²¡æœ‰ç±»ä¼¼MySQLä¸­çš„Tableçš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åŒºåˆ†ä¸åŒç±»å‹çš„keyå‘¢ï¼Ÿ</p><p>ä¾‹å¦‚ï¼Œéœ€è¦å­˜å‚¨ç”¨æˆ·.å•†å“ä¿¡æ¯åˆ°redisï¼Œæœ‰ä¸€ä¸ªç”¨æˆ·idæ˜¯1ï¼Œæœ‰ä¸€ä¸ªå•†å“idæ°å¥½ä¹Ÿæ˜¯1ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨idä½œä¸ºkeyï¼Œé‚£å°±ä¼šå†²çªäº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™keyæ·»åŠ å‰ç¼€åŠ ä»¥åŒºåˆ†ï¼Œä¸è¿‡è¿™ä¸ªå‰ç¼€ä¸æ˜¯éšä¾¿åŠ çš„ï¼Œæœ‰ä¸€å®šçš„è§„èŒƒï¼š</p><p>Redisçš„keyå…è®¸æœ‰å¤šä¸ªå•è¯å½¢æˆå±‚çº§ç»“æ„ï¼Œå¤šä¸ªå•è¯ä¹‹é—´ç”¨â€™:â€™éš”å¼€ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221216214910.png" alt=""></p><p>è¿™ä¸ªæ ¼å¼å¹¶éå›ºå®šï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥åˆ é™¤æˆ–æ·»åŠ è¯æ¡ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„é¡¹ç›®åç§°å« heimaï¼Œæœ‰userå’Œproductä¸¤ç§ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰keyï¼š</p><ul><li><p>userç›¸å…³çš„keyï¼š<strong>heima:user:1</strong></p></li><li><p>productç›¸å…³çš„keyï¼š<strong>heima:product:1</strong></p></li></ul><p>å¦‚æœValueæ˜¯ä¸€ä¸ªJavaå¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªUserå¯¹è±¡ï¼Œåˆ™å¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²åå­˜å‚¨ï¼š</p><div class="table-container"><table><thead><tr><th><strong>KEY</strong></th><th><strong>VALUE</strong></th></tr></thead><tbody><tr><td>heima:user:1</td><td>{â€œidâ€:1, â€œnameâ€: â€œJackâ€, â€œageâ€: 21}</td></tr><tr><td>heima:product:1</td><td>{â€œidâ€:1, â€œnameâ€: â€œå°ç±³11â€, â€œpriceâ€: 4999}</td></tr></tbody></table></div><p>ä¸€æ—¦æˆ‘ä»¬å‘redisé‡‡ç”¨è¿™æ ·çš„æ–¹å¼å­˜å‚¨ï¼Œé‚£ä¹ˆåœ¨å¯è§†åŒ–ç•Œé¢ä¸­ï¼Œredisä¼šä»¥å±‚çº§ç»“æ„æ¥è¿›è¡Œå­˜å‚¨ï¼Œå½¢æˆç±»ä¼¼äºè¿™æ ·çš„ç»“æ„ï¼Œæ›´åŠ æ–¹ä¾¿Redisè·å–æ•°æ®</p><p>å¯è§†åŒ–ç•Œé¢ä¸­æ˜¯è¿™æ ·ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221216214659.png" alt=""></p><h3 id="4-5-Rediså‘½ä»¤-Hashå‘½ä»¤"><a href="#4-5-Rediså‘½ä»¤-Hashå‘½ä»¤" class="headerlink" title="4.5 Rediså‘½ä»¤-Hashå‘½ä»¤"></a>4.5 Rediså‘½ä»¤-Hashå‘½ä»¤</h3><p>Hashç±»å‹ï¼Œä¹Ÿå«æ•£åˆ—ï¼Œå…¶valueæ˜¯ä¸€ä¸ªæ— åºå­—å…¸ï¼Œç±»ä¼¼äºJavaä¸­çš„HashMapç»“æ„ã€‚</p><p>Stringç»“æ„æ˜¯å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²åå­˜å‚¨ï¼Œå½“éœ€è¦ä¿®æ”¹å¯¹è±¡æŸä¸ªå­—æ®µæ—¶å¾ˆä¸æ–¹ä¾¿ä½†æ˜¯Hashç»“æ„å¯ä»¥å°†å¯¹è±¡ä¸­çš„æ¯ä¸ªå­—æ®µç‹¬ç«‹å­˜å‚¨ï¼Œå¯ä»¥é’ˆå¯¹å•ä¸ªå­—æ®µåšCRUDï¼š</p><p>æˆ‘çš„ç†è§£æ˜¯é”®å€¼å¯¹ç±»å‹ï¼Œå¯ä»¥ä¿®æ”¹å¯¹åº”çš„å­—æ®µçš„å€¼ã€‚</p><p><strong>Hashç±»å‹çš„å¸¸è§å‘½ä»¤</strong></p><ul><li><p>HSET key field valueï¼šæ·»åŠ æˆ–è€…ä¿®æ”¹hashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HGET key fieldï¼šè·å–ä¸€ä¸ªhashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HMSETï¼šæ‰¹é‡æ·»åŠ å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HMGETï¼šæ‰¹é‡è·å–å¤šä¸ªhashç±»å‹keyçš„fieldçš„å€¼</p></li><li><p>HGETALLï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„fieldå’Œvalue</p></li><li>HKEYSï¼šè·å–ä¸€ä¸ªhashç±»å‹çš„keyä¸­çš„æ‰€æœ‰çš„field</li><li>HINCRBY:è®©ä¸€ä¸ªhashç±»å‹keyçš„å­—æ®µå€¼è‡ªå¢å¹¶æŒ‡å®šæ­¥é•¿</li><li>HSETNXï¼šæ·»åŠ ä¸€ä¸ªhashç±»å‹çš„keyçš„fieldå€¼ï¼Œå‰ææ˜¯è¿™ä¸ªfieldä¸å­˜åœ¨ï¼Œå¦åˆ™ä¸æ‰§è¡Œ</li></ul><p><strong>è´´å¿ƒå°æç¤º</strong>ï¼šå“ˆå¸Œç»“æ„ä¹Ÿæ˜¯æˆ‘ä»¬ä»¥åå®é™…å¼€å‘ä¸­å¸¸ç”¨çš„å‘½ä»¤å“Ÿ</p><ul><li>HSETå’ŒHGET</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSET heima:user:<span class="number">3</span> name Lucy<span class="comment">//å¤§keyæ˜¯ heima:user:3 å°keyæ˜¯nameï¼Œå°valueæ˜¯Lucy</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSET heima:user:<span class="number">3</span> age <span class="number">21</span><span class="comment">// å¦‚æœæ“ä½œä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ˜¯æ–°å¢</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSET heima:user:<span class="number">3</span> age <span class="number">17</span> <span class="comment">//å¦‚æœæ“ä½œå­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ˜¯ä¿®æ”¹</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGET heima:user:<span class="number">3</span> name </span><br><span class="line"><span class="string">&quot;Lucy&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGET heima:user:<span class="number">3</span> age</span><br><span class="line"><span class="string">&quot;17&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HMSETå’ŒHMGET</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMSET heima:user:<span class="number">4</span> name HanMeiMei</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMSET heima:user:<span class="number">4</span> name LiLei age <span class="number">20</span> sex man</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HMGET heima:user:<span class="number">4</span> name age sex</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HGETALL</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;sex&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HKEYSå’ŒHVALS</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HKEYS heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;sex&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HVALS heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;20&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;man&quot;</span></span><br></pre></td></tr></table></figure><ul><li>HINCRBY</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HINCRBY  heima:user:<span class="number">4</span> age <span class="number">2</span></span><br><span class="line">(integer) <span class="number">22</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HVALS heima:user:<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;LiLei&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;22&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;man&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HINCRBY  heima:user:<span class="number">4</span> age -<span class="number">2</span></span><br><span class="line">(integer) <span class="number">20</span></span><br></pre></td></tr></table></figure><ul><li>HSETNX</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSETNX heima:user4 sex <span class="title function_">woman</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL heima:user:<span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Lucy&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;17&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HSETNX heima:user:<span class="number">3</span> sex <span class="title function_">woman</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; HGETALL heima:user:<span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Lucy&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;17&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;sex&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;woman&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-6-Rediså‘½ä»¤-Listå‘½ä»¤"><a href="#4-6-Rediså‘½ä»¤-Listå‘½ä»¤" class="headerlink" title="4.6 Rediså‘½ä»¤-Listå‘½ä»¤"></a>4.6 Rediså‘½ä»¤-Listå‘½ä»¤</h3><p>Redisä¸­çš„Listç±»å‹ä¸Javaä¸­çš„LinkedListç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ç»“æ„ã€‚æ—¢å¯ä»¥æ”¯æŒæ­£å‘æ£€ç´¢å’Œä¹Ÿå¯ä»¥æ”¯æŒåå‘æ£€ç´¢ã€‚</p><p>ç‰¹å¾ä¹Ÿä¸LinkedListç±»ä¼¼ï¼š</p><ul><li>æœ‰åº</li><li>å…ƒç´ å¯ä»¥é‡å¤</li><li>æ’å…¥å’Œåˆ é™¤å¿«</li><li>æŸ¥è¯¢é€Ÿåº¦ä¸€èˆ¬</li></ul><p>å¸¸ç”¨æ¥å­˜å‚¨ä¸€ä¸ªæœ‰åºæ•°æ®ï¼Œä¾‹å¦‚ï¼šæœ‹å‹åœˆç‚¹èµåˆ—è¡¨ï¼Œè¯„è®ºåˆ—è¡¨ç­‰ã€‚</p><p><strong>Listçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</strong></p><p>ç±»ä¼¼äºä¸€ä¸ªåŒå‘é“¾è¡¨çš„ç»“æ„</p><ul><li>LPUSH key element â€¦ ï¼šå‘åˆ—è¡¨å·¦ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>LPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å·¦ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰åˆ™è¿”å›nil</li><li>RPUSH key element â€¦ ï¼šå‘åˆ—è¡¨å³ä¾§æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>RPOP keyï¼šç§»é™¤å¹¶è¿”å›åˆ—è¡¨å³ä¾§çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>LRANGE key star endï¼šè¿”å›ä¸€æ®µè§’æ ‡èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ï¼ˆredisè§’æ ‡ä¹Ÿæ˜¯ä»0å¼€å§‹ï¼‰</li><li>BLPOPå’ŒBRPOPï¼šä¸LPOPå’ŒRPOPç±»ä¼¼ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æŒ‡å®šæ—¶é—´ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›nil</li></ul><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221217202656.png" alt=""></p><ul><li>LPUSHå’ŒRPUSH</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPUSH users <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPUSH users <span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span><br><span class="line">(integer) <span class="number">6</span></span><br></pre></td></tr></table></figure><ul><li>LPOPå’ŒRPOP</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPOP users</span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; RPOP users</span><br><span class="line"><span class="string">&quot;6&quot;</span></span><br></pre></td></tr></table></figure><ul><li>LRANGE</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LRANGE users <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;4&quot;</span></span><br></pre></td></tr></table></figure><p><strong>æ·»åŠ ä¸€ä¸ªå°æ€è€ƒ</strong>ï¼š<br>Liståœ¨æ ˆå’Œé˜Ÿåˆ—ä¸­çš„åº”ç”¨ï¼š<br>æ ˆï¼šå…¥å£å’Œå‡ºå£åœ¨ä¸€å—<br>é˜Ÿåˆ—ï¼šå…¥å£å’Œå‡ºå£ä¸åœ¨ä¸€å—<br>é‚£ä¹ˆé˜»å¡é˜Ÿåˆ—å¦‚ä½•å®ç°ï¼šåˆ‡æ¢ä¸€ä¸‹ä½¿ç”¨çš„å‘½ä»¤å³å¯</p><h3 id="4-7-Rediså‘½ä»¤-Setå‘½ä»¤"><a href="#4-7-Rediså‘½ä»¤-Setå‘½ä»¤" class="headerlink" title="4.7 Rediså‘½ä»¤-Setå‘½ä»¤"></a>4.7 Rediså‘½ä»¤-Setå‘½ä»¤</h3><p>Redisçš„Setç»“æ„ä¸Javaä¸­çš„HashSetç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªvalueä¸ºnullçš„HashMapã€‚å› ä¸ºä¹Ÿæ˜¯ä¸€ä¸ªhashè¡¨ï¼Œå› æ­¤å…·å¤‡ä¸HashSetç±»ä¼¼çš„ç‰¹å¾ï¼š</p><ul><li>æ— åº</li><li>å…ƒç´ ä¸å¯é‡å¤</li><li>æŸ¥æ‰¾å¿«</li><li>æ”¯æŒäº¤é›†.å¹¶é›†.å·®é›†ç­‰åŠŸèƒ½</li></ul><p><strong>Setç±»å‹çš„å¸¸è§å‘½ä»¤</strong></p><ul><li>SADD key member â€¦ ï¼šå‘setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li><li>SREM key member â€¦ : ç§»é™¤setä¸­çš„æŒ‡å®šå…ƒç´ </li><li>SCARD keyï¼š è¿”å›setä¸­å…ƒç´ çš„ä¸ªæ•°</li><li>SISMEMBER key memberï¼šåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºsetä¸­</li><li>SMEMBERSï¼šè·å–setä¸­çš„æ‰€æœ‰å…ƒç´ </li><li>SINTER key1 key2 â€¦ ï¼šæ±‚key1ä¸key2çš„äº¤é›†</li><li>SDIFF key1 key2 â€¦ ï¼šæ±‚key1ä¸key2çš„å·®é›†</li><li>SUNION key1 key2 ..ï¼šæ±‚key1å’Œkey2çš„å¹¶é›†</li></ul><p>ä¾‹å¦‚ä¸¤ä¸ªé›†åˆï¼šs1å’Œs2:</p><p>æ±‚äº¤é›†ï¼šSINTER s1 s2</p><p>æ±‚s1ä¸s2çš„ä¸åŒï¼šSDIFF s1 s2</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221217204507.png" alt=""></p><p><strong>å…·ä½“å‘½ä»¤</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; sadd s1 a b <span class="title function_">c</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; smembers s1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; srem s1 <span class="title function_">a</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER s1 <span class="title function_">a</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER s1 <span class="title function_">b</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SCARD <span class="title function_">s1</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p><strong>æ¡ˆä¾‹</strong></p><ul><li>å°†ä¸‹åˆ—æ•°æ®ç”¨Redisçš„Seté›†åˆæ¥å­˜å‚¨ï¼š</li><li>å¼ ä¸‰çš„å¥½å‹æœ‰ï¼šæå››.ç‹äº”.èµµå…­</li><li>æå››çš„å¥½å‹æœ‰ï¼šç‹äº”.éº»å­.äºŒç‹—</li><li>åˆ©ç”¨Setçš„å‘½ä»¤å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</li><li>è®¡ç®—å¼ ä¸‰çš„å¥½å‹æœ‰å‡ äºº</li><li>è®¡ç®—å¼ ä¸‰å’Œæå››æœ‰å“ªäº›å…±åŒå¥½å‹</li><li>æŸ¥è¯¢å“ªäº›äººæ˜¯å¼ ä¸‰çš„å¥½å‹å´ä¸æ˜¯æå››çš„å¥½å‹</li><li>æŸ¥è¯¢å¼ ä¸‰å’Œæå››çš„å¥½å‹æ€»å…±æœ‰å“ªäº›äºº</li><li>åˆ¤æ–­æå››æ˜¯å¦æ˜¯å¼ ä¸‰çš„å¥½å‹</li><li>åˆ¤æ–­å¼ ä¸‰æ˜¯å¦æ˜¯æå››çš„å¥½å‹</li><li>å°†æå››ä»å¼ ä¸‰çš„å¥½å‹åˆ—è¡¨ä¸­ç§»é™¤</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SADD zs lisi wangwu <span class="title function_">zhaoliu</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SADD ls wangwu mazi <span class="title function_">ergou</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SCARD <span class="title function_">zs</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SINTER zs ls</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SDIFF zs ls</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;zhaoliu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;lisi&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SUNION zs ls</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;wangwu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;zhaoliu&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;lisi&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;mazi&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;ergou&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER zs <span class="title function_">lisi</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SISMEMBER ls <span class="title function_">zhangsan</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SREM zs <span class="title function_">lisi</span></span><br><span class="line"><span class="params">(integer)</span> <span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SMEMBERS zs</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;zhaoliu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;wangwu&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-8-Rediså‘½ä»¤-SortedSetç±»å‹"><a href="#4-8-Rediså‘½ä»¤-SortedSetç±»å‹" class="headerlink" title="4.8 Rediså‘½ä»¤-SortedSetç±»å‹"></a>4.8 Rediså‘½ä»¤-SortedSetç±»å‹</h3><p>Redisçš„SortedSetæ˜¯ä¸€ä¸ªå¯æ’åºçš„seté›†åˆï¼Œä¸Javaä¸­çš„TreeSetæœ‰äº›ç±»ä¼¼ï¼Œä½†åº•å±‚æ•°æ®ç»“æ„å´å·®åˆ«å¾ˆå¤§ã€‚SortedSetä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¸¦æœ‰ä¸€ä¸ªscoreå±æ€§ï¼Œå¯ä»¥åŸºäºscoreå±æ€§å¯¹å…ƒç´ æ’åºï¼Œåº•å±‚çš„å®ç°æ˜¯ä¸€ä¸ªè·³è¡¨ï¼ˆSkipListï¼‰åŠ  hashè¡¨ã€‚</p><p>SortedSetå…·å¤‡ä¸‹åˆ—ç‰¹æ€§ï¼š</p><ul><li>å¯æ’åº</li><li>å…ƒç´ ä¸é‡å¤</li><li>æŸ¥è¯¢é€Ÿåº¦å¿«</li></ul><p>å› ä¸ºSortedSetçš„å¯æ’åºç‰¹æ€§ï¼Œç»å¸¸è¢«ç”¨æ¥å®ç°æ’è¡Œæ¦œè¿™æ ·çš„åŠŸèƒ½ã€‚</p><p>SortedSetçš„å¸¸è§å‘½ä»¤æœ‰ï¼š</p><ul><li>ZADD key score memberï¼šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ åˆ°sorted set ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™æ›´æ–°å…¶scoreå€¼</li><li>ZREM key memberï¼šåˆ é™¤sorted setä¸­çš„ä¸€ä¸ªæŒ‡å®šå…ƒç´ </li><li>ZSCORE key member : è·å–sorted setä¸­çš„æŒ‡å®šå…ƒç´ çš„scoreå€¼</li><li>ZRANK key memberï¼šè·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’å</li><li>ZCARD keyï¼šè·å–sorted setä¸­çš„å…ƒç´ ä¸ªæ•°</li><li>ZCOUNT key min maxï¼šç»Ÿè®¡scoreå€¼åœ¨ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ çš„ä¸ªæ•°</li><li>ZINCRBY key increment memberï¼šè®©sorted setä¸­çš„æŒ‡å®šå…ƒç´ è‡ªå¢ï¼Œæ­¥é•¿ä¸ºæŒ‡å®šçš„incrementå€¼</li><li>ZRANGE key min maxï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ </li><li>ZRANGEBYSCORE key min maxï¼šæŒ‰ç…§scoreæ’åºåï¼Œè·å–æŒ‡å®šscoreèŒƒå›´å†…çš„å…ƒç´ </li><li>ZDIFF.ZINTER.ZUNIONï¼šæ±‚å·®é›†.äº¤é›†.å¹¶é›†</li></ul><p>æ³¨æ„ï¼šæ‰€æœ‰çš„æ’åé»˜è®¤éƒ½æ˜¯å‡åºï¼Œå¦‚æœè¦é™åºåˆ™åœ¨å‘½ä»¤çš„Zåé¢æ·»åŠ REVå³å¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>å‡åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZRANK key member</li><li><strong>é™åº</strong>è·å–sorted set ä¸­çš„æŒ‡å®šå…ƒç´ çš„æ’åï¼šZREVRANK key memeber</li></ul><h2 id="5-Redisçš„Javaå®¢æˆ·ç«¯-Jedis"><a href="#5-Redisçš„Javaå®¢æˆ·ç«¯-Jedis" class="headerlink" title="5.Redisçš„Javaå®¢æˆ·ç«¯-Jedis"></a>5.Redisçš„Javaå®¢æˆ·ç«¯-Jedis</h2><p>åœ¨Rediså®˜ç½‘ä¸­æä¾›äº†å„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ï¼Œåœ°å€ï¼š<a href="https://redis.io/docs/clients/">https://redis.io/docs/clients/</a></p><p>æ ‡è®°ä¸ºâ¤çš„å°±æ˜¯æ¨èä½¿ç”¨çš„javaå®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221217210446.png" alt=""></p><ul><li>Jediså’ŒLettuceï¼šè¿™ä¸¤ä¸ªä¸»è¦æ˜¯æä¾›äº†Rediså‘½ä»¤å¯¹åº”çš„APIï¼Œæ–¹ä¾¿æˆ‘ä»¬æ“ä½œRedisï¼Œè€ŒSpringDataRedisåˆå¯¹è¿™ä¸¤ç§åšäº†æŠ½è±¡å’Œå°è£…ï¼Œå› æ­¤æˆ‘ä»¬åæœŸä¼šç›´æ¥ä»¥SpringDataRedisæ¥å­¦ä¹ ã€‚</li><li>Redissonï¼šæ˜¯åœ¨RedisåŸºç¡€ä¸Šå®ç°äº†åˆ†å¸ƒå¼çš„å¯ä¼¸ç¼©çš„javaæ•°æ®ç»“æ„ï¼Œä¾‹å¦‚Map.Queueç­‰ï¼Œè€Œä¸”æ”¯æŒè·¨è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼šLock.Semaphoreç­‰å¾…ï¼Œæ¯”è¾ƒé€‚åˆç”¨æ¥å®ç°ç‰¹æ®Šçš„åŠŸèƒ½éœ€æ±‚ã€‚</li></ul><h3 id="5-1-Jediså¿«é€Ÿå…¥é—¨"><a href="#5-1-Jediså¿«é€Ÿå…¥é—¨" class="headerlink" title="5.1 Jediså¿«é€Ÿå…¥é—¨"></a>5.1 Jediså¿«é€Ÿå…¥é—¨</h3><p><strong>å…¥é—¨æ¡ˆä¾‹è¯¦ç»†æ­¥éª¤</strong></p><p>æ¡ˆä¾‹åˆ†æï¼š</p><p>0ï¼‰åˆ›å»ºå·¥ç¨‹ï¼š</p><p>1ï¼‰å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jedis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å•å…ƒæµ‹è¯•--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2ï¼‰å»ºç«‹è¿æ¥</p><p>æ–°å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.å»ºç«‹è¿æ¥</span></span><br><span class="line">    <span class="comment">// jedis = new Jedis(&quot;192.168.150.101&quot;, 6379);</span></span><br><span class="line">    jedis = JedisConnectionFactory.getJedis();</span><br><span class="line">    <span class="comment">// 2.è®¾ç½®å¯†ç </span></span><br><span class="line">    jedis.auth(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">    <span class="comment">// 3.é€‰æ‹©åº“</span></span><br><span class="line">    jedis.select(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¼‰æµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å­˜å…¥æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jedis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;result = &quot;</span> + result);</span><br><span class="line">    <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ’å…¥hashæ•°æ®</span></span><br><span class="line">    jedis.hset(<span class="string">&quot;user:1&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    jedis.hset(<span class="string">&quot;user:1&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–</span></span><br><span class="line">    Map&lt;String, String&gt; map = jedis.hgetAll(<span class="string">&quot;user:1&quot;</span>);</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¼‰é‡Šæ”¾èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (jedis != <span class="literal">null</span>) &#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-Jedisè¿æ¥æ± "><a href="#5-2-Jedisè¿æ¥æ± " class="headerlink" title="5.2 Jedisè¿æ¥æ± "></a>5.2 Jedisè¿æ¥æ± </h3><p>Jedisæœ¬èº«æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯è¿æ¥ä¼šæœ‰æ€§èƒ½æŸè€—ï¼Œå› æ­¤æˆ‘ä»¬æ¨èå¤§å®¶ä½¿ç”¨Jedisè¿æ¥æ± ä»£æ›¿Jedisçš„ç›´è¿æ–¹å¼</p><p>æœ‰å…³æ± åŒ–æ€æƒ³ï¼Œå¹¶ä¸ä»…ä»…æ˜¯è¿™é‡Œä¼šä½¿ç”¨ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½æœ‰ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬çš„æ•°æ®åº“è¿æ¥æ± ï¼Œæ¯”å¦‚æˆ‘ä»¬tomcatä¸­çš„çº¿ç¨‹æ± ï¼Œè¿™äº›éƒ½æ˜¯æ± åŒ–æ€æƒ³çš„ä½“ç°ã€‚</p><h4 id="5-2-1-åˆ›å»ºJedisçš„è¿æ¥æ± "><a href="#5-2-1-åˆ›å»ºJedisçš„è¿æ¥æ± " class="headerlink" title="5.2.1.åˆ›å»ºJedisçš„è¿æ¥æ± "></a>5.2.1.åˆ›å»ºJedisçš„è¿æ¥æ± </h4><ul><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisConnectionFacotry</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">static</span> &#123;</span><br><span class="line">         <span class="comment">//é…ç½®è¿æ¥æ± </span></span><br><span class="line">         <span class="type">JedisPoolConfig</span> <span class="variable">poolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">         poolConfig.setMaxTotal(<span class="number">8</span>);</span><br><span class="line">         poolConfig.setMaxIdle(<span class="number">8</span>);</span><br><span class="line">         poolConfig.setMinIdle(<span class="number">0</span>);</span><br><span class="line">         poolConfig.setMaxWaitMillis(<span class="number">1000</span>);</span><br><span class="line">         <span class="comment">//åˆ›å»ºè¿æ¥æ± å¯¹è±¡</span></span><br><span class="line">         jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(poolConfig,</span><br><span class="line">                 <span class="string">&quot;192.168.150.101&quot;</span>,<span class="number">6379</span>,<span class="number">1000</span>,<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title function_">getJedis</span><span class="params">()</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä»£ç è¯´æ˜ï¼š</strong></p><ul><li><p>1ï¼‰ JedisConnectionFacotryï¼šå·¥å‚è®¾è®¡æ¨¡å¼æ˜¯å®é™…å¼€å‘ä¸­éå¸¸å¸¸ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å‚ï¼Œå»é™ä½ä»£çš„è€¦åˆï¼Œæ¯”å¦‚Springä¸­çš„Beançš„åˆ›å»ºï¼Œå°±ç”¨åˆ°äº†å·¥å‚è®¾è®¡æ¨¡å¼</p></li><li><p>2ï¼‰é™æ€ä»£ç å—ï¼šéšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼Œç¡®ä¿åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ‘ä»¬åœ¨åŠ è½½å½“å‰å·¥å‚ç±»çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‰§è¡Œstaticçš„æ“ä½œå®Œæˆå¯¹ è¿æ¥æ± çš„åˆå§‹åŒ–</p></li><li><p>3ï¼‰æœ€åæä¾›è¿”å›è¿æ¥æ± ä¸­è¿æ¥çš„æ–¹æ³•.</p></li></ul><h4 id="5-2-2-æ”¹é€ åŸå§‹ä»£ç "><a href="#5-2-2-æ”¹é€ åŸå§‹ä»£ç " class="headerlink" title="5.2.2.æ”¹é€ åŸå§‹ä»£ç "></a>5.2.2.æ”¹é€ åŸå§‹ä»£ç </h4><p><strong>ä»£ç è¯´æ˜:</strong></p><p>1.åœ¨æˆ‘ä»¬å®Œæˆäº†ä½¿ç”¨å·¥å‚è®¾è®¡æ¨¡å¼æ¥å®Œæˆä»£ç çš„ç¼–å†™ä¹‹åï¼Œæˆ‘ä»¬åœ¨è·å¾—è¿æ¥æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡å·¥å‚æ¥è·å¾—ã€‚</p><p>ï¼Œè€Œä¸ç”¨ç›´æ¥å»newå¯¹è±¡ï¼Œé™ä½è€¦åˆï¼Œå¹¶ä¸”ä½¿ç”¨çš„è¿˜æ˜¯è¿æ¥æ± å¯¹è±¡ã€‚</p><p>2.å½“æˆ‘ä»¬ä½¿ç”¨äº†è¿æ¥æ± åï¼Œå½“æˆ‘ä»¬å…³é—­è¿æ¥å…¶å®å¹¶ä¸æ˜¯å…³é—­ï¼Œè€Œæ˜¯å°†Jedisè¿˜å›è¿æ¥æ± çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@BeforeEach</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line">     <span class="comment">/*jedis = new Jedis(&quot;127.0.0.1&quot;,6379);*/</span></span><br><span class="line">     jedis = JedisConnectionFacotry.getJedis();</span><br><span class="line">      <span class="comment">//é€‰æ‹©åº“</span></span><br><span class="line">     jedis.select(<span class="number">0</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (jedis != <span class="literal">null</span>) &#123;</span><br><span class="line">         jedis.close();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="6-Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis"><a href="#6-Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis" class="headerlink" title="6.Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis"></a>6.Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis</h2><p>SpringDataæ˜¯Springä¸­æ•°æ®æ“ä½œçš„æ¨¡å—ï¼ŒåŒ…å«å¯¹å„ç§æ•°æ®åº“çš„é›†æˆï¼Œå…¶ä¸­å¯¹Redisçš„é›†æˆæ¨¡å—å°±å«åšSpringDataRedisï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://spring.io/projects/spring-data-redis">https://spring.io/projects/spring-data-redis</a></p><ul><li>æä¾›äº†å¯¹ä¸åŒRediså®¢æˆ·ç«¯çš„æ•´åˆï¼ˆLettuceå’ŒJedisï¼‰</li><li>æä¾›äº†RedisTemplateç»Ÿä¸€APIæ¥æ“ä½œRedis</li><li>æ”¯æŒRedisçš„å‘å¸ƒè®¢é˜…æ¨¡å‹</li><li>æ”¯æŒRediså“¨å…µå’ŒRedisé›†ç¾¤</li><li>æ”¯æŒåŸºäºLettuceçš„å“åº”å¼ç¼–ç¨‹</li><li>æ”¯æŒåŸºäºJDK.JSON.å­—ç¬¦ä¸².Springå¯¹è±¡çš„æ•°æ®åºåˆ—åŒ–åŠååºåˆ—åŒ–</li><li>æ”¯æŒåŸºäºRedisçš„JDKCollectionå®ç°</li></ul><p>SpringDataRedisä¸­æä¾›äº†RedisTemplateå·¥å…·ç±»ï¼Œå…¶ä¸­å°è£…äº†å„ç§å¯¹Redisçš„æ“ä½œã€‚å¹¶ä¸”å°†ä¸åŒæ•°æ®ç±»å‹çš„æ“ä½œAPIå°è£…åˆ°äº†ä¸åŒçš„ç±»å‹ä¸­ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221218223308.png" alt=""></p><h3 id="6-1-å¿«é€Ÿå…¥é—¨"><a href="#6-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="6.1.å¿«é€Ÿå…¥é—¨"></a>6.1.å¿«é€Ÿå…¥é—¨</h3><p>SpringBootå·²ç»æä¾›äº†å¯¹SpringDataRedisçš„æ”¯æŒï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼š</p><h4 id="6-1-1-å¯¼å…¥pomåæ ‡"><a href="#6-1-1-å¯¼å…¥pomåæ ‡" class="headerlink" title="6.1.1 å¯¼å…¥pomåæ ‡"></a>6.1.1 å¯¼å…¥pomåæ ‡</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.heima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>redis-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--redisä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--common-pool--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Jacksonä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="6-1-2-é…ç½®æ–‡ä»¶"><a href="#6-1-2-é…ç½®æ–‡ä»¶" class="headerlink" title="6.1.2 é…ç½®æ–‡ä»¶"></a>6.1.2 é…ç½®æ–‡ä»¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span>  <span class="comment">#æœ€å¤§è¿æ¥</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span>   <span class="comment">#æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span>   <span class="comment">#æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">100ms</span> <span class="comment">#è¿æ¥ç­‰å¾…æ—¶é—´</span></span><br></pre></td></tr></table></figure><h4 id="6-1-3-æµ‹è¯•ä»£ç "><a href="#6-1-3-æµ‹è¯•ä»£ç " class="headerlink" title="6.1.3 æµ‹è¯•ä»£ç "></a>6.1.3 æµ‹è¯•ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å†™å…¥ä¸€æ¡Stringæ•°æ®</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–stringæ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è´´å¿ƒå°æç¤ºï¼šSpringDataJpaä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œè®°ä½å¦‚ä¸‹å‡ ä¸ªæ­¥éª¤å³å¯</strong></p><p>SpringDataRedisçš„ä½¿ç”¨æ­¥éª¤ï¼š</p><ul><li>å¼•å…¥spring-boot-starter-data-redisä¾èµ–</li><li>åœ¨application.ymlé…ç½®Redisä¿¡æ¯</li><li>æ³¨å…¥RedisTemplate</li></ul><h3 id="6-2-æ•°æ®åºåˆ—åŒ–å™¨"><a href="#6-2-æ•°æ®åºåˆ—åŒ–å™¨" class="headerlink" title="6.2 .æ•°æ®åºåˆ—åŒ–å™¨"></a>6.2 .æ•°æ®åºåˆ—åŒ–å™¨</h3><p>RedisTemplateå¯ä»¥æ¥æ”¶ä»»æ„Objectä½œä¸ºå€¼å†™å…¥Redis</p><p>åªä¸è¿‡å†™å…¥å‰ä¼šæŠŠObjectåºåˆ—åŒ–ä¸ºå­—èŠ‚å½¢å¼ï¼Œé»˜è®¤æ˜¯é‡‡ç”¨JDKåºåˆ—åŒ–ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/a44c5fa5an273386da3c5e74d2a281f4.jpg" alt=""></p><p>ç¼ºç‚¹ï¼š</p><ul><li>å¯è¯»æ€§å·®</li><li>å†…å­˜å ç”¨è¾ƒå¤§</li></ul><p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedisTemplateå¯¹è±¡</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è®¾ç½®è¿æ¥å·¥å‚</span></span><br><span class="line">        template.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">// åˆ›å»ºJSONåºåˆ—åŒ–å·¥å…·</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">jsonRedisSerializer</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®Keyçš„åºåˆ—åŒ–</span></span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">// è®¾ç½®Valueçš„åºåˆ—åŒ–</span></span><br><span class="line">        template.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">        template.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="comment">// è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨äº†JSONåºåˆ—åŒ–æ¥ä»£æ›¿é»˜è®¤çš„JDKåºåˆ—åŒ–æ–¹å¼ã€‚æœ€ç»ˆç»“æœå¦‚å›¾ï¼š</p><p><img src="https://i.imgur.com/XOAq3cN.png" alt=""></p><p>æ•´ä½“å¯è¯»æ€§æœ‰äº†å¾ˆå¤§æå‡ï¼Œå¹¶ä¸”èƒ½å°†Javaå¯¹è±¡è‡ªåŠ¨çš„åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŸ¥è¯¢æ—¶èƒ½è‡ªåŠ¨æŠŠJSONååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚ä¸è¿‡ï¼Œå…¶ä¸­è®°å½•äº†åºåˆ—åŒ–æ—¶å¯¹åº”çš„classåç§°ï¼Œç›®çš„æ˜¯ä¸ºäº†æŸ¥è¯¢æ—¶å®ç°è‡ªåŠ¨ååºåˆ—åŒ–ã€‚è¿™ä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p><h3 id="6-3-StringRedisTemplate"><a href="#6-3-StringRedisTemplate" class="headerlink" title="6.3 StringRedisTemplate"></a>6.3 StringRedisTemplate</h3><p>å°½ç®¡JSONçš„åºåˆ—åŒ–æ–¹å¼å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†ä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜:ä¸ºäº†åœ¨ååºåˆ—åŒ–æ—¶çŸ¥é“å¯¹è±¡çš„ç±»å‹ï¼ŒJSONåºåˆ—åŒ–å™¨ä¼šå°†ç±»çš„classç±»å‹å†™å…¥jsonç»“æœä¸­ï¼Œå­˜å…¥Redisï¼Œä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ã€‚</p><p>ä¸ºäº†å‡å°‘å†…å­˜çš„æ¶ˆè€—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ‰‹åŠ¨åºåˆ—åŒ–çš„æ–¹å¼ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯ä¸å€ŸåŠ©é»˜è®¤çš„åºåˆ—åŒ–å™¨ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±æ¥æ§åˆ¶åºåˆ—åŒ–çš„åŠ¨ä½œï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬åªé‡‡ç”¨Stringçš„åºåˆ—åŒ–å™¨ï¼Œè¿™æ ·ï¼Œåœ¨å­˜å‚¨valueæ—¶ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨å†…å­˜ä¸­å°±ä¸ç”¨å¤šå­˜å‚¨æ•°æ®ï¼Œä»è€ŒèŠ‚çº¦æˆ‘ä»¬çš„å†…å­˜ç©ºé—´</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/df86f8cfft692cf5927d0ca19f41ed98.jpg" alt=""></p><p>è¿™ç§ç”¨æ³•æ¯”è¾ƒæ™®éï¼Œå› æ­¤SpringDataRediså°±æä¾›äº†RedisTemplateçš„å­ç±»ï¼šStringRedisTemplateï¼Œå®ƒçš„keyå’Œvalueçš„åºåˆ—åŒ–æ–¹å¼é»˜è®¤å°±æ˜¯Stringæ–¹å¼ã€‚</p><p>çœå»äº†æˆ‘ä»¬è‡ªå®šä¹‰RedisTemplateçš„åºåˆ—åŒ–æ–¹å¼çš„æ­¥éª¤ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisStringTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å†™å…¥ä¸€æ¡Stringæ•°æ®</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;verify:phone:13600527634&quot;</span>, <span class="string">&quot;124143&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–stringæ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;è™å“¥&quot;</span>, <span class="number">21</span>);</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨åºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">        <span class="comment">// å†™å…¥æ•°æ®</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;user:200&quot;</span>, json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ•°æ®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonUser</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;user:200&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> mapper.readValue(jsonUser, User.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;user1 = &quot;</span> + user1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯ä»¥å‘ç°å­˜å‚¨çš„æ•°æ®ä¸­å°‘äº†ä¹‹å‰ä¸ºäº†æ–¹ä¾¿ååºåˆ—åŒ–çš„é‚£ä¸²æ•°æ®ã€‚</p><p>æœ€åå°æ€»ç»“ï¼š</p><p>RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆï¼š</p><ul><li><p>æ–¹æ¡ˆä¸€ï¼š</p><ul><li>è‡ªå®šä¹‰RedisTemplate</li><li>ä¿®æ”¹RedisTemplateçš„åºåˆ—åŒ–å™¨ä¸ºGenericJackson2JsonRedisSerializer</li></ul></li><li><p>æ–¹æ¡ˆäºŒï¼š</p><ul><li>ä½¿ç”¨StringRedisTemplate</li><li>å†™å…¥Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠå¯¹è±¡åºåˆ—åŒ–ä¸ºJSON</li><li>è¯»å–Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠè¯»å–åˆ°çš„JSONååºåˆ—åŒ–ä¸ºå¯¹è±¡</li></ul></li></ul><h3 id="6-4-Hashç»“æ„æ“ä½œ"><a href="#6-4-Hashç»“æ„æ“ä½œ" class="headerlink" title="6.4 Hashç»“æ„æ“ä½œ"></a>6.4 Hashç»“æ„æ“ä½œ</h3><p>åœ¨åŸºç¡€ç¯‡çš„æœ€åï¼Œå’±ä»¬å¯¹Hashç»“æ„æ“ä½œä¸€ä¸‹ï¼Œæ”¶ä¸€ä¸ªå°å°¾å·´ï¼Œè¿™ä¸ªä»£ç å’±ä»¬å°±ä¸å†è§£é‡Šå•¦</p><p>é©¬ä¸Šå°±å¼€å§‹æ–°çš„ç¯‡ç« ~~~è¿›å…¥åˆ°æˆ‘ä»¬çš„Rediså®æˆ˜ç¯‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisStringTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:400&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:400&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;Object, Object&gt; entries = stringRedisTemplate.opsForHash().entries(<span class="string">&quot;user:400&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;entries = &quot;</span> + entries);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®å‰ç½® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså®æˆ˜ç¯‡</title>
      <link href="/posts/2796640407.html"/>
      <url>/posts/2796640407.html</url>
      
        <content type="html"><![CDATA[<h1 id="å®æˆ˜ç¯‡Redis"><a href="#å®æˆ˜ç¯‡Redis" class="headerlink" title="å®æˆ˜ç¯‡Redis"></a>å®æˆ˜ç¯‡Redis</h1><h2 id="å¼€ç¯‡å¯¼è¯»"><a href="#å¼€ç¯‡å¯¼è¯»" class="headerlink" title="å¼€ç¯‡å¯¼è¯»"></a>å¼€ç¯‡å¯¼è¯»</h2><p>å®æˆ˜éª—ä¸»è¦å®ç°å†…å®¹å¦‚ä¸‹ï¼ˆå…±å…«ä¸ªæ¨¡å—ï¼‰ï¼š</p><ul><li>çŸ­ä¿¡ç™»å½•</li></ul><p>è¿™ä¸€å—æˆ‘ä»¬ä¼šä½¿ç”¨rediså…±äº«sessionæ¥å®ç°</p><ul><li>å•†æˆ·æŸ¥è¯¢ç¼“å­˜</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šç†è§£ç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜ç©¿é€ï¼Œç¼“å­˜é›ªå´©ç­‰é—®é¢˜ï¼Œè®©å°ä¼™ä¼´çš„å¯¹äºè¿™äº›æ¦‚å¿µçš„ç†è§£ä¸ä»…ä»…æ˜¯åœç•™åœ¨æ¦‚å¿µä¸Šï¼Œæ›´æ˜¯èƒ½åœ¨ä»£ç ä¸­çœ‹åˆ°å¯¹åº”çš„å†…å®¹</p><ul><li>ä¼˜æƒ å·ç§’æ€</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¼šRedisçš„è®¡æ•°å™¨åŠŸèƒ½ï¼Œ ç»“åˆLuaå®Œæˆé«˜æ€§èƒ½çš„redisæ“ä½œï¼ŒåŒæ—¶å­¦ä¼šRedisåˆ†å¸ƒå¼é”çš„åŸç†ï¼ŒåŒ…æ‹¬Redisçš„ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—</p><ul><li>è¾¾äººæ¢åº—</li></ul><p>åŸºäºListæ¥å®Œæˆç‚¹èµåˆ—è¡¨çš„æ“ä½œï¼ŒåŒæ—¶åŸºäºSortedSetæ¥å®Œæˆç‚¹èµçš„æ’è¡Œæ¦œåŠŸèƒ½</p><ul><li>å¥½å‹å…³æ³¨</li></ul><p>åŸºäºSeté›†åˆçš„å…³æ³¨ã€å–æ¶ˆå…³æ³¨ï¼Œå…±åŒå…³æ³¨ç­‰ç­‰åŠŸèƒ½ï¼Œè¿™ä¸€å—çŸ¥è¯†å’±ä»¬ä¹‹å‰å°±è®²è¿‡ï¼Œè¿™æ¬¡æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ¥ä½¿ç”¨ä¸€ä¸‹</p><ul><li>é™„è¿‘çš„å•†æˆ·</li></ul><p>æˆ‘ä»¬åˆ©ç”¨Redisçš„GEOHashæ¥å®Œæˆå¯¹äºåœ°ç†åæ ‡çš„æ“ä½œ</p><ul><li>UVç»Ÿè®¡</li></ul><p>ä¸»è¦æ˜¯ä½¿ç”¨Redisæ¥å®Œæˆç»Ÿè®¡åŠŸèƒ½</p><ul><li>ç”¨æˆ·ç­¾åˆ°</li></ul><p>ä½¿ç”¨Redisçš„BitMapæ•°æ®ç»Ÿè®¡åŠŸèƒ½</p><h2 id="1ã€çŸ­ä¿¡ç™»å½•"><a href="#1ã€çŸ­ä¿¡ç™»å½•" class="headerlink" title="1ã€çŸ­ä¿¡ç™»å½•"></a>1ã€çŸ­ä¿¡ç™»å½•</h2><h3 id="1-1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®"><a href="#1-1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®" class="headerlink" title="1.1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®"></a>1.1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®</h3><h4 id="1-1-1-ã€å¯¼å…¥SQL"><a href="#1-1-1-ã€å¯¼å…¥SQL" class="headerlink" title="1.1.1 ã€å¯¼å…¥SQL"></a>1.1.1 ã€å¯¼å…¥SQL</h4><p>é¦–å…ˆç¬¬ä¸€æ­¥å¿…ç„¶æ˜¯å¯¼å…¥é¡¹ç›®æ‰€éœ€æ•°æ®ã€‚</p><h4 id="1-1-2ã€æœ‰å…³å½“å‰æ¨¡å‹"><a href="#1-1-2ã€æœ‰å…³å½“å‰æ¨¡å‹" class="headerlink" title="1.1.2ã€æœ‰å…³å½“å‰æ¨¡å‹"></a>1.1.2ã€æœ‰å…³å½“å‰æ¨¡å‹</h4><p>æ‰‹æœºæˆ–è€…appç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æˆ‘ä»¬çš„nginxæœåŠ¡å™¨ï¼ŒnginxåŸºäºä¸ƒå±‚æ¨¡å‹èµ°çš„äº‹HTTPåè®®ï¼Œå¯ä»¥å®ç°åŸºäºLuaç›´æ¥ç»•å¼€tomcatè®¿é—®redisï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œè½»æ¾æ‰›ä¸‹ä¸Šä¸‡å¹¶å‘ï¼Œ è´Ÿè½½å‡è¡¡åˆ°ä¸‹æ¸¸tomcatæœåŠ¡å™¨ï¼Œæ‰“æ•£æµé‡ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä¸€å°4æ ¸8Gçš„tomcatï¼Œåœ¨ä¼˜åŒ–å’Œå¤„ç†ç®€å•ä¸šåŠ¡çš„åŠ æŒä¸‹ï¼Œå¤§ä¸äº†å°±å¤„ç†1000å·¦å³çš„å¹¶å‘ï¼Œ ç»è¿‡nginxçš„è´Ÿè½½å‡è¡¡åˆ†æµåï¼Œåˆ©ç”¨é›†ç¾¤æ”¯æ’‘èµ·æ•´ä¸ªé¡¹ç›®ï¼ŒåŒæ—¶nginxåœ¨éƒ¨ç½²äº†å‰ç«¯é¡¹ç›®åï¼Œæ›´æ˜¯å¯ä»¥åšåˆ°åŠ¨é™åˆ†ç¦»ï¼Œè¿›ä¸€æ­¥é™ä½tomcatæœåŠ¡çš„å‹åŠ›ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¾—é nginxèµ·ä½œç”¨ï¼Œæ‰€ä»¥nginxæ˜¯æ•´ä¸ªé¡¹ç›®ä¸­é‡è¦çš„ä¸€ç¯ã€‚</p><p>åœ¨tomcatæ”¯æ’‘èµ·å¹¶å‘æµé‡åï¼Œæˆ‘ä»¬å¦‚æœè®©tomcatç›´æ¥å»è®¿é—®Mysqlï¼Œæ ¹æ®ç»éªŒMysqlä¼ä¸šçº§æœåŠ¡å™¨åªè¦ä¸Šç‚¹å¹¶å‘ï¼Œä¸€èˆ¬æ˜¯16æˆ–32 æ ¸å¿ƒcpuï¼Œ32 æˆ–64Gå†…å­˜ï¼Œåƒä¼ä¸šçº§mysqlåŠ ä¸Šå›ºæ€ç¡¬ç›˜èƒ½å¤Ÿæ”¯æ’‘çš„å¹¶å‘ï¼Œå¤§æ¦‚å°±æ˜¯4000èµ·~7000å·¦å³ï¼Œä¸Šä¸‡å¹¶å‘ï¼Œ ç¬é—´å°±ä¼šè®©MysqlæœåŠ¡å™¨çš„cpuï¼Œç¡¬ç›˜å…¨éƒ¨æ‰“æ»¡ï¼Œå®¹æ˜“å´©æºƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¼šé€‰æ‹©ä½¿ç”¨mysqlé›†ç¾¤ï¼ŒåŒæ—¶ä¸ºäº†è¿›ä¸€æ­¥é™ä½Mysqlçš„å‹åŠ›ï¼ŒåŒæ—¶å¢åŠ è®¿é—®çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåŠ å…¥Redisï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤ä½¿å¾—Rediså¯¹å¤–æä¾›æ›´å¥½çš„æœåŠ¡ã€‚</p><h4 id="1-1-3ã€å¯¼å…¥åç«¯é¡¹ç›®"><a href="#1-1-3ã€å¯¼å…¥åç«¯é¡¹ç›®" class="headerlink" title="1.1.3ã€å¯¼å…¥åç«¯é¡¹ç›®"></a>1.1.3ã€å¯¼å…¥åç«¯é¡¹ç›®</h4><p>åœ¨èµ„æ–™ä¸­æä¾›äº†ä¸€ä¸ªé¡¹ç›®æºç ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221219210240.png" alt=""></p><h4 id="1-1-4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹"><a href="#1-1-4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹" class="headerlink" title="1.1.4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹"></a>1.1.4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹</h4><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221219210334.png" alt=""></p><h4 id="1-1-5-è¿è¡Œå‰ç«¯é¡¹ç›®"><a href="#1-1-5-è¿è¡Œå‰ç«¯é¡¹ç›®" class="headerlink" title="1.1.5 è¿è¡Œå‰ç«¯é¡¹ç›®"></a>1.1.5 è¿è¡Œå‰ç«¯é¡¹ç›®</h4><p>åœ¨æµè§ˆå™¨ä½¿ç”¨æ‰‹æœºç«¯è¾“å…¥8080ç«¯å£å³å¯ã€‚</p><h3 id="1-2-ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹"><a href="#1-2-ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹" class="headerlink" title="1.2 ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹"></a>1.2 ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹</h3><p><strong>å‘é€éªŒè¯ç ï¼š</strong></p><p>ç”¨æˆ·åœ¨æäº¤æ‰‹æœºå·åï¼Œä¼šæ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•ï¼Œåˆ™è¦æ±‚ç”¨æˆ·é‡æ–°è¾“å…¥æ‰‹æœºå·</p><p>å¦‚æœæ‰‹æœºå·åˆæ³•ï¼Œåå°æ­¤æ—¶ç”Ÿæˆå¯¹åº”çš„éªŒè¯ç ï¼ŒåŒæ—¶å°†éªŒè¯ç è¿›è¡Œä¿å­˜ï¼Œç„¶åå†é€šè¿‡çŸ­ä¿¡çš„æ–¹å¼å°†éªŒè¯ç å‘é€ç»™ç”¨æˆ·</p><p><strong>çŸ­ä¿¡éªŒè¯ç ç™»å½•ã€æ³¨å†Œï¼š</strong></p><p>ç”¨æˆ·å°†éªŒè¯ç å’Œæ‰‹æœºå·è¿›è¡Œè¾“å…¥ï¼Œåå°ä»sessionä¸­æ‹¿åˆ°å½“å‰éªŒè¯ç ï¼Œç„¶åå’Œç”¨æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ— æ³•é€šè¿‡æ ¡éªŒï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™åå°æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä¸ºç”¨æˆ·åˆ›å»ºè´¦å·ä¿¡æ¯ï¼Œä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ— è®ºæ˜¯å¦å­˜åœ¨ï¼Œéƒ½ä¼šå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°sessionä¸­ï¼Œæ–¹ä¾¿åç»­è·å¾—å½“å‰ç™»å½•ä¿¡æ¯</p><p><strong>æ ¡éªŒç™»å½•çŠ¶æ€:</strong></p><p>ç”¨æˆ·åœ¨è¯·æ±‚æ—¶å€™ï¼Œä¼šä»cookieä¸­æºå¸¦è€…JsessionIdåˆ°åå°ï¼Œåå°é€šè¿‡JsessionIdä»sessionä¸­æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰sessionä¿¡æ¯ï¼Œåˆ™è¿›è¡Œæ‹¦æˆªï¼Œå¦‚æœæœ‰sessionä¿¡æ¯ï¼Œåˆ™å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œ</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221219210818.png" alt=""></p><h3 id="1-3-ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½"><a href="#1-3-ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½" class="headerlink" title="1.3 ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½"></a>1.3 ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½</h3><p><strong>é¡µé¢æµç¨‹</strong></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221219210944.png" alt=""></p><p><strong>å…·ä½“ä»£ç å¦‚ä¸‹</strong></p><ul><li>å‘é€éªŒè¯ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.ç¬¦åˆï¼Œç”ŸæˆéªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ä¿å­˜éªŒè¯ç åˆ° session</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line">    <span class="comment">// 5.å‘é€éªŒè¯ç </span></span><br><span class="line">    log.debug(<span class="string">&quot;å‘é€çŸ­ä¿¡éªŒè¯ç æˆåŠŸï¼ŒéªŒè¯ç ï¼š&#123;&#125;&quot;</span>, code);<span class="comment">//è¿™é‡Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹logæ—¥å¿—ä¸­çš„å†™æ³•&#123;&#125;è¢«æ›¿æ¢ä¸ºåç»­ä¼ å…¥çš„å€¼</span></span><br><span class="line">    <span class="comment">// è¿”å›ok</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®ç°çŸ­ä¿¡éªŒè¯ç ç™»å½•æµç¨‹</strong></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221219214619.png" alt=""></p><ul><li>ç™»å½•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç¬¬ä¸€æ­¥ ï¼šæ ¡éªŒæ‰‹æœºå·æ ¼å¼æ˜¯å¦æœ‰é—®é¢˜åå°æœ‰æ²¡æœ‰é¢å¤–å¤„ç†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone_num</span> <span class="operator">=</span>loginForm.getPhone();</span><br><span class="line">    <span class="keyword">if</span>(RegexUtils.isPhoneInvalid(phone_num))&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. ç¬¬äºŒæ­¥ï¼šéªŒè¯éªŒè¯ç æ˜¯å¦æ­£ç¡®,ifæ˜¯ä¸ä¸€è‡´çš„æƒ…å†µä¸‹</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">backstageCode</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">    <span class="comment">//è¿™é‡Œå¯¹ifä½¿ç”¨åå‘åˆ¤å®šï¼Œå°±æ˜¯é˜²æ­¢å‡ºç°å¤šé‡åµŒå¥—çš„é—®é¢˜</span></span><br><span class="line">    <span class="keyword">if</span>(code == <span class="literal">null</span> || !backstageCode.toString().equals(code))&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç ä¸æ­£ç¡®ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. ç¬¬ä¸‰æ­¥ï¼šåœ¨å‰ä¸¤è€…æ²¡é—®é¢˜çš„åŸºç¡€ä¸Šï¼Œåœ¨åº“ä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨æ­¤æ‰‹æœºå·</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>,phone_num).one();</span><br><span class="line">    <span class="comment">// 4. ç¬¬å››æ­¥ï¼šå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºæ–°ç”¨æˆ·å¹¶å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">        user = creatUser(phone_num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5. ç¬¬äº”æ­¥ï¼šä¸ç®¡æ˜¯å¦å­˜åœ¨æœ€åä¸€æ­¥éƒ½æ˜¯å°†ç”¨æˆ·ä¿å­˜åˆ°session</span></span><br><span class="line">    <span class="comment">//è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå·¥å…·ç±»å°†ä¼ å…¥çš„å¯¹åº”å±æ€§åå°†Userå­˜å…¥UserDTOä¸­</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>, BeanUtil.copyProperties(user, UserDTO.class));</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> User <span class="title function_">creatUser</span><span class="params">(String phone_num)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ–°ç”¨æˆ·</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setPhone(phone_num);</span><br><span class="line">    user.setNickName(USER_NICK_NAME_PREFIX+RandomUtil.randomString(<span class="number">10</span>));</span><br><span class="line">    <span class="comment">// 2. è°ƒç”¨mybatisPlusä¸­ç»™çš„æ–¹æ³•ä¿å­˜</span></span><br><span class="line">    save(user);</span><br><span class="line">    <span class="comment">// 3. è¿”å›æ–°å»ºç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½"><a href="#1-4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½" class="headerlink" title="1.4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½"></a>1.4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½</h3><p><strong>æ¸©é¦¨å°è´´å£«ï¼štomcatçš„è¿è¡ŒåŸç†</strong></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/2fb44d471p03d0731ec47046ede586d3.jpg" alt=""></p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè®¿é—®æˆ‘ä»¬å‘tomcatæ³¨å†Œçš„ç«¯å£ï¼Œä»»ä½•ç¨‹åºæƒ³è¦è¿è¡Œï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å½“å‰ç«¯å£å·è¿›è¡Œç›‘å¬ï¼Œtomcatä¹Ÿä¸ä¾‹å¤–ï¼Œå½“ç›‘å¬çº¿ç¨‹çŸ¥é“ç”¨æˆ·æƒ³è¦å’Œtomcatè¿›è¡Œè¿æ¥æ—¶ï¼Œé‚£ä¼šç”±ç›‘å¬çº¿ç¨‹åˆ›å»ºsocketè¿æ¥ï¼Œsocketéƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œç”¨æˆ·é€šè¿‡socketåƒäº’ç›¸ä¼ é€’æ•°æ®ï¼Œå½“tomcatç«¯çš„socketæ¥å—åˆ°æ•°æ®åï¼Œæ­¤æ—¶ç›‘å¬çº¿ç¨‹ä¼šä»tomcatçš„çº¿ç¨‹æ± ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç”¨æˆ·è¯·æ±‚ï¼Œåœ¨æˆ‘ä»¬çš„æœåŠ¡éƒ¨ç½²åˆ°tomcatåï¼Œçº¿ç¨‹ä¼šæ‰¾åˆ°ç”¨æˆ·æƒ³è¦è®¿é—®çš„å·¥ç¨‹ï¼Œç„¶åç”¨è¿™ä¸ªçº¿ç¨‹è½¬å‘åˆ°å·¥ç¨‹ä¸­çš„controllerï¼Œserviceï¼Œdaoä¸­ï¼Œå¹¶ä¸”è®¿é—®å¯¹åº”çš„DBï¼Œåœ¨ç”¨æˆ·æ‰§è¡Œå®Œè¯·æ±‚åï¼Œå†ç»Ÿä¸€è¿”å›ï¼Œå†æ‰¾åˆ°tomcatç«¯çš„socketï¼Œå†å°†æ•°æ®å†™å›åˆ°ç”¨æˆ·ç«¯çš„socketï¼Œå®Œæˆè¯·æ±‚å’Œå“åº”</p><p>é€šè¿‡ä»¥ä¸Šè®²è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ æ¯ä¸ªç”¨æˆ·å…¶å®å¯¹åº”éƒ½æ˜¯å»æ‰¾tomcatçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆå·¥ä½œçš„ï¼Œ ä½¿ç”¨å®Œæˆåå†è¿›è¡Œå›æ”¶ï¼Œæ—¢ç„¶æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç”¨æˆ·å»è®¿é—®æˆ‘ä»¬çš„å·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨threadlocalæ¥åšåˆ°çº¿ç¨‹éš”ç¦»ï¼Œæ¯ä¸ªçº¿ç¨‹æ“ä½œè‡ªå·±çš„ä¸€ä»½æ•°æ®</p><p><strong>æ¸©é¦¨å°è´´å£«ï¼šå…³äºthreadlocal</strong></p><p>å¦‚æœå°ä¼™ä¼´ä»¬çœ‹è¿‡threadLocalçš„æºç ï¼Œä½ ä¼šå‘ç°åœ¨threadLocalä¸­ï¼Œæ— è®ºæ˜¯ä»–çš„putæ–¹æ³•å’Œä»–çš„getæ–¹æ³•ï¼Œ éƒ½æ˜¯å…ˆä»è·å¾—å½“å‰ç”¨æˆ·çš„çº¿ç¨‹ï¼Œç„¶åä»çº¿ç¨‹ä¸­å–å‡ºçº¿ç¨‹çš„æˆå‘˜å˜é‡mapï¼Œåªè¦çº¿ç¨‹ä¸ä¸€æ ·ï¼Œmapå°±ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥åšåˆ°çº¿ç¨‹éš”ç¦»</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221220213131.png" alt=""></p><p><strong>åœ¨æ‰§è¡Œæ‰€æœ‰controllerä¹‹å‰å’Œä¹‹åéƒ½éœ€è¦æ‰§è¡Œçš„ä¸å¦¨æ”¾å…¥æ‹¦æˆªå™¨ä¸­</strong></p><p>æ³¨æ„æ‰€æœ‰çš„æ‹¦æˆªå™¨éƒ½éœ€è¦ç»§æ‰¿çš„ç±»ä¸º<code>HandlerInterceptor</code></p><p>æ‹¦æˆªå™¨ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1. ç¬¬ä¸€æ­¥ï¼šè·å–åˆ°session åœ¨æ‹¦æˆªå™¨ä¸­requestå¯ä»¥ç›´æ¥è·å–åˆ°session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2. ç¬¬äºŒæ­¥ï¼šä»sessionä¸­è·å–åˆ°ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="comment">//3. ç¬¬ä¸‰æ­¥ï¼šæŸ¥æ‰¾è¯¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">            <span class="comment">//ä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4. ç¬¬å››æ­¥ï¼šè‹¥å­˜åœ¨åˆ™ä¿å­˜è‡³ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser((UserDTO) user);</span><br><span class="line">        <span class="comment">//5. ç¬¬äº”æ­¥ï¼šæ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//ä¸ºäº†é¿å…å†…å­˜æ³„æ¼</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è®©æ‹¦æˆªå™¨ç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// tokenåˆ·æ–°çš„æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">RefreshTokenInterceptor</span>(stringRedisTemplate)).addPathPatterns(<span class="string">&quot;/**&quot;</span>).order(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯"><a href="#1-5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯" class="headerlink" title="1.5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯"></a>1.5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</h3><p>æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è§‚å¯Ÿåˆ°æ­¤æ—¶ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯éƒ½åœ¨ï¼Œè¿™æ ·æä¸ºä¸é è°±ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“åœ¨è¿”å›ç”¨æˆ·ä¿¡æ¯ä¹‹å‰ï¼Œå°†ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯è¿›è¡Œéšè—ï¼Œé‡‡ç”¨çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ä¹¦å†™ä¸€ä¸ªUserDtoå¯¹è±¡ï¼Œè¿™ä¸ªUserDtoå¯¹è±¡å°±æ²¡æœ‰æ•æ„Ÿä¿¡æ¯äº†ï¼Œæˆ‘ä»¬åœ¨è¿”å›å‰ï¼Œå°†æœ‰ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„Userå¯¹è±¡è½¬åŒ–æˆæ²¡æœ‰æ•æ„Ÿä¿¡æ¯çš„UserDtoå¯¹è±¡ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿé¿å…è¿™ä¸ªå°´å°¬çš„é—®é¢˜äº†</p><p><strong>å¦‚æœå‡ºç°æ— æ³•ç™»å½•ç­‰é—®é¢˜ï¼Œé¦–å…ˆéƒ¨è¦æ…Œï¼Œå…ˆå†·é™ä»”ç»†çš„æ£€æŸ¥ä¸€éè‡ªå·±çš„ä»£ç æ˜¯å¦å¯¼è‡´Userå’ŒUserDTOå†²çªè¿™ä¸ªé—®é¢˜</strong></p><p><strong>åœ¨ç™»å½•æ–¹æ³•å¤„ä¿®æ”¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°sessionä¸­</span></span><br><span class="line">session.setAttribute(<span class="string">&quot;user&quot;</span>, BeanUtils.copyProperties(user,UserDTO.class));</span><br></pre></td></tr></table></figure><p><strong>åœ¨æ‹¦æˆªå™¨å¤„ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Threadlocal</span></span><br><span class="line">UserHolder.saveUser((UserDTO) user);</span><br></pre></td></tr></table></figure><p><strong>åœ¨UserHolderå¤„ï¼šå°†userå¯¹è±¡æ¢æˆUserDTO</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHolder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;UserDTO&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(UserDTO user)</span>&#123;</span><br><span class="line">        tl.set(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDTO <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tl.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeUser</span><span class="params">()</span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-6ã€sessionå…±äº«é—®é¢˜"><a href="#1-6ã€sessionå…±äº«é—®é¢˜" class="headerlink" title="1.6ã€sessionå…±äº«é—®é¢˜"></a>1.6ã€sessionå…±äº«é—®é¢˜</h3><p><strong>æ ¸å¿ƒæ€è·¯åˆ†æï¼š</strong></p><p>æ¯ä¸ªtomcatä¸­éƒ½æœ‰ä¸€ä»½å±äºè‡ªå·±çš„session,å‡è®¾ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç¬¬ä¸€å°tomcatï¼Œå¹¶ä¸”æŠŠè‡ªå·±çš„ä¿¡æ¯å­˜æ”¾åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨çš„sessionä¸­ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡è¿™ä¸ªç”¨æˆ·è®¿é—®åˆ°äº†ç¬¬äºŒå°tomcatï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒå°æœåŠ¡å™¨ä¸Šï¼Œè‚¯å®šæ²¡æœ‰ç¬¬ä¸€å°æœåŠ¡å™¨å­˜æ”¾çš„sessionï¼Œæ‰€ä»¥æ­¤æ—¶ æ•´ä¸ªç™»å½•æ‹¦æˆªåŠŸèƒ½å°±ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæ—©æœŸçš„æ–¹æ¡ˆæ˜¯sessionæ‹·è´ï¼Œå°±æ˜¯è¯´è™½ç„¶æ¯ä¸ªtomcatä¸Šéƒ½æœ‰ä¸åŒçš„sessionï¼Œä½†æ˜¯æ¯å½“ä»»æ„ä¸€å°æœåŠ¡å™¨çš„sessionä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šåŒæ­¥ç»™å…¶ä»–çš„TomcatæœåŠ¡å™¨çš„sessionï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°sessionçš„å…±äº«äº†</p><p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆå…·æœ‰ä¸¤ä¸ªå¤§é—®é¢˜</p><p>1ã€æ¯å°æœåŠ¡å™¨ä¸­éƒ½æœ‰å®Œæ•´çš„ä¸€ä»½sessionæ•°æ®ï¼ŒæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚</p><p>2ã€sessionæ‹·è´æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å»¶è¿Ÿ</p><p>æ‰€ä»¥å’±ä»¬åæ¥é‡‡ç”¨çš„æ–¹æ¡ˆéƒ½æ˜¯åŸºäºredisæ¥å®Œæˆï¼Œæˆ‘ä»¬æŠŠsessionæ¢æˆredisï¼Œredisæ•°æ®æœ¬èº«å°±æ˜¯å…±äº«çš„ï¼Œå°±å¯ä»¥é¿å…sessionå…±äº«çš„é—®é¢˜äº†</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221221101609.png" alt=""></p><h3 id="1-7-Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹"><a href="#1-7-Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹" class="headerlink" title="1.7 Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹"></a>1.7 Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹</h3><h4 id="1-7-1ã€è®¾è®¡keyçš„ç»“æ„"><a href="#1-7-1ã€è®¾è®¡keyçš„ç»“æ„" class="headerlink" title="1.7.1ã€è®¾è®¡keyçš„ç»“æ„"></a>1.7.1ã€è®¾è®¡keyçš„ç»“æ„</h4><p>é¦–å…ˆæˆ‘ä»¬è¦æ€è€ƒä¸€ä¸‹åˆ©ç”¨redisæ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆåˆ°åº•ä½¿ç”¨å“ªç§ç»“æ„å‘¢ï¼Ÿç”±äºå­˜å…¥çš„æ•°æ®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Stringï¼Œæˆ–è€…æ˜¯ä½¿ç”¨å“ˆå¸Œï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æœä½¿ç”¨Stringï¼ŒåŒå­¦ä»¬æ³¨æ„ä»–çš„valueï¼Œç”¨å¤šå ç”¨ä¸€ç‚¹ç©ºé—´ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œï¼Œåˆ™ä»–çš„valueä¸­åªä¼šå­˜å‚¨ä»–æ•°æ®æœ¬èº«ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«åœ¨æ„å†…å­˜ï¼Œå…¶å®ä½¿ç”¨Stringå°±å¯ä»¥å•¦ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221221102116.png" alt=""><br><em>è¿™é‡Œæ¥å¤ä¹ ä¸‹ä¹‹å‰çš„çŸ¥è¯†</em></p><h4 id="1-7-2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚"><a href="#1-7-2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚" class="headerlink" title="1.7.2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚"></a>1.7.2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚</h4><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Stringç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„keyï¼Œvalueé”®å€¼å¯¹çš„æ–¹å¼ï¼Œä½†æ˜¯å…³äºkeyçš„å¤„ç†ï¼Œsessionä»–æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„sessionï¼Œä½†æ˜¯redisçš„keyæ˜¯å…±äº«çš„ï¼Œå’±ä»¬å°±ä¸èƒ½ä½¿ç”¨codeäº†</p><p>åœ¨è®¾è®¡è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹‹å‰è®²è¿‡éœ€è¦æ»¡è¶³ä¸¤ç‚¹</p><p>1ã€keyè¦å…·æœ‰å”¯ä¸€æ€§</p><p>2ã€keyè¦æ–¹ä¾¿æºå¸¦ï¼Œæ–¹ä¾¿æå–æ•°æ®</p><p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨phoneï¼šæ‰‹æœºå·è¿™ä¸ªçš„æ•°æ®æ¥å­˜å‚¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœæŠŠè¿™æ ·çš„æ•æ„Ÿæ•°æ®å­˜å‚¨åˆ°redisä¸­å¹¶ä¸”ä»é¡µé¢ä¸­å¸¦è¿‡æ¥æ¯•ç«Ÿä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åå°ç”Ÿæˆä¸€ä¸ªéšæœºä¸²tokenï¼Œç„¶åè®©å‰ç«¯å¸¦æ¥è¿™ä¸ªtokenå°±èƒ½å®Œæˆæˆ‘ä»¬çš„æ•´ä½“é€»è¾‘äº†</p><h4 id="1-7-3ã€æ•´ä½“è®¿é—®æµç¨‹"><a href="#1-7-3ã€æ•´ä½“è®¿é—®æµç¨‹" class="headerlink" title="1.7.3ã€æ•´ä½“è®¿é—®æµç¨‹"></a>1.7.3ã€æ•´ä½“è®¿é—®æµç¨‹</h4><p>å½“æ³¨å†Œå®Œæˆåï¼Œç”¨æˆ·å»ç™»å½•ä¼šå»æ ¡éªŒç”¨æˆ·æäº¤çš„æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºï¼Œæœ€åå°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°redisï¼Œå¹¶ä¸”ç”Ÿæˆtokenä½œä¸ºredisçš„keyï¼Œå½“æˆ‘ä»¬æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œä¼šå»æºå¸¦ç€tokenè¿›è¡Œè®¿é—®ï¼Œä»redisä¸­å–å‡ºtokenå¯¹åº”çš„valueï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‹¦æˆªï¼Œå¦‚æœå­˜åœ¨åˆ™å°†å…¶ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œã€‚</p><p>æ‰€ä»¥ä¸€å…±å­˜åœ¨ä¸‰å¤„çš„æ”¹åŠ¨ï¼Œå®ç°æ—¶åŸºäºè¿™ä¸‰ç‚¹å»ä¿®æ”¹<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221221102440.png" alt=""></p><h3 id="1-8-åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•"><a href="#1-8-åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•" class="headerlink" title="1.8 åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•"></a>1.8 åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•</h3><p>è¿™é‡Œå…·ä½“é€»è¾‘å°±ä¸åˆ†æäº†ï¼Œä¹‹å‰å’±ä»¬å·²ç»é‡ç‚¹åˆ†æè¿‡è¿™ä¸ªé€»è¾‘å•¦ã€‚</p><p><strong>UserServiceImplä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.ä»redisè·å–éªŒè¯ç å¹¶æ ¡éªŒ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">cacheCode</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone);</span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">    <span class="keyword">if</span> (cacheCode == <span class="literal">null</span> || !cacheCode.equals(code)) &#123;</span><br><span class="line">        <span class="comment">// ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· select * from tb_user where phone = ?</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>, phone).one();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·å¹¶ä¿å­˜</span></span><br><span class="line">        user = createUserWithPhone(phone);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° redisä¸­</span></span><br><span class="line">    <span class="comment">// 7.1.éšæœºç”Ÿæˆtokenï¼Œä½œä¸ºç™»å½•ä»¤ç‰Œ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// 7.2.å°†Userå¯¹è±¡è½¬ä¸ºHashMapå­˜å‚¨</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">    Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO, <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">            CopyOptions.create()</span><br><span class="line">                    .setIgnoreNullValue(<span class="literal">true</span>)</span><br><span class="line">                    .setFieldValueEditor((fieldName, fieldValue) -&gt; fieldValue.toString()));</span><br><span class="line">    <span class="comment">// 7.3.å­˜å‚¨</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">    stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);</span><br><span class="line">    <span class="comment">// 7.4.è®¾ç½®tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">    stringRedisTemplate.expire(tokenKey, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8.è¿”å›token</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-9-è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜"><a href="#1-9-è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜" class="headerlink" title="1.9 è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜"></a>1.9 è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜</h3><h4 id="1-9-1-åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š"><a href="#1-9-1-åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š" class="headerlink" title="1.9.1 åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š"></a>1.9.1 åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š</h4><p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä»–ç¡®å®å¯ä»¥ä½¿ç”¨å¯¹åº”è·¯å¾„çš„æ‹¦æˆªï¼ŒåŒæ—¶åˆ·æ–°ç™»å½•tokenä»¤ç‰Œçš„å­˜æ´»æ—¶é—´ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªæ‹¦æˆªå™¨ä»–åªæ˜¯æ‹¦æˆªéœ€è¦è¢«æ‹¦æˆªçš„è·¯å¾„ï¼Œå‡è®¾å½“å‰ç”¨æˆ·è®¿é—®äº†ä¸€äº›ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨å°±ä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥æ­¤æ—¶ä»¤ç‰Œåˆ·æ–°çš„åŠ¨ä½œå®é™…ä¸Šå°±ä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆä»–æ˜¯å­˜åœ¨é—®é¢˜çš„</p><h4 id="1-9-2-ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#1-9-2-ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="1.9.2 ä¼˜åŒ–æ–¹æ¡ˆ"></a>1.9.2 ä¼˜åŒ–æ–¹æ¡ˆ</h4><p>æ—¢ç„¶ä¹‹å‰çš„æ‹¦æˆªå™¨æ— æ³•å¯¹ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æ‹¦æˆªæ‰€æœ‰çš„è·¯å¾„ï¼ŒæŠŠç¬¬äºŒä¸ªæ‹¦æˆªå™¨åšçš„äº‹æƒ…æ”¾å…¥åˆ°ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­ï¼ŒåŒæ—¶åˆ·æ–°ä»¤ç‰Œï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨æœ‰äº†threadLocalçš„æ•°æ®ï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬äºŒä¸ªæ‹¦æˆªå™¨åªéœ€è¦åˆ¤æ–­æ‹¦æˆªå™¨ä¸­çš„userå¯¹è±¡æ˜¯å¦å­˜åœ¨å³å¯ï¼Œå®Œæˆæ•´ä½“åˆ·æ–°åŠŸèƒ½ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221221161453.png" alt=""></p><h4 id="1-9-3-ä»£ç "><a href="#1-9-3-ä»£ç " class="headerlink" title="1.9.3 ä»£ç "></a>1.9.3 ä»£ç </h4><p><strong>RefreshTokenInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshTokenInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–è¯·æ±‚å¤´ä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åŸºäºTOKENè·å–redisä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span>  <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(key);</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.å°†æŸ¥è¯¢åˆ°çš„hashæ•°æ®è½¬ä¸ºUserDTO</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 6.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° ThreadLocal</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// 7.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(key, LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 8.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// ç§»é™¤ç”¨æˆ·</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>LoginInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼ˆThreadLocalä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (UserHolder.getUser() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰ï¼Œéœ€è¦æ‹¦æˆªï¼Œè®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">// æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœ‰ç”¨æˆ·ï¼Œåˆ™æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜"><a href="#2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜"></a>2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯ç¼“å­˜"><a href="#2-1-ä»€ä¹ˆæ˜¯ç¼“å­˜" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ç¼“å­˜?"></a>2.1 ä»€ä¹ˆæ˜¯ç¼“å­˜?</h3><p><strong>å‰è¨€</strong>:<strong>ä»€ä¹ˆæ˜¯ç¼“å­˜?</strong></p><p>ä¸¾ä¸ªä¾‹å­:è¶Šé‡è½¦,å±±åœ°è‡ªè¡Œè½¦,éƒ½æ‹¥æœ‰â€é¿éœ‡å™¨â€,<strong>é˜²æ­¢</strong>è½¦ä½“åŠ é€Ÿåå› æƒ¯æ€§,åœ¨é…·ä¼¼â€Uâ€å­—æ¯çš„åœ°å½¢ä¸Šé£è·ƒ,ç¡¬ç€é™†å¯¼è‡´çš„<strong>æŸå®³</strong>,åƒä¸ªå¼¹ç°§ä¸€æ ·;</p><p>åŒæ ·,å®é™…å¼€å‘ä¸­,ç³»ç»Ÿä¹Ÿéœ€è¦â€é¿éœ‡å™¨â€,é˜²æ­¢è¿‡é«˜çš„æ•°æ®è®¿é—®çŒ›å†²ç³»ç»Ÿ,å¯¼è‡´å…¶æ“ä½œçº¿ç¨‹æ— æ³•åŠæ—¶å¤„ç†ä¿¡æ¯è€Œç˜«ç—ª;</p><p>è¿™åœ¨å®é™…å¼€å‘ä¸­å¯¹ä¼ä¸šè®²,å¯¹äº§å“å£ç¢‘,ç”¨æˆ·è¯„ä»·éƒ½æ˜¯è‡´å‘½çš„;æ‰€ä»¥ä¼ä¸šéå¸¸é‡è§†ç¼“å­˜æŠ€æœ¯;</p><p><strong>ç¼“å­˜(</strong>Cache),å°±æ˜¯æ•°æ®äº¤æ¢çš„<strong>ç¼“å†²åŒº</strong>,ä¿—ç§°çš„ç¼“å­˜å°±æ˜¯<strong>ç¼“å†²åŒºå†…çš„æ•°æ®</strong>,ä¸€èˆ¬ä»æ•°æ®åº“ä¸­è·å–,å­˜å‚¨äºæœ¬åœ°ä»£ç </p><p>ä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¾‹<span class="number">1</span>:Static <span class="keyword">final</span> ConcurrentHashMap&lt;K,V&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(); æœ¬åœ°ç”¨äºé«˜å¹¶å‘</span><br><span class="line"></span><br><span class="line">ä¾‹<span class="number">2</span>:<span class="keyword">static</span> <span class="keyword">final</span> Cache&lt;K,V&gt; USER_CACHE = CacheBuilder.newBuilder().build(); ç”¨äºredisç­‰ç¼“å­˜</span><br><span class="line"></span><br><span class="line">ä¾‹<span class="number">3</span>:Static <span class="keyword">final</span> Map&lt;K,V&gt; map =  <span class="keyword">new</span> <span class="title class_">HashMap</span>(); æœ¬åœ°ç¼“å­˜</span><br></pre></td></tr></table></figure><p>ç”±äºå…¶è¢«<strong>Static</strong>ä¿®é¥°,æ‰€ä»¥éšç€ç±»çš„åŠ è½½è€Œè¢«åŠ è½½åˆ°<strong>å†…å­˜ä¹‹ä¸­</strong>,ä½œä¸ºæœ¬åœ°ç¼“å­˜,ç”±äºå…¶åˆè¢«<strong>final</strong>ä¿®é¥°,æ‰€ä»¥å…¶å¼•ç”¨(ä¾‹3:map)å’Œå¯¹è±¡(ä¾‹3:new HashMap())ä¹‹é—´çš„å…³ç³»æ˜¯å›ºå®šçš„,ä¸èƒ½æ”¹å˜,å› æ­¤ä¸ç”¨æ‹…å¿ƒèµ‹å€¼(=)å¯¼è‡´ç¼“å­˜å¤±æ•ˆ;</p><h4 id="2-1-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜"><a href="#2-1-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜" class="headerlink" title="2.1.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜"></a>2.1.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜</h4><p>ä¸€å¥è¯:å› ä¸º<strong>é€Ÿåº¦å¿«,å¥½ç”¨</strong></p><p>ç¼“å­˜æ•°æ®å­˜å‚¨äºä»£ç ä¸­,è€Œä»£ç è¿è¡Œåœ¨å†…å­˜ä¸­,å†…å­˜çš„è¯»å†™æ€§èƒ½è¿œé«˜äºç£ç›˜,ç¼“å­˜å¯ä»¥å¤§å¤§é™ä½<strong>ç”¨æˆ·è®¿é—®å¹¶å‘é‡å¸¦æ¥çš„</strong>æœåŠ¡å™¨è¯»å†™å‹åŠ›</p><p>å®é™…å¼€å‘è¿‡ç¨‹ä¸­,ä¼ä¸šçš„æ•°æ®é‡,å°‘åˆ™å‡ åä¸‡,å¤šåˆ™å‡ åƒä¸‡,è¿™ä¹ˆå¤§æ•°æ®é‡,å¦‚æœæ²¡æœ‰ç¼“å­˜æ¥ä½œä¸ºâ€é¿éœ‡å™¨â€,ç³»ç»Ÿæ˜¯å‡ ä¹æ’‘ä¸ä½çš„,æ‰€ä»¥ä¼ä¸šä¼šå¤§é‡è¿ç”¨åˆ°ç¼“å­˜æŠ€æœ¯;</p><p>ä½†æ˜¯ç¼“å­˜ä¹Ÿä¼šå¢åŠ ä»£ç å¤æ‚åº¦å’Œè¿è¥çš„æˆæœ¬ã€‚</p><h4 id="2-1-2-å¦‚ä½•ä½¿ç”¨ç¼“å­˜"><a href="#2-1-2-å¦‚ä½•ä½¿ç”¨ç¼“å­˜" class="headerlink" title="2.1.2 å¦‚ä½•ä½¿ç”¨ç¼“å­˜"></a>2.1.2 å¦‚ä½•ä½¿ç”¨ç¼“å­˜</h4><p>å®é™…å¼€å‘ä¸­,ä¼šæ„ç­‘å¤šçº§ç¼“å­˜æ¥ä½¿ç³»ç»Ÿè¿è¡Œé€Ÿåº¦è¿›ä¸€æ­¥æå‡,ä¾‹å¦‚:æœ¬åœ°ç¼“å­˜ä¸redisä¸­çš„ç¼“å­˜å¹¶å‘ä½¿ç”¨</p><p><strong>æµè§ˆå™¨ç¼“å­˜</strong>ï¼šä¸»è¦æ˜¯å­˜åœ¨äºæµè§ˆå™¨ç«¯çš„ç¼“å­˜</p><p><strong>åº”ç”¨å±‚ç¼“å­˜ï¼š</strong>å¯ä»¥åˆ†ä¸ºtomcatæœ¬åœ°ç¼“å­˜ï¼Œæ¯”å¦‚ä¹‹å‰æåˆ°çš„mapï¼Œæˆ–è€…æ˜¯ä½¿ç”¨redisä½œä¸ºç¼“å­˜</p><p><strong>æ•°æ®åº“ç¼“å­˜ï¼š</strong>åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€ç‰‡ç©ºé—´æ˜¯ buffer poolï¼Œå¢æ”¹æŸ¥æ•°æ®éƒ½ä¼šå…ˆåŠ è½½åˆ°mysqlçš„ç¼“å­˜ä¸­</p><p><strong>CPUç¼“å­˜ï¼š</strong>å½“ä»£è®¡ç®—æœºæœ€å¤§çš„é—®é¢˜æ˜¯ cpuæ€§èƒ½æå‡äº†ï¼Œä½†å†…å­˜è¯»å†™é€Ÿåº¦æ²¡æœ‰è·Ÿä¸Šï¼Œæ‰€ä»¥ä¸ºäº†é€‚åº”å½“ä¸‹çš„æƒ…å†µï¼Œå¢åŠ äº†cpuçš„L1ï¼ŒL2ï¼ŒL3çº§çš„ç¼“å­˜</p><h3 id="2-2-æ·»åŠ å•†æˆ·ç¼“å­˜"><a href="#2-2-æ·»åŠ å•†æˆ·ç¼“å­˜" class="headerlink" title="2.2 æ·»åŠ å•†æˆ·ç¼“å­˜"></a>2.2 æ·»åŠ å•†æˆ·ç¼“å­˜</h3><p>åœ¨æˆ‘ä»¬æŸ¥è¯¢å•†æˆ·ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æ“ä½œä»æ•°æ®åº“ä¸­å»è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œå¤§è‡´é€»è¾‘æ˜¯è¿™æ ·ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“é‚£è‚¯å®šæ…¢å’¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¢åŠ ç¼“å­˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">public Result queryShopById(@PathVariable(&quot;id&quot;) Long id) &#123;</span><br><span class="line">    //è¿™é‡Œæ˜¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</span><br><span class="line">    return shopService.queryById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-1-ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯"><a href="#2-2-1-ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯" class="headerlink" title="2.2.1 ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯"></a>2.2.1 ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯</h4><p>æ ‡å‡†çš„æ“ä½œæ–¹å¼å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æ•°æ®å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸å­˜åœ¨ï¼Œå†æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®å­˜å…¥redisã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221226200326.png" alt=""></p><h4 id="2-1-2ã€ä»£ç å¦‚ä¸‹"><a href="#2-1-2ã€ä»£ç å¦‚ä¸‹" class="headerlink" title="2.1.2ã€ä»£ç å¦‚ä¸‹"></a>2.1.2ã€ä»£ç å¦‚ä¸‹</h4><p>ä»£ç æ€è·¯ï¼šå¦‚æœç¼“å­˜æœ‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå­˜å…¥redisã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/20221226200438.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ShopMapper, Shop&gt; <span class="keyword">implements</span> <span class="title class_">IShopService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">        <span class="comment">//1. ä»redisä¸­æŸ¥è¯¢å•†é“º</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopJs</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">//2. å•†é“ºå­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(shopJs)) &#123;</span><br><span class="line">            <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJs, Shop.class);</span><br><span class="line">            <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3. å•†é“ºä¸å­˜åœ¨è¿›å…¥ä¸‹ä¸€æ­¥</span></span><br><span class="line">        <span class="comment">//4. è¿›å…¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(key);</span><br><span class="line">        <span class="comment">//5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span>(shop==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;å•†é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6. å­˜åœ¨ï¼Œé¦–å…ˆå†™å…¥redisï¼Œä¹‹åè¿”å›</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shop_r</span> <span class="operator">=</span> JSONUtil.toJsonStr(shop);</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,shop_r);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»™æ‰€æœ‰åº—é“ºåˆ†ç±»æŸ¥è¯¢æ·»åŠ ç¼“å­˜ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopTypeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ShopTypeMapper, ShopType&gt; <span class="keyword">implements</span> <span class="title class_">IShopTypeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. é¦–å…ˆåˆ°redisä¸­æŸ¥è¯¢è¯¥list</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOPLIST_KEY;</span><br><span class="line">        List&lt;String&gt; shopTypeList = stringRedisTemplate.opsForList().range(key, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//2. å­˜åœ¨ï¼Œç›´æ¥è¿”å›å³å¯</span></span><br><span class="line">        <span class="keyword">if</span> (!shopTypeList.isEmpty()) &#123;</span><br><span class="line">            List&lt;ShopType&gt; typeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (String shopType : shopTypeList) &#123;</span><br><span class="line">                <span class="type">ShopType</span> <span class="variable">type</span> <span class="operator">=</span> JSONUtil.toBean(shopType, ShopType.class);</span><br><span class="line">                typeList.add(type);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> Result.ok(typeList);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3. ä¸å­˜åœ¨ï¼Œè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">        List&lt;ShopType&gt; typeList = query().orderByAsc(<span class="string">&quot;sort&quot;</span>).list();</span><br><span class="line">        <span class="comment">//4. è‹¥è¿˜æ˜¯ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span>(typeList.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å­˜åœ¨å•†é“ºåˆ†ç±»ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(ShopType shopType : typeList)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> JSONUtil.toJsonStr(shopType);</span><br><span class="line">            <span class="comment">//5. å­˜åœ¨ï¼Œå€ŸåŠ©å¢å¼ºforç›´æ¥å­˜å‚¨å…¥redis</span></span><br><span class="line">            stringRedisTemplate.opsForList().leftPushAll(key,s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. è¿”å›é¡µé¢ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(typeList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></p><h3 id="2-3-ç¼“å­˜æ›´æ–°ç­–ç•¥"><a href="#2-3-ç¼“å­˜æ›´æ–°ç­–ç•¥" class="headerlink" title="2.3 ç¼“å­˜æ›´æ–°ç­–ç•¥"></a>2.3 ç¼“å­˜æ›´æ–°ç­–ç•¥</h3><p>ç¼“å­˜æ›´æ–°æ˜¯redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œè®¾è®¡å‡ºæ¥çš„ä¸€ä¸ªä¸œè¥¿ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…å­˜æ•°æ®å®è´µï¼Œå½“æˆ‘ä»¬å‘redisæ’å…¥å¤ªå¤šæ•°æ®ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®è¿‡å¤šï¼Œæ‰€ä»¥redisä¼šå¯¹éƒ¨åˆ†æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…æŠŠä»–å«ä¸ºæ·˜æ±°æ›´åˆé€‚ã€‚</p><p><strong>å†…å­˜æ·˜æ±°ï¼š</strong>redisè‡ªåŠ¨è¿›è¡Œï¼Œå½“rediså†…å­˜è¾¾åˆ°å’±ä»¬è®¾å®šçš„max-memeryçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ·˜æ±°æœºåˆ¶ï¼Œæ·˜æ±°æ‰ä¸€äº›ä¸é‡è¦çš„æ•°æ®(å¯ä»¥è‡ªå·±è®¾ç½®ç­–ç•¥æ–¹å¼)</p><p><strong>è¶…æ—¶å‰”é™¤ï¼š</strong>å½“æˆ‘ä»¬ç»™redisè®¾ç½®äº†è¿‡æœŸæ—¶é—´ttlä¹‹åï¼Œredisä¼šå°†è¶…æ—¶çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œæ–¹ä¾¿å’±ä»¬ç»§ç»­ä½¿ç”¨ç¼“å­˜</p><p><strong>ä¸»åŠ¨æ›´æ–°ï¼š</strong>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æŠŠç¼“å­˜åˆ æ‰ï¼Œé€šå¸¸ç”¨äºè§£å†³ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212282133632.png" alt=""></p><h4 id="2-3-1-ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š"><a href="#2-3-1-ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="2.3.1 ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š"></a>2.3.1 ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š</h4><p>ç”±äºæˆ‘ä»¬çš„<strong>ç¼“å­˜çš„æ•°æ®æºæ¥è‡ªäºæ•°æ®åº“</strong>,è€Œæ•°æ®åº“çš„<strong>æ•°æ®æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„</strong>,å› æ­¤,å¦‚æœå½“æ•°æ®åº“ä¸­<strong>æ•°æ®å‘ç”Ÿå˜åŒ–,è€Œç¼“å­˜å´æ²¡æœ‰åŒæ­¥</strong>,æ­¤æ—¶å°±ä¼šæœ‰<strong>ä¸€è‡´æ€§é—®é¢˜å­˜åœ¨</strong>,å…¶åæœæ˜¯:</p><p>ç”¨æˆ·ä½¿ç”¨ç¼“å­˜ä¸­çš„è¿‡æ—¶æ•°æ®,å°±ä¼šäº§ç”Ÿç±»ä¼¼å¤šçº¿ç¨‹æ•°æ®å®‰å…¨é—®é¢˜,ä»è€Œå½±å“ä¸šåŠ¡,äº§å“å£ç¢‘ç­‰;æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆï¼Œæ˜¯ä¸ºä¸»åŠ¨æ›´æ–°çš„ä¸‰ç§ç­–ç•¥ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212290931653.png" alt=""></p><h4 id="2-3-2-ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ"><a href="#2-3-2-ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ" class="headerlink" title="2.3.2 ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ"></a>2.3.2 ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ</h4><p>ç»¼åˆè€ƒè™‘ä½¿ç”¨æ–¹æ¡ˆä¸€ï¼Œä½†æ˜¯æ–¹æ¡ˆä¸€è°ƒç”¨è€…å¦‚ä½•å¤„ç†å‘¢ï¼Ÿè¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜</p><p>æ“ä½œç¼“å­˜å’Œæ•°æ®åº“æ—¶æœ‰ä¸‰ä¸ªé—®é¢˜éœ€è¦è€ƒè™‘ï¼š</p><p>å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œé‚£ä¹ˆå‡è®¾æˆ‘ä»¬æ¯æ¬¡æ“ä½œæ•°æ®åº“åï¼Œéƒ½æ“ä½œç¼“å­˜ï¼Œä½†æ˜¯ä¸­é—´å¦‚æœæ²¡æœ‰äººæŸ¥è¯¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæ›´æ–°åŠ¨ä½œå®é™…ä¸Šåªæœ‰æœ€åä¸€æ¬¡ç”Ÿæ•ˆï¼Œä¸­é—´çš„æ›´æ–°åŠ¨ä½œæ„ä¹‰å¹¶ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¼“å­˜åˆ é™¤ï¼Œç­‰å¾…å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå°†ç¼“å­˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥</p><ul><li><p>åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</p><ul><li>æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“éƒ½æ›´æ–°ç¼“å­˜ï¼Œæ— æ•ˆå†™æ“ä½œè¾ƒå¤š</li><li>åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶è®©ç¼“å­˜å¤±æ•ˆï¼ŒæŸ¥è¯¢æ—¶å†æ›´æ–°ç¼“å­˜</li></ul></li><li><p>å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„æ“ä½œçš„åŒæ—¶æˆåŠŸæˆ–å¤±è´¥ï¼Ÿ</p><ul><li>å•ä½“ç³»ç»Ÿï¼Œå°†ç¼“å­˜ä¸æ•°æ®åº“æ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåˆ©ç”¨TCCç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</li></ul></li></ul><p>åº”è¯¥å…·ä½“æ“ä½œç¼“å­˜è¿˜æ˜¯æ“ä½œæ•°æ®åº“ï¼Œæˆ‘ä»¬åº”å½“æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼ŒåŸå› åœ¨äºï¼Œå¦‚æœä½ é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ¥è®¿é—®æ—¶ï¼Œå‡è®¾çº¿ç¨‹1å…ˆæ¥ï¼Œä»–å…ˆæŠŠç¼“å­˜åˆ äº†ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ•°æ®å¹¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä»–å†™å…¥ç¼“å­˜ï¼Œå½“ä»–å†™å…¥ç¼“å­˜åï¼Œçº¿ç¨‹1å†æ‰§è¡Œæ›´æ–°åŠ¨ä½œæ—¶ï¼Œå®é™…ä¸Šå†™å…¥çš„å°±æ˜¯æ—§çš„æ•°æ®ï¼Œæ–°çš„æ•°æ®è¢«æ—§æ•°æ®è¦†ç›–äº†ã€‚</p><ul><li>å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Ÿ<ul><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“</li><li>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</li></ul></li></ul><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212290947780.png" alt=""></p><h3 id="2-4-å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"><a href="#2-4-å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´" class="headerlink" title="2.4 å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"></a>2.4 å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´</h3><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><p>ä¿®æ”¹ShopControllerä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ»¡è¶³ä¸‹é¢çš„éœ€æ±‚ï¼š</p><p>æ ¹æ®idæŸ¥è¯¢åº—é“ºæ—¶ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æ•°æ®åº“ç»“æœå†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</p><p>æ ¹æ®idä¿®æ”¹åº—é“ºæ—¶ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</p><p><strong>ä¿®æ”¹é‡ç‚¹ä»£ç 1</strong>ï¼šä¿®æ”¹<strong>ShopServiceImpl</strong>çš„queryByIdæ–¹æ³•</p><p><strong>è®¾ç½®redisç¼“å­˜æ—¶æ·»åŠ è¿‡æœŸæ—¶é—´</strong><br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291107318.png" alt=""></p><p><strong>ä¿®æ”¹é‡ç‚¹ä»£ç 2</strong></p><p>ä»£ç åˆ†æï¼šé€šè¿‡ä¹‹å‰çš„æ·˜æ±°ï¼Œæˆ‘ä»¬ç¡®å®šäº†é‡‡ç”¨åˆ é™¤ç­–ç•¥ï¼Œæ¥è§£å†³åŒå†™é—®é¢˜ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†æ•°æ®ä¹‹åï¼Œç„¶åæŠŠç¼“å­˜ä¸­çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼ŒæŸ¥è¯¢æ—¶å‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä¼šä»mysqlä¸­åŠ è½½æœ€æ–°çš„æ•°æ®ï¼Œä»è€Œé¿å…æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(Shop shop)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> shop.getId();</span><br><span class="line">    <span class="keyword">if</span>(id==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸èƒ½ä¼ å…¥ç©ºçš„åº—é“ºidï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//1ã€å†™å…¥æ•°æ®åº“</span></span><br><span class="line">    updateById(shop);</span><br><span class="line">    <span class="comment">//2. åˆ é™¤redisç¼“å­˜</span></span><br><span class="line">    stringRedisTemplate.delete(CACHE_SHOP_KEY + id);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br></pre></td></tr></table></figure><h3 id="2-5-ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯"><a href="#2-5-ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯" class="headerlink" title="2.5 ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯"></a>2.5 ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯</h3><p>ç¼“å­˜ç©¿é€ ï¼šç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ç¼“å­˜ç©ºå¯¹è±¡<ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼š<ul><li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li><li>å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</li></ul></li></ul></li><li>å¸ƒéš†è¿‡æ»¤<ul><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š<ul><li>å®ç°å¤æ‚</li><li>å­˜åœ¨è¯¯åˆ¤å¯èƒ½</li></ul></li></ul></li></ul><p><strong>ç¼“å­˜ç©ºå¯¹è±¡æ€è·¯åˆ†æï¼š</strong>å½“æˆ‘ä»¬å®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œå…ˆè¯·æ±‚redisï¼Œä½†æ˜¯æ­¤æ—¶redisä¸­æ²¡æœ‰æ•°æ®ï¼Œæ­¤æ—¶ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ç©¿é€äº†ç¼“å­˜ï¼Œç›´å‡»æ•°æ®åº“ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®åº“èƒ½å¤Ÿæ‰¿è½½çš„å¹¶å‘ä¸å¦‚redisè¿™ä¹ˆé«˜ï¼Œå¦‚æœå¤§é‡çš„è¯·æ±‚åŒæ—¶è¿‡æ¥è®¿é—®è¿™ç§ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™äº›è¯·æ±‚å°±éƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å“ªæ€•è¿™ä¸ªæ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ä¸ªæ•°æ®å­˜å…¥åˆ°redisä¸­å»ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡ç”¨æˆ·è¿‡æ¥è®¿é—®è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨redisä¸­ä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªæ•°æ®å°±ä¸ä¼šè¿›å…¥åˆ°ç¼“å­˜äº†</p><p><strong>å¸ƒéš†è¿‡æ»¤ï¼š</strong>å¸ƒéš†è¿‡æ»¤å™¨å…¶å®é‡‡ç”¨çš„æ˜¯å“ˆå¸Œæ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªåºå¤§çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œèµ°å“ˆå¸Œæ€æƒ³å»åˆ¤æ–­å½“å‰è¿™ä¸ªè¦æŸ¥è¯¢çš„è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå»è®¿é—®redisï¼Œå“ªæ€•æ­¤æ—¶redisä¸­çš„æ•°æ®è¿‡æœŸäº†ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥è¿™ä¸ªæ•°æ®åï¼Œå†å°†å…¶æ”¾å…¥åˆ°redisä¸­ï¼Œ</p><p>å‡è®¾å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</p><p>è¿™ç§æ–¹å¼ä¼˜ç‚¹åœ¨äºèŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œå­˜åœ¨è¯¯åˆ¤ï¼Œè¯¯åˆ¤åŸå› åœ¨äºï¼šå¸ƒéš†è¿‡æ»¤å™¨èµ°çš„æ˜¯å“ˆå¸Œæ€æƒ³ï¼Œåªè¦å“ˆå¸Œæ€æƒ³ï¼Œå°±å¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çª</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291154146.png" alt=""></p><h3 id="2-6-ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š"><a href="#2-6-ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š" class="headerlink" title="2.6 ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š"></a>2.6 ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š</h3><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><p>åœ¨åŸæ¥çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°è¿™ä¸ªæ•°æ®åœ¨mysqlä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥å°±è¿”å›404äº†ï¼Œè¿™æ ·æ˜¯ä¼šå­˜åœ¨ç¼“å­˜ç©¿é€é—®é¢˜çš„</p><p>ç°åœ¨çš„é€»è¾‘ä¸­ï¼šå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸ä¼šè¿”å›404 ï¼Œè¿˜æ˜¯ä¼šæŠŠè¿™ä¸ªæ•°æ®å†™å…¥åˆ°Redisä¸­ï¼Œå¹¶ä¸”å°†valueè®¾ç½®ä¸ºç©ºï¼Œæ¬§å½“å†æ¬¡å‘èµ·æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°å‘½ä¸­ä¹‹åï¼Œåˆ¤æ–­è¿™ä¸ªvalueæ˜¯å¦æ˜¯nullï¼Œå¦‚æœæ˜¯nullï¼Œåˆ™æ˜¯ä¹‹å‰å†™å…¥çš„æ•°æ®ï¼Œè¯æ˜æ˜¯ç¼“å­˜ç©¿é€æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291307886.png" alt=""></p><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç¼“å­˜ç©¿é€äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œä¸æ–­å‘èµ·è¿™æ ·çš„è¯·æ±‚ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›</li></ul><p>ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><ul><li>ç¼“å­˜nullå€¼</li><li>å¸ƒéš†è¿‡æ»¤</li><li>å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹</li><li>åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li><li>åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ</li><li>åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ</li></ul><h3 id="2-7-ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯"><a href="#2-7-ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯" class="headerlink" title="2.7 ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯"></a>2.7 ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li></ul><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291308607.png" alt=""></p><h3 id="2-8-ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯"><a href="#2-8-ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯" class="headerlink" title="2.8 ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯"></a>2.8 ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>ç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>äº’æ–¥é”</li><li>é€»è¾‘è¿‡æœŸ</li></ul><p>é€»è¾‘åˆ†æï¼šå‡è®¾çº¿ç¨‹1åœ¨æŸ¥è¯¢ç¼“å­˜ä¹‹åï¼Œæœ¬æ¥åº”è¯¥å»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®é‡æ–°åŠ è½½åˆ°ç¼“å­˜çš„ï¼Œæ­¤æ—¶åªè¦çº¿ç¨‹1èµ°å®Œè¿™ä¸ªé€»è¾‘ï¼Œå…¶ä»–çº¿ç¨‹å°±éƒ½èƒ½ä»ç¼“å­˜ä¸­åŠ è½½è¿™äº›æ•°æ®äº†ï¼Œä½†æ˜¯å‡è®¾åœ¨çº¿ç¨‹1æ²¡æœ‰èµ°å®Œçš„æ—¶å€™ï¼Œåç»­çš„çº¿ç¨‹2ï¼Œçº¿ç¨‹3ï¼Œçº¿ç¨‹4åŒæ—¶è¿‡æ¥è®¿é—®å½“å‰è¿™ä¸ªæ–¹æ³•ï¼Œ é‚£ä¹ˆè¿™äº›çº¿ç¨‹éƒ½ä¸èƒ½ä»ç¼“å­˜ä¸­æŸ¥è¯¢åˆ°æ•°æ®ï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šåŒä¸€æ—¶åˆ»æ¥è®¿é—®æŸ¥è¯¢ç¼“å­˜ï¼Œéƒ½æ²¡æŸ¥åˆ°ï¼Œæ¥ç€åŒä¸€æ—¶é—´å»è®¿é—®æ•°æ®åº“ï¼ŒåŒæ—¶çš„å»æ‰§è¡Œæ•°æ®åº“ä»£ç ï¼Œå¯¹æ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§</p><p>è§£å†³æ–¹æ¡ˆä¸€ã€ä½¿ç”¨é”æ¥è§£å†³ï¼š</p><p>å› ä¸ºé”èƒ½å®ç°äº’æ–¥æ€§ã€‚å‡è®¾çº¿ç¨‹è¿‡æ¥ï¼Œåªèƒ½ä¸€ä¸ªäººä¸€ä¸ªäººçš„æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé¿å…å¯¹äºæ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§ï¼Œä½†è¿™ä¹Ÿä¼šå½±å“æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå› ä¸ºæ­¤æ—¶ä¼šè®©æŸ¥è¯¢çš„æ€§èƒ½ä»å¹¶è¡Œå˜æˆäº†ä¸²è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨tryLockæ–¹æ³• + double checkæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p><p>å‡è®¾ç°åœ¨çº¿ç¨‹1è¿‡æ¥è®¿é—®ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä»–è·å¾—åˆ°äº†é”çš„èµ„æºï¼Œé‚£ä¹ˆçº¿ç¨‹1å°±ä¼šä¸€ä¸ªäººå»æ‰§è¡Œé€»è¾‘ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰è·å¾—åˆ°é”ï¼Œé‚£ä¹ˆçº¿ç¨‹2å°±å¯ä»¥è¿›è¡Œåˆ°ä¼‘çœ ï¼Œç›´åˆ°çº¿ç¨‹1æŠŠé”é‡Šæ”¾åï¼Œçº¿ç¨‹2è·å¾—åˆ°é”ï¼Œç„¶åå†æ¥æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶å°±èƒ½å¤Ÿä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</p><p>è§£å†³æ–¹æ¡ˆäºŒã€é€»è¾‘è¿‡æœŸæ–¹æ¡ˆ</p><p>æ–¹æ¡ˆåˆ†æï¼šæˆ‘ä»¬ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯åœ¨äºæˆ‘ä»¬å¯¹keyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå‡è®¾æˆ‘ä»¬ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…¶å®å°±ä¸ä¼šæœ‰ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·æ•°æ®ä¸å°±ä¸€ç›´å ç”¨æˆ‘ä»¬å†…å­˜äº†å—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨é€»è¾‘è¿‡æœŸæ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®åœ¨ redisçš„valueä¸­ï¼Œæ³¨æ„ï¼šè¿™ä¸ªè¿‡æœŸæ—¶é—´å¹¶ä¸ä¼šç›´æ¥ä½œç”¨äºredisï¼Œè€Œæ˜¯æˆ‘ä»¬åç»­é€šè¿‡é€»è¾‘å»å¤„ç†ã€‚å‡è®¾çº¿ç¨‹1å»æŸ¥è¯¢ç¼“å­˜ï¼Œç„¶åä»valueä¸­åˆ¤æ–­å‡ºæ¥å½“å‰çš„æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œæ­¤æ—¶çº¿ç¨‹1å»è·å¾—äº’æ–¥é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹ä¼šè¿›è¡Œé˜»å¡ï¼Œè·å¾—äº†é”çš„çº¿ç¨‹ä»–ä¼šå¼€å¯ä¸€ä¸ª çº¿ç¨‹å»è¿›è¡Œ ä»¥å‰çš„é‡æ„æ•°æ®çš„é€»è¾‘ï¼Œç›´åˆ°æ–°å¼€çš„çº¿ç¨‹å®Œæˆè¿™ä¸ªé€»è¾‘åï¼Œæ‰é‡Šæ”¾é”ï¼Œ è€Œçº¿ç¨‹1ç›´æ¥è¿›è¡Œè¿”å›ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹3è¿‡æ¥è®¿é—®ï¼Œç”±äºçº¿ç¨‹çº¿ç¨‹2æŒæœ‰ç€é”ï¼Œæ‰€ä»¥çº¿ç¨‹3æ— æ³•è·å¾—é”ï¼Œçº¿ç¨‹3ä¹Ÿç›´æ¥è¿”å›æ•°æ®ï¼Œåªæœ‰ç­‰åˆ°æ–°å¼€çš„çº¿ç¨‹2æŠŠé‡å»ºæ•°æ®æ„å»ºå®Œåï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½èµ°è¿”å›æ­£ç¡®çš„æ•°æ®ã€‚</p><p>è¿™ç§æ–¹æ¡ˆå·§å¦™åœ¨äºï¼Œå¼‚æ­¥çš„æ„å»ºç¼“å­˜ï¼Œç¼ºç‚¹åœ¨äºåœ¨æ„å»ºå®Œç¼“å­˜ä¹‹å‰ï¼Œè¿”å›çš„éƒ½æ˜¯è„æ•°æ®ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291536357.png" alt=""></p><p>è¿›è¡Œå¯¹æ¯”</p><p><strong>äº’æ–¥é”æ–¹æ¡ˆï¼š</strong>ç”±äºä¿è¯äº†äº’æ–¥æ€§ï¼Œæ‰€ä»¥æ•°æ®ä¸€è‡´ï¼Œä¸”å®ç°ç®€å•ï¼Œå› ä¸ºä»…ä»…åªéœ€è¦åŠ ä¸€æŠŠé”è€Œå·²ï¼Œä¹Ÿæ²¡å…¶ä»–çš„äº‹æƒ…éœ€è¦æ“å¿ƒï¼Œæ‰€ä»¥æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œç¼ºç‚¹åœ¨äºæœ‰é”å°±æœ‰æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä¸”åªèƒ½ä¸²è¡Œæ‰§è¡Œæ€§èƒ½è‚¯å®šå—åˆ°å½±å“</p><p><strong>é€»è¾‘è¿‡æœŸæ–¹æ¡ˆï¼š</strong> çº¿ç¨‹è¯»å–è¿‡ç¨‹ä¸­ä¸éœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å¥½ï¼Œæœ‰ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æŒæœ‰é”å»è¿›è¡Œé‡æ„æ•°æ®ï¼Œä½†æ˜¯åœ¨é‡æ„æ•°æ®å®Œæˆå‰ï¼Œå…¶ä»–çš„çº¿ç¨‹åªèƒ½è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œä¸”å®ç°èµ·æ¥éº»çƒ¦</p><p>æ‰€ä»¥äºŒè€…å¹¶æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ£ä¹‹åˆ†ï¼Œåªæ˜¯åœ¨æ‰€è¦éœ€æ±‚ä¸Šæœ‰æ‰€å–èˆ</p><h3 id="2-9-åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"><a href="#2-9-åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜" class="headerlink" title="2.9 åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"></a>2.9 åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p>æ ¸å¿ƒæ€è·¯ï¼šç›¸è¾ƒäºåŸæ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®åç›´æ¥æŸ¥è¯¢æ•°æ®åº“è€Œè¨€ï¼Œç°åœ¨çš„æ–¹æ¡ˆæ˜¯ è¿›è¡ŒæŸ¥è¯¢ä¹‹åï¼Œå¦‚æœä»ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™è¿›è¡Œäº’æ–¥é”çš„è·å–ï¼Œè·å–äº’æ–¥é”åï¼Œåˆ¤æ–­æ˜¯å¦è·å¾—åˆ°äº†é”ï¼Œå¦‚æœæ²¡æœ‰è·å¾—åˆ°ï¼Œåˆ™ä¼‘çœ ï¼Œè¿‡ä¸€ä¼šå†è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ï¼Œæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢</p><p>å¦‚æœè·å–åˆ°äº†é”çš„çº¿ç¨‹ï¼Œå†å»è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åå°†æ•°æ®å†™å…¥redisï¼Œå†é‡Šæ”¾é”ï¼Œè¿”å›æ•°æ®ï¼Œåˆ©ç”¨äº’æ–¥é”å°±èƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œæ“ä½œæ•°æ®åº“çš„é€»è¾‘ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291553419.png" alt=""></p><p><strong>æ“ä½œé”çš„ä»£ç ï¼š</strong></p><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨redisçš„setnxæ–¹æ³•æ¥è¡¨ç¤ºè·å–é”ï¼Œè¯¥æ–¹æ³•å«ä¹‰æ˜¯redisä¸­å¦‚æœæ²¡æœ‰è¿™ä¸ªkeyï¼Œåˆ™æ’å…¥æˆåŠŸï¼Œè¿”å›1ï¼Œåœ¨stringRedisTemplateä¸­è¿”å›trueï¼Œ  å¦‚æœæœ‰è¿™ä¸ªkeyåˆ™æ’å…¥å¤±è´¥ï¼Œåˆ™è¿”å›0ï¼Œåœ¨stringRedisTemplateè¿”å›falseï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡trueï¼Œæˆ–è€…æ˜¯falseï¼Œæ¥è¡¨ç¤ºæ˜¯å¦æœ‰çº¿ç¨‹æˆåŠŸæ’å…¥keyï¼ŒæˆåŠŸæ’å…¥çš„keyçš„çº¿ç¨‹æˆ‘ä»¬è®¤ä¸ºä»–å°±æ˜¯è·å¾—åˆ°é”çš„çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    stringRedisTemplate.delete(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ“ä½œä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryWithMutex</span><span class="params">(Long id)</span>  &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">       <span class="comment">// 1ã€ä»redisä¸­æŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">       <span class="comment">// 2ã€åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">       <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">           <span class="comment">// å­˜åœ¨,ç›´æ¥è¿”å›</span></span><br><span class="line">           <span class="keyword">return</span> JSONUtil.toBean(shopJson, Shop.class);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//åˆ¤æ–­å‘½ä¸­çš„å€¼æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">       <span class="keyword">if</span> (shopJson != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="comment">//è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">           <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 4.å®ç°ç¼“å­˜é‡æ„</span></span><br><span class="line">       <span class="comment">//4.1 è·å–äº’æ–¥é”</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> <span class="string">&quot;lock:shop:&quot;</span> + id;</span><br><span class="line">       <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">           <span class="comment">// 4.2 åˆ¤æ–­å¦è·å–æˆåŠŸ</span></span><br><span class="line">           <span class="keyword">if</span>(!isLock)&#123;</span><br><span class="line">               <span class="comment">//4.3 å¤±è´¥ï¼Œåˆ™ä¼‘çœ é‡è¯•</span></span><br><span class="line">               Thread.sleep(<span class="number">50</span>);</span><br><span class="line">               <span class="keyword">return</span> queryWithMutex(id);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//4.4 æˆåŠŸï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">            shop = getById(id);</span><br><span class="line">           <span class="comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">           <span class="keyword">if</span>(shop == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">               stringRedisTemplate.opsForValue().set(key,<span class="string">&quot;&quot;</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line">               <span class="comment">//è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">               <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//6.å†™å…¥redis</span></span><br><span class="line">           stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop),CACHE_NULL_TTL,TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">finally</span> &#123;</span><br><span class="line">           <span class="comment">//7.é‡Šæ”¾äº’æ–¥é”</span></span><br><span class="line">           unlock(lockKey);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> shop;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="3-0-ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"><a href="#3-0-ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜" class="headerlink" title="3.0 ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"></a>3.0 ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p><strong>éœ€æ±‚ï¼šä¿®æ”¹æ ¹æ®idæŸ¥è¯¢å•†é“ºçš„ä¸šåŠ¡ï¼ŒåŸºäºé€»è¾‘è¿‡æœŸæ–¹å¼æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</strong></p><p>æ€è·¯åˆ†æï¼šå½“ç”¨æˆ·å¼€å§‹æŸ¥è¯¢redisæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç›´æ¥è¿”å›ç©ºæ•°æ®ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œä¸€æ—¦å‘½ä¸­åï¼Œå°†valueå–å‡ºï¼Œåˆ¤æ–­valueä¸­çš„è¿‡æœŸæ—¶é—´æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›redisä¸­çš„æ•°æ®ï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ™åœ¨å¼€å¯ç‹¬ç«‹çº¿ç¨‹åç›´æ¥è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œç‹¬ç«‹çº¿ç¨‹å»é‡æ„æ•°æ®ï¼Œé‡æ„å®Œæˆåé‡Šæ”¾äº’æ–¥é”ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291713829.png" alt=""></p><p>å¦‚æœå°è£…æ•°æ®ï¼šå› ä¸ºç°åœ¨redisä¸­å­˜å‚¨çš„æ•°æ®çš„valueéœ€è¦å¸¦ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶è¦ä¹ˆä½ å»ä¿®æ”¹åŸæ¥çš„å®ä½“ç±»ï¼Œè¦ä¹ˆä½ </p><p><strong>æ­¥éª¤ä¸€ã€</strong></p><p>æ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆï¼Œå¯¹åŸæ¥ä»£ç æ²¡æœ‰ä¾µå…¥æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime expireTime;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒã€</strong></p><p>åœ¨<strong>ShopServiceImpl</strong> æ–°å¢æ­¤æ–¹æ³•ï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•è¿›è¡Œç¼“å­˜é¢„çƒ­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveShopRedis</span><span class="params">(Long id,Long expireSeconds)</span>&#123;</span><br><span class="line">    <span class="comment">//1. æŸ¥è¯¢åº—é“ºæ•°æ®</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="comment">//2. å°è£…é€»è¾‘æ—¶é—´è¿‡æœŸç±»</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">    redisData.setData(shop);</span><br><span class="line">    redisData.setExpireTime(LocalDateTime.now().plusSeconds(expireSeconds));</span><br><span class="line">    <span class="comment">//3. å†™å…¥redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(CACHE_SHOP_KEY+id,JSONUtil.toJsonStr(redisData));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨æµ‹è¯•ç±»ä¸­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HmDianPingApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ShopServiceImpl shopService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveShop</span><span class="params">()</span>&#123;</span><br><span class="line">        shopService.saveShopRedis(<span class="number">11l</span>,<span class="number">10l</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212291813092.png" alt=""></p><p>æ­¥éª¤ä¸‰ï¼šæ­£å¼ä»£ç </p><p><strong>ShopServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨çº¿ç¨‹æ± å¼€å¯æ–°çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">public</span> Shop <span class="title function_">queryWithLogicalExpire</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//1. ä»redisä¸­æŸ¥è¯¢å•†é“º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJs</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//2. å•†é“ºä¸å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(shopJs)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. å•†é“ºå­˜åœ¨ï¼Œé¦–å…ˆå…ˆéœ€è¦è·å–åˆ°çœŸæ­£çš„åº—é“ºä¿¡æ¯ï¼Œéœ€è¿›è¡Œè½¬æ¢</span></span><br><span class="line">    <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(shopJs, RedisData.class);</span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);</span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">    <span class="comment">//4. åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">    <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now()))&#123;</span><br><span class="line">        <span class="comment">//4.1 å¦‚æœæœªè¿‡æœŸï¼Œè¿”å›å•†é“ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> shop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//4.2 è¿‡æœŸï¼Œå°è¯•è·å–äº’æ–¥é”</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">    <span class="comment">//5. è·å–æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹</span></span><br><span class="line">    <span class="comment">//5.1 ç‹¬ç«‹çº¿ç¨‹ç¼“å­˜é‡å»º</span></span><br><span class="line">        CACHE_REBUILD_EXECUTOR.submit(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.saveShopRedis(id,<span class="number">10L</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//5.2 å…³é—­äº’æ–¥é”</span></span><br><span class="line">                delLock(lockKey);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6. è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> shop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-1ã€å°è£…Rediså·¥å…·ç±»"><a href="#3-1ã€å°è£…Rediså·¥å…·ç±»" class="headerlink" title="3.1ã€å°è£…Rediså·¥å…·ç±»"></a>3.1ã€å°è£…Rediså·¥å…·ç±»</h3><p>åŸºäºStringRedisTemplateå°è£…ä¸€ä¸ªç¼“å­˜å·¥å…·ç±»ï¼Œæ»¡è¶³ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>æ–¹æ³•1ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®TTLè¿‡æœŸæ—¶é—´</li><li><p>æ–¹æ³•2ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“å­˜å‡»ç©¿é—®é¢˜</p></li><li><p>æ–¹æ³•3ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œåˆ©ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹å¼è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</p></li><li>æ–¹æ³•4ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œéœ€è¦åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</li></ul><p>å°†é€»è¾‘è¿›è¡Œå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">CACHE_REBUILD_EXECUTOR</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CacheClient</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setWithLogicalExpire</span><span class="params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®é€»è¾‘è¿‡æœŸ</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisData</span>();</span><br><span class="line">        redisData.setData(value);</span><br><span class="line">        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));</span><br><span class="line">        <span class="comment">// å†™å…¥Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R,ID&gt; R <span class="title function_">queryWithPassThrough</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(json)) &#123;</span><br><span class="line">            <span class="comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(json, type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">        <span class="keyword">if</span> (json != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">        <span class="comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">        <span class="keyword">if</span> (r == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">            stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">            <span class="comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">        <span class="built_in">this</span>.set(key, r, time, unit);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithLogicalExpire</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(json)) &#123;</span><br><span class="line">            <span class="comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">RedisData</span> <span class="variable">redisData</span> <span class="operator">=</span> JSONUtil.toBean(json, RedisData.class);</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">expireTime</span> <span class="operator">=</span> redisData.getExpireTime();</span><br><span class="line">        <span class="comment">// 5.åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">        <span class="keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// 5.1.æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.2.å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6.ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 6.1.è·å–äº’æ–¥é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">        <span class="comment">// 6.2.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span> (isLock)&#123;</span><br><span class="line">            <span class="comment">// 6.3.æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">            CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">                    <span class="type">R</span> <span class="variable">newR</span> <span class="operator">=</span> dbFallback.apply(id);</span><br><span class="line">                    <span class="comment">// é‡å»ºç¼“å­˜</span></span><br><span class="line">                    <span class="built_in">this</span>.setWithLogicalExpire(key, newR, time, unit);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">                    unlock(lockKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.4.è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;R, ID&gt; R <span class="title function_">queryWithMutex</span><span class="params">(</span></span><br><span class="line"><span class="params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keyPrefix + id;</span><br><span class="line">        <span class="comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">            <span class="comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> JSONUtil.toBean(shopJson, type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></span><br><span class="line">        <span class="keyword">if</span> (shopJson != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.å®ç°ç¼“å­˜é‡å»º</span></span><br><span class="line">        <span class="comment">// 4.1.è·å–äº’æ–¥é”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lockKey</span> <span class="operator">=</span> LOCK_SHOP_KEY + id;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> tryLock(lockKey);</span><br><span class="line">            <span class="comment">// 4.2.åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">                <span class="comment">// 4.3.è·å–é”å¤±è´¥ï¼Œä¼‘çœ å¹¶é‡è¯•</span></span><br><span class="line">                Thread.sleep(<span class="number">50</span>);</span><br><span class="line">                <span class="keyword">return</span> queryWithMutex(keyPrefix, id, type, dbFallback, time, unit);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 4.4.è·å–é”æˆåŠŸï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span></span><br><span class="line">            r = dbFallback.apply(id);</span><br><span class="line">            <span class="comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">            <span class="keyword">if</span> (r == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†ç©ºå€¼å†™å…¥redis</span></span><br><span class="line">                stringRedisTemplate.opsForValue().set(key, <span class="string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);</span><br><span class="line">                <span class="comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span></span><br><span class="line">            <span class="built_in">this</span>.set(key, r, time, unit);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 7.é‡Šæ”¾é”</span></span><br><span class="line">            unlock(lockKey);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 8.è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="string">&quot;1&quot;</span>, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> BooleanUtil.isTrue(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ShopServiceImpl ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> CacheClient cacheClient;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£å†³ç¼“å­˜ç©¿é€</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> cacheClient</span><br><span class="line">                .queryWithPassThrough(CACHE_SHOP_KEY, id, Shop.class, <span class="built_in">this</span>::getById, CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">        <span class="comment">// Shop shop = cacheClient</span></span><br><span class="line">        <span class="comment">//         .queryWithMutex(CACHE_SHOP_KEY, id, Shop.class, this::getById, CACHE_SHOP_TTL, TimeUnit.MINUTES);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿</span></span><br><span class="line">        <span class="comment">// Shop shop = cacheClient</span></span><br><span class="line">        <span class="comment">//         .queryWithLogicalExpire(CACHE_SHOP_KEY, id, Shop.class, this::getById, 20L, TimeUnit.SECONDS);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shop == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 7.è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>p.s. Function<ID, R> dbFallback å…¶ä¸­æ˜¯ä¸¤ä¸ªæ³›å‹ï¼Œä¸€ä¸ªæ˜¯å‚æ•°çš„ç±»å‹ï¼Œä¸€ä¸ªæ˜¯è¿”å›å€¼çš„ç±»å‹</p><h2 id="3ã€ä¼˜æƒ å·ç§’æ€"><a href="#3ã€ä¼˜æƒ å·ç§’æ€" class="headerlink" title="3ã€ä¼˜æƒ å·ç§’æ€"></a>3ã€ä¼˜æƒ å·ç§’æ€</h2><h3 id="3-1-å…¨å±€å”¯ä¸€ID"><a href="#3-1-å…¨å±€å”¯ä¸€ID" class="headerlink" title="3.1 -å…¨å±€å”¯ä¸€ID"></a>3.1 -å…¨å±€å”¯ä¸€ID</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸,å½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œè€Œè®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDå°±å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾</li><li>å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶</li></ul><p>åœºæ™¯åˆ†æï¼šå¦‚æœæˆ‘ä»¬çš„idå…·æœ‰å¤ªæ˜æ˜¾çš„è§„åˆ™ï¼Œç”¨æˆ·æˆ–è€…è¯´å•†ä¸šå¯¹æ‰‹å¾ˆå®¹æ˜“çŒœæµ‹å‡ºæ¥æˆ‘ä»¬çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å•†åŸåœ¨ä¸€å¤©æ—¶é—´å†…ï¼Œå–å‡ºäº†å¤šå°‘å•ï¼Œè¿™æ˜æ˜¾ä¸åˆé€‚ã€‚</p><p>åœºæ™¯åˆ†æäºŒï¼šéšç€æˆ‘ä»¬å•†åŸè§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œmysqlçš„å•è¡¨çš„å®¹é‡ä¸å®œè¶…è¿‡500Wï¼Œæ•°æ®é‡è¿‡å¤§ä¹‹åï¼Œæˆ‘ä»¬è¦è¿›è¡Œæ‹†åº“æ‹†è¡¨ï¼Œä½†æ‹†åˆ†è¡¨äº†ä¹‹åï¼Œä»–ä»¬ä»é€»è¾‘ä¸Šè®²ä»–ä»¬æ˜¯åŒä¸€å¼ è¡¨ï¼Œæ‰€ä»¥ä»–ä»¬çš„idæ˜¯ä¸èƒ½ä¸€æ ·çš„ï¼Œ äºæ˜¯ä¹æˆ‘ä»¬éœ€è¦ä¿è¯idçš„å”¯ä¸€æ€§ã€‚</p><p><strong>å…¨å±€IDç”Ÿæˆå™¨</strong>ï¼Œæ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç”¨æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„å·¥å…·ï¼Œä¸€èˆ¬è¦æ»¡è¶³ä¸‹åˆ—ç‰¹æ€§ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212312053187.png" alt=""></p><p>ä¸ºäº†å¢åŠ IDçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨Redisè‡ªå¢çš„æ•°å€¼ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202212312053582.png" alt=""></p><h3 id="3-2-Rediså®ç°å…¨å±€å”¯ä¸€Id"><a href="#3-2-Rediså®ç°å…¨å±€å”¯ä¸€Id" class="headerlink" title="3.2 -Rediså®ç°å…¨å±€å”¯ä¸€Id"></a>3.2 -Rediså®ç°å…¨å±€å”¯ä¸€Id</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisIdWorker</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å§‹æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BEGIN_TIMESTAMP</span> <span class="operator">=</span> <span class="number">1640995200L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—å·çš„ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">COUNT_BITS</span> <span class="operator">=</span> <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisIdWorker</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">nextId</span><span class="params">(String keyPrefix)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.ç”Ÿæˆæ—¶é—´æˆ³</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">long</span> <span class="variable">nowSecond</span> <span class="operator">=</span> now.toEpochSecond(ZoneOffset.UTC);</span><br><span class="line">        <span class="type">long</span> <span class="variable">timestamp</span> <span class="operator">=</span> nowSecond - BEGIN_TIMESTAMP;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.ç”Ÿæˆåºåˆ—å·</span></span><br><span class="line">        <span class="comment">// 2.1.è·å–å½“å‰æ—¥æœŸï¼Œç²¾ç¡®åˆ°å¤©</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy:MM:dd&quot;</span>));</span><br><span class="line">        <span class="comment">// 2.2.è‡ªå¢é•¿</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="string">&quot;icr:&quot;</span> + keyPrefix + <span class="string">&quot;:&quot;</span> + date);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> timestamp &lt;&lt; COUNT_BITS | count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><p>çŸ¥è¯†å°è´´å£«ï¼šå…³äºcountdownlatch</p><p>countdownlatchåä¸ºä¿¡å·æªï¼šä¸»è¦çš„ä½œç”¨æ˜¯åŒæ­¥åè°ƒåœ¨å¤šçº¿ç¨‹çš„ç­‰å¾…äºå”¤é†’é—®é¢˜</p><p>æˆ‘ä»¬å¦‚æœæ²¡æœ‰CountDownLatch ï¼Œé‚£ä¹ˆç”±äºç¨‹åºæ˜¯å¼‚æ­¥çš„ï¼Œå½“å¼‚æ­¥ç¨‹åºæ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œä¸»çº¿ç¨‹å°±å·²ç»æ‰§è¡Œå®Œäº†ï¼Œç„¶åæˆ‘ä»¬æœŸæœ›çš„æ˜¯åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œä¹‹åï¼Œä¸»çº¿ç¨‹å†èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­¤æ—¶éœ€è¦ä½¿ç”¨åˆ°CountDownLatch</p><p>CountDownLatch ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•</p><p>1ã€countDown</p><p>2ã€await</p><p>await æ–¹æ³• æ˜¯é˜»å¡æ–¹æ³•ï¼Œæˆ‘ä»¬æ‹…å¿ƒåˆ†çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œmainçº¿ç¨‹å°±å…ˆæ‰§è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨awaitå¯ä»¥è®©mainçº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™mainçº¿ç¨‹ä¸å†é˜»å¡å‘¢ï¼Ÿå½“CountDownLatch  å†…éƒ¨ç»´æŠ¤çš„ å˜é‡å˜ä¸º0æ—¶ï¼Œå°±ä¸å†é˜»å¡ï¼Œç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™CountDownLatch   ç»´æŠ¤çš„å˜é‡å˜ä¸º0 å‘¢ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€æ¬¡countDown ï¼Œå†…éƒ¨å˜é‡å°±å‡å°‘1ï¼Œæˆ‘ä»¬è®©åˆ†çº¿ç¨‹å’Œå˜é‡ç»‘å®šï¼Œ æ‰§è¡Œå®Œä¸€ä¸ªåˆ†çº¿ç¨‹å°±å‡å°‘ä¸€ä¸ªå˜é‡ï¼Œå½“åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œï¼ŒCountDownLatch ç»´æŠ¤çš„å˜é‡å°±æ˜¯0ï¼Œæ­¤æ—¶awaitå°±ä¸å†é˜»å¡ï¼Œç»Ÿè®¡å‡ºæ¥çš„æ—¶é—´ä¹Ÿå°±æ˜¯æ‰€æœ‰åˆ†çº¿ç¨‹æ‰§è¡Œå®Œåçš„æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testIdWorker</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">300</span>; i++) &#123;</span><br><span class="line">        es.submit(task);</span><br><span class="line">    &#125;</span><br><span class="line">    latch.await();</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;time = &quot;</span> + (end - begin));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-æ·»åŠ ä¼˜æƒ å·"><a href="#3-3-æ·»åŠ ä¼˜æƒ å·" class="headerlink" title="3.3 æ·»åŠ ä¼˜æƒ å·"></a>3.3 æ·»åŠ ä¼˜æƒ å·</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼Œåˆ†ä¸ºå¹³ä»·åˆ¸å’Œç‰¹ä»·åˆ¸ã€‚å¹³ä»·åˆ¸å¯ä»¥ä»»æ„è´­ä¹°ï¼Œè€Œç‰¹ä»·åˆ¸éœ€è¦ç§’æ€æŠ¢è´­ï¼š</p><p>tb_voucherï¼šä¼˜æƒ åˆ¸çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¼˜æƒ é‡‘é¢ã€ä½¿ç”¨è§„åˆ™ç­‰<br>tb_seckill_voucherï¼šä¼˜æƒ åˆ¸çš„åº“å­˜ã€å¼€å§‹æŠ¢è´­æ—¶é—´ï¼Œç»“æŸæŠ¢è´­æ—¶é—´ã€‚ç‰¹ä»·ä¼˜æƒ åˆ¸æ‰éœ€è¦å¡«å†™è¿™äº›ä¿¡æ¯</p><p>å¹³ä»·å·ç”±äºä¼˜æƒ åŠ›åº¦å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ä»»æ„é¢†å–</p><p>è€Œä»£é‡‘åˆ¸ç”±äºä¼˜æƒ åŠ›åº¦å¤§ï¼Œæ‰€ä»¥åƒç¬¬äºŒç§å·ï¼Œå°±å¾—é™åˆ¶æ•°é‡ï¼Œä»è¡¨ç»“æ„ä¸Šä¹Ÿèƒ½çœ‹å‡ºï¼Œç‰¹ä»·å·é™¤äº†å…·æœ‰ä¼˜æƒ å·çš„åŸºæœ¬ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜å…·æœ‰åº“å­˜ï¼ŒæŠ¢è´­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ç­‰ç­‰å­—æ®µ</p><p><strong>æ–°å¢æ™®é€šå·ä»£ç ï¼š  </strong>VoucherController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addVoucher</span><span class="params">(<span class="meta">@RequestBody</span> Voucher voucher)</span> &#123;</span><br><span class="line">    voucherService.save(voucher);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(voucher.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–°å¢ç§’æ€å·ä»£ç ï¼š</strong></p><p><strong>VoucherController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;seckill&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addSeckillVoucher</span><span class="params">(<span class="meta">@RequestBody</span> Voucher voucher)</span> &#123;</span><br><span class="line">    voucherService.addSeckillVoucher(voucher);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(voucher.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>VoucherServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-å®ç°ç§’æ€ä¸‹å•"><a href="#3-4-å®ç°ç§’æ€ä¸‹å•" class="headerlink" title="3.4 å®ç°ç§’æ€ä¸‹å•"></a>3.4 å®ç°ç§’æ€ä¸‹å•</h3><p>ä¸‹å•æ ¸å¿ƒæ€è·¯ï¼šå½“æˆ‘ä»¬ç‚¹å‡»æŠ¢è´­æ—¶ï¼Œä¼šè§¦å‘å³ä¾§çš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”çš„controllerå³å¯</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301021642485.png" alt=""></p><p>ç§’æ€ä¸‹å•åº”è¯¥æ€è€ƒçš„å†…å®¹ï¼š</p><p>ä¸‹å•æ—¶éœ€è¦åˆ¤æ–­ä¸¤ç‚¹ï¼š</p><ul><li>ç§’æ€æ˜¯å¦å¼€å§‹æˆ–ç»“æŸï¼Œå¦‚æœå°šæœªå¼€å§‹æˆ–å·²ç»ç»“æŸåˆ™æ— æ³•ä¸‹å•</li><li>åº“å­˜æ˜¯å¦å……è¶³ï¼Œä¸è¶³åˆ™æ— æ³•ä¸‹å•</li></ul><p>ä¸‹å•æ ¸å¿ƒé€»è¾‘åˆ†æï¼š</p><p>å½“ç”¨æˆ·å¼€å§‹è¿›è¡Œä¸‹å•ï¼Œæˆ‘ä»¬åº”å½“å»æŸ¥è¯¢ä¼˜æƒ å·ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°ä¼˜æƒ å·ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ç§’æ€æ¡ä»¶</p><p>æ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸¤è€…éƒ½æ»¡è¶³ï¼Œåˆ™æ‰£å‡åº“å­˜ï¼Œåˆ›å»ºè®¢å•ï¼Œç„¶åè¿”å›è®¢å•idï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³åˆ™ç›´æ¥ç»“æŸã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301021641717.png" alt=""></p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 6.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line">    <span class="comment">// 6.2.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 6.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-åº“å­˜è¶…å–é—®é¢˜åˆ†æ"><a href="#3-5-åº“å­˜è¶…å–é—®é¢˜åˆ†æ" class="headerlink" title="3.5 åº“å­˜è¶…å–é—®é¢˜åˆ†æ"></a>3.5 åº“å­˜è¶…å–é—®é¢˜åˆ†æ</h3><p>æœ‰å…³è¶…å–é—®é¢˜åˆ†æï¼šåœ¨æˆ‘ä»¬åŸæœ‰ä»£ç ä¸­æ˜¯è¿™ä¹ˆå†™çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">       <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">       <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//5ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">           .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">           .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">   <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">       <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">       <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾çº¿ç¨‹1è¿‡æ¥æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­å‡ºæ¥åº“å­˜å¤§äº1ï¼Œæ­£å‡†å¤‡å»æ‰£å‡åº“å­˜ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ¥å¾—åŠå»æ‰£å‡ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2ä¹Ÿå»æŸ¥è¯¢åº“å­˜ï¼Œå‘ç°è¿™ä¸ªæ•°é‡ä¸€å®šä¹Ÿå¤§äº1ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šå»æ‰£å‡åº“å­˜ï¼Œæœ€ç»ˆå¤šä¸ªçº¿ç¨‹ç›¸å½“äºä¸€èµ·å»æ‰£å‡åº“å­˜ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°åº“å­˜çš„è¶…å–é—®é¢˜ã€‚</p><p>è¶…å–é—®é¢˜æ˜¯å…¸å‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŠ é”ï¼šè€Œå¯¹äºåŠ é”ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šè§ä¸‹å›¾ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301021735736.png" alt=""></p><p><strong>æ‚²è§‚é”ï¼š</strong></p><p> æ‚²è§‚é”å¯ä»¥å®ç°å¯¹äºæ•°æ®çš„ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œæ¯”å¦‚synï¼Œå’Œlockéƒ½æ˜¯æ‚²è§‚é”çš„ä»£è¡¨ï¼ŒåŒæ—¶ï¼Œæ‚²è§‚é”ä¸­åˆå¯ä»¥å†ç»†åˆ†ä¸ºå…¬å¹³é”ï¼Œéå…¬å¹³é”ï¼Œå¯é‡å…¥é”ï¼Œç­‰ç­‰</p><p><strong>ä¹è§‚é”ï¼š</strong></p><p>  ä¹è§‚é”ï¼šä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®ä¼šå¯¹ç‰ˆæœ¬å·+1ï¼Œå†æäº¤å›æ•°æ®æ—¶ï¼Œä¼šå»æ ¡éªŒæ˜¯å¦æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å¤§1 ï¼Œå¦‚æœå¤§1 ï¼Œåˆ™è¿›è¡Œæ“ä½œæˆåŠŸï¼Œè¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼Œå¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç‰ˆæœ¬å·åªæ¯”åŸæ¥å¤§1 ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰äººå¯¹ä»–è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œä»–çš„æ“ä½œå°±æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœä¸å¤§1ï¼Œåˆ™æ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œå½“ç„¶ä¹è§‚é”è¿˜æœ‰ä¸€äº›å˜ç§çš„å¤„ç†æ–¹å¼æ¯”å¦‚cas</p><p>  ä¹è§‚é”çš„å…¸å‹ä»£è¡¨ï¼šå°±æ˜¯casï¼Œåˆ©ç”¨casè¿›è¡Œæ— é”åŒ–æœºåˆ¶åŠ é”ï¼Œvar5 æ˜¯æ“ä½œå‰è¯»å–çš„å†…å­˜å€¼ï¼Œwhileä¸­çš„var1+var2 æ˜¯é¢„ä¼°å€¼ï¼Œå¦‚æœé¢„ä¼°å€¼ == å†…å­˜å€¼ï¼Œåˆ™ä»£è¡¨ä¸­é—´æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶å°±å°†æ–°å€¼å»æ›¿æ¢ å†…å­˜å€¼</p><p>  å…¶ä¸­do while æ˜¯ä¸ºäº†åœ¨æ“ä½œå¤±è´¥æ—¶ï¼Œå†æ¬¡è¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œå³æŠŠä¹‹å‰çš„é€»è¾‘å†æ“ä½œä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> var5;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    var5 = <span class="built_in">this</span>.getIntVolatile(var1, var2);</span><br><span class="line">&#125; <span class="keyword">while</span>(!<span class="built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> var5;</span><br></pre></td></tr></table></figure><p><strong>æœ¬æ–‡åœ¨æ­¤å¤„ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š</strong></p><p>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼æ˜¯æ²¡æœ‰åƒcasä¸€æ ·å¸¦è‡ªæ—‹çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰å¯¹versionçš„ç‰ˆæœ¬å·+1 ï¼Œä»–çš„æ“ä½œé€»è¾‘æ˜¯åœ¨æ“ä½œæ—¶ï¼Œå¯¹ç‰ˆæœ¬å·è¿›è¡Œ+1 æ“ä½œï¼Œç„¶åè¦æ±‚version å¦‚æœæ˜¯1 çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œåï¼Œæ•°æ®åº“ä¸­çš„versionå˜æˆäº†2ï¼Œä½†æ˜¯ä»–è‡ªå·±æ»¡è¶³version=1 ï¼Œæ‰€ä»¥æ²¡æœ‰é—®é¢˜ï¼Œæ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œï¼Œçº¿ç¨‹2 æœ€åä¹Ÿéœ€è¦åŠ ä¸Šæ¡ä»¶version =1 ï¼Œä½†æ˜¯ç°åœ¨ç”±äºçº¿ç¨‹1å·²ç»æ“ä½œè¿‡äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2ï¼Œæ“ä½œæ—¶å°±ä¸æ»¡è¶³version=1 çš„æ¡ä»¶äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2æ— æ³•æ‰§è¡ŒæˆåŠŸ</p><p>è¿™é‡Œæ˜¯ä½¿ç”¨casçš„æ–¹å¼ï¼Œæ€æƒ³æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯å¤„ç†æ–¹å¼ä¸ä¸€è‡´<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301021737534.png" alt=""></p><h3 id="3-6-ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜"><a href="#3-6-ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜" class="headerlink" title="3.6 ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜"></a>3.6 ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜</h3><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆä¸€ã€</strong></p><p>VoucherOrderServiceImpl åœ¨æ‰£å‡åº“å­˜æ—¶ï¼Œæ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>) <span class="comment">//set stock = stock -1</span></span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).eq(<span class="string">&quot;stock&quot;</span>,voucher.getStock()).update(); <span class="comment">//where id = ï¼Ÿ and stock = ?</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé€»è¾‘çš„æ ¸å¿ƒå«ä¹‰æ˜¯ï¼šåªè¦æˆ‘æ‰£å‡åº“å­˜æ—¶çš„åº“å­˜å’Œä¹‹å‰æˆ‘æŸ¥è¯¢åˆ°çš„åº“å­˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ„å‘³ç€æ²¡æœ‰äººåœ¨ä¸­é—´ä¿®æ”¹è¿‡åº“å­˜ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯ä»¥ä¸Šè¿™ç§æ–¹å¼é€šè¿‡æµ‹è¯•å‘ç°ä¼šæœ‰å¾ˆå¤šå¤±è´¥çš„æƒ…å†µï¼Œå¤±è´¥çš„åŸå› åœ¨äºï¼šåœ¨ä½¿ç”¨ä¹è§‚é”è¿‡ç¨‹ä¸­å‡è®¾100ä¸ªçº¿ç¨‹åŒæ—¶éƒ½æ‹¿åˆ°äº†100çš„åº“å­˜ï¼Œç„¶åå¤§å®¶ä¸€èµ·å»è¿›è¡Œæ‰£å‡ï¼Œä½†æ˜¯100ä¸ªäººä¸­åªæœ‰1ä¸ªäººèƒ½æ‰£å‡æˆåŠŸï¼Œå…¶ä»–çš„äººåœ¨å¤„ç†æ—¶ï¼Œä»–ä»¬åœ¨æ‰£å‡æ—¶ï¼Œåº“å­˜å·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œæ‰€ä»¥æ­¤æ—¶å…¶ä»–çº¿ç¨‹éƒ½ä¼šå¤±è´¥</p><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆäºŒã€</strong></p><p>ä¹‹å‰çš„æ–¹å¼è¦ä¿®æ”¹å‰åéƒ½ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆ†æè¿‡ï¼ŒæˆåŠŸçš„æ¦‚ç‡å¤ªä½ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¹è§‚é”éœ€è¦å˜ä¸€ä¸‹ï¼Œæ”¹æˆstockå¤§äº0 å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update().gt(<span class="string">&quot;stock&quot;</span>,<span class="number">0</span>); <span class="comment">//where id = ? and stock &gt; 0</span></span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ä¹è§‚é”æ˜¯é’ˆå¯¹æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œçš„æ—¶å€™ä½¿ç”¨ï¼Œç”¨æ¥å»åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†æ•°æ®æ›´æ–°</em></p><p><strong>çŸ¥è¯†å°æ‰©å±•ï¼š</strong></p><p>é’ˆå¯¹casä¸­çš„è‡ªæ—‹å‹åŠ›è¿‡å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Longaddrè¿™ä¸ªç±»å»è§£å†³</p><p>Java8 æä¾›çš„ä¸€ä¸ªå¯¹AtomicLongæ”¹è¿›åçš„ä¸€ä¸ªç±»ï¼ŒLongAdder</p><p>å¤§é‡çº¿ç¨‹å¹¶å‘æ›´æ–°ä¸€ä¸ªåŸå­æ€§çš„æ—¶å€™ï¼Œå¤©ç„¶çš„é—®é¢˜å°±æ˜¯è‡ªæ—‹ï¼Œä¼šå¯¼è‡´å¹¶å‘æ€§é—®é¢˜ï¼Œå½“ç„¶è¿™ä¹Ÿæ¯”æˆ‘ä»¬ç›´æ¥ä½¿ç”¨synæ¥çš„å¥½</p><p>æ‰€ä»¥åˆ©ç”¨è¿™ä¹ˆä¸€ä¸ªç±»ï¼ŒLongAdderæ¥è¿›è¡Œä¼˜åŒ–</p><p>å¦‚æœè·å–æŸä¸ªå€¼ï¼Œåˆ™ä¼šå¯¹cellå’Œbaseçš„å€¼è¿›è¡Œé€’å¢ï¼Œæœ€åè¿”å›ä¸€ä¸ªå®Œæ•´çš„å€¼</p><p><img src=".\Rediså®æˆ˜ç¯‡.assets\1653370271627.png" alt="1653370271627"></p><h3 id="3-6-ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•"><a href="#3-6-ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•" class="headerlink" title="3.6 ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•"></a>3.6 ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ç§’æ€ä¸šåŠ¡ï¼Œè¦æ±‚åŒä¸€ä¸ªä¼˜æƒ åˆ¸ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€å•</p><p><strong>ç°åœ¨çš„é—®é¢˜åœ¨äºï¼š</strong></p><p>ä¼˜æƒ å·æ˜¯ä¸ºäº†å¼•æµï¼Œä½†æ˜¯ç›®å‰çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥æ— é™åˆ¶çš„æŠ¢è¿™ä¸ªä¼˜æƒ å·ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“å¢åŠ ä¸€å±‚é€»è¾‘ï¼Œè®©ä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€ä¸ªå•ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªç”¨æˆ·ä¸‹å¤šä¸ªå•</p><p>å…·ä½“æ“ä½œé€»è¾‘å¦‚ä¸‹ï¼šæ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œç„¶åå†æ ¹æ®ä¼˜æƒ å·idå’Œç”¨æˆ·idæŸ¥è¯¢æ˜¯å¦å·²ç»ä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œå¦‚æœä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œåˆ™ä¸å†ä¸‹å•ï¼Œå¦åˆ™è¿›è¡Œä¸‹å•</p><p>VoucherOrderServiceImpl  </p><p><strong>åˆæ­¥ä»£ç ï¼šå¢åŠ ä¸€äººä¸€å•é€»è¾‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">        <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.ä¸€äººä¸€å•é€»è¾‘</span></span><br><span class="line">    <span class="comment">// 5.1.ç”¨æˆ·id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">    <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6ï¼Œæ‰£å‡åº“å­˜</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">            .setSql(<span class="string">&quot;stock= stock -1&quot;</span>)</span><br><span class="line">            .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).update();</span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="comment">//æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.åˆ›å»ºè®¢å•</span></span><br><span class="line">    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">    <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    voucherOrder.setId(orderId);</span><br><span class="line"></span><br><span class="line">    voucherOrder.setUserId(userId);</span><br><span class="line">    <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">    voucherOrder.setVoucherId(voucherId);</span><br><span class="line">    save(voucherOrder);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜ï¼š</strong>ç°åœ¨çš„é—®é¢˜è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå¹¶å‘è¿‡æ¥ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œéƒ½ä¸å­˜åœ¨è®¢å•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ é”ï¼Œä½†æ˜¯ä¹è§‚é”æ¯”è¾ƒé€‚åˆæ›´æ–°æ•°æ®ï¼Œè€Œç°åœ¨æ˜¯æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ‚²è§‚é”æ“ä½œ</p><p><strong>æ³¨æ„ï¼š</strong>åœ¨è¿™é‡Œæåˆ°äº†éå¸¸å¤šçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ…¢æ…¢çš„æ¥æ€è€ƒï¼Œé¦–å…ˆæˆ‘ä»¬çš„åˆå§‹æ–¹æ¡ˆæ˜¯å°è£…äº†ä¸€ä¸ªcreateVoucherOrderæ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†ç¡®ä¿ä»–çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†ä¸€æŠŠsynchronized é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·æ·»åŠ é”ï¼Œé”çš„ç²’åº¦å¤ªç²—äº†ï¼Œåœ¨ä½¿ç”¨é”è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶<strong>é”ç²’åº¦</strong> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œå› ä¸ºå¦‚æœé”çš„ç²’åº¦å¤ªå¤§ï¼Œä¼šå¯¼è‡´æ¯ä¸ªçº¿ç¨‹è¿›æ¥éƒ½ä¼šé”ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ§åˆ¶é”çš„ç²’åº¦ï¼Œä»¥ä¸‹è¿™æ®µä»£ç éœ€è¦ä¿®æ”¹ä¸ºï¼š<br>intern() è¿™ä¸ªæ–¹æ³•æ˜¯ä»å¸¸é‡æ± ä¸­æ‹¿åˆ°æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨userId.toString() ä»–æ‹¿åˆ°çš„å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨é”å¿…é¡»ä¿è¯é”å¿…é¡»æ˜¯åŒä¸€æŠŠï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨intern()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span>  Result <span class="title function_">createVoucherOrder</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line"><span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line"><span class="keyword">synchronized</span>(userId.toString().intern())&#123;</span><br><span class="line">         <span class="comment">// 5.1.æŸ¥è¯¢è®¢å•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).count();</span><br><span class="line">        <span class="comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>) <span class="comment">// set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>) <span class="comment">// where id = ? and stock &gt; 0</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// æ‰£å‡å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 7.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 7.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 7.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        save(voucherOrder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7.è¿”å›è®¢å•id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šä»£ç è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œé—®é¢˜çš„åŸå› åœ¨äºå½“å‰æ–¹æ³•è¢«springçš„äº‹åŠ¡æ§åˆ¶ï¼Œå¦‚æœä½ åœ¨æ–¹æ³•å†…éƒ¨åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´å½“å‰æ–¹æ³•äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯é”å·²ç»é‡Šæ”¾ä¹Ÿä¼šå¯¼è‡´é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å°†å½“å‰æ–¹æ³•æ•´ä½“åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿äº‹åŠ¡ä¸ä¼šå‡ºç°é—®é¢˜</p><p>äºæ˜¯æˆ‘ä»¬é€‰æ‹©å°†ä¸Šé¢çš„è¿”å›æ–¹æ³•ç»™åŒ…è£¹èµ·æ¥</p><p>ä½†æ˜¯ä»¥ä¸Šåšæ³•ä¾ç„¶æœ‰é—®é¢˜ï¼Œå› ä¸ºä½ è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯this.çš„æ–¹å¼è°ƒç”¨çš„ï¼Œäº‹åŠ¡æƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜å¾—åˆ©ç”¨ä»£ç†æ¥ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—åŸå§‹çš„äº‹åŠ¡å¯¹è±¡ï¼Œ æ¥æ“ä½œäº‹åŠ¡</p><h3 id="3-7-é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜"><a href="#3-7-é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜" class="headerlink" title="3.7 é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜"></a>3.7 é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜</h3><p>é€šè¿‡åŠ é”å¯ä»¥è§£å†³åœ¨å•æœºæƒ…å†µä¸‹çš„ä¸€äººä¸€å•å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å°±ä¸è¡Œäº†ã€‚</p><p>1ã€æˆ‘ä»¬å°†æœåŠ¡å¯åŠ¨ä¸¤ä»½ï¼Œç«¯å£åˆ†åˆ«ä¸º8081å’Œ8082</p><p>2ã€ç„¶åä¿®æ”¹nginxçš„confç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ï¼Œé…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡</p><p><strong>å…·ä½“æ“ä½œ(ç•¥)</strong></p><p><strong>æœ‰å…³é”å¤±æ•ˆåŸå› åˆ†æ</strong></p><p>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="4ã€åˆ†å¸ƒå¼é”"><a href="#4ã€åˆ†å¸ƒå¼é”" class="headerlink" title="4ã€åˆ†å¸ƒå¼é”"></a>4ã€åˆ†å¸ƒå¼é”</h2><h3 id="4-1-ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”"><a href="#4-1-ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”" class="headerlink" title="4.1 ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”"></a>4.1 ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”</h3><p>åˆ†å¸ƒå¼é”ï¼šæ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”äº’æ–¥çš„é”ã€‚</p><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶éƒ½ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œåªè¦å¤§å®¶ä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301041133983.png" alt=""></p><p>é‚£ä¹ˆåˆ†å¸ƒå¼é”ä»–åº”è¯¥æ»¡è¶³ä¸€äº›ä»€ä¹ˆæ ·çš„æ¡ä»¶å‘¢ï¼Ÿ</p><p>å¯è§æ€§ï¼šå¤šä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹è¯´çš„å¯è§æ€§å¹¶ä¸æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æŒ‡çš„å†…å­˜å¯è§æ€§ï¼Œåªæ˜¯è¯´å¤šä¸ªè¿›ç¨‹ä¹‹é—´éƒ½èƒ½æ„ŸçŸ¥åˆ°å˜åŒ–çš„æ„æ€</p><p>äº’æ–¥ï¼šäº’æ–¥æ˜¯åˆ†å¸ƒå¼é”çš„æœ€åŸºæœ¬çš„æ¡ä»¶ï¼Œä½¿å¾—ç¨‹åºä¸²è¡Œæ‰§è¡Œ</p><p>é«˜å¯ç”¨ï¼šç¨‹åºä¸æ˜“å´©æºƒï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½ä¿è¯è¾ƒé«˜çš„å¯ç”¨æ€§</p><p>é«˜æ€§èƒ½ï¼šç”±äºåŠ é”æœ¬èº«å°±è®©æ€§èƒ½é™ä½ï¼Œæ‰€æœ‰å¯¹äºåˆ†å¸ƒå¼é”æœ¬èº«éœ€è¦ä»–å°±è¾ƒé«˜çš„åŠ é”æ€§èƒ½å’Œé‡Šæ”¾é”æ€§èƒ½</p><p>å®‰å…¨æ€§ï¼šå®‰å…¨ä¹Ÿæ˜¯ç¨‹åºä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301041135385.png" alt=""></p><p>å¸¸è§çš„åˆ†å¸ƒå¼é”æœ‰ä¸‰ç§</p><p>Mysqlï¼šmysqlæœ¬èº«å°±å¸¦æœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯ç”±äºmysqlæ€§èƒ½æœ¬èº«ä¸€èˆ¬ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä½¿ç”¨mysqlä½œä¸ºåˆ†å¸ƒå¼é”æ¯”è¾ƒå°‘è§</p><p>Redisï¼šredisä½œä¸ºåˆ†å¸ƒå¼é”æ˜¯éå¸¸å¸¸è§çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œç°åœ¨ä¼ä¸šçº§å¼€å‘ä¸­åŸºæœ¬éƒ½ä½¿ç”¨redisæˆ–è€…zookeeperä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œåˆ©ç”¨setnxè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ’å…¥keyæˆåŠŸï¼Œåˆ™è¡¨ç¤ºè·å¾—åˆ°äº†é”ï¼Œå¦‚æœæœ‰äººæ’å…¥æˆåŠŸï¼Œå…¶ä»–äººæ’å…¥å¤±è´¥åˆ™è¡¨ç¤ºæ— æ³•è·å¾—åˆ°é”ï¼Œåˆ©ç”¨è¿™å¥—é€»è¾‘æ¥å®ç°åˆ†å¸ƒå¼é”</p><p>Zookeeperï¼šzookeeperä¹Ÿæ˜¯ä¼ä¸šçº§å¼€å‘ä¸­è¾ƒå¥½çš„ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆï¼Œç”±äºæœ¬å¥—è§†é¢‘å¹¶ä¸è®²è§£zookeeperçš„åŸç†å’Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼Œæ‰€ä»¥ä¸è¿‡å¤šé˜è¿°</p><h3 id="4-2-ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯"><a href="#4-2-ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯" class="headerlink" title="4.2 ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯"></a>4.2 ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯</h3><p>å®ç°åˆ†å¸ƒå¼é”æ—¶éœ€è¦å®ç°çš„ä¸¤ä¸ªåŸºæœ¬æ–¹æ³•ï¼š</p><ul><li><p>è·å–é”ï¼š</p><ul><li>äº’æ–¥ï¼šç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”</li><li>éé˜»å¡ï¼šå°è¯•ä¸€æ¬¡ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li></ul></li><li><p>é‡Šæ”¾é”ï¼š</p><ul><li>æ‰‹åŠ¨é‡Šæ”¾</li><li>è¶…æ—¶é‡Šæ”¾ï¼šè·å–é”æ—¶æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´</li></ul></li></ul><p>æ ¸å¿ƒæ€è·¯ï¼š</p><p>æˆ‘ä»¬åˆ©ç”¨redis çš„setNx æ–¹æ³•ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¯¥æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œredis ä¸­å°±æœ‰è¿™ä¸ªkey äº†ï¼Œè¿”å›äº†1ï¼Œå¦‚æœç»“æœæ˜¯1ï¼Œåˆ™è¡¨ç¤ºä»–æŠ¢åˆ°äº†é”ï¼Œé‚£ä¹ˆä»–å»æ‰§è¡Œä¸šåŠ¡ï¼Œç„¶åå†åˆ é™¤é”ï¼Œé€€å‡ºé”é€»è¾‘ï¼Œæ²¡æœ‰æŠ¢åˆ°é”çš„å“¥ä»¬ï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åé‡è¯•å³å¯</p><h3 id="4-3-å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€"><a href="#4-3-å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€" class="headerlink" title="4.3 å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€"></a>4.3 å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€</h3><ul><li>åŠ é”é€»è¾‘</li></ul><p><strong>é”çš„åŸºæœ¬æ¥å£</strong></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301042114562.png" alt=""></p><p><strong>SimpleRedisLock</strong></p><p>åˆ©ç”¨setnxæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä¿è¯åŠ é”å’Œå¢åŠ è¿‡æœŸæ—¶é—´å…·æœ‰åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_PREFIX=<span class="string">&quot;lock:&quot;</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId()</span><br><span class="line">    <span class="comment">// è·å–é”</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">            .setIfAbsent(KEY_PREFIX + name, threadId + <span class="string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">    <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é‡Šæ”¾é”é€»è¾‘</li></ul><p>SimpleRedisLock</p><p>é‡Šæ”¾é”ï¼Œé˜²æ­¢åˆ é™¤åˆ«äººçš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡delåˆ é™¤é”</span></span><br><span class="line">    stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸šåŠ¡ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">      <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">      <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">      <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">          <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">          <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">      <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">      <span class="comment">//åˆ›å»ºé”å¯¹è±¡(æ–°å¢ä»£ç )</span></span><br><span class="line">      <span class="type">SimpleRedisLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRedisLock</span>(<span class="string">&quot;order:&quot;</span> + userId, stringRedisTemplate);</span><br><span class="line">      <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1200</span>);</span><br><span class="line"><span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">      <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">          <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">          <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">          <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">          lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜"><a href="#4-4-Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜" class="headerlink" title="4.4 Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜"></a>4.4 Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜</h3><p>é€»è¾‘è¯´æ˜ï¼š</p><p>æŒæœ‰é”çš„çº¿ç¨‹åœ¨é”çš„å†…éƒ¨å‡ºç°äº†é˜»å¡ï¼Œå¯¼è‡´ä»–çš„é”è‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹2æ¥å°è¯•è·å¾—é”ï¼Œå°±æ‹¿åˆ°äº†è¿™æŠŠé”ï¼Œç„¶åçº¿ç¨‹2åœ¨æŒæœ‰é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç»§ç»­æ‰§è¡Œï¼Œè€Œçº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèµ°åˆ°äº†åˆ é™¤é”é€»è¾‘ï¼Œæ­¤æ—¶å°±ä¼šæŠŠæœ¬åº”è¯¥å±äºçº¿ç¨‹2çš„é”è¿›è¡Œåˆ é™¤ï¼Œè¿™å°±æ˜¯è¯¯åˆ åˆ«äººé”çš„æƒ…å†µè¯´æ˜</p><p>è§£å†³æ–¹æ¡ˆï¼šè§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå»åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦å±äºè‡ªå·±ï¼Œå¦‚æœå±äºè‡ªå·±ï¼Œåˆ™ä¸è¿›è¡Œé”çš„åˆ é™¤ï¼Œå‡è®¾è¿˜æ˜¯ä¸Šè¾¹çš„æƒ…å†µï¼Œçº¿ç¨‹1å¡é¡¿ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œçº¿ç¨‹2è¿›å…¥åˆ°é”çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶çº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç„¶ååˆ é™¤é”ï¼Œä½†æ˜¯çº¿ç¨‹1ï¼Œä¸€çœ‹å½“å‰è¿™æŠŠé”ä¸æ˜¯å±äºè‡ªå·±ï¼Œäºæ˜¯ä¸è¿›è¡Œåˆ é™¤é”é€»è¾‘ï¼Œå½“çº¿ç¨‹2èµ°åˆ°åˆ é™¤é”é€»è¾‘æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¡è¿‡è‡ªåŠ¨é‡Šæ”¾é”çš„æ—¶é—´ç‚¹ï¼Œåˆ™åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å±äºè‡ªå·±çš„ï¼Œäºæ˜¯åˆ é™¤è¿™æŠŠé”ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301042140890.png" alt=""></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301042141353.png" alt=""></p><h3 id="4-5-è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜"><a href="#4-5-è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜" class="headerlink" title="4.5 è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜"></a>4.5 è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ä¹‹å‰çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œæ»¡è¶³ï¼šåœ¨è·å–é”æ—¶å­˜å…¥çº¿ç¨‹æ ‡ç¤ºï¼ˆå¯ä»¥ç”¨UUIDè¡¨ç¤ºï¼‰<br>åœ¨é‡Šæ”¾é”æ—¶å…ˆè·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</p><ul><li>å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”</li><li>å¦‚æœä¸ä¸€è‡´åˆ™ä¸é‡Šæ”¾é”</li></ul><p>æ ¸å¿ƒé€»è¾‘ï¼šåœ¨å­˜å…¥é”æ—¶ï¼Œæ”¾å…¥è‡ªå·±çº¿ç¨‹çš„æ ‡è¯†ï¼Œåœ¨åˆ é™¤é”æ—¶ï¼Œåˆ¤æ–­å½“å‰è¿™æŠŠé”çš„æ ‡è¯†æ˜¯ä¸æ˜¯è‡ªå·±å­˜å…¥çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸è¿›è¡Œåˆ é™¤ã€‚</p><p>æµç¨‹æ›´æ”¹ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301042142141.png" alt=""></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼šåŠ é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ID_PREFIX</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>) + <span class="string">&quot;-&quot;</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> timeoutSec)</span> &#123;</span><br><span class="line">   <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">   <span class="comment">// è·å–é”</span></span><br><span class="line">   <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> stringRedisTemplate.opsForValue()</span><br><span class="line">                .setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);</span><br><span class="line">   <span class="keyword">return</span> Boolean.TRUE.equals(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Šæ”¾é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">threadId</span> <span class="operator">=</span> ID_PREFIX + Thread.currentThread().getId();</span><br><span class="line">    <span class="comment">// è·å–é”ä¸­çš„æ ‡ç¤º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ ‡ç¤ºæ˜¯å¦ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">if</span>(threadId.equals(id)) &#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">        stringRedisTemplate.delete(KEY_PREFIX + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æœ‰å…³ä»£ç å®æ“è¯´æ˜ï¼š</strong></p><p>åœ¨æˆ‘ä»¬ä¿®æ”¹å®Œæ­¤å¤„ä»£ç åï¼Œæˆ‘ä»¬é‡å¯å·¥ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”åï¼Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ æ­¤æ—¶è¿›å…¥åˆ°é”å†…éƒ¨ï¼Œå†æ”¾è¡Œç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªçº¿ç¨‹ç”±äºé”çš„valueå€¼å¹¶éæ˜¯è‡ªå·±ï¼Œæ‰€ä»¥ä¸èƒ½é‡Šæ”¾é”ï¼Œä¹Ÿå°±æ— æ³•åˆ é™¤åˆ«äººçš„é”ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾é”ï¼Œé€šè¿‡è¿™ä¸ªæ¡ˆä¾‹åˆæ­¥è¯´æ˜æˆ‘ä»¬è§£å†³äº†é”è¯¯åˆ çš„é—®é¢˜ã€‚</p><h3 id="4-6-åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜"><a href="#4-6-åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜" class="headerlink" title="4.6 åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜"></a>4.6 åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜</h3><p>æ›´ä¸ºæç«¯çš„è¯¯åˆ é€»è¾‘è¯´æ˜ï¼š</p><p>çº¿ç¨‹1ç°åœ¨æŒæœ‰é”ä¹‹åï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘è¿‡ç¨‹ä¸­ï¼Œä»–æ­£å‡†å¤‡åˆ é™¤é”ï¼Œè€Œä¸”å·²ç»èµ°åˆ°äº†æ¡ä»¶åˆ¤æ–­çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚ä»–å·²ç»æ‹¿åˆ°äº†å½“å‰è¿™æŠŠé”ç¡®å®æ˜¯å±äºä»–è‡ªå·±çš„ï¼Œæ­£å‡†å¤‡åˆ é™¤é”ï¼Œä½†æ˜¯æ­¤æ—¶ä»–çš„é”åˆ°æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹2è¿›æ¥ï¼Œä½†æ˜¯çº¿ç¨‹1ä»–ä¼šæ¥ç€å¾€åæ‰§è¡Œï¼Œå½“ä»–å¡é¡¿ç»“æŸåï¼Œä»–ç›´æ¥å°±ä¼šæ‰§è¡Œåˆ é™¤é”é‚£è¡Œä»£ç ï¼Œç›¸å½“äºæ¡ä»¶åˆ¤æ–­å¹¶æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼Œè¿™å°±æ˜¯åˆ é”æ—¶çš„åŸå­æ€§é—®é¢˜ï¼Œä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹1çš„æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬è¦é˜²æ­¢åˆšæ‰çš„æƒ…å†µå‘ç”Ÿï¼Œ</p><h3 id="4-7-Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜"><a href="#4-7-Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜" class="headerlink" title="4.7 Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜"></a>4.7 Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜</h3><p>Redisæä¾›äº†Luaè„šæœ¬åŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªè„šæœ¬ä¸­ç¼–å†™å¤šæ¡Rediså‘½ä»¤ï¼Œç¡®ä¿å¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶çš„åŸå­æ€§ã€‚Luaæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒçš„åŸºæœ¬è¯­æ³•å¤§å®¶å¯ä»¥å‚è€ƒç½‘ç«™ï¼š<a href="https://www.runoob.com/lua/lua-tutorial.htmlï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaå»æ“ä½œredisï¼Œåˆèƒ½ä¿è¯ä»–çš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§åŠ¨ä½œäº†ï¼Œä½œä¸ºJavaç¨‹åºå‘˜è¿™ä¸€å—å¹¶ä¸ä½œä¸€ä¸ªç®€å•è¦æ±‚ï¼Œå¹¶ä¸éœ€è¦å¤§å®¶è¿‡äºç²¾é€šï¼Œåªéœ€è¦çŸ¥é“ä»–æœ‰ä»€ä¹ˆä½œç”¨å³å¯ã€‚">https://www.runoob.com/lua/lua-tutorial.htmlï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaå»æ“ä½œredisï¼Œåˆèƒ½ä¿è¯ä»–çš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§åŠ¨ä½œäº†ï¼Œä½œä¸ºJavaç¨‹åºå‘˜è¿™ä¸€å—å¹¶ä¸ä½œä¸€ä¸ªç®€å•è¦æ±‚ï¼Œå¹¶ä¸éœ€è¦å¤§å®¶è¿‡äºç²¾é€šï¼Œåªéœ€è¦çŸ¥é“ä»–æœ‰ä»€ä¹ˆä½œç”¨å³å¯ã€‚</a></p><p>è¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis.call(<span class="string">&#x27;å‘½ä»¤åç§°&#x27;</span>, <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;å…¶å®ƒå‚æ•°&#x27;</span>, ...)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œset name jackï¼Œåˆ™è„šæœ¬æ˜¯è¿™æ ·ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ set name jack</span><br><span class="line">redis.call(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;jack&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å…ˆæ‰§è¡Œset name Roseï¼Œå†æ‰§è¡Œget nameï¼Œåˆ™è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å…ˆæ‰§è¡Œ set name jack</span><br><span class="line">redis.call(<span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>)</span><br><span class="line"># å†æ‰§è¡Œ get name</span><br><span class="line"><span class="keyword">local</span> name = redis.call(<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"># è¿”å›</span><br><span class="line"><span class="keyword">return</span> name</span><br></pre></td></tr></table></figure><p>å†™å¥½è„šæœ¬ä»¥åï¼Œéœ€è¦ç”¨Rediså‘½ä»¤æ¥è°ƒç”¨è„šæœ¬ï¼Œè°ƒç”¨è„šæœ¬çš„å¸¸è§å‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151836836.jpg" alt=""></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œ redis.call(â€˜setâ€™, â€˜nameâ€™, â€˜jackâ€™) è¿™ä¸ªè„šæœ¬ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151837811.jpg" alt=""></p><p>å¦‚æœè„šæœ¬ä¸­çš„keyã€valueä¸æƒ³å†™æ­»ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚keyç±»å‹å‚æ•°ä¼šæ”¾å…¥KEYSæ•°ç»„ï¼Œå…¶å®ƒå‚æ•°ä¼šæ”¾å…¥ARGVæ•°ç»„ï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ä»KEYSå’ŒARGVæ•°ç»„è·å–è¿™äº›å‚æ•°ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151837171.jpg" alt=""></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å›ä¸€ä¸‹æˆ‘ä»¬é‡Šæ”¾é”çš„é€»è¾‘ï¼š</p><p>é‡Šæ”¾é”çš„ä¸šåŠ¡æµç¨‹æ˜¯è¿™æ ·çš„</p><p>â€‹    1ã€è·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤º</p><p>â€‹    2ã€åˆ¤æ–­æ˜¯å¦ä¸æŒ‡å®šçš„æ ‡ç¤ºï¼ˆå½“å‰çº¿ç¨‹æ ‡ç¤ºï¼‰ä¸€è‡´</p><p>â€‹    3ã€å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”ï¼ˆåˆ é™¤ï¼‰</p><p>â€‹    4ã€å¦‚æœä¸ä¸€è‡´åˆ™ä»€ä¹ˆéƒ½ä¸åš</p><p>å¦‚æœç”¨Luaè„šæœ¬æ¥è¡¨ç¤ºåˆ™æ˜¯è¿™æ ·çš„ï¼š</p><p>æœ€ç»ˆæˆ‘ä»¬æ“ä½œredisçš„æ‹¿é”æ¯”é”åˆ é”çš„luaè„šæœ¬å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡Œçš„ KEYS[1] å°±æ˜¯é”çš„keyï¼Œè¿™é‡Œçš„ARGV[1] å°±æ˜¯å½“å‰çº¿ç¨‹æ ‡ç¤º</span></span><br><span class="line"><span class="comment">-- è·å–é”ä¸­çš„æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> (redis.call(<span class="string">&#x27;GET&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>]) <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- ä¸€è‡´ï¼Œåˆ™åˆ é™¤é”</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&#x27;DEL&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="4-8-åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”"><a href="#4-8-åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”" class="headerlink" title="4.8 åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”"></a>4.8 åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”</h3><p>luaè„šæœ¬æœ¬èº«å¹¶ä¸éœ€è¦å¤§å®¶èŠ±è´¹å¤ªå¤šæ—¶é—´å»ç ”ç©¶ï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•è°ƒç”¨ï¼Œå¤§è‡´æ˜¯ä»€ä¹ˆæ„æ€å³å¯ï¼Œæ‰€ä»¥åœ¨ç¬”è®°ä¸­å¹¶ä¸ä¼šè¯¦ç»†çš„å»è§£é‡Šè¿™äº›luaè¡¨è¾¾å¼çš„å«ä¹‰ã€‚</p><p>æˆ‘ä»¬çš„RedisTemplateä¸­ï¼Œå¯ä»¥åˆ©ç”¨executeæ–¹æ³•å»æ‰§è¡Œluaè„šæœ¬ï¼Œå‚æ•°å¯¹åº”å…³ç³»å°±å¦‚ä¸‹å›¾è‚¡ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151838223.jpg" alt=""></p><p><strong>Javaä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        UNLOCK_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        UNLOCK_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;unlock.lua&quot;</span>));</span><br><span class="line">        UNLOCK_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨luaè„šæœ¬</span></span><br><span class="line">    stringRedisTemplate.execute(</span><br><span class="line">            UNLOCK_SCRIPT,</span><br><span class="line">            Collections.singletonList(KEY_PREFIX + name),</span><br><span class="line">            ID_PREFIX + Thread.currentThread().getId());</span><br><span class="line">&#125;</span><br><span class="line">ç»è¿‡ä»¥ä¸Šä»£ç æ”¹é€ åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç° æ‹¿é”æ¯”é”åˆ é”çš„åŸå­æ€§åŠ¨ä½œäº†~</span><br></pre></td></tr></table></figure><p>å°æ€»ç»“ï¼š</p><p>åŸºäºRedisçš„åˆ†å¸ƒå¼é”å®ç°æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨set nx exè·å–é”ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¿å­˜çº¿ç¨‹æ ‡ç¤º</li><li>é‡Šæ”¾é”æ—¶å…ˆåˆ¤æ–­çº¿ç¨‹æ ‡ç¤ºæ˜¯å¦ä¸è‡ªå·±ä¸€è‡´ï¼Œä¸€è‡´åˆ™åˆ é™¤é”<ul><li>ç‰¹æ€§ï¼š<ul><li>åˆ©ç”¨set nxæ»¡è¶³äº’æ–¥æ€§</li><li>åˆ©ç”¨set exä¿è¯æ•…éšœæ—¶é”ä¾ç„¶èƒ½é‡Šæ”¾ï¼Œé¿å…æ­»é”ï¼Œæé«˜å®‰å…¨æ€§</li><li>åˆ©ç”¨Redisé›†ç¾¤ä¿è¯é«˜å¯ç”¨å’Œé«˜å¹¶å‘ç‰¹æ€§</li></ul></li></ul></li></ul><p>ç¬”è€…æ€»ç»“ï¼šæˆ‘ä»¬ä¸€è·¯èµ°æ¥ï¼Œåˆ©ç”¨æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä½†æ˜¯æœ‰äº†è¿‡æœŸæ—¶é—´ä¹‹åï¼Œå¯èƒ½å‡ºç°è¯¯åˆ åˆ«äººé”çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¼€å§‹æ˜¯åˆ©ç”¨åˆ ä¹‹å‰ é€šè¿‡æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”è¿™ä¸ªé€»è¾‘æ¥è§£å†³çš„ï¼Œä¹Ÿå°±æ˜¯åˆ ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œä½†æ˜¯ç°åœ¨è¿˜æœ‰åŸå­æ€§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æ³•ä¿è¯æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§çš„åŠ¨ä½œï¼Œæœ€åé€šè¿‡luaè¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>ä½†æ˜¯ç›®å‰è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜é”ä¸ä½ï¼Œä»€ä¹ˆæ˜¯é”ä¸ä½å‘¢ï¼Œä½ æƒ³ä¸€æƒ³ï¼Œå¦‚æœå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–ç»­æœŸä¸€ä¸‹ï¼Œæ¯”å¦‚ç»­ä¸ª30sï¼Œå°±å¥½åƒæ˜¯ç½‘å§ä¸Šç½‘ï¼Œ ç½‘è´¹åˆ°äº†ä¹‹åï¼Œç„¶åè¯´ï¼Œæ¥ï¼Œç½‘ç®¡ï¼Œå†ç»™æˆ‘æ¥10å—çš„ï¼Œæ˜¯ä¸æ˜¯åè¾¹çš„é—®é¢˜éƒ½ä¸ä¼šå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆç»­æœŸé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Œå¯ä»¥ä¾èµ–äºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ redissionå•¦</p><p><strong>æµ‹è¯•é€»è¾‘ï¼š</strong></p><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¾—åˆ°äº†é”ï¼Œæ‰‹åŠ¨åˆ é™¤é”ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶äº†ï¼Œå…¶ä»–çº¿ç¨‹ä¼šæ‰§è¡Œluaæ¥æŠ¢é”ï¼Œå½“ç¬¬ä¸€å¤©çº¿ç¨‹åˆ©ç”¨luaåˆ é™¤é”æ—¶ï¼Œluaèƒ½ä¿è¯ä»–ä¸èƒ½åˆ é™¤ä»–çš„é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ é™¤é”æ—¶ï¼Œåˆ©ç”¨luaåŒæ ·å¯ä»¥ä¿è¯ä¸ä¼šåˆ é™¤åˆ«äººçš„é”ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚</p><h2 id="5ã€åˆ†å¸ƒå¼é”-redission"><a href="#5ã€åˆ†å¸ƒå¼é”-redission" class="headerlink" title="5ã€åˆ†å¸ƒå¼é”-redission"></a>5ã€åˆ†å¸ƒå¼é”-redission</h2><h3 id="5-1-åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»"><a href="#5-1-åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»" class="headerlink" title="5.1 åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»"></a>5.1 åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»</h3><p>åŸºäºsetnxå®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><strong>é‡å…¥é—®é¢˜</strong>ï¼šé‡å…¥é—®é¢˜æ˜¯æŒ‡ è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥åˆ°ç›¸åŒçš„é”çš„ä»£ç å—ä¸­ï¼Œå¯é‡å…¥é”çš„æ„ä¹‰åœ¨äºé˜²æ­¢æ­»é”ï¼Œæ¯”å¦‚HashTableè¿™æ ·çš„ä»£ç ä¸­ï¼Œä»–çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨synchronizedä¿®é¥°çš„ï¼Œå‡å¦‚ä»–åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœæ˜¯ä¸å¯é‡å…¥çš„ï¼Œä¸å°±æ­»é”äº†å—ï¼Ÿæ‰€ä»¥å¯é‡å…¥é”ä»–çš„ä¸»è¦æ„ä¹‰æ˜¯é˜²æ­¢æ­»é”ï¼Œæˆ‘ä»¬çš„synchronizedå’ŒLocké”éƒ½æ˜¯å¯é‡å…¥çš„ã€‚</p><p><strong>ä¸å¯é‡è¯•</strong>ï¼šæ˜¯æŒ‡ç›®å‰çš„åˆ†å¸ƒå¼åªèƒ½å°è¯•ä¸€æ¬¡ï¼Œæˆ‘ä»¬è®¤ä¸ºåˆç†çš„æƒ…å†µæ˜¯ï¼šå½“çº¿ç¨‹åœ¨è·å¾—é”å¤±è´¥åï¼Œä»–åº”è¯¥èƒ½å†æ¬¡å°è¯•è·å¾—é”ã€‚</p><p><strong>è¶…æ—¶é‡Šæ”¾ï¼š</strong>æˆ‘ä»¬åœ¨åŠ é”æ—¶å¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„æˆ‘ä»¬å¯ä»¥é˜²æ­¢æ­»é”ï¼Œä½†æ˜¯å¦‚æœå¡é¡¿çš„æ—¶é—´è¶…é•¿ï¼Œè™½ç„¶æˆ‘ä»¬é‡‡ç”¨äº†luaè¡¨è¾¾å¼é˜²æ­¢åˆ é”çš„æ—¶å€™ï¼Œè¯¯åˆ åˆ«äººçš„é”ï¼Œä½†æ˜¯æ¯•ç«Ÿæ²¡æœ‰é”ä½ï¼Œæœ‰å®‰å…¨éšæ‚£</p><p><strong>ä¸»ä»ä¸€è‡´æ€§ï¼š</strong> å¦‚æœRedisæä¾›äº†ä¸»ä»é›†ç¾¤ï¼Œå½“æˆ‘ä»¬å‘é›†ç¾¤å†™æ•°æ®æ—¶ï¼Œä¸»æœºéœ€è¦å¼‚æ­¥çš„å°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œè€Œä¸‡ä¸€åœ¨åŒæ­¥è¿‡å»ä¹‹å‰ï¼Œä¸»æœºå®•æœºäº†ï¼Œå°±ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301061334094.png" alt=""></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯Redissionå‘¢</p><p>Redissonæ˜¯ä¸€ä¸ªåœ¨Redisçš„åŸºç¡€ä¸Šå®ç°çš„Javaé©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„Javaå¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…å«äº†å„ç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚</p><p>Redissionæä¾›äº†åˆ†å¸ƒå¼é”çš„å¤šç§å¤šæ ·çš„åŠŸèƒ½</p><h3 id="5-2-åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨"><a href="#5-2-åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨" class="headerlink" title="5.2 åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨"></a>5.2 åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨</h3><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.redisson&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;redisson&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;<span class="number">3.13</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>é…ç½®Redissonå®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedissonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedissonClient <span class="title function_">redissonClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// é…ç½®</span></span><br><span class="line">        <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">        config.useSingleServer().setAddress(<span class="string">&quot;redis://192.168.150.101:6379&quot;</span>)</span><br><span class="line">            .setPassword(<span class="string">&quot;123321&quot;</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºRedissonClientå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> Redisson.create(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ä½•ä½¿ç”¨Redissionçš„åˆ†å¸ƒå¼é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissionClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testRedisson</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//è·å–é”(å¯é‡å…¥)ï¼ŒæŒ‡å®šé”çš„åç§°</span></span><br><span class="line">    <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;anyLock&quot;</span>);</span><br><span class="line">    <span class="comment">//å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´(æœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock(<span class="number">1</span>,<span class="number">10</span>,TimeUnit.SECONDS);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­è·å–é”æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span>(isLock)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰§è¡Œä¸šåŠ¡&quot;</span>);          </span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ VoucherOrderServiceImpl</p><p>æ³¨å…¥RedissonClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span></span><br><span class="line">        <span class="type">SeckillVoucher</span> <span class="variable">voucher</span> <span class="operator">=</span> seckillVoucherService.getById(voucherId);</span><br><span class="line">        <span class="comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;</span><br><span class="line">            <span class="comment">// å°šæœªå¼€å§‹</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="keyword">if</span> (voucher.getStock() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// åº“å­˜ä¸è¶³</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">//åˆ›å»ºé”å¯¹è±¡ è¿™ä¸ªä»£ç ä¸ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="comment">//SimpleRedisLock lock = new SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">//è·å–é”å¯¹è±¡</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">       </span><br><span class="line"><span class="comment">//åŠ é”å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (!isLock) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span></span><br><span class="line">            <span class="type">IVoucherOrderService</span> <span class="variable">proxy</span> <span class="operator">=</span> (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">            <span class="keyword">return</span> proxy.createVoucherOrder(voucherId);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†"><a href="#5-3-åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†" class="headerlink" title="5.3 åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†"></a>5.3 åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†</h3><p>åœ¨Locké”ä¸­ï¼Œä»–æ˜¯å€ŸåŠ©äºåº•å±‚çš„ä¸€ä¸ªvoaltileçš„ä¸€ä¸ªstateå˜é‡æ¥è®°å½•é‡å…¥çš„çŠ¶æ€çš„ï¼Œæ¯”å¦‚å½“å‰æ²¡æœ‰äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstate=0ï¼Œå‡å¦‚æœ‰äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstate=1ï¼Œå¦‚æœæŒæœ‰è¿™æŠŠé”çš„äººå†æ¬¡æŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstateå°±ä¼š+1 ï¼Œå¦‚æœæ˜¯å¯¹äºsynchronizedè€Œè¨€ï¼Œä»–åœ¨cè¯­è¨€ä»£ç ä¸­ä¼šæœ‰ä¸€ä¸ªcountï¼ŒåŸç†å’Œstateç±»ä¼¼ï¼Œä¹Ÿæ˜¯é‡å…¥ä¸€æ¬¡å°±åŠ ä¸€ï¼Œé‡Šæ”¾ä¸€æ¬¡å°±-1 ï¼Œç›´åˆ°å‡å°‘æˆ0 æ—¶ï¼Œè¡¨ç¤ºå½“å‰è¿™æŠŠé”æ²¡æœ‰è¢«äººæŒæœ‰ã€‚  </p><p>åœ¨redissionä¸­ï¼Œæˆ‘ä»¬çš„ä¹Ÿæ”¯æŒæ”¯æŒå¯é‡å…¥é”</p><p>åœ¨åˆ†å¸ƒå¼é”ä¸­ï¼Œä»–é‡‡ç”¨hashç»“æ„ç”¨æ¥å­˜å‚¨é”ï¼Œå…¶ä¸­å¤§keyè¡¨ç¤ºè¡¨ç¤ºè¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œç”¨å°keyè¡¨ç¤ºå½“å‰è¿™æŠŠé”è¢«å“ªä¸ªçº¿ç¨‹æŒæœ‰ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹å½“å‰çš„è¿™ä¸ªluaè¡¨è¾¾å¼ï¼Œä¸ºäº†ä¿è¯æ•´ä¸ªæµç¨‹çš„åŸå­æ€§ï¼Œä½¿ç”¨luaè„šæœ¬å®ç°è¿™äº›åŠŸèƒ½</p><p>è¿™ä¸ªåœ°æ–¹ä¸€å…±æœ‰3ä¸ªå‚æ•°</p><p><strong>KEYS[1] ï¼š é”åç§°</strong></p><p><strong>ARGV[1]ï¼š  é”å¤±æ•ˆæ—¶é—´</strong></p><p><strong>ARGV[2]ï¼š  id + â€œ:â€ + threadId; é”çš„å°key</strong></p><p>exists: åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨  nameï¼šæ˜¯lockæ˜¯å¦å­˜åœ¨,å¦‚æœ==0ï¼Œå°±è¡¨ç¤ºå½“å‰è¿™æŠŠé”ä¸å­˜åœ¨</p><p>redis.call(â€˜hsetâ€™, KEYS[1], ARGV[2], 1);æ­¤æ—¶ä»–å°±å¼€å§‹å¾€redisé‡Œè¾¹å»å†™æ•°æ® ï¼Œå†™æˆä¸€ä¸ªhashç»“æ„</p><p>Lock{</p><p>â€‹    id + <strong>â€œ:â€</strong> + threadId :  1</p><p>}</p><p>å¦‚æœå½“å‰è¿™æŠŠé”å­˜åœ¨ï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå†åˆ¤æ–­</p><p>redis.call(â€˜hexistsâ€™, KEYS[1], ARGV[2]) == 1</p><p>æ­¤æ—¶éœ€è¦é€šè¿‡å¤§key+å°keyåˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„ï¼Œåˆ™è¿›è¡Œ</p><p>redis.call(â€˜hincrbyâ€™, KEYS[1], ARGV[2], 1)</p><p>å°†å½“å‰è¿™ä¸ªé”çš„valueè¿›è¡Œ+1 ï¼Œredis.call(â€˜pexpireâ€™, KEYS[1], ARGV[1]);<br>ç„¶åå†å¯¹å…¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¡¨ç¤ºå½“å‰è¿™æŠŠé”æŠ¢é”å¤±è´¥ï¼Œæœ€åè¿”å›pttlï¼Œå³ä¸ºå½“å‰è¿™æŠŠé”çš„å¤±æ•ˆæ—¶é—´</p><p>luaè„šæœ¬è¯­è¨€æ•´åˆï¼š<br>è·å–é”ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071336891.png" alt=""><br>é‡Šæ”¾é”ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071336811.png" alt=""></p><p>æµç¨‹ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071332169.png" alt=""></p><p>æˆ‘ä»¬å†™ä¸ªæ–¹æ³•å¯¹ä¸Šé¢æ‰€è¯´çš„è¿›è¡Œæµ‹è¯•ï¼š<br>å‘ç°å­˜å…¥redisä¸­çš„æ˜¯hashç»“æ„</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071339250.png" alt=""></p><p>é‡å…¥æ¬¡æ•°ä¸º1ï¼Œå…¶ä½™å’Œä¸Šé¢æ‰€è¯´ä¸€è‡´ï¼Œæ­¤å¤„ä¸åšæ¼”ç¤ºäº†</p><h3 id="5-4-åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶"><a href="#5-4-åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶" class="headerlink" title="5.4 åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶"></a>5.4 åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶</h3><p><strong>è¯´æ˜</strong>ï¼šç”±äºè¯¾ç¨‹ä¸­å·²ç»è¯´æ˜äº†æœ‰å…³tryLockçš„æºç è§£æä»¥åŠå…¶çœ‹é—¨ç‹—åŸç†ï¼Œæ‰€ä»¥ç¬”è€…åœ¨è¿™é‡Œç»™å¤§å®¶åˆ†ælock()æ–¹æ³•çš„æºç è§£æï¼Œå¸Œæœ›å¤§å®¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤ŸæŒæ¡æ›´å¤šçš„çŸ¥è¯†</p><p>æŠ¢é”è¿‡ç¨‹ä¸­ï¼Œè·å¾—å½“å‰çº¿ç¨‹ï¼Œé€šè¿‡tryAcquireè¿›è¡ŒæŠ¢é”ï¼Œè¯¥æŠ¢é”é€»è¾‘å’Œä¹‹å‰é€»è¾‘ç›¸åŒ</p><p>1ã€å…ˆåˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥ä¸€æŠŠé”ï¼Œè¿”å›null</p><p>2ã€åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºå½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›null</p><p>æ‰€ä»¥å¦‚æœè¿”å›æ˜¯nullï¼Œåˆ™ä»£è¡¨ç€å½“å‰è¿™å“¥ä»¬å·²ç»æŠ¢é”å®Œæ¯•ï¼Œæˆ–è€…å¯é‡å…¥å®Œæ¯•ï¼Œä½†æ˜¯å¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¿›å…¥åˆ°ç¬¬ä¸‰ä¸ªæ¡ä»¶ï¼Œè¿”å›çš„æ˜¯é”çš„å¤±æ•ˆæ—¶é—´ï¼ŒåŒå­¦ä»¬å¯ä»¥è‡ªè¡Œå¾€ä¸‹ç¿»ä¸€ç‚¹ç‚¹ï¼Œä½ èƒ½å‘ç°æœ‰ä¸ªwhile( true) å†æ¬¡è¿›è¡ŒtryAcquireè¿›è¡ŒæŠ¢é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">threadId</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line"><span class="type">Long</span> <span class="variable">ttl</span> <span class="operator">=</span> tryAcquire(-<span class="number">1</span>, leaseTime, unit, threadId);</span><br><span class="line"><span class="comment">// lock acquired</span></span><br><span class="line"><span class="keyword">if</span> (ttl == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯ï¼Œå› ä¸ºlockæ–¹æ³•æœ‰é‡è½½æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å¸¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸å¸¦å‚æ•°ï¼Œå¦‚æœå¸¦å¸¦å‚æ•°ä¼ å…¥çš„å€¼æ˜¯-1ï¼Œå¦‚æœä¼ å…¥å‚æ•°ï¼Œåˆ™leaseTimeæ˜¯ä»–æœ¬èº«ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥äº†å‚æ•°ï¼Œæ­¤æ—¶leaseTime != -1 åˆ™ä¼šè¿›å»æŠ¢é”ï¼ŒæŠ¢é”çš„é€»è¾‘å°±æ˜¯ä¹‹å‰è¯´çš„é‚£ä¸‰ä¸ªé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (leaseTime != -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ²¡æœ‰ä¼ å…¥æ—¶é—´ï¼Œåˆ™æ­¤æ—¶ä¹Ÿä¼šè¿›è¡ŒæŠ¢é”ï¼Œ è€Œä¸”æŠ¢é”æ—¶é—´æ˜¯é»˜è®¤çœ‹é—¨ç‹—æ—¶é—´ commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout()</p><p>ttlRemainingFuture.onComplete((ttlRemaining, e) è¿™å¥è¯ç›¸å½“äºå¯¹ä»¥ä¸ŠæŠ¢é”è¿›è¡Œäº†ç›‘å¬ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸Šè¾¹æŠ¢é”å®Œæ¯•åï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå…·ä½“è°ƒç”¨çš„é€»è¾‘å°±æ˜¯å»åå°å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œç»­çº¦é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯çœ‹é—¨ç‹—çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RFuture&lt;Long&gt; ttlRemainingFuture = tryLockInnerAsync(waitTime,</span><br><span class="line">                                        commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(),</span><br><span class="line">                                        TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);</span><br><span class="line">ttlRemainingFuture.onComplete((ttlRemaining, e) -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// lock acquired</span></span><br><span class="line">    <span class="keyword">if</span> (ttlRemaining == <span class="literal">null</span>) &#123;</span><br><span class="line">        scheduleExpirationRenewal(threadId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> ttlRemainingFuture;</span><br></pre></td></tr></table></figure><p>æ­¤é€»è¾‘å°±æ˜¯ç»­çº¦é€»è¾‘ï¼Œæ³¨æ„çœ‹commandExecutor.getConnectionManager().newTimeoutï¼ˆï¼‰ æ­¤æ–¹æ³•</p><p>Method(  <strong>new</strong> TimerTask() {},å‚æ•°2 ï¼Œå‚æ•°3  )</p><p>æŒ‡çš„æ˜¯ï¼šé€šè¿‡å‚æ•°2ï¼Œå‚æ•°3 å»æè¿°ä»€ä¹ˆæ—¶å€™å»åšå‚æ•°1çš„äº‹æƒ…ï¼Œç°åœ¨çš„æƒ…å†µæ˜¯ï¼š10sä¹‹åå»åšå‚æ•°ä¸€çš„äº‹æƒ…</p><p>å› ä¸ºé”çš„å¤±æ•ˆæ—¶é—´æ˜¯30sï¼Œå½“10sä¹‹åï¼Œæ­¤æ—¶è¿™ä¸ªtimeTask å°±è§¦å‘äº†ï¼Œä»–å°±å»è¿›è¡Œç»­çº¦ï¼ŒæŠŠå½“å‰è¿™æŠŠé”ç»­çº¦æˆ30sï¼Œå¦‚æœæ“ä½œæˆåŠŸï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šé€’å½’è°ƒç”¨è‡ªå·±ï¼Œå†é‡æ–°è®¾ç½®ä¸€ä¸ªtimeTask()ï¼Œäºæ˜¯å†è¿‡10sååˆå†è®¾ç½®ä¸€ä¸ªtimerTaskï¼Œå®Œæˆä¸åœçš„ç»­çº¦</p><p>é‚£ä¹ˆå¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³ï¼Œå‡è®¾æˆ‘ä»¬çš„çº¿ç¨‹å‡ºç°äº†å®•æœºä»–è¿˜ä¼šç»­çº¦å—ï¼Ÿå½“ç„¶ä¸ä¼šï¼Œå› ä¸ºæ²¡æœ‰äººå†å»è°ƒç”¨renewExpirationè¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç­‰åˆ°æ—¶é—´ä¹‹åè‡ªç„¶å°±é‡Šæ”¾äº†ã€‚  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">renewExpiration</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ExpirationEntry</span> <span class="variable">ee</span> <span class="operator">=</span> EXPIRATION_RENEWAL_MAP.get(getEntryName());</span><br><span class="line">    <span class="keyword">if</span> (ee == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">Timeout</span> <span class="variable">task</span> <span class="operator">=</span> commandExecutor.getConnectionManager().newTimeout(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Timeout timeout)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">ExpirationEntry</span> <span class="variable">ent</span> <span class="operator">=</span> EXPIRATION_RENEWAL_MAP.get(getEntryName());</span><br><span class="line">            <span class="keyword">if</span> (ent == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">threadId</span> <span class="operator">=</span> ent.getFirstThreadId();</span><br><span class="line">            <span class="keyword">if</span> (threadId == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            RFuture&lt;Boolean&gt; future = renewExpirationAsync(threadId);</span><br><span class="line">            future.onComplete((res, e) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;Can&#x27;t update lock &quot;</span> + getName() + <span class="string">&quot; expiration&quot;</span>, e);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (res) &#123;</span><br><span class="line">                    <span class="comment">// reschedule itself</span></span><br><span class="line">                    renewExpiration();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, internalLockLeaseTime / <span class="number">3</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    </span><br><span class="line">    ee.setTimeout(task);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°ç»“ï¼š</strong>ï¼ˆæµç¨‹ï¼‰<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071947288.png" alt=""></p><p>åˆ†å¸ƒå¼åŸç†è§£å†³é—®é¢˜å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼ˆä¸å¯é‡å…¥ï¼Œä¸å¯é‡è¯•ï¼Œè¶…æ—¶é‡Šæ”¾ï¼‰ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071950079.png" alt=""></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071948547.png" alt=""></p><h3 id="5-5-åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†"><a href="#5-5-åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†" class="headerlink" title="5.5 åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†"></a>5.5 åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†</h3><p>è§£å†³é—®é¢˜ï¼šä¸»ä»ä¸€è‡´æ€§</p><p>ä¸ºäº†æé«˜redisçš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šæ­å»ºé›†ç¾¤æˆ–è€…ä¸»ä»ï¼Œç°åœ¨ä»¥ä¸»ä»ä¸ºä¾‹</p><p>æ­¤æ—¶æˆ‘ä»¬å»å†™å‘½ä»¤ï¼Œå†™åœ¨ä¸»æœºä¸Šï¼Œ ä¸»æœºä¼šå°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œä½†æ˜¯å‡è®¾åœ¨ä¸»æœºè¿˜æ²¡æœ‰æ¥å¾—åŠæŠŠæ•°æ®å†™å…¥åˆ°ä»æœºå»çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¸»æœºå®•æœºï¼Œå“¨å…µä¼šå‘ç°ä¸»æœºå®•æœºï¼Œå¹¶ä¸”é€‰ä¸¾ä¸€ä¸ªslaveå˜æˆmasterï¼Œè€Œæ­¤æ—¶æ–°çš„masterä¸­å®é™…ä¸Šå¹¶æ²¡æœ‰é”ä¿¡æ¯ï¼Œæ­¤æ—¶é”ä¿¡æ¯å°±å·²ç»ä¸¢æ‰äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œredissionæå‡ºæ¥äº†MutiLocké”ï¼Œä½¿ç”¨è¿™æŠŠé”å’±ä»¬å°±ä¸ä½¿ç”¨ä¸»ä»äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„åœ°ä½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ è¿™æŠŠé”åŠ é”çš„é€»è¾‘éœ€è¦å†™å…¥åˆ°æ¯ä¸€ä¸ªä¸»ä¸›èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å†™å…¥æˆåŠŸï¼Œæ­¤æ—¶æ‰æ˜¯åŠ é”æˆåŠŸï¼Œå‡è®¾ç°åœ¨æŸä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œé‚£ä¹ˆä»–å»è·å¾—é”çš„æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‹¿ä¸åˆ°ï¼Œéƒ½ä¸èƒ½ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå°±ä¿è¯äº†åŠ é”çš„å¯é æ€§ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301071954705.png" alt=""></p><p>é‚£ä¹ˆMutiLock åŠ é”åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å½“æˆ‘ä»¬å»è®¾ç½®äº†å¤šä¸ªé”æ—¶ï¼Œredissionä¼šå°†å¤šä¸ªé”æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åç”¨whileå¾ªç¯å»ä¸åœå»å°è¯•æ‹¿é”ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªæ€»å…±çš„åŠ é”æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç”¨éœ€è¦åŠ é”çš„ä¸ªæ•° * 1500ms ï¼Œå‡è®¾æœ‰3ä¸ªé”ï¼Œé‚£ä¹ˆæ—¶é—´å°±æ˜¯4500msï¼Œå‡è®¾åœ¨è¿™4500mså†…ï¼Œæ‰€æœ‰çš„é”éƒ½åŠ é”æˆåŠŸï¼Œ é‚£ä¹ˆæ­¤æ—¶æ‰ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå¦‚æœåœ¨4500msæœ‰çº¿ç¨‹åŠ é”å¤±è´¥ï¼Œåˆ™ä¼šå†æ¬¡å»è¿›è¡Œé‡è¯•ï¼Œå¯è¿›å…¥RedissonClientè·å–é”æ–¹æ³•çš„mutiLockè”é”æ–¹æ³•ä¸­æŸ¥çœ‹æºç è®¾å®šæœºåˆ¶ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301072009515.png" alt=""></p><h2 id="6ã€ç§’æ€ä¼˜åŒ–"><a href="#6ã€ç§’æ€ä¼˜åŒ–" class="headerlink" title="6ã€ç§’æ€ä¼˜åŒ–"></a>6ã€ç§’æ€ä¼˜åŒ–</h2><h3 id="6-1-ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯"><a href="#6-1-ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯" class="headerlink" title="6.1 ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯"></a>6.1 ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯</h3><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸‹å•æµç¨‹</p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶ä¼šè¯·æ±‚nginxï¼Œnginxä¼šè®¿é—®åˆ°tomcatï¼Œè€Œtomcatä¸­çš„ç¨‹åºï¼Œä¼šè¿›è¡Œä¸²è¡Œæ“ä½œï¼Œåˆ†æˆå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤</p><p>1ã€æŸ¥è¯¢ä¼˜æƒ å·</p><p>2ã€åˆ¤æ–­ç§’æ€åº“å­˜æ˜¯å¦è¶³å¤Ÿ</p><p>3ã€æŸ¥è¯¢è®¢å•</p><p>4ã€æ ¡éªŒæ˜¯å¦æ˜¯ä¸€äººä¸€å•</p><p>5ã€æ‰£å‡åº“å­˜</p><p>6ã€åˆ›å»ºè®¢å•</p><p>åœ¨è¿™å…­æ­¥æ“ä½œä¸­ï¼Œåˆæœ‰å¾ˆå¤šæ“ä½œæ˜¯è¦å»æ“ä½œæ•°æ®åº“çš„ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œ è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„å¾ˆæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼‚æ­¥ç¨‹åºæ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•åŠ é€Ÿå‘¢ï¼Ÿ</p><p>åœ¨è¿™é‡Œç¬”è€…æƒ³ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹è¯¾ç¨‹å†…æ²¡æœ‰çš„æ€è·¯ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å°ä¼™ä¼´è¿™ä¹ˆæƒ³ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¯ä»¥ä½¿ç”¨å¼‚æ­¥ç¼–æ’æ¥åšï¼Œæˆ–è€…è¯´æˆ‘å¼€å¯Nå¤šçº¿ç¨‹ï¼ŒNå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢ä¼˜æƒ å·ï¼Œä¸€ä¸ªæ‰§è¡Œåˆ¤æ–­æ‰£å‡åº“å­˜ï¼Œä¸€ä¸ªå»åˆ›å»ºè®¢å•ç­‰ç­‰ï¼Œç„¶åå†ç»Ÿä¸€åšè¿”å›ï¼Œè¿™ç§åšæ³•å’Œè¯¾ç¨‹ä¸­æœ‰å“ªç§å¥½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è¯¾ç¨‹ä¸­çš„å¥½ï¼Œå› ä¸ºå¦‚æœä½ é‡‡ç”¨æˆ‘åˆšè¯´çš„æ–¹å¼ï¼Œå¦‚æœè®¿é—®çš„äººå¾ˆå¤šï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½ä¸€ä¸‹å­å°±è¢«æ¶ˆè€—å®Œäº†ï¼Œè€Œä¸”ä½ ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºï¼Œä½ è§‰å¾—æ—¶æ•ˆæ€§ä¼šéå¸¸é‡è¦ï¼Œä½†æ˜¯ä½ æƒ³æƒ³æ˜¯å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œæ¯”å¦‚æˆ‘åªè¦ç¡®å®šä»–èƒ½åšè¿™ä»¶äº‹ï¼Œç„¶åæˆ‘åè¾¹æ…¢æ…¢åšå°±å¯ä»¥äº†ï¼Œæˆ‘å¹¶ä¸éœ€è¦ä»–ä¸€å£æ°”åšå®Œè¿™ä»¶äº‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“é‡‡ç”¨çš„æ˜¯è¯¾ç¨‹ä¸­ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼æ¥å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æˆ–è€…æ˜¯å¼‚æ­¥ç¼–æ’çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªéœ€æ±‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301072043396.png" alt=""></p><p>ä¼˜åŒ–æ–¹æ¡ˆï¼šæˆ‘ä»¬å°†è€—æ—¶æ¯”è¾ƒçŸ­çš„é€»è¾‘åˆ¤æ–­æ”¾å…¥åˆ°redisä¸­ï¼Œæ¯”å¦‚æ˜¯å¦åº“å­˜è¶³å¤Ÿï¼Œæ¯”å¦‚æ˜¯å¦ä¸€äººä¸€å•ï¼Œè¿™æ ·çš„æ“ä½œï¼Œåªè¦è¿™ç§é€»è¾‘å¯ä»¥å®Œæˆï¼Œå°±æ„å‘³ç€æˆ‘ä»¬æ˜¯ä¸€å®šå¯ä»¥ä¸‹å•å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¿«é€Ÿçš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æœ¬å°±ä¸ç”¨ç­‰ä¸‹å•é€»è¾‘èµ°å®Œï¼Œæˆ‘ä»¬ç›´æ¥ç»™ç”¨æˆ·è¿”å›æˆåŠŸï¼Œ å†åœ¨åå°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåå°çº¿ç¨‹æ…¢æ…¢çš„å»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯ï¼Œè¿™æ ·ç¨‹åºä¸å°±è¶…çº§å¿«äº†å—ï¼Ÿè€Œä¸”ä¹Ÿä¸ç”¨æ‹…å¿ƒçº¿ç¨‹æ± æ¶ˆè€—æ®†å°½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬çš„ç¨‹åºä¸­å¹¶æ²¡æœ‰æ‰‹åŠ¨ä½¿ç”¨ä»»ä½•çº¿ç¨‹æ± ï¼Œå½“ç„¶è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªéš¾ç‚¹</p><p>ç¬¬ä¸€ä¸ªéš¾ç‚¹æ˜¯æˆ‘ä»¬æ€ä¹ˆåœ¨redisä¸­å»å¿«é€Ÿæ ¡éªŒä¸€äººä¸€å•ï¼Œè¿˜æœ‰åº“å­˜åˆ¤æ–­ï¼Œåº“å­˜åˆ¤æ–­å­˜å…¥æ—¶åªéœ€è¦å­˜å…¥ä¸€ä¸ªStringçš„å€¼ï¼Œå¦‚å›¾</p><p>ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯ç”±äºæˆ‘ä»¬æ ¡éªŒå’Œtomctä¸‹å•æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“åˆ°åº•å“ªä¸ªå•ä»–æœ€åæ˜¯å¦æˆåŠŸï¼Œæˆ–è€…æ˜¯ä¸‹å•å®Œæˆï¼Œä¸ºäº†å®Œæˆè¿™ä»¶äº‹æˆ‘ä»¬åœ¨redisæ“ä½œå®Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå°†ä¸€äº›ä¿¡æ¯è¿”å›ç»™å‰ç«¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›ä¿¡æ¯ä¸¢åˆ°å¼‚æ­¥queueä¸­å»ï¼Œåç»­æ“ä½œä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªidæ¥æŸ¥è¯¢æˆ‘ä»¬tomcatä¸­çš„ä¸‹å•é€»è¾‘æ˜¯å¦å®Œæˆäº†ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹æ•´ä½“æ€è·¯ï¼šå½“ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³åªéœ€è¦å¯¼redisä¸­å»æ ¹æ®keyæ‰¾å¯¹åº”çš„valueæ˜¯å¦å¤§äº0å³å¯ï¼Œå¦‚æœä¸å……è¶³ï¼Œåˆ™ç›´æ¥ç»“æŸï¼Œå¦‚æœå……è¶³ï¼Œç»§ç»­åœ¨redisä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡æ•°æ®ï¼Œè¯´æ˜ä»–å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡è®°å½•ï¼Œåˆ™å°†userIdå’Œä¼˜æƒ å·å­˜å…¥åˆ°redisä¸­ï¼Œå¹¶ä¸”è¿”å›0ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦ä¿è¯æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaæ¥æ“ä½œ</p><p>å½“ä»¥ä¸Šåˆ¤æ–­é€»è¾‘èµ°å®Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å½“å‰redisä¸­è¿”å›çš„ç»“æœæ˜¯å¦æ˜¯0 ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥ä¸‹å•ï¼Œåˆ™å°†ä¹‹å‰è¯´çš„ä¿¡æ¯å­˜å…¥åˆ°åˆ°queueä¸­å»ï¼Œç„¶åè¿”å›ï¼Œç„¶åå†æ¥ä¸ªçº¿ç¨‹å¼‚æ­¥çš„ä¸‹å•ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡è¿”å›çš„è®¢å•idæ¥åˆ¤æ–­æ˜¯å¦ä¸‹å•æˆåŠŸã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301072054178.png" alt=""></p><h3 id="6-2-ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­"><a href="#6-2-ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­" class="headerlink" title="6.2 ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­"></a>6.2 ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­</h3><p>ä¸šåŠ¡éœ€æ±‚ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301082046756.png" alt=""></p><p>VoucherServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addSeckillVoucher</span><span class="params">(Voucher voucher)</span> &#123;</span><br><span class="line">    <span class="comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span></span><br><span class="line">    save(voucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span></span><br><span class="line">    <span class="type">SeckillVoucher</span> <span class="variable">seckillVoucher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SeckillVoucher</span>();</span><br><span class="line">    seckillVoucher.setVoucherId(voucher.getId());</span><br><span class="line">    seckillVoucher.setStock(voucher.getStock());</span><br><span class="line">    seckillVoucher.setBeginTime(voucher.getBeginTime());</span><br><span class="line">    seckillVoucher.setEndTime(voucher.getEndTime());</span><br><span class="line">    seckillVoucherService.save(seckillVoucher);</span><br><span class="line">    <span class="comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span></span><br><span class="line">    <span class="comment">//SECKILL_STOCK_KEY è¿™ä¸ªå˜é‡å®šä¹‰åœ¨RedisConstansä¸­</span></span><br><span class="line">    <span class="comment">//private static final String SECKILL_STOCK_KEY =&quot;seckill:stock:&quot;</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´luaè¡¨è¾¾å¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.å‚æ•°åˆ—è¡¨</span></span><br><span class="line"><span class="comment">-- 1.1.ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="keyword">local</span> voucherId = ARGV[<span class="number">1</span>]</span><br><span class="line"><span class="comment">-- 1.2.ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> userId = ARGV[<span class="number">2</span>]</span><br><span class="line"><span class="comment">-- 1.3.è®¢å•id</span></span><br><span class="line"><span class="keyword">local</span> orderId = ARGV[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.æ•°æ®key</span></span><br><span class="line"><span class="comment">-- 2.1.åº“å­˜key</span></span><br><span class="line"><span class="keyword">local</span> stockKey = <span class="string">&#x27;seckill:stock:&#x27;</span> .. voucherId</span><br><span class="line"><span class="comment">-- 2.2.è®¢å•key</span></span><br><span class="line"><span class="keyword">local</span> orderKey = <span class="string">&#x27;seckill:order:&#x27;</span> .. voucherId</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.è„šæœ¬ä¸šåŠ¡</span></span><br><span class="line"><span class="comment">-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">tonumber</span>(redis.call(<span class="string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span></span><br><span class="line"><span class="keyword">if</span>(redis.call(<span class="string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="number">1</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 3.4.æ‰£åº“å­˜ incrby stockKey -1</span></span><br><span class="line">redis.call(<span class="string">&#x27;incrby&#x27;</span>, stockKey, <span class="number">-1</span>)</span><br><span class="line"><span class="comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId</span></span><br><span class="line">redis.call(<span class="string">&#x27;sadd&#x27;</span>, orderKey, userId)</span><br><span class="line"><span class="comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span></span><br><span class="line">redis.call(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å½“ä»¥ä¸Šluaè¡¨è¾¾å¼æ‰§è¡Œå®Œæ¯•åï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®æ­¥éª¤3,4æ¥æ‰§è¡Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡äº†</p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.nextId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">    <span class="comment">// 1.æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">            SECKILL_SCRIPT,</span><br><span class="line">            Collections.emptyList(),</span><br><span class="line">            voucherId.toString(), userId.toString(), String.valueOf(orderId)</span><br><span class="line">    );</span><br><span class="line">    <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">    <span class="comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(r == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TODO ä¿å­˜é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// 3.è¿”å›è®¢å•id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–"><a href="#6-3-ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–" class="headerlink" title="6.3 ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–"></a>6.3 ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–</h3><p>VoucherOrderServiceImpl</p><p>ä¿®æ”¹ä¸‹å•åŠ¨ä½œï¼Œç°åœ¨æˆ‘ä»¬å»ä¸‹å•æ—¶ï¼Œæ˜¯é€šè¿‡luaè¡¨è¾¾å¼å»åŸå­æ‰§è¡Œåˆ¤æ–­é€»è¾‘ï¼Œå¦‚æœåˆ¤æ–­æˆ‘å‡ºæ¥ä¸ä¸º0 ï¼Œåˆ™è¦ä¹ˆæ˜¯åº“å­˜ä¸è¶³ï¼Œè¦ä¹ˆæ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™æŠŠä¸‹å•çš„é€»è¾‘ä¿å­˜åˆ°é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå¼‚æ­¥æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;VoucherOrderMapper, VoucherOrder&gt; <span class="keyword">implements</span> <span class="title class_">IVoucherOrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ISeckillVoucherService seckillVoucherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisIdWorker redisIdWorker;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedissonClient redissonClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DefaultRedisScript&lt;Long&gt; SECKILL_SCRIPT;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        SECKILL_SCRIPT = <span class="keyword">new</span> <span class="title class_">DefaultRedisScript</span>&lt;&gt;();</span><br><span class="line">        SECKILL_SCRIPT.setLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;seckillvoucher.lua&quot;</span>));</span><br><span class="line">        SECKILL_SCRIPT.setResultType(Long.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºé˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1024</span>*<span class="number">1024</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹æ± å»å¤„ç†è®¢å•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">SECKILL_ORDER_EXECUTOR</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨è§£æ˜¯ä¸ºäº†æ˜¯å¼‚æ­¥é˜»å¡é˜Ÿåˆ—åœ¨ç±»åˆå§‹åŒ–åå°±æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        SECKILL_ORDER_EXECUTOR.submit(<span class="keyword">new</span> <span class="title class_">VoucherOrderHandler</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è·å–åˆ°è®¢å•ä¿¡æ¯</span></span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> orderTasks.take();</span><br><span class="line">                    <span class="comment">// åˆ›å»ºè®¢å•</span></span><br><span class="line">                    handleVocherOrder(voucherOrder);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleVocherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªé”å¯¹è±¡</span></span><br><span class="line">        <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redissonClient.getLock(<span class="string">&quot;lock:order:&quot;</span> + userId);</span><br><span class="line">        <span class="comment">//è·å–é”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isLock</span> <span class="operator">=</span> lock.tryLock();</span><br><span class="line">        <span class="keyword">if</span>(!isLock)&#123;</span><br><span class="line">            <span class="comment">//è·å–å¤±è´¥</span></span><br><span class="line">            log.error(<span class="string">&quot;ä¸€ä¸ªå°æœ‹å‹åªèƒ½ä¸‹ä¸€å•å“¦ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ³¨æ„ï¼šç”±äºæ˜¯springçš„äº‹åŠ¡æ˜¯æ”¾åœ¨threadLocalä¸­ï¼Œæ­¤æ—¶çš„æ˜¯å¤šçº¿ç¨‹ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆ</span></span><br><span class="line">            proxy.creatVoucherOrder(voucherOrder);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IVoucherOrderService proxy;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">seckillVoucher</span><span class="params">(Long voucherId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ‰§è¡Œluaè„šæœ¬</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> stringRedisTemplate.execute(</span><br><span class="line">                SECKILL_SCRIPT,</span><br><span class="line">                Collections.emptyList(),</span><br><span class="line">                voucherId.toString(), userId.toString()</span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> result.intValue();</span><br><span class="line">        <span class="comment">// 2.1 ç»“æœä¸ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span>(i != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(i == <span class="number">1</span> ? <span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span> : <span class="string">&quot;ä¸èƒ½é‡å¤ä¸‹å•ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="comment">//è¿™é‡Œçš„ä¸šåŠ¡å°±æ˜¯ç»™å¯¹åº”çš„è¡¨å¡«ä¸Šå¯¹åº”çš„ä¿¡æ¯</span></span><br><span class="line">        <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>();</span><br><span class="line">        <span class="comment">// 4.1.è®¢å•id</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> redisIdWorker.newId(<span class="string">&quot;order&quot;</span>);</span><br><span class="line">        voucherOrder.setId(orderId);</span><br><span class="line">        <span class="comment">// 4.2.ç”¨æˆ·id</span></span><br><span class="line">        voucherOrder.setUserId(userId);</span><br><span class="line">        <span class="comment">// 4.3.ä»£é‡‘åˆ¸id</span></span><br><span class="line">        voucherOrder.setVoucherId(voucherId);</span><br><span class="line">        <span class="comment">// 5. æ·»åŠ å…¥é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">        orderTasks.add(voucherOrder);</span><br><span class="line">        <span class="comment">// 6. åœ¨ä¸»çº¿ç¨‹è·å–åˆ°å¯¹åº”çš„ä»£ç†å¯¹è±¡æ–¹ä¾¿å­çº¿ç¨‹å»è°ƒç”¨</span></span><br><span class="line">        proxy = (IVoucherOrderService) AopContext.currentProxy();</span><br><span class="line">        <span class="comment">// 7. è¿”å›æˆåŠŸä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(orderId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">creatVoucherOrder</span><span class="params">(VoucherOrder voucherOrder)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸€äººä¸€å•</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> voucherOrder.getUserId();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;ä¸€ä¸ªå°æœ‹å‹åªå¯ä»¥æŠ¢è´­ä¸€å¼ å“¦~&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡å®ç°æ‰£å‡åº“å­˜</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> seckillVoucherService.update()</span><br><span class="line">                .setSql(<span class="string">&quot;stock = stock - 1&quot;</span>)<span class="comment">//set stock = stock - 1</span></span><br><span class="line">                .eq(<span class="string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).gt(<span class="string">&quot;stock&quot;</span>, <span class="number">0</span>)<span class="comment">//è¿™é‡Œæ˜¯ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶åˆ¤æ–­</span></span><br><span class="line">                .update();</span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        save(voucherOrder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç§’æ€ä¸šåŠ¡çš„ä¼˜åŒ–æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å…ˆåˆ©ç”¨Rediså®Œæˆåº“å­˜ä½™é‡ã€ä¸€äººä¸€å•åˆ¤æ–­ï¼Œå®ŒæˆæŠ¢å•ä¸šåŠ¡</li><li>å†å°†ä¸‹å•ä¸šåŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥ä¸‹å•</li><li>åŸºäºé˜»å¡é˜Ÿåˆ—çš„å¼‚æ­¥ç§’æ€å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ<ul><li>å†…å­˜é™åˆ¶é—®é¢˜</li><li>æ•°æ®å®‰å…¨é—®é¢˜</li></ul></li></ul><h2 id="7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—"><a href="#7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—"></a>7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—</h2><h3 id="7-1-Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-1-Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.1 Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—"></a>7.1 Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—</h3><p>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚æœ€ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹åŒ…æ‹¬3ä¸ªè§’è‰²ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºæ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰</li><li>ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li>æ¶ˆè´¹è€…ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯å¹¶å¤„ç†æ¶ˆæ¯</li></ul><p>ä½¿ç”¨é˜Ÿåˆ—çš„å¥½å¤„åœ¨äº <strong>è§£è€¦ï¼š</strong>æ‰€è°“è§£è€¦ï¼Œä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­å°±æ˜¯ï¼šå¿«é€’å‘˜(ç”Ÿäº§è€…)æŠŠå¿«é€’æ”¾åˆ°å¿«é€’æŸœé‡Œè¾¹(Message Queue)å»ï¼Œæˆ‘ä»¬(æ¶ˆè´¹è€…)ä»å¿«é€’æŸœé‡Œè¾¹å»æ‹¿ä¸œè¥¿ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œå¦‚æœè€¦åˆï¼Œé‚£ä¹ˆè¿™ä¸ªå¿«é€’å‘˜ç›¸å½“äºç›´æ¥æŠŠå¿«é€’äº¤ç»™ä½ ï¼Œè¿™äº‹å›ºç„¶å¥½ï¼Œä½†æ˜¯ä¸‡ä¸€ä½ ä¸åœ¨å®¶ï¼Œé‚£ä¹ˆå¿«é€’å‘˜å°±ä¼šä¸€ç›´ç­‰ä½ ï¼Œè¿™å°±æµªè´¹äº†å¿«é€’å‘˜çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿™ç§æ€æƒ³åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>è¿™ç§åœºæ™¯åœ¨æˆ‘ä»¬ç§’æ€ä¸­å°±å˜æˆäº†ï¼šæˆ‘ä»¬ä¸‹å•ä¹‹åï¼Œåˆ©ç”¨rediså»è¿›è¡Œæ ¡éªŒä¸‹å•æ¡ä»¶ï¼Œå†é€šè¿‡é˜Ÿåˆ—æŠŠæ¶ˆæ¯å‘é€å‡ºå»ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆè§£è€¦ï¼ŒåŒæ—¶ä¹ŸåŠ å¿«æˆ‘ä»¬çš„å“åº”é€Ÿåº¦ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„mqï¼Œæ¯”å¦‚kafkaï¼Œrabbitmqç­‰ç­‰ï¼Œä½†æ˜¯å‘¢ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…mqï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨redisæä¾›çš„mqæ–¹æ¡ˆï¼Œé™ä½æˆ‘ä»¬çš„éƒ¨ç½²å’Œå­¦ä¹ æˆæœ¬ã€‚</p><h3 id="7-2-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-2-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.2 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—"></a>7.2 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>åŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</strong></p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚è€ŒRedisçš„listæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¾ˆå®¹æ˜“æ¨¡æ‹Ÿå‡ºé˜Ÿåˆ—æ•ˆæœã€‚</p><p>é˜Ÿåˆ—æ˜¯å…¥å£å’Œå‡ºå£ä¸åœ¨ä¸€è¾¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ï¼šLPUSH ç»“åˆ RPOPã€æˆ–è€… RPUSH ç»“åˆ LPOPæ¥å®ç°ã€‚<br>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶RPOPæˆ–LPOPæ“ä½œä¼šè¿”å›nullï¼Œå¹¶ä¸åƒJVMçš„é˜»å¡é˜Ÿåˆ—é‚£æ ·ä¼šé˜»å¡å¹¶ç­‰å¾…æ¶ˆæ¯ã€‚å› æ­¤è¿™é‡Œåº”è¯¥ä½¿ç”¨BRPOPæˆ–è€…BLPOPæ¥å®ç°é˜»å¡æ•ˆæœã€‚</p><p>åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>åˆ©ç”¨Rediså­˜å‚¨ï¼Œä¸å—é™äºJVMå†…å­˜ä¸Šé™</li><li>åŸºäºRedisçš„æŒä¹…åŒ–æœºåˆ¶ï¼Œæ•°æ®å®‰å…¨æ€§æœ‰ä¿è¯</li><li>å¯ä»¥æ»¡è¶³æ¶ˆæ¯æœ‰åºæ€§</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>åªæ”¯æŒå•æ¶ˆè´¹è€…</li></ul><h3 id="7-3-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-3-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.3 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>7.3 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>PubSubï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ˜¯Redis2.0ç‰ˆæœ¬å¼•å…¥çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹ã€‚é¡¾åæ€ä¹‰ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªchannelï¼Œç”Ÿäº§è€…å‘å¯¹åº”channelå‘é€æ¶ˆæ¯åï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ã€‚</p><p> SUBSCRIBE channel [channel] ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“<br> PUBLISH channel msg ï¼šå‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯<br> PSUBSCRIBE pattern[pattern] ï¼šè®¢é˜…ä¸patternæ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301091947112.png" alt=""></p><p>æ¼”ç¤ºï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301091948396.png" alt=""></p><p>åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>é‡‡ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œæ”¯æŒå¤šç”Ÿäº§ã€å¤šæ¶ˆè´¹</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™ï¼Œè¶…å‡ºæ—¶æ•°æ®ä¸¢å¤±</li></ul><h3 id="7-4-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-4-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.4 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>7.4 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>Stream æ˜¯ Redis 5.0 å¼•å…¥çš„ä¸€ç§æ–°æ•°æ®ç±»å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½éå¸¸å®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>å‘é€æ¶ˆæ¯çš„å‘½ä»¤ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092020100.png" alt=""></p><p>ä¾‹å¦‚ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092021488.png" alt=""></p><p>è¯»å–æ¶ˆæ¯çš„æ–¹å¼ä¹‹ä¸€ï¼šXREAD</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092025472.png" alt=""></p><p>XREADé˜»å¡æ–¹å¼ï¼Œè¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092034875.png" alt=""></p><p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ªç¯çš„è°ƒç”¨XREADé˜»å¡æ–¹å¼æ¥æŸ¥è¯¢æœ€æ–°æ¶ˆæ¯ï¼Œä»è€Œå®ç°æŒç»­ç›‘å¬é˜Ÿåˆ—çš„æ•ˆæœï¼Œä¼ªä»£ç å¦‚ä¸‹</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092032971.png" alt=""></p><p>æ³¨æ„ï¼šå½“æˆ‘ä»¬æŒ‡å®šèµ·å§‹IDä¸º$æ—¶ï¼Œä»£è¡¨è¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†ä¸€æ¡æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰è¶…è¿‡1æ¡ä»¥ä¸Šçš„æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—ï¼Œåˆ™ä¸‹æ¬¡è·å–æ—¶ä¹Ÿåªèƒ½è·å–åˆ°æœ€æ–°çš„ä¸€æ¡ï¼Œä¼šå‡ºç°æ¼è¯»æ¶ˆæ¯çš„é—®é¢˜</p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li></ul><h3 id="7-5-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„"><a href="#7-5-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„" class="headerlink" title="7.5 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„"></a>7.5 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„</h3><p>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šå°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092038966.png" alt=""></p><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092039204.png" alt=""></p><p>å…¶å®ƒå¸¸è§å‘½ä»¤ï¼š</p><p> <strong>åˆ é™¤æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DESTORY key groupName</span><br></pre></td></tr></table></figure><p> <strong>ç»™æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP CREATECONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p> <strong>åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­çš„æŒ‡å®šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP DELCONSUMER key groupname consumername</span><br></pre></td></tr></table></figure><p>ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span><br></pre></td></tr></table></figure><ul><li>groupï¼šæ¶ˆè´¹ç»„åç§°</li><li>consumerï¼šæ¶ˆè´¹è€…åç§°ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</li><li>countï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å¤§æ•°é‡</li><li>BLOCK millisecondsï¼šå½“æ²¡æœ‰æ¶ˆæ¯æ—¶æœ€é•¿ç­‰å¾…æ—¶é—´</li><li>NOACKï¼šæ— éœ€æ‰‹åŠ¨ACKï¼Œè·å–åˆ°æ¶ˆæ¯åè‡ªåŠ¨ç¡®è®¤</li><li>STREAMS keyï¼šæŒ‡å®šé˜Ÿåˆ—åç§°</li><li>IDï¼šè·å–æ¶ˆæ¯çš„èµ·å§‹IDï¼š</li></ul><p>â€œ&gt;â€ï¼šä»ä¸‹ä¸€ä¸ªæœªæ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹<br>å…¶å®ƒï¼šæ ¹æ®æŒ‡å®šidä»pending-listä¸­è·å–å·²æ¶ˆè´¹ä½†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚0ï¼Œæ˜¯ä»pending-listä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹</p><p>æ¼”ç¤ºï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301092138393.png" alt=""></p><p>pending-listä¸­çš„æ¶ˆæ¯è·å–ï¼šï¼ˆæ˜¯å·²ç»è·å–åˆ°ä½†æ˜¯æ²¡æœ‰è¿›è¡Œackç¡®è®¤çš„ä¿¡æ¯ï¼‰<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301100928398.png" alt=""></p><p><strong>æµç¨‹ï¼š</strong></p><ol><li>é¦–å…ˆä½¿ç”¨xaddè¿›è¡Œé”®å€¼å¯¹æ¶ˆæ¯æ·»åŠ </li><li>é€šè¿‡xgroupæŒ‡ä»¤åˆ›å»ºåˆ†ç»„</li><li>ä¹‹åé€šè¿‡xreadgroupå»è·å–ä¿¡æ¯åŒæ—¶åˆ›å»ºå¯¹åº”æ¶ˆè´¹è€…ï¼Œå¼€å§‹æ˜¯ä½¿ç”¨&gt;çš„æ–¹å¼</li><li>åœ¨å…¨éƒ¨è·å–ä¹‹åå¯¹è·å–çš„æ¶ˆæ¯è¿›è¡Œxackå¤„ç†</li><li>å¦‚æœå¿˜è®°å¤„ç†ï¼Œåˆ™å¯ä»¥è¿›å…¥pending-listæŸ¥çœ‹ï¼Œå¯ä»¥å°†xreadgroupæŒ‡ä»¤ä¸­çš„&gt;æ”¹ä¸º0ï¼Œå¯¹pending-listä¸­çš„æœªå¤„ç†çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†</li></ol><p>æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯çš„åŸºæœ¬æ€è·¯ï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301100944457.png" alt=""></p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADGROUPå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>å¯ä»¥å¤šæ¶ˆè´¹è€…äº‰æŠ¢æ¶ˆæ¯ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æ²¡æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li><li>æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</li></ul><p>æœ€åæˆ‘ä»¬æ¥ä¸ªå°å¯¹æ¯”</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301101013913.png" alt=""></p><h3 id="7-6-åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•"><a href="#7-6-åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•" class="headerlink" title="7.6 åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•"></a>7.6 åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•</h3><p>éœ€æ±‚ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªStreamç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåä¸ºstream.orders</li><li>ä¿®æ”¹ä¹‹å‰çš„ç§’æ€ä¸‹å•Luaè„šæœ¬ï¼Œåœ¨è®¤å®šæœ‰æŠ¢è´­èµ„æ ¼åï¼Œç›´æ¥å‘stream.ordersä¸­æ·»åŠ æ¶ˆæ¯ï¼Œå†…å®¹åŒ…å«voucherIdã€userIdã€orderId</li><li>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå°è¯•è·å–stream.ordersä¸­çš„æ¶ˆæ¯ï¼Œå®Œæˆä¸‹å•</li></ul><p>åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ä¹Ÿå¯ç›´æ¥ä½¿ç”¨xgroupçš„æ–¹å¼ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301101016750.png" alt=""></p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;stream.orders&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è·å–åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ xreadgroup GROUP g1 c1 COUNT 1 BLOCK 2000 STREAM stream.orders &gt;</span></span><br><span class="line">                    List&lt;MapRecord&lt;String, Object, Object&gt;&gt; recordList = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                            Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                            StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                            StreamOffset.create(queueName, ReadOffset.lastConsumed())</span><br><span class="line">                    );</span><br><span class="line">                    <span class="comment">// åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">                    <span class="keyword">if</span>(recordList == <span class="literal">null</span> || recordList.isEmpty())&#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœè·å–å¤±è´¥</span></span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// è§£æè·å–åˆ°çš„è®¢å•æ•°æ®</span></span><br><span class="line">                    MapRecord&lt;String, Object, Object&gt; record = recordList.get(<span class="number">0</span>);</span><br><span class="line">                    Map&lt;Object, Object&gt; recordValue = record.getValue();</span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(recordValue, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                    <span class="comment">// åˆ›å»ºè®¢å•</span></span><br><span class="line">                    handleVocherOrder(voucherOrder);</span><br><span class="line">                    <span class="comment">// è¿›è¡Œackç¡®è®¤</span></span><br><span class="line">                    stringRedisTemplate.opsForStream().acknowledge(queueName,<span class="string">&quot;s1&quot;</span>,record.getId());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                    <span class="comment">//å¤„ç†å¼‚å¸¸æ¶ˆæ¯</span></span><br><span class="line">                    handlePendingList();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// è·å–åˆ°pendinglistä¸­çš„è®¢å•ä¿¡æ¯ xreadgroup GROUP g1 c1 COUNT 1 STREAM stream.orders 0</span></span><br><span class="line">                    List&lt;MapRecord&lt;String, Object, Object&gt;&gt; recordList = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                            Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                            StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                            StreamOffset.create(queueName, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                    );</span><br><span class="line">                    <span class="comment">// åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦è·å–æˆåŠŸ</span></span><br><span class="line">                    <span class="keyword">if</span>(recordList == <span class="literal">null</span> || recordList.isEmpty())&#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœè·å–å¤±è´¥ï¼Œç›´æ¥é€€å‡ºå¾ªç¯</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// è§£æè·å–åˆ°çš„è®¢å•æ•°æ®</span></span><br><span class="line">                    MapRecord&lt;String, Object, Object&gt; record = recordList.get(<span class="number">0</span>);</span><br><span class="line">                    Map&lt;Object, Object&gt; recordValue = record.getValue();</span><br><span class="line">                    <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(recordValue, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                    <span class="comment">// åˆ›å»ºè®¢å•</span></span><br><span class="line">                    handleVocherOrder(voucherOrder);</span><br><span class="line">                    <span class="comment">// è¿›è¡Œackç¡®è®¤</span></span><br><span class="line">                    stringRedisTemplate.opsForStream().acknowledge(queueName,<span class="string">&quot;s1&quot;</span>,record.getId());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;å¤„ç†penddingè®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(ex);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8ã€è¾¾äººæ¢åº—"><a href="#8ã€è¾¾äººæ¢åº—" class="headerlink" title="8ã€è¾¾äººæ¢åº—"></a>8ã€è¾¾äººæ¢åº—</h2><h3 id="8-1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°"><a href="#8-1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°" class="headerlink" title="8.1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°"></a>8.1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°</h3><p>å‘å¸ƒæ¢åº—ç¬”è®°</p><p>æ¢åº—ç¬”è®°ç±»ä¼¼ç‚¹è¯„ç½‘ç«™çš„è¯„ä»·ï¼Œå¾€å¾€æ˜¯å›¾æ–‡ç»“åˆã€‚å¯¹åº”çš„è¡¨æœ‰ä¸¤ä¸ªï¼š<br>tb_blogï¼šæ¢åº—ç¬”è®°è¡¨ï¼ŒåŒ…å«ç¬”è®°ä¸­çš„æ ‡é¢˜ã€æ–‡å­—ã€å›¾ç‰‡ç­‰<br>tb_blog_commentsï¼šå…¶ä»–ç”¨æˆ·å¯¹æ¢åº—ç¬”è®°çš„è¯„ä»·</p><p>ä¸Šä¼ æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;blog&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">uploadImage</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile image)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è·å–åŸå§‹æ–‡ä»¶åç§°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> image.getOriginalFilename();</span><br><span class="line">            <span class="comment">// ç”Ÿæˆæ–°æ–‡ä»¶å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> createNewFileName(originalFilename);</span><br><span class="line">            <span class="comment">// ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">            image.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(SystemConstants.IMAGE_UPLOAD_DIR, fileName));</span><br><span class="line">            <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">            log.debug(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œ&#123;&#125;&quot;</span>, fileName);</span><br><span class="line">            <span class="keyword">return</span> Result.ok(fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šéœ€è¦ä¿®æ”¹SystemConstants.IMAGE_UPLOAD_DIR è‡ªå·±å›¾ç‰‡æ‰€åœ¨çš„åœ°å€ï¼Œåœ¨å®é™…å¼€å‘ä¸­å›¾ç‰‡ä¸€èˆ¬ä¼šæ”¾åœ¨nginxä¸Šæˆ–è€…æ˜¯äº‘å­˜å‚¨ä¸Šã€‚</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/blog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IBlogService blogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(<span class="meta">@RequestBody</span> Blog blog)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">        blog.setUpdateTime(user.getId());</span><br><span class="line">        <span class="comment">//ä¿å­˜æ¢åº—åšæ–‡</span></span><br><span class="line">        blogService.saveBlog(blog);</span><br><span class="line">        <span class="comment">//è¿”å›id</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°"><a href="#8-2-è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°" class="headerlink" title="8.2 è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°"></a>8.2 è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°</h3><p>å®ç°æŸ¥çœ‹å‘å¸ƒæ¢åº—ç¬”è®°çš„æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ä»£ç ï¼š</p><p>BlogServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BlogMapper, Blog&gt; <span class="keyword">implements</span> <span class="title class_">IBlogService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryhotBlog</span><span class="params">(Integer current)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">        Page&lt;Blog&gt; page = query()</span><br><span class="line">                .orderByDesc(<span class="string">&quot;liked&quot;</span>)</span><br><span class="line">                .page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line">        <span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">        List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">        records.forEach(<span class="built_in">this</span>::queryuserById);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(records);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">queryuserById</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> blog.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">        blog.setName(user.getNickName());</span><br><span class="line">        blog.setIcon(user.getIcon());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">queryBlogById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æŸ¥è¯¢å¯¹åº”åº—é“ºä¿¡æ¯å¹¶è¿”å›</span></span><br><span class="line">        <span class="type">Blog</span> <span class="variable">blog</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="keyword">if</span> (blog==<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;åšå®¢ä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶è¿”å›</span></span><br><span class="line">        queryuserById(blog);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(blog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8-3-è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½"><a href="#8-3-è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½" class="headerlink" title="8.3 è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½"></a>8.3 è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½</h3><p>åˆå§‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿®æ”¹ç‚¹èµæ•°é‡</span></span><br><span class="line">    blogService.update().setSql(<span class="string">&quot;liked = liked +1 &quot;</span>).eq(<span class="string">&quot;id&quot;</span>,id).update();</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜åˆ†æï¼šè¿™ç§æ–¹å¼ä¼šå¯¼è‡´ä¸€ä¸ªç”¨æˆ·æ— é™ç‚¹èµï¼Œæ˜æ˜¾æ˜¯ä¸åˆç†çš„</p><p>é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨çš„é€»è¾‘ï¼Œå‘èµ·è¯·æ±‚åªæ˜¯ç»™æ•°æ®åº“+1ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><p>å®Œå–„ç‚¹èµåŠŸèƒ½</p><p>éœ€æ±‚ï¼š</p><ul><li>åŒä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡ï¼Œå†æ¬¡ç‚¹å‡»åˆ™å–æ¶ˆç‚¹èµ</li><li>å¦‚æœå½“å‰ç”¨æˆ·å·²ç»ç‚¹èµï¼Œåˆ™ç‚¹èµæŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼ˆå‰ç«¯å·²å®ç°ï¼Œåˆ¤æ–­å­—æ®µBlogç±»çš„isLikeå±æ€§ï¼‰</li></ul><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>ç»™Blogç±»ä¸­æ·»åŠ ä¸€ä¸ªisLikeå­—æ®µï¼Œæ ‡ç¤ºæ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµ</li><li>ä¿®æ”¹ç‚¹èµåŠŸèƒ½ï¼Œåˆ©ç”¨Redisçš„seté›†åˆåˆ¤æ–­æ˜¯å¦ç‚¹èµè¿‡ï¼Œæœªç‚¹èµè¿‡åˆ™ç‚¹èµæ•°+1ï¼Œå·²ç‚¹èµè¿‡åˆ™ç‚¹èµæ•°-1</li><li>ä¿®æ”¹æ ¹æ®idæŸ¥è¯¢Blogçš„ä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li><li>ä¿®æ”¹åˆ†é¡µæŸ¥è¯¢Blogä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li></ul><p>ä¸ºä»€ä¹ˆé‡‡ç”¨seté›†åˆï¼š</p><p>å› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œå½“ç”¨æˆ·æ“ä½œè¿‡ä¹‹åï¼Œæ— è®ºä»–æ€ä¹ˆæ“ä½œï¼Œéƒ½æ˜¯</p><p>å…·ä½“æ­¥éª¤ï¼š</p><p>1ã€åœ¨Blog æ·»åŠ ä¸€ä¸ªå­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Boolean isLike;</span><br></pre></td></tr></table></figure><p>2ã€ä¿®æ”¹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">        <span class="comment">// 2. åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç‚¹èµ</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> stringRedisTemplate.opsForSet().isMember(key, userId.toString());</span><br><span class="line">        <span class="keyword">if</span> (BooleanUtil.isFalse(isMember)) &#123;</span><br><span class="line">            <span class="comment">// 2.1 ç”¨æˆ·æœªç‚¹èµ</span></span><br><span class="line">            <span class="comment">// 2.1.1 æ•°æ®åº“ä¸­å¯¹ç‚¹èµæ•°+1</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">update</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">            <span class="keyword">if</span> (update) &#123;</span><br><span class="line">                <span class="comment">// æ›´æ–°æˆåŠŸä¹‹å</span></span><br><span class="line">                <span class="comment">// 2.1.2 åœ¨redisä¸­è¿›è¡Œæ·»åŠ set</span></span><br><span class="line">                stringRedisTemplate.opsForSet().add(key, userId.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 2.2 ç”¨æˆ·å·²ç‚¹èµ</span></span><br><span class="line">            <span class="comment">// 2.1.1 æ•°æ®åº“ä¸­å¯¹ç‚¹èµæ•°-1</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">update</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">            <span class="keyword">if</span> (update) &#123;</span><br><span class="line">                <span class="comment">// æ›´æ–°æˆåŠŸä¹‹å</span></span><br><span class="line">                <span class="comment">// 2.1.2 åœ¨redisä¸­è¿›è¡Œæ·»åŠ set</span></span><br><span class="line">                stringRedisTemplate.opsForSet().remove(key, userId.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ"><a href="#8-4-è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ" class="headerlink" title="8.4 è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ"></a>8.4 è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ</h3><p>åœ¨æ¢åº—ç¬”è®°çš„è¯¦æƒ…é¡µé¢ï¼Œåº”è¯¥æŠŠç»™è¯¥ç¬”è®°ç‚¹èµçš„äººæ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚æœ€æ—©ç‚¹èµçš„TOP5ï¼Œå½¢æˆç‚¹èµæ’è¡Œæ¦œï¼š</p><p>ä¹‹å‰çš„ç‚¹èµæ˜¯æ”¾åˆ°seté›†åˆï¼Œä½†æ˜¯seté›†åˆæ˜¯ä¸èƒ½æ’åºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªå¯ä»¥æ’åºçš„seté›†åˆï¼Œå°±æ˜¯å’±ä»¬çš„sortedSet</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥æ¥å¯¹æ¯”ä¸€ä¸‹è¿™äº›é›†åˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301111250453.png" alt=""></p><p>æ‰€æœ‰ç‚¹èµçš„äººï¼Œéœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“ä½¿ç”¨setæˆ–è€…æ˜¯sortedSet</p><p>å…¶æ¬¡æˆ‘ä»¬éœ€è¦æ’åºï¼Œå°±å¯ä»¥ç›´æ¥é”å®šä½¿ç”¨sortedSetå•¦</p><p>ä¿®æ”¹ä»£ç </p><p>BlogServiceImpl</p><p>ç‚¹èµé€»è¾‘ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">likeBlog</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç‚¹èµ ä¿®æ”¹ä¸ºsortedset</span></span><br><span class="line">    <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">    <span class="keyword">if</span> (score == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 2.1 ç”¨æˆ·æœªç‚¹èµ</span></span><br><span class="line">        <span class="comment">// 2.1.1 æ•°æ®åº“ä¸­å¯¹ç‚¹èµæ•°+1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">update</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked + 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="keyword">if</span> (update) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°æˆåŠŸä¹‹å</span></span><br><span class="line">            <span class="comment">// 2.1.2 åœ¨redisä¸­è¿›è¡Œæ·»åŠ set ä¿®æ”¹ä¸ºsortedset</span></span><br><span class="line">            stringRedisTemplate.opsForZSet().add(key,userId.toString(),System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 2.2 ç”¨æˆ·å·²ç‚¹èµ</span></span><br><span class="line">        <span class="comment">// 2.1.1 æ•°æ®åº“ä¸­å¯¹ç‚¹èµæ•°-1</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">update</span> <span class="operator">=</span> update().setSql(<span class="string">&quot;liked = liked - 1&quot;</span>).eq(<span class="string">&quot;id&quot;</span>, id).update();</span><br><span class="line">        <span class="keyword">if</span> (update) &#123;</span><br><span class="line">            <span class="comment">// æ›´æ–°æˆåŠŸä¹‹å</span></span><br><span class="line">            <span class="comment">// 2.1.2 åœ¨redisä¸­è¿›è¡Œæ·»åŠ set</span></span><br><span class="line">            stringRedisTemplate.opsForZSet().remove(key,userId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">isBlogLiked</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// æ­¤æ—¶æœªç™»å½•æ— éœ€æŸ¥è¯¢æ˜¯å¦ç‚¹èµ</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> user.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + blog.getId();</span><br><span class="line">    <span class="comment">// 2. åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç‚¹èµ</span></span><br><span class="line">    <span class="type">Double</span> <span class="variable">score</span> <span class="operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());</span><br><span class="line">    blog.setIsLike(score != <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹èµåˆ—è¡¨æŸ¥è¯¢åˆ—è¡¨</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogLikes</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogLikes(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">querBlogLikes</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLOG_LIKED_KEY + id;</span><br><span class="line">    <span class="comment">// 1. æŸ¥è¯¢åˆ°å¯¹åº”çš„user list</span></span><br><span class="line">    Set&lt;String&gt; userList = stringRedisTemplate.opsForZSet().range(key, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">if</span>(userList == <span class="literal">null</span>|| userList.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. è§£æå‡ºå¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    List&lt;Long&gt; collectIds = userList.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, collectIds);</span><br><span class="line">    <span class="comment">// 3. å¯¹è·å¾—åˆ°çš„ç”¨æˆ·ä¿¡æ¯è¿›è½¬æ¢æˆuserDTOç±»å‹</span></span><br><span class="line">    <span class="comment">// 4. æ ¹æ®idæŸ¥è¯¢å¹¶ä¸”å†™å‡ºå¯¹åº”sqlè¯­å¥</span></span><br><span class="line">    List&lt;UserDTO&gt; userDTOS = userService.query()</span><br><span class="line">            .in(<span class="string">&quot;id&quot;</span>,collectIds).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list()</span><br><span class="line">            .stream().map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(userDTOS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸šåŠ¡æµç¨‹æ€»ç»“ï¼š</p><ol><li>é¦–å…ˆåˆ‡æ¢å­˜å‚¨redisçš„æ•°æ®ç»“æ„ä¸ºsortedsetï¼Œè®¾ç½®å…¶ä¸­çš„scoreå€¼ï¼Œå€¼è®¾ç½®ä¸ºæ—¶é—´æˆ³</li><li>è®¾ç½®å¯¹åº”è·å–å–œæ¬¢ç¬”è®°ç”¨æˆ·çš„æ¥å£ä»¥åŠæ–¹æ³•ï¼Œè¿›å…¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶æ’åºï¼Œä½†æ˜¯ç”±äºæ•°æ®åº“ä¸­é»˜è®¤æ˜¯æŒ‰ç…§idé¡ºåºæ’åºæ‰€ä»¥æ­¤æ—¶éœ€ä¿®æ”¹è¯¥æ’åºé€»è¾‘ï¼Œè‡ªå·±ç¼–å†™ä¸€æ®µorder byè¯­å¥æ ¹æ®æŸ¥è¯¢é¡ºåºå±•ç¤º</li></ol><h2 id="9ã€å¥½å‹å…³æ³¨"><a href="#9ã€å¥½å‹å…³æ³¨" class="headerlink" title="9ã€å¥½å‹å…³æ³¨"></a>9ã€å¥½å‹å…³æ³¨</h2><h3 id="9-1-å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨"><a href="#9-1-å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨" class="headerlink" title="9.1 å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨"></a>9.1 å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨</h3><p>é’ˆå¯¹ç”¨æˆ·çš„æ“ä½œï¼šå¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œå…³æ³¨å’Œå–æ¶ˆå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121149120.png" alt=""><br>å®ç°æ€è·¯ï¼š</p><p>éœ€æ±‚ï¼šåŸºäºè¯¥è¡¨æ•°æ®ç»“æ„ï¼Œå®ç°ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>å…³æ³¨å’Œå–å…³æ¥å£</li><li>åˆ¤æ–­æ˜¯å¦å…³æ³¨çš„æ¥å£</li></ul><p>å…³æ³¨æ˜¯Userä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯åšä¸»ä¸ç²‰ä¸çš„å…³ç³»ï¼Œæ•°æ®åº“ä¸­æœ‰ä¸€å¼ tb_followè¡¨æ¥æ ‡ç¤ºï¼š</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121151354.png" alt=""></p><p>æ³¨æ„: è¿™é‡Œéœ€è¦æŠŠä¸»é”®ä¿®æ”¹ä¸ºè‡ªå¢é•¿ï¼Œç®€åŒ–å¼€å‘ã€‚</p><p>FollowController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³æ³¨</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId, <span class="meta">@PathVariable(&quot;isFollow&quot;)</span> Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> followService.follow(followUserId, isFollow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–æ¶ˆå…³æ³¨</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/or/not/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> followService.isFollow(followUserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>FollowService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">å–æ¶ˆå…³æ³¨service</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(Long followUserId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">// 2.æŸ¥è¯¢æ˜¯å¦å…³æ³¨ select count(*) from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId).count();</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(count &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> å…³æ³¨service</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">        <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">            <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">            <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">            follow.setUserId(userId);</span><br><span class="line">            follow.setFollowUserId(followUserId);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">            remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                    .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨"><a href="#9-2-å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨" class="headerlink" title="9.2 å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨"></a>9.2 å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨</h3><p>æƒ³è¦å»çœ‹å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œéœ€è¦é¦–å…ˆè¿›å…¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚</p><p>1ã€å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…</p><p>2ã€å»æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°</p><p>ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½å’Œå…±åŒå…³æ³¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°†ç¬”è®°ä¸­çš„ä»£ç æ‹·è´åˆ°ideaä¸­å°±å¯ä»¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½äº†ï¼Œæˆ‘ä»¬çš„é‡ç‚¹åœ¨äºå…±åŒå…³æ³¨åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span>&#123;</span><br><span class="line"><span class="comment">// æŸ¥è¯¢è¯¦æƒ…</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"><span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line"><span class="comment">// è¿”å›</span></span><br><span class="line"><span class="keyword">return</span> Result.ok(userDTO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlogController  æ ¹æ®idæŸ¥è¯¢åšä¸»çš„æ¢åº—ç¬”è®°</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/of/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogByUserId</span><span class="params">(</span></span><br><span class="line"><span class="params"><span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params"><span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line"><span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">Page&lt;Blog&gt; page = blogService.query()</span><br><span class="line">.eq(<span class="string">&quot;user_id&quot;</span>, id).page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line"><span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line"><span class="keyword">return</span> Result.ok(records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å…±åŒå…³æ³¨å¦‚ä½•å®ç°ï¼š</p><p>éœ€æ±‚ï¼šåˆ©ç”¨Redisä¸­æ°å½“çš„æ•°æ®ç»“æ„ï¼Œå®ç°å…±åŒå…³æ³¨åŠŸèƒ½ã€‚åœ¨åšä¸»ä¸ªäººé¡µé¢å±•ç¤ºå‡ºå½“å‰ç”¨æˆ·ä¸åšä¸»çš„å…±åŒå…³æ³¨å‘¢ã€‚</p><p>å½“ç„¶æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„seté›†åˆå’¯ï¼Œåœ¨seté›†åˆä¸­ï¼Œæœ‰äº¤é›†å¹¶é›†è¡¥é›†çš„apiï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸¤äººçš„å…³æ³¨çš„äººåˆ†åˆ«æ”¾å…¥åˆ°ä¸€ä¸ªseté›†åˆä¸­ï¼Œç„¶åå†é€šè¿‡apiå»æŸ¥çœ‹è¿™ä¸¤ä¸ªseté›†åˆä¸­çš„äº¤é›†æ•°æ®ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥æ”¹é€ å½“å‰çš„å…³æ³¨åˆ—è¡¨</p><p>æ”¹é€ åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·å…³æ³¨äº†æŸä½ç”¨æˆ·åï¼Œéœ€è¦å°†æ•°æ®æ”¾å…¥åˆ°seté›†åˆä¸­ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œå…±åŒå…³æ³¨ï¼ŒåŒæ—¶å½“å–æ¶ˆå…³æ³¨æ—¶ï¼Œä¹Ÿéœ€è¦ä»seté›†åˆä¸­è¿›è¡Œåˆ é™¤</p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">    <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">        <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">        follow.setUserId(userId);</span><br><span class="line">        follow.setFollowUserId(followUserId);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idï¼Œæ”¾å…¥redisçš„seté›†åˆ sadd userId followerUserId</span></span><br><span class="line">            stringRedisTemplate.opsForSet().add(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisé›†åˆä¸­ç§»é™¤</span></span><br><span class="line">            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…·ä½“çš„å…³æ³¨ä»£ç ï¼š</strong></p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">followCommons</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 2.æ±‚äº¤é›†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + id;</span><br><span class="line">    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);</span><br><span class="line">    <span class="keyword">if</span> (intersect == <span class="literal">null</span> || intersect.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ— äº¤é›†</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è§£æidé›†åˆ</span></span><br><span class="line">    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-3-å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ"><a href="#9-3-å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ" class="headerlink" title="9.3 å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ"></a>9.3 å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ</h3><p>å½“æˆ‘ä»¬å…³æ³¨äº†ç”¨æˆ·åï¼Œè¿™ä¸ªç”¨æˆ·å‘äº†åŠ¨æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æŠŠè¿™äº›æ•°æ®æ¨é€ç»™ç”¨æˆ·ï¼Œè¿™ä¸ªéœ€æ±‚ï¼Œå…¶å®æˆ‘ä»¬åˆæŠŠä»–å«åšFeedæµï¼Œå…³æ³¨æ¨é€ä¹Ÿå«åšFeedæµï¼Œç›´è¯‘ä¸ºæŠ•å–‚ã€‚ä¸ºç”¨æˆ·æŒç»­çš„æä¾›â€œæ²‰æµ¸å¼â€çš„ä½“éªŒï¼Œé€šè¿‡æ— é™ä¸‹æ‹‰åˆ·æ–°è·å–æ–°çš„ä¿¡æ¯ã€‚</p><p>å¯¹äºä¼ ç»Ÿçš„æ¨¡å¼çš„å†…å®¹è§£é”ï¼šæˆ‘ä»¬æ˜¯éœ€è¦ç”¨æˆ·å»é€šè¿‡æœç´¢å¼•æ“æˆ–è€…æ˜¯å…¶ä»–çš„æ–¹å¼å»è§£é”æƒ³è¦çœ‹çš„å†…å®¹</p><p>å¯¹äºæ–°å‹çš„Feedæµçš„çš„æ•ˆæœï¼šä¸éœ€è¦æˆ‘ä»¬ç”¨æˆ·å†å»æ¨é€ä¿¡æ¯ï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ†æç”¨æˆ·åˆ°åº•æƒ³è¦ä»€ä¹ˆï¼Œç„¶åç›´æ¥æŠŠå†…å®¹æ¨é€ç»™ç”¨æˆ·ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ çš„èŠ‚çº¦æ—¶é—´ï¼Œä¸ç”¨ä¸»åŠ¨å»å¯»æ‰¾ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121858850.png" alt=""></p><p>Feedæµçš„å®ç°æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><p>Feedæµäº§å“æœ‰ä¸¤ç§å¸¸è§æ¨¡å¼ï¼š<br>Timelineï¼šä¸åšå†…å®¹ç­›é€‰ï¼Œç®€å•çš„æŒ‰ç…§å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨ã€‚ä¾‹å¦‚æœ‹å‹åœˆ</p><ul><li>ä¼˜ç‚¹ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šæœ‰ç¼ºå¤±ã€‚å¹¶ä¸”å®ç°ä¹Ÿç›¸å¯¹ç®€å•</li><li>ç¼ºç‚¹ï¼šä¿¡æ¯å™ªéŸ³è¾ƒå¤šï¼Œç”¨æˆ·ä¸ä¸€å®šæ„Ÿå…´è¶£ï¼Œå†…å®¹è·å–æ•ˆç‡ä½</li></ul><p>æ™ºèƒ½æ’åºï¼šåˆ©ç”¨æ™ºèƒ½ç®—æ³•å±è”½æ‰è¿è§„çš„ã€ç”¨æˆ·ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚æ¨é€ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯æ¥å¸å¼•ç”¨æˆ·</p><ul><li>ä¼˜ç‚¹ï¼šæŠ•å–‚ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯ï¼Œç”¨æˆ·ç²˜åº¦å¾ˆé«˜ï¼Œå®¹æ˜“æ²‰è¿·</li><li>ç¼ºç‚¹ï¼šå¦‚æœç®—æ³•ä¸ç²¾å‡†ï¼Œå¯èƒ½èµ·åˆ°åä½œç”¨<br>æœ¬ä¾‹ä¸­çš„ä¸ªäººé¡µé¢ï¼Œæ˜¯åŸºäºå…³æ³¨çš„å¥½å‹æ¥åšFeedæµï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</li></ul><p>æˆ‘ä»¬æœ¬æ¬¡é’ˆå¯¹å¥½å‹çš„æ“ä½œï¼Œé‡‡ç”¨çš„å°±æ˜¯Timelineçš„æ–¹å¼ï¼Œåªéœ€è¦æ‹¿åˆ°æˆ‘ä»¬å…³æ³¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§æ—¶é—´æ’åºå³å¯</p><p>ï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li>æ‹‰æ¨¡å¼</li><li>æ¨æ¨¡å¼</li><li>æ¨æ‹‰ç»“åˆ</li></ul><p><strong>æ‹‰æ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»æ‰©æ•£</p><p>è¯¥æ¨¡å¼çš„æ ¸å¿ƒå«ä¹‰å°±æ˜¯ï¼šå½“å¼ ä¸‰å’Œæå››å’Œç‹äº”å‘äº†æ¶ˆæ¯åï¼Œéƒ½ä¼šä¿å­˜åœ¨è‡ªå·±çš„é‚®ç®±ä¸­ï¼Œå‡è®¾èµµå…­è¦è¯»å–ä¿¡æ¯ï¼Œé‚£ä¹ˆä»–ä¼šä»è¯»å–ä»–è‡ªå·±çš„æ”¶ä»¶ç®±ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šä»ä»–å…³æ³¨çš„äººç¾¤ä¸­ï¼ŒæŠŠä»–å…³æ³¨äººçš„ä¿¡æ¯å…¨éƒ¨éƒ½è¿›è¡Œæ‹‰å–ï¼Œç„¶ååœ¨è¿›è¡Œæ’åº</p><p>ä¼˜ç‚¹ï¼šæ¯”è¾ƒèŠ‚çº¦ç©ºé—´ï¼Œå› ä¸ºèµµå…­åœ¨è¯»ä¿¡æ¯æ—¶ï¼Œå¹¶æ²¡æœ‰é‡å¤è¯»å–ï¼Œè€Œä¸”è¯»å–å®Œä¹‹åå¯ä»¥æŠŠä»–çš„æ”¶ä»¶ç®±è¿›è¡Œæ¸…æ¥šã€‚</p><p>ç¼ºç‚¹ï¼šæ¯”è¾ƒå»¶è¿Ÿï¼Œå½“ç”¨æˆ·è¯»å–æ•°æ®æ—¶æ‰å»å…³æ³¨çš„äººé‡Œè¾¹å»è¯»å–æ•°æ®ï¼Œå‡è®¾ç”¨æˆ·å…³æ³¨äº†å¤§é‡çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šæ‹‰å–æµ·é‡çš„å†…å®¹ï¼Œå¯¹æœåŠ¡å™¨å‹åŠ›å·¨å¤§ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151829348.jpg" alt=""></p><p><strong>æ¨æ¨¡å¼</strong>ï¼šä¹Ÿå«åšå†™æ‰©æ•£ã€‚</p><p>æ¨æ¨¡å¼æ˜¯æ²¡æœ‰å†™é‚®ç®±çš„ï¼Œå½“å¼ ä¸‰å†™äº†ä¸€ä¸ªå†…å®¹ï¼Œæ­¤æ—¶ä¼šä¸»åŠ¨çš„æŠŠå¼ ä¸‰å†™çš„å†…å®¹å‘é€åˆ°ä»–çš„ç²‰ä¸æ”¶ä»¶ç®±ä¸­å»ï¼Œå‡è®¾æ­¤æ—¶æå››å†æ¥è¯»å–ï¼Œå°±ä¸ç”¨å†å»ä¸´æ—¶æ‹‰å–äº†</p><p>ä¼˜ç‚¹ï¼šæ—¶æ•ˆå¿«ï¼Œä¸ç”¨ä¸´æ—¶æ‹‰å–</p><p>ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¤§ï¼Œå‡è®¾ä¸€ä¸ªå¤§Vå†™ä¿¡æ¯ï¼Œå¾ˆå¤šäººå…³æ³¨ä»–ï¼Œ å°±ä¼šå†™å¾ˆå¤šåˆ†æ•°æ®åˆ°ç²‰ä¸é‚£è¾¹å»</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151830240.jpg" alt=""></p><p><strong>æ¨æ‹‰ç»“åˆæ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»å†™æ··åˆï¼Œå…¼å…·æ¨å’Œæ‹‰ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ã€‚</p><p>æ¨æ‹‰æ¨¡å¼æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œç«™åœ¨å‘ä»¶äººè¿™ä¸€æ®µï¼Œå¦‚æœæ˜¯ä¸ªæ™®é€šçš„äººï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨å†™æ‰©æ•£çš„æ–¹å¼ï¼Œç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ°ä»–çš„ç²‰ä¸ä¸­å»ï¼Œå› ä¸ºæ™®é€šçš„äººä»–çš„ç²‰ä¸å…³æ³¨é‡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™æ ·åšæ²¡æœ‰å‹åŠ›ï¼Œå¦‚æœæ˜¯å¤§Vï¼Œé‚£ä¹ˆä»–æ˜¯ç›´æ¥å°†æ•°æ®å…ˆå†™å…¥åˆ°ä¸€ä»½åˆ°å‘ä»¶ç®±é‡Œè¾¹å»ï¼Œç„¶åå†ç›´æ¥å†™ä¸€ä»½åˆ°æ´»è·ƒç²‰ä¸æ”¶ä»¶ç®±é‡Œè¾¹å»ï¼Œç°åœ¨ç«™åœ¨æ”¶ä»¶äººè¿™ç«¯æ¥çœ‹ï¼Œå¦‚æœæ˜¯æ´»è·ƒç²‰ä¸ï¼Œé‚£ä¹ˆå¤§Vå’Œæ™®é€šçš„äººå‘çš„éƒ½ä¼šç›´æ¥å†™å…¥åˆ°è‡ªå·±æ”¶ä»¶ç®±é‡Œè¾¹æ¥ï¼Œè€Œå¦‚æœæ˜¯æ™®é€šçš„ç²‰ä¸ï¼Œç”±äºä»–ä»¬ä¸Šçº¿ä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥ç­‰ä»–ä»¬ä¸Šçº¿æ—¶ï¼Œå†ä»å‘ä»¶ç®±é‡Œè¾¹å»æ‹‰ä¿¡æ¯ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121904640.png" alt=""></p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121904647.png" alt=""></p><h3 id="9-4-å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±"><a href="#9-4-å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±" class="headerlink" title="9.4 å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±"></a>9.4 å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±</h3><p>éœ€æ±‚ï¼š</p><ul><li>ä¿®æ”¹æ–°å¢æ¢åº—ç¬”è®°çš„ä¸šåŠ¡ï¼Œåœ¨ä¿å­˜blogåˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œæ¨é€åˆ°ç²‰ä¸çš„æ”¶ä»¶ç®±</li><li>æ”¶ä»¶ç®±æ»¡è¶³å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œå¿…é¡»ç”¨Redisçš„æ•°æ®ç»“æ„å®ç°</li><li>æŸ¥è¯¢æ”¶ä»¶ç®±æ•°æ®æ—¶ï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢</li></ul><p>Feedæµä¸­çš„æ•°æ®ä¼šä¸æ–­æ›´æ–°ï¼Œæ‰€ä»¥æ•°æ®çš„è§’æ ‡ä¹Ÿåœ¨å˜åŒ–ï¼Œå› æ­¤ä¸èƒ½é‡‡ç”¨ä¼ ç»Ÿçš„åˆ†é¡µæ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿäº†åˆ†é¡µåœ¨feedæµæ˜¯ä¸é€‚ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–</p><p>å‡è®¾åœ¨t1 æ—¶åˆ»ï¼Œæˆ‘ä»¬å»è¯»å–ç¬¬ä¸€é¡µï¼Œæ­¤æ—¶page = 1 ï¼Œsize = 5 ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‹¿åˆ°çš„å°±æ˜¯10~6 è¿™å‡ æ¡è®°å½•ï¼Œå‡è®¾ç°åœ¨t2æ—¶å€™åˆå‘å¸ƒäº†ä¸€æ¡è®°å½•ï¼Œæ­¤æ—¶t3 æ—¶åˆ»ï¼Œæˆ‘ä»¬æ¥è¯»å–ç¬¬äºŒé¡µï¼Œè¯»å–ç¬¬äºŒé¡µä¼ å…¥çš„å‚æ•°æ˜¯page=2 ï¼Œsize=5 ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯»å–åˆ°çš„ç¬¬äºŒé¡µå®é™…ä¸Šæ˜¯ä»6 å¼€å§‹ï¼Œç„¶åæ˜¯6~2 ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯»å–åˆ°äº†é‡å¤çš„æ•°æ®ï¼Œæ‰€ä»¥feedæµçš„åˆ†é¡µï¼Œä¸èƒ½é‡‡ç”¨åŸå§‹æ–¹æ¡ˆæ¥åšã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121945477.png" alt=""></p><p>Feedæµçš„æ»šåŠ¨åˆ†é¡µ</p><p>æˆ‘ä»¬éœ€è¦è®°å½•æ¯æ¬¡æ“ä½œçš„æœ€åä¸€æ¡ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¼€å§‹å»è¯»å–æ•°æ®</p><p>ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬ä»t1æ—¶åˆ»å¼€å§‹ï¼Œæ‹¿ç¬¬ä¸€é¡µæ•°æ®ï¼Œæ‹¿åˆ°äº†10~6ï¼Œç„¶åè®°å½•ä¸‹å½“å‰æœ€åä¸€æ¬¡æ‹¿å–çš„è®°å½•ï¼Œå°±æ˜¯6ï¼Œt2æ—¶åˆ»å‘å¸ƒäº†æ–°çš„è®°å½•ï¼Œæ­¤æ—¶è¿™ä¸ª11æ”¾åˆ°æœ€é¡¶ä¸Šï¼Œä½†æ˜¯ä¸ä¼šå½±å“æˆ‘ä»¬ä¹‹å‰è®°å½•çš„6ï¼Œæ­¤æ—¶t3æ—¶åˆ»æ¥æ‹¿ç¬¬äºŒé¡µï¼Œç¬¬äºŒé¡µè¿™ä¸ªæ—¶å€™æ‹¿æ•°æ®ï¼Œè¿˜æ˜¯ä»6åä¸€ç‚¹çš„5å»æ‹¿ï¼Œå°±æ‹¿åˆ°äº†5-1çš„è®°å½•ã€‚æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹å¯ä»¥é‡‡ç”¨sortedSetæ¥åšï¼Œå¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è®°å½•å½“å‰è·å–æ•°æ®æ—¶é—´æˆ³æœ€å°å€¼ï¼Œå°±å¯ä»¥å®ç°æ»šåŠ¨åˆ†é¡µäº†</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301121947177.png" alt=""></p><p>æ ¸å¿ƒçš„æ„æ€ï¼šå°±æ˜¯æˆ‘ä»¬åœ¨ä¿å­˜å®Œæ¢åº—ç¬”è®°åï¼Œè·å¾—åˆ°å½“å‰ç¬”è®°çš„ç²‰ä¸ï¼Œç„¶åæŠŠæ•°æ®æ¨é€åˆ°ç²‰ä¸çš„redisä¸­å»ã€‚</p><p>å¦‚æœæ•°æ®ä¼šæœ‰ä¸æ–­å˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨sortedsetæ•°æ®ç»“æ„ä¸­çš„rangeæŸ¥è¯¢æ–¹å¼ï¼Œè€Œä¸æ˜¯scoreæ’åæ–¹å¼æ›´å¥½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    blog.setUserId(user.getId());</span><br><span class="line">    <span class="comment">// 2.ä¿å­˜æ¢åº—ç¬”è®°</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(blog);</span><br><span class="line">    <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ–°å¢ç¬”è®°å¤±è´¥!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æŸ¥è¯¢ç¬”è®°ä½œè€…çš„æ‰€æœ‰ç²‰ä¸ select * from tb_follow where follow_user_id = ?</span></span><br><span class="line">    List&lt;Follow&gt; follows = followService.query().eq(<span class="string">&quot;follow_user_id&quot;</span>, user.getId()).list();</span><br><span class="line">    <span class="comment">// 4.æ¨é€ç¬”è®°idç»™æ‰€æœ‰ç²‰ä¸</span></span><br><span class="line">    <span class="keyword">for</span> (Follow follow : follows) &#123;</span><br><span class="line">        <span class="comment">// 4.1.è·å–ç²‰ä¸id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> follow.getUserId();</span><br><span class="line">        <span class="comment">// 4.2.æ¨é€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">        stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.è¿”å›id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±"><a href="#9-5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±" class="headerlink" title="9.5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±"></a>9.5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±</h3><p>éœ€æ±‚ï¼šåœ¨ä¸ªäººä¸»é¡µçš„â€œå…³æ³¨â€å¡ç‰‡ä¸­ï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºæ¨é€çš„Blogä¿¡æ¯ï¼š</p><p>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>1ã€æ¯æ¬¡æŸ¥è¯¢å®Œæˆåï¼Œæˆ‘ä»¬è¦åˆ†æå‡ºæŸ¥è¯¢å‡ºæ•°æ®çš„æœ€å°æ—¶é—´æˆ³ï¼Œè¿™ä¸ªå€¼ä¼šä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶</p><p>2ã€æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸ä¸Šä¸€æ¬¡æŸ¥è¯¢ç›¸åŒçš„æŸ¥è¯¢ä¸ªæ•°ä½œä¸ºåç§»é‡ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼Œè·³è¿‡è¿™äº›æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œæ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®</p><p>ç»¼ä¸Šï¼šæˆ‘ä»¬çš„è¯·æ±‚å‚æ•°ä¸­å°±éœ€è¦æºå¸¦ lastIdï¼šä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ å’Œåç§»é‡è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><p>è¿™ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€æ¬¡ä¼šç”±å‰ç«¯æ¥æŒ‡å®šï¼Œä»¥åçš„æŸ¥è¯¢å°±æ ¹æ®åå°ç»“æœä½œä¸ºæ¡ä»¶ï¼Œå†æ¬¡ä¼ é€’åˆ°åå°ã€‚</p><p>ç±»ä¼¼æ“ä½œxshellï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301131032544.png" alt=""><br>è¿˜æœ‰éœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ï¼šoffsetçš„å€¼å¦‚ä½•è®¾å®šï¼Œå½“å‡ºç°å’ŒlastIdçš„å€¼ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œè¦è®¾å®šè¯¥å€¼ä¸ºå’ŒlastId scoreå€¼ä¸€æ ·çš„å…ƒç´ æ•°é‡<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301131038220.png" alt=""></p><p>å…·ä½“å®ç°æ€è·¯ï¼š<br><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301131042382.png" alt=""></p><p>ä¸€ã€å®šä¹‰å‡ºæ¥å…·ä½“çš„è¿”å›å€¼å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScrollResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Long minTime;</span><br><span class="line">    <span class="keyword">private</span> Integer offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogController</p><p>æ³¨æ„ï¼šRequestParam è¡¨ç¤ºæ¥å—urlåœ°å€æ ä¼ å‚çš„æ³¨è§£ï¼Œå½“æ–¹æ³•ä¸Šå‚æ•°çš„åç§°å’Œurlåœ°å€æ ä¸ç›¸åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡RequestParam æ¥è¿›è¡ŒæŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/follow&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;lastId&quot;)</span> Long max, <span class="meta">@RequestParam(value = &quot;offset&quot;, defaultValue = &quot;0&quot;)</span> Integer offset)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogOfFollow(max, offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BlogServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryFollowBlog</span><span class="params">(Long max, Integer offset)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">    <span class="comment">// 2. æŸ¥è¯¢æ”¶ä»¶ç®±</span></span><br><span class="line">    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTuples = stringRedisTemplate</span><br><span class="line">            .opsForZSet().reverseRangeByScoreWithScores(key, <span class="number">0</span>, max, offset, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span>(typedTuples == <span class="literal">null</span> || typedTuples.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. è§£ææ•°æ®å‡º blogId,minTime,offset</span></span><br><span class="line">    List&lt;Long&gt; blogIds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(typedTuples.size());</span><br><span class="line">    <span class="type">long</span> <span class="variable">minTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; typedTuple : typedTuples) &#123;</span><br><span class="line">        <span class="comment">// 3.1 æˆåŠŸè·å–åˆ°æ‰€æœ‰blogId</span></span><br><span class="line">        blogIds.add(Long.valueOf(typedTuple.getValue()));</span><br><span class="line">        <span class="comment">// 3.2 è·å–minTime</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> typedTuple.getScore().longValue();</span><br><span class="line">        <span class="keyword">if</span>(time == minTime)&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            minTime = time;</span><br><span class="line">            count = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. æ ¹æ®blogIdè¿”å›æŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">blogIdStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, blogIds);</span><br><span class="line">    List&lt;Blog&gt; blogs = query().in(<span class="string">&quot;id&quot;</span>,blogIds).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + blogIdStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line">    <span class="keyword">for</span> (Blog blog : blogs) &#123;</span><br><span class="line">        <span class="comment">// 4.1 æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶è¿”å›</span></span><br><span class="line">        queryUserById(blog);</span><br><span class="line">        <span class="comment">// 4.2 æŸ¥è¯¢blogæ˜¯å¦è¢«ç‚¹èµ</span></span><br><span class="line">        isBlogLiked(blog);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5. å°è£…æˆScrollResultå¯¹è±¡å¹¶è¿”å›</span></span><br><span class="line">    <span class="type">ScrollResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScrollResult</span>();</span><br><span class="line">    result.setList(blogs);</span><br><span class="line">    result.setOffset(count);</span><br><span class="line">    result.setMinTime(minTime);</span><br><span class="line">    <span class="keyword">return</span> Result.ok(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10ã€é™„è¿‘å•†æˆ·"><a href="#10ã€é™„è¿‘å•†æˆ·" class="headerlink" title="10ã€é™„è¿‘å•†æˆ·"></a>10ã€é™„è¿‘å•†æˆ·</h2><h3 id="10-1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•"><a href="#10-1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="10.1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•"></a>10.1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•</h3><p>GEOå°±æ˜¯Geolocationçš„ç®€å†™å½¢å¼ï¼Œä»£è¡¨åœ°ç†åæ ‡ã€‚Redisåœ¨3.2ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹GEOçš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨åœ°ç†åæ ‡ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®ç»çº¬åº¦æ¥æ£€ç´¢æ•°æ®ã€‚å¸¸è§çš„å‘½ä»¤æœ‰ï¼š</p><ul><li>GEOADDï¼šæ·»åŠ ä¸€ä¸ªåœ°ç†ç©ºé—´ä¿¡æ¯ï¼ŒåŒ…å«ï¼šç»åº¦ï¼ˆlongitudeï¼‰ã€çº¬åº¦ï¼ˆlatitudeï¼‰ã€å€¼ï¼ˆmemberï¼‰</li><li>GEODISTï¼šè®¡ç®—æŒ‡å®šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›</li><li>GEOHASHï¼šå°†æŒ‡å®šmemberçš„åæ ‡è½¬ä¸ºhashå­—ç¬¦ä¸²å½¢å¼å¹¶è¿”å›</li><li>GEOPOSï¼šè¿”å›æŒ‡å®šmemberçš„åæ ‡</li><li>GEORADIUSï¼šæŒ‡å®šåœ†å¿ƒã€åŠå¾„ï¼Œæ‰¾åˆ°è¯¥åœ†å†…åŒ…å«çš„æ‰€æœ‰memberï¼Œå¹¶æŒ‰ç…§ä¸åœ†å¿ƒä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚6.ä»¥åå·²åºŸå¼ƒ</li><li>GEOSEARCHï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æœç´¢memberï¼Œå¹¶æŒ‰ç…§ä¸æŒ‡å®šç‚¹ä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚èŒƒå›´å¯ä»¥æ˜¯åœ†å½¢æˆ–çŸ©å½¢ã€‚6.2.æ–°åŠŸèƒ½</li><li>GEOSEARCHSTOREï¼šä¸GEOSEARCHåŠŸèƒ½ä¸€è‡´ï¼Œä¸è¿‡å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„keyã€‚ 6.2.æ–°åŠŸèƒ½</li></ul><h3 id="10-2ã€-é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO"><a href="#10-2ã€-é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO" class="headerlink" title="10.2ã€ é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO"></a>10.2ã€ é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO</h3><p>å…·ä½“åœºæ™¯è¯´æ˜ï¼š</p><p>å½“æˆ‘ä»¬ç‚¹å‡»ç¾é£Ÿä¹‹åï¼Œä¼šå‡ºç°ä¸€ç³»åˆ—çš„å•†å®¶ï¼Œå•†å®¶ä¸­å¯ä»¥æŒ‰ç…§å¤šç§æ’åºæ–¹å¼ï¼Œæˆ‘ä»¬æ­¤æ—¶å…³æ³¨çš„æ˜¯è·ç¦»ï¼Œè¿™ä¸ªåœ°æ–¹å°±éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬çš„GEOï¼Œå‘åå°ä¼ å…¥å½“å‰appæ”¶é›†çš„åœ°å€(æˆ‘ä»¬æ­¤å¤„æ˜¯å†™æ­»çš„) ï¼Œä»¥å½“å‰åæ ‡ä½œä¸ºåœ†å¿ƒï¼ŒåŒæ—¶ç»‘å®šç›¸åŒçš„åº—å®¶ç±»å‹typeï¼Œä»¥åŠåˆ†é¡µä¿¡æ¯ï¼ŒæŠŠè¿™å‡ ä¸ªæ¡ä»¶ä¼ å…¥åå°ï¼Œåå°æŸ¥è¯¢å‡ºå¯¹åº”çš„æ•°æ®å†è¿”å›ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301131247132.png" alt=""></p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šå°†æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å¯¼å…¥åˆ°redisä¸­å»ï¼Œredisä¸­çš„GEOï¼ŒGEOåœ¨redisä¸­å°±ä¸€ä¸ªmenberå’Œä¸€ä¸ªç»çº¬åº¦ï¼Œæˆ‘ä»¬æŠŠxå’Œyè½´ä¼ å…¥åˆ°redisåšçš„ç»çº¬åº¦ä½ç½®å»ï¼Œä½†æˆ‘ä»¬ä¸èƒ½æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾å…¥åˆ°menberä¸­å»ï¼Œæ¯•ç«Ÿä½œä¸ºredisæ˜¯ä¸€ä¸ªå†…å­˜çº§æ•°æ®åº“ï¼Œå¦‚æœå­˜æµ·é‡æ•°æ®ï¼Œredisè¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹å­˜å‚¨ä»–çš„idå³å¯ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨redisä¸­å¹¶æ²¡æœ‰å­˜å‚¨typeï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ ¹æ®typeæ¥å¯¹æ•°æ®è¿›è¡Œç­›é€‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å•†æˆ·ç±»å‹åšåˆ†ç»„ï¼Œç±»å‹ç›¸åŒçš„å•†æˆ·ä½œä¸ºåŒä¸€ç»„ï¼Œä»¥typeIdä¸ºkeyå­˜å…¥åŒä¸€ä¸ªGEOé›†åˆä¸­å³å¯</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301131251617.png" alt=""></p><p>ä»£ç </p><p>HmDianPingApplicationTests</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">loadShopData</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1. æŸ¥è¯¢åº—é“ºä¿¡æ¯</span></span><br><span class="line">        List&lt;Shop&gt; shopList = shopService.list();</span><br><span class="line">        <span class="comment">// 2. ç»™æŸ¥è¯¢åˆ°çš„åº—é“ºæŒ‰ç…§typeIdè¿›è¡Œåˆ†ç»„</span></span><br><span class="line">        Map&lt;Long, List&lt;Shop&gt;&gt; listMap = shopList.stream().collect(Collectors.groupingBy(Shop::getTypeId));</span><br><span class="line">        <span class="comment">// 3. å¤„ç†åº—é“ºæ•°æ®å­˜å…¥redis</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Long, List&lt;Shop&gt;&gt; entry : listMap.entrySet()) &#123;</span><br><span class="line">            <span class="comment">// 3.1 å®šä¹‰å­˜å…¥redisä¸­çš„key</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">typeId</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">            <span class="comment">// 3.2 è·å–åŒç±»å‹åº—é“ºé›†åˆ</span></span><br><span class="line">            List&lt;Shop&gt; value = entry.getValue();</span><br><span class="line">            List&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; locations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(value.size());</span><br><span class="line">            <span class="comment">// 3.3 å†™å…¥redis GADD key ç»çº¬åº¦ member</span></span><br><span class="line">            <span class="keyword">for</span> (Shop shop : value) &#123;</span><br><span class="line">                <span class="comment">// æ–¹å¼ä¸€ï¼ˆç¼ºç‚¹ï¼šæ•ˆç‡ä½ï¼Œéœ€è¦ä¾æ¬¡å‘é€è¯·æ±‚å­˜å…¥redisï¼‰</span></span><br><span class="line"><span class="comment">//                stringRedisTemplate.opsForGeo().add(key,new Point(shop.getX(),shop.getY()),shop.getId().toString());</span></span><br><span class="line">                <span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line">                locations.add(<span class="keyword">new</span> <span class="title class_">RedisGeoCommands</span>.GeoLocation&lt;&gt;</span><br><span class="line">                        (shop.getId().toString(),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Point</span>(shop.getX(),shop.getY())));</span><br><span class="line">            &#125;</span><br><span class="line">            stringRedisTemplate.opsForGeo().add(key,locations);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="10-3-é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½"><a href="#10-3-é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½" class="headerlink" title="10.3 é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½"></a>10.3 é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½</h3><p>SpringDataRedisçš„2.3.9ç‰ˆæœ¬å¹¶ä¸æ”¯æŒRedis 6.2æä¾›çš„GEOSEARCHå‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æç¤ºå…¶ç‰ˆæœ¬ï¼Œä¿®æ”¹è‡ªå·±çš„POM</p><p>ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.6</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.lettuce&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">6.1</span><span class="number">.6</span>.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼š</p><p>ShopController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/type&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopByType</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;typeId&quot;)</span> Integer typeId,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;x&quot;, required = false)</span> Double x,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(value = &quot;y&quot;, required = false)</span> Double y</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> shopService.queryShopByType(typeId, current, x, y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ShopServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopByType</span><span class="params">(Integer typeId, Integer current, Double x, Double y)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡è¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">if</span>(x == <span class="literal">null</span> || y==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®ç±»å‹åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">        Page&lt;Shop&gt; page = query()</span><br><span class="line">                .eq(<span class="string">&quot;type_id&quot;</span>, typeId)</span><br><span class="line">                .page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.DEFAULT_PAGE_SIZE));</span><br><span class="line">        <span class="comment">// è¿”å›æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(page.getRecords());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. è®¡ç®—åˆ†é¡µå‚æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> (current - <span class="number">1</span>) * SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line">    <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> current * SystemConstants.DEFAULT_PAGE_SIZE;</span><br><span class="line">    <span class="comment">// 3. æŸ¥è¯¢redisæ ¹æ®è·ç¦»æ’åºå¹¶åˆ†é¡µ GEOSEARCH key BYLONLAT x y BYRADIUS 10 WITHDISTANCE</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SHOP_GEO_KEY + typeId;</span><br><span class="line">    GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = stringRedisTemplate.opsForGeo().search(</span><br><span class="line">            key,</span><br><span class="line">            GeoReference.fromCoordinate(x, y),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Distance</span>(<span class="number">5000</span>),</span><br><span class="line">            RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span>(results == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. è§£æå‡ºshopId</span></span><br><span class="line">    List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt;&gt; shopList = results.getContent();</span><br><span class="line">    List&lt;Long&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(shopList.size());</span><br><span class="line">    HashMap&lt;String, Distance&gt; distanceMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(shopList.size());</span><br><span class="line">    <span class="keyword">if</span>(shopList.size() &lt;= start)&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯è¡¨ç¤ºæ²¡æœ‰ä¸‹ä¸€é¡µäº†</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.1 æˆªå–ä» start~end èŒƒå›´çš„åº—é“º</span></span><br><span class="line">    shopList.stream().skip(start).forEach(result-&gt;&#123;</span><br><span class="line">        <span class="comment">// 4.2 è·å–åº—é“ºid</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">shopIdStr</span> <span class="operator">=</span> result.getContent().getName();</span><br><span class="line">        ids.add(Long.valueOf(shopIdStr));</span><br><span class="line">        <span class="comment">// 4.3 è·å–åº—é“ºè·ç¦»</span></span><br><span class="line">        <span class="type">Distance</span> <span class="variable">distance</span> <span class="operator">=</span> result.getDistance();</span><br><span class="line">        distanceMap.put(shopIdStr,distance);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 5. æ ¹æ®shopIdæŸ¥è¯¢åº—é“º</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, ids);</span><br><span class="line">    <span class="comment">// ç”±äºç›´æ¥ä½¿ç”¨listæŸ¥è¯¢æ–¹å¼ä¼šå¯¼è‡´é¡ºåºå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨æ‰‹å†™sqlçš„æ–¹å¼</span></span><br><span class="line">    List&lt;Shop&gt; shops = query().in(<span class="string">&quot;id&quot;</span>, ids).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line">    <span class="keyword">for</span> (Shop shop : shops) &#123;</span><br><span class="line">        shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6. è¿”å›åº—é“ºä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shops);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11ã€ç”¨æˆ·ç­¾åˆ°"><a href="#11ã€ç”¨æˆ·ç­¾åˆ°" class="headerlink" title="11ã€ç”¨æˆ·ç­¾åˆ°"></a>11ã€ç”¨æˆ·ç­¾åˆ°</h2><h4 id="11-1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º"><a href="#11-1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º" class="headerlink" title="11.1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º"></a>11.1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º</h4><p>æˆ‘ä»¬é’ˆå¯¹ç­¾åˆ°åŠŸèƒ½å®Œå…¨å¯ä»¥é€šè¿‡mysqlæ¥å®Œæˆï¼Œæ¯”å¦‚è¯´ä»¥ä¸‹è¿™å¼ è¡¨</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301132108996.png" alt=""></p><p>ç”¨æˆ·ä¸€æ¬¡ç­¾åˆ°ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•ï¼Œå‡å¦‚æœ‰1000ä¸‡ç”¨æˆ·ï¼Œå¹³å‡æ¯äººæ¯å¹´ç­¾åˆ°æ¬¡æ•°ä¸º10æ¬¡ï¼Œåˆ™è¿™å¼ è¡¨ä¸€å¹´çš„æ•°æ®é‡ä¸º 1äº¿æ¡</p><p>æ¯ç­¾åˆ°ä¸€æ¬¡éœ€è¦ä½¿ç”¨ï¼ˆ8 + 8 + 1 + 1 + 3 + 1ï¼‰å…±22 å­—èŠ‚çš„å†…å­˜ï¼Œä¸€ä¸ªæœˆåˆ™æœ€å¤šéœ€è¦600å¤šå­—èŠ‚</p><p>æˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿç®€åŒ–ä¸€ç‚¹å‘¢ï¼Ÿå…¶å®å¯ä»¥è€ƒè™‘å°æ—¶å€™ä¸€ä¸ªæŒºå¸¸è§çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°æ—¶å€™ï¼Œå’±ä»¬å‡†å¤‡ä¸€å¼ å°å°çš„å¡ç‰‡ï¼Œä½ åªè¦ç­¾åˆ°å°±æ‰“ä¸Šä¸€ä¸ªå‹¾ï¼Œæˆ‘æœ€ååˆ¤æ–­ä½ æ˜¯å¦ç­¾åˆ°ï¼Œå…¶å®åªéœ€è¦åˆ°å°å¡ç‰‡ä¸Šçœ‹ä¸€çœ‹å°±çŸ¥é“äº†</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼è¿™æ ·çš„æ–¹æ¡ˆæ¥å®ç°æˆ‘ä»¬çš„ç­¾åˆ°éœ€æ±‚ã€‚</p><p>æˆ‘ä»¬æŒ‰æœˆæ¥ç»Ÿè®¡ç”¨æˆ·ç­¾åˆ°ä¿¡æ¯ï¼Œç­¾åˆ°è®°å½•ä¸º1ï¼Œæœªç­¾åˆ°åˆ™è®°å½•ä¸º0.</p><p>æŠŠæ¯ä¸€ä¸ªbitä½å¯¹åº”å½“æœˆçš„æ¯ä¸€å¤©ï¼Œå½¢æˆäº†æ˜ å°„å…³ç³»ã€‚ç”¨0å’Œ1æ ‡ç¤ºä¸šåŠ¡çŠ¶æ€ï¼Œè¿™ç§æ€è·¯å°±ç§°ä¸ºä½å›¾ï¼ˆBitMapï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±ç”¨æå°çš„ç©ºé—´ï¼Œæ¥å®ç°äº†å¤§é‡æ•°æ®çš„è¡¨ç¤º</p><p>Redisä¸­æ˜¯åˆ©ç”¨stringç±»å‹æ•°æ®ç»“æ„å®ç°BitMapï¼Œå› æ­¤æœ€å¤§ä¸Šé™æ˜¯512Mï¼Œè½¬æ¢ä¸ºbitåˆ™æ˜¯ 2^32ä¸ªbitä½ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301132107228.png" alt=""></p><p>BitMapçš„æ“ä½œå‘½ä»¤æœ‰ï¼š</p><ul><li>SETBITï¼šå‘æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰å­˜å…¥ä¸€ä¸ª0æˆ–1</li><li>GETBIT ï¼šè·å–æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„bitå€¼</li><li>BITCOUNT ï¼šç»Ÿè®¡BitMapä¸­å€¼ä¸º1çš„bitä½çš„æ•°é‡</li><li>BITFIELD ï¼šæ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è‡ªå¢ï¼‰BitMapä¸­bitæ•°ç»„ä¸­çš„æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„å€¼</li><li>BITFIELD_RO ï¼šè·å–BitMapä¸­bitæ•°ç»„ï¼Œå¹¶ä»¥åè¿›åˆ¶å½¢å¼è¿”å›</li><li>BITOP ï¼šå°†å¤šä¸ªBitMapçš„ç»“æœåšä½è¿ç®—ï¼ˆä¸ ã€æˆ–ã€å¼‚æˆ–ï¼‰</li><li>BITPOS ï¼šæŸ¥æ‰¾bitæ•°ç»„ä¸­æŒ‡å®šèŒƒå›´å†…ç¬¬ä¸€ä¸ª0æˆ–1å‡ºç°çš„ä½ç½®</li></ul><h4 id="11-2-ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½"><a href="#11-2-ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½" class="headerlink" title="11.2 ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½"></a>11.2 ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½</h4><p>éœ€æ±‚ï¼šå®ç°ç­¾åˆ°æ¥å£ï¼Œå°†å½“å‰ç”¨æˆ·å½“å¤©ç­¾åˆ°ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p><p>æ€è·¯ï¼šæˆ‘ä»¬å¯ä»¥æŠŠå¹´å’Œæœˆä½œä¸ºbitMapçš„keyï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªbitMapä¸­ï¼Œæ¯æ¬¡ç­¾åˆ°å°±åˆ°å¯¹åº”çš„ä½ä¸ŠæŠŠæ•°å­—ä»0å˜æˆ1ï¼Œåªè¦å¯¹åº”æ˜¯1ï¼Œå°±è¡¨æ˜è¯´æ˜è¿™ä¸€å¤©å·²ç»ç­¾åˆ°äº†ï¼Œåä¹‹åˆ™æ²¡æœ‰ç­¾åˆ°ã€‚</p><p>æˆ‘ä»¬é€šè¿‡æ¥å£æ–‡æ¡£å‘ç°ï¼Œæ­¤æ¥å£å¹¶æ²¡æœ‰ä¼ é€’ä»»ä½•çš„å‚æ•°ï¼Œæ²¡æœ‰å‚æ•°æ€ä¹ˆç¡®å®æ˜¯å“ªä¸€å¤©ç­¾åˆ°å‘¢ï¼Ÿè¿™ä¸ªå¾ˆå®¹æ˜“ï¼Œå¯ä»¥é€šè¿‡åå°ä»£ç ç›´æ¥è·å–å³å¯ï¼Œç„¶ååˆ°å¯¹åº”çš„åœ°å€ä¸Šå»ä¿®æ”¹bitMapã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301132120470.png" alt=""><br><strong>ä»£ç </strong></p><p>UserController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sign&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> userService.sign();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.å†™å…¥Redis SETBIT key offset 1</span></span><br><span class="line">    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="number">1</span>, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-3-ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡"><a href="#11-3-ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡" class="headerlink" title="11.3 ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡"></a>11.3 ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡</h4><p><strong>é—®é¢˜1ï¼š</strong>ä»€ä¹ˆå«åšè¿ç»­ç­¾åˆ°å¤©æ•°ï¼Ÿ<br>ä»æœ€åä¸€æ¬¡ç­¾åˆ°å¼€å§‹å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€æ¬¡æœªç­¾åˆ°ä¸ºæ­¢ï¼Œè®¡ç®—æ€»çš„ç­¾åˆ°æ¬¡æ•°ï¼Œå°±æ˜¯è¿ç»­ç­¾åˆ°å¤©æ•°ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301141352918.png" alt=""></p><p>Javaé€»è¾‘ä»£ç ï¼šè·å¾—å½“å‰è¿™ä¸ªæœˆçš„æœ€åä¸€æ¬¡ç­¾åˆ°æ•°æ®ï¼Œå®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åä¸åœçš„å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°è·å¾—ç¬¬ä¸€ä¸ªé0çš„æ•°å­—å³å¯ï¼Œæ¯å¾—åˆ°ä¸€ä¸ªé0çš„æ•°å­—è®¡æ•°å™¨+1ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œå°±å¯ä»¥è·å¾—å½“å‰æœˆçš„ç­¾åˆ°æ€»å¤©æ•°äº†</p><p><strong>é—®é¢˜2ï¼š</strong>å¦‚ä½•å¾—åˆ°æœ¬æœˆåˆ°ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰ç­¾åˆ°æ•°æ®ï¼Ÿ</p><p>  BITFIELD key GET u[dayOfMonth] 0</p><p>å‡è®¾ä»Šå¤©æ˜¯10å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»å½“å‰æœˆçš„ç¬¬ä¸€å¤©å¼€å§‹ï¼Œè·å¾—åˆ°å½“å‰è¿™ä¸€å¤©çš„ä½æ•°ï¼Œæ˜¯10å·ï¼Œé‚£ä¹ˆå°±æ˜¯10ä½ï¼Œå»æ‹¿è¿™æ®µæ—¶é—´çš„æ•°æ®ï¼Œå°±èƒ½æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®äº†ï¼Œé‚£ä¹ˆè¿™10å¤©é‡Œè¾¹ç­¾åˆ°äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿç»Ÿè®¡æœ‰å¤šå°‘ä¸ª1å³å¯ã€‚</p><p><strong>é—®é¢˜3ï¼šå¦‚ä½•ä»åå‘å‰éå†æ¯ä¸ªbitä½ï¼Ÿ</strong></p><p>æ³¨æ„ï¼šbitMapè¿”å›çš„æ•°æ®æ˜¯10è¿›åˆ¶ï¼Œå“ªå‡å¦‚è¯´è¿”å›ä¸€ä¸ªæ•°å­—8ï¼Œé‚£ä¹ˆæˆ‘å“ªå„¿çŸ¥é“åˆ°åº•å“ªäº›æ˜¯0ï¼Œå“ªäº›æ˜¯1å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦è®©å¾—åˆ°çš„10è¿›åˆ¶æ•°å­—å’Œ1åšä¸è¿ç®—å°±å¯ä»¥äº†ï¼Œå› ä¸º1åªæœ‰é‡è§1 æ‰æ˜¯1ï¼Œå…¶ä»–æ•°å­—éƒ½æ˜¯0 ï¼Œæˆ‘ä»¬æŠŠç­¾åˆ°ç»“æœå’Œ1è¿›è¡Œä¸æ“ä½œï¼Œæ¯ä¸ä¸€æ¬¡ï¼Œå°±æŠŠç­¾åˆ°ç»“æœå‘å³ç§»åŠ¨ä¸€ä½ï¼Œä¾æ¬¡å†…æ¨ï¼Œæˆ‘ä»¬å°±èƒ½å®Œæˆé€ä¸ªéå†çš„æ•ˆæœäº†ã€‚</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301141352430.png" alt=""></p><p>éœ€æ±‚ï¼šå®ç°ä¸‹é¢æ¥å£ï¼Œç»Ÿè®¡å½“å‰ç”¨æˆ·æˆªæ­¢å½“å‰æ—¶é—´åœ¨æœ¬æœˆçš„è¿ç»­ç­¾åˆ°å¤©æ•°</p><p>æœ‰ç”¨æˆ·æœ‰æ—¶é—´æˆ‘ä»¬å°±å¯ä»¥ç»„ç»‡å‡ºå¯¹åº”çš„keyï¼Œæ­¤æ—¶å°±èƒ½æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·æˆªæ­¢è¿™å¤©çš„æ‰€æœ‰ç­¾åˆ°è®°å½•ï¼Œå†æ ¹æ®è¿™å¥—ç®—æ³•ï¼Œå°±èƒ½ç»Ÿè®¡å‡ºæ¥ä»–è¿ç»­ç­¾åˆ°çš„æ¬¡æ•°äº†</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301141353251.png" alt=""></p><p>ä»£ç </p><p><strong>UserController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/sign/count&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.signCount();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">signCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.è·å–æ—¥æœŸ</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="comment">// 3.æ‹¼æ¥key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">keySuffix</span> <span class="operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="string">&quot;:yyyyMM&quot;</span>));</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_SIGN_KEY + userId + keySuffix;</span><br><span class="line">    <span class="comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> now.getDayOfMonth();</span><br><span class="line">    <span class="comment">// 5.è·å–æœ¬æœˆæˆªæ­¢ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰çš„ç­¾åˆ°è®°å½•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°å­— BITFIELD sign:5:202203 GET u14 0</span></span><br><span class="line">    List&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(</span><br><span class="line">            key,</span><br><span class="line">            BitFieldSubCommands.create()</span><br><span class="line">                    .get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">null</span> || result.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰ä»»ä½•ç­¾åˆ°ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">num</span> <span class="operator">=</span> result.get(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="literal">null</span> || num == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 6.å¾ªç¯éå†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 6.1.è®©è¿™ä¸ªæ•°å­—ä¸1åšä¸è¿ç®—ï¼Œå¾—åˆ°æ•°å­—çš„æœ€åä¸€ä¸ªbitä½  // åˆ¤æ–­è¿™ä¸ªbitä½æ˜¯å¦ä¸º0</span></span><br><span class="line">        <span class="keyword">if</span> ((num &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸º0ï¼Œè¯´æ˜æœªç­¾åˆ°ï¼Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜å·²ç­¾åˆ°ï¼Œè®¡æ•°å™¨+1</span></span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŠŠæ•°å­—å³ç§»ä¸€ä½ï¼ŒæŠ›å¼ƒæœ€åä¸€ä¸ªbitä½ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªbitä½</span></span><br><span class="line">        num &gt;&gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="11-4-é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ"><a href="#11-4-é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ" class="headerlink" title="11.4 é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ"></a>11.4 é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ</h4><p>å›é¡¾<strong>ç¼“å­˜ç©¿é€</strong>ï¼š</p><p>å‘èµ·äº†ä¸€ä¸ªæ•°æ®åº“ä¸å­˜åœ¨çš„ï¼Œredisé‡Œè¾¹ä¹Ÿä¸å­˜åœ¨çš„æ•°æ®ï¼Œé€šå¸¸ä½ å¯ä»¥æŠŠä»–çœ‹æˆä¸€ä¸ªæ”»å‡»</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>åˆ¤æ–­id&lt;0</p></li><li><p>å¦‚æœæ•°æ®åº“æ˜¯ç©ºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å¾€redisé‡Œè¾¹æŠŠè¿™ä¸ªç©ºæ•°æ®ç¼“å­˜èµ·æ¥</p></li></ul><p>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯idä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ­¤æ—¶å°±æ— æ³•ç”Ÿæ•ˆ</p><p>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæ˜¯ä¸åŒçš„idé‚£å°±å¯ä»¥é˜²æ­¢ä¸‹æ¬¡è¿‡æ¥ç›´å‡»æ•°æ®</p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®ï¼Œæ‰€å¯¹åº”çš„idå†™å…¥åˆ°ä¸€ä¸ªlisté›†åˆä¸­ï¼Œå½“ç”¨æˆ·è¿‡æ¥è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥å»åˆ¤æ–­listä¸­æ˜¯å¦åŒ…å«å½“å‰çš„è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œå¦‚æœè¯´ç”¨æˆ·è¦æŸ¥è¯¢çš„idæ•°æ®å¹¶ä¸åœ¨listé›†åˆä¸­ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœlistä¸­åŒ…å«å¯¹åº”æŸ¥è¯¢çš„idæ•°æ®ï¼Œåˆ™è¯´æ˜ä¸æ˜¯ä¸€æ¬¡ç¼“å­˜ç©¿é€æ•°æ®ï¼Œåˆ™ç›´æ¥æ”¾è¡Œã€‚</p><p>ç°åœ¨çš„é—®é¢˜æ˜¯è¿™ä¸ªä¸»é”®å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆçŸ­ï¼Œè€Œæ˜¯å¾ˆé•¿çš„ä¸€ä¸ª ä¸»é”®</p><p>å“ªæ€•ä½ å•ç‹¬å»æ</p><h2 id="12ã€UVç»Ÿè®¡"><a href="#12ã€UVç»Ÿè®¡" class="headerlink" title="12ã€UVç»Ÿè®¡"></a>12ã€UVç»Ÿè®¡</h2><h3 id="12-1-ã€UVç»Ÿè®¡-HyperLogLog"><a href="#12-1-ã€UVç»Ÿè®¡-HyperLogLog" class="headerlink" title="12.1 ã€UVç»Ÿè®¡-HyperLogLog"></a>12.1 ã€UVç»Ÿè®¡-HyperLogLog</h3><p>å–è¿™ä¸ªä¸»é”®ï¼Œä½†æ˜¯åœ¨11å¹´å·¦å³ï¼Œæ·˜å®çš„å•†å“æ€»é‡å°±å·²ç»è¶…è¿‡10äº¿ä¸ª</p><p>æ‰€ä»¥å¦‚æœé‡‡ç”¨ä»¥ä¸Šæ–¹æ¡ˆï¼Œè¿™ä¸ªlistä¹Ÿä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨bitmapæ¥å‡å°‘listçš„å­˜å‚¨ç©ºé—´</p><p>æˆ‘ä»¬å¯ä»¥æŠŠlistæ•°æ®æŠ½è±¡æˆä¸€ä¸ªéå¸¸å¤§çš„bitmapï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨listï¼Œè€Œæ˜¯å°†dbä¸­çš„idæ•°æ®åˆ©ç”¨å“ˆå¸Œæ€æƒ³ï¼Œæ¯”å¦‚ï¼š</p><p>id % bitmap.size  = ç®—å‡ºå½“å‰è¿™ä¸ªidå¯¹åº”åº”è¯¥è½åœ¨bitmapçš„å“ªä¸ªç´¢å¼•ä¸Šï¼Œç„¶åå°†è¿™ä¸ªå€¼ä»0å˜æˆ1ï¼Œç„¶åå½“ç”¨æˆ·æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ­¤æ—¶å·²ç»æ²¡æœ‰äº†listï¼Œè®©ç”¨æˆ·ç”¨ä»–æŸ¥è¯¢çš„idå»ç”¨ç›¸åŒçš„å“ˆå¸Œç®—æ³•ï¼Œ ç®—å‡ºæ¥å½“å‰è¿™ä¸ªidåº”å½“è½åœ¨bitmapçš„å“ªä¸€ä½ï¼Œç„¶ååˆ¤æ–­è¿™ä¸€ä½æ˜¯0ï¼Œè¿˜æ˜¯1ï¼Œå¦‚æœæ˜¯0åˆ™è¡¨æ˜è¿™ä¸€ä½ä¸Šçš„æ•°æ®ä¸€å®šä¸å­˜åœ¨ï¼Œ  é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å¤„ç†ï¼Œéœ€è¦é‡ç‚¹è€ƒè™‘ä¸€ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯è¯¯å·®ç‡ï¼Œæ‰€è°“çš„è¯¯å·®ç‡å°±æ˜¯æŒ‡å½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œäº§ç”Ÿçš„è¯¯å·®ã€‚<br>é¦–å…ˆæˆ‘ä»¬ææ‡‚ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>UVï¼šå…¨ç§°Unique Visitorï¼Œä¹Ÿå«ç‹¬ç«‹è®¿å®¢é‡ï¼Œæ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚1å¤©å†…åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è®¿é—®è¯¥ç½‘ç«™ï¼Œåªè®°å½•1æ¬¡ã€‚</li><li>PVï¼šå…¨ç§°Page Viewï¼Œä¹Ÿå«é¡µé¢è®¿é—®é‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯è®¿é—®ç½‘ç«™çš„ä¸€ä¸ªé¡µé¢ï¼Œè®°å½•1æ¬¡PVï¼Œç”¨æˆ·å¤šæ¬¡æ‰“å¼€é¡µé¢ï¼Œåˆ™è®°å½•å¤šæ¬¡PVã€‚å¾€å¾€ç”¨æ¥è¡¡é‡ç½‘ç«™çš„æµé‡ã€‚</li></ul><p>é€šå¸¸æ¥è¯´UVä¼šæ¯”PVå¤§å¾ˆå¤šï¼Œæ‰€ä»¥è¡¡é‡åŒä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ï¼Œæˆ‘ä»¬éœ€è¦ç»¼åˆè€ƒè™‘å¾ˆå¤šå› ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯å•çº¯çš„æŠŠè¿™ä¸¤ä¸ªå€¼ä½œä¸ºä¸€ä¸ªå‚è€ƒå€¼</p><p>UVç»Ÿè®¡åœ¨æœåŠ¡ç«¯åšä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºè¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»ç»Ÿè®¡è¿‡äº†ï¼Œéœ€è¦å°†ç»Ÿè®¡è¿‡çš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜ã€‚ä½†æ˜¯å¦‚æœæ¯ä¸ªè®¿é—®çš„ç”¨æˆ·éƒ½ä¿å­˜åˆ°Redisä¸­ï¼Œæ•°æ®é‡ä¼šéå¸¸ææ€–ï¼Œé‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>Hyperloglog(HLL)æ˜¯ä»Loglogç®—æ³•æ´¾ç”Ÿçš„æ¦‚ç‡ç®—æ³•ï¼Œç”¨äºç¡®å®šéå¸¸å¤§çš„é›†åˆçš„åŸºæ•°ï¼Œè€Œä¸éœ€è¦å­˜å‚¨å…¶æ‰€æœ‰å€¼ã€‚ç›¸å…³ç®—æ³•åŸç†å¤§å®¶å¯ä»¥å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903785744056333#heading-0">https://juejin.cn/post/6844903785744056333#heading-0</a><br>Redisä¸­çš„HLLæ˜¯åŸºäºstringç»“æ„å®ç°çš„ï¼Œå•ä¸ªHLLçš„å†…å­˜<strong>æ°¸è¿œå°äº16kb</strong>ï¼Œ<strong>å†…å­˜å ç”¨ä½</strong>çš„ä»¤äººå‘æŒ‡ï¼ä½œä¸ºä»£ä»·ï¼Œå…¶æµ‹é‡ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œ<strong>æœ‰å°äº0.81ï¼…çš„è¯¯å·®</strong>ã€‚ä¸è¿‡å¯¹äºUVç»Ÿè®¡æ¥è¯´ï¼Œè¿™å®Œå…¨å¯ä»¥å¿½ç•¥ã€‚</p><h3 id="12-2-UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡"><a href="#12-2-UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡" class="headerlink" title="12.2 UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡"></a>12.2 UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡</h3><p>æµ‹è¯•æ€è·¯ï¼šæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å•å…ƒæµ‹è¯•ï¼Œå‘HyperLogLogä¸­æ·»åŠ 100ä¸‡æ¡æ•°æ®ï¼Œçœ‹çœ‹å†…å­˜å ç”¨å’Œç»Ÿè®¡æ•ˆæœå¦‚ä½•</p><p><img src="https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301151824909.png" alt=""></p><p>ç»“æœå¤§æ¦‚æ˜¯14kbçš„æ¶ˆè€—ï¼Œä¸Šé¢å·ç§°æ˜¯16kbä»¥å†…æ²¡æœ‰ç¿»è½¦ï¼Œä¸¢å¤±ç‡å¤§æ¦‚æ˜¯0.2%å·¦å³ã€‚</p><p>ç»è¿‡æµ‹è¯•ï¼šæˆ‘ä»¬ä¼šå‘ç”Ÿä»–çš„è¯¯å·®æ˜¯åœ¨å…è®¸èŒƒå›´å†…ï¼Œå¹¶ä¸”å†…å­˜å ç”¨æå°</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶æµæ“ä½œ</title>
      <link href="/posts/1001496239.html"/>
      <url>/posts/1001496239.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h1><h2 id="åŸºç¡€éƒ¨åˆ†"><a href="#åŸºç¡€éƒ¨åˆ†" class="headerlink" title="åŸºç¡€éƒ¨åˆ†"></a>åŸºç¡€éƒ¨åˆ†</h2><p>æ–‡ä»¶æ“ä½œâ€”â€”stdlibåº“å‡½æ•°<br>FILE <em>fp â€”-å®šä¹‰æ–‡ä»¶æŒ‡é’ˆ<br>fopen(â€œå‚æ•°ï¼šè·¯å¾„ï¼ˆç»å¯¹ç›¸å¯¹éƒ½å¯)ï¼‰â€,â€å‚æ•°ï¼šæ“ä½œæ¨¡å¼â€ â€”-å‡½æ•°æ‰“å¼€æ–‡ä»¶</em>å¦‚æœæƒ³ç›´æ¥æŒ‰ç…§æ–‡ä»¶åæ‰“å¼€ï¼Œéœ€è¦è®©æ–‡ä»¶å’Œæºæ–‡ä»¶demo.cæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹*<br>fclose(fp) æ–‡ä»¶æ‰“å¼€ä¹‹åéœ€è¦è®°å¾—å…³é—­<br>p.s. æ³¨æ„æ‰“å¼€ä¹‹åæ–‡ä»¶æŒ‡é’ˆä¼šå‡ºç°åœ¨é¦–ä¸ªå­—æ¯å‰æ–¹ï¼Œéšç€æ“ä½œçš„è¿›è¡Œé€æ¸ç§»åŠ¨<br>æ¨¡å¼ï¼š</p><ul><li>r æ¨¡å¼ï¼šè¯»æ–‡ä»¶ ch = fgetc(pf);</li><li>w æ¨¡å¼ï¼šå†™æ–‡ä»¶ ch = fputc(â€˜2â€™, pf); æ‰§è¡Œæ—¶ä¸è¦ä¸è¯»æ“ä½œä¸€åŒè¿›è¡Œå¦åˆ™å¯èƒ½å‡ºç°æ— æ³•ç†è§£çš„bug<br><em>å†™å…¥çš„æ—¶å€™æ˜¯è¦†ç›–ï¼Œè€Œä¸æ˜¯å¾€åæ¨ï¼Œåæ¨æ˜¯è®°äº‹æœ¬è‡ªå¸¦å®ç°çš„åŠŸèƒ½</em><br>æ–‡ä»¶çš„ç»“æŸæ ‡å¿—æ˜¯ä¸€ä¸ªEOF å¾ªç¯æ¡ä»¶    while (!feof(pf)) </li></ul><h2 id="è¿›é˜¶éƒ¨åˆ†"><a href="#è¿›é˜¶éƒ¨åˆ†" class="headerlink" title="è¿›é˜¶éƒ¨åˆ†"></a>è¿›é˜¶éƒ¨åˆ†</h2><p><strong>å¯¹ç»“æ„ä½“ç­‰æœ‰æ ¼å¼çš„æ“ä½œ</strong><br>ä½¿ç”¨è¯»å†™å‡½æ•°</p><ul><li>è¯» fread(â€œå‚æ•°ï¼šåœ°å€â€,â€å‚æ•°ï¼šè¯¥æ¿å—çš„å¤§å°â€,â€å‚æ•°ï¼šè¿™æ ·çš„æ¿å—çš„æ•°é‡â€,â€å‚æ•°ï¼šæ–‡ä»¶æŒ‡é’ˆâ€)<br><em>å‡ä¸éœ€è¦å¸¦å¼•å·</em><br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221213154044.png" alt=""></li><li>å†™ fwrite(â€œâ€,â€â€,â€â€,â€â€)å’ŒfreadåŒç†</li><li>æ–‡ä»¶å®šä½ fseek(â€œå‚æ•°ï¼šæ–‡ä»¶æŒ‡é’ˆâ€,â€å‚æ•°ï¼šåç§»é‡â€,â€å‚æ•°ï¼šç‰¹å®šå«ä¹‰ï¼ˆSEEK_SETæ–‡ä»¶å¼€å¤´ï¼ŒENDå°±æ˜¯æ–‡ä»¶æœ«å°¾ï¼‰â€) è¯´é€šä¿—ç‚¹å°±æ˜¯æ”¹å˜å…‰æ ‡çš„ä½ç½®ï¼Œä¸€èˆ¬å†™å…¥ä¹‹åï¼Œå…‰æ ‡éƒ½ä¼šå¤„äºæœ€åçš„ä½ç½®<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221213152859.png" alt=""><br>æƒ³è¦ä»æœ€ååç§»ï¼Œéœ€è¦ä½¿ç”¨è´Ÿæ•°ï¼Œåç§»é‡æ˜¯æœ‰æ­£è´Ÿä¹‹åˆ†çš„<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221213163121.png" alt=""></li></ul><h2 id="åœ¨æ•°æ®ç»“æ„è¯¾è®¾ä¸­ç”¨åˆ°çš„æ–‡ä»¶æµæ“ä½œ"><a href="#åœ¨æ•°æ®ç»“æ„è¯¾è®¾ä¸­ç”¨åˆ°çš„æ–‡ä»¶æµæ“ä½œ" class="headerlink" title="åœ¨æ•°æ®ç»“æ„è¯¾è®¾ä¸­ç”¨åˆ°çš„æ–‡ä»¶æµæ“ä½œ"></a>åœ¨æ•°æ®ç»“æ„è¯¾è®¾ä¸­ç”¨åˆ°çš„æ–‡ä»¶æµæ“ä½œ</h2><p>æ€è·¯ï¼š</p><ol><li>åœ¨æ„å»ºæ—¶é€šè¿‡èˆªç­ç»“æ„ä½“å†™å…¥ä¸¤ä¸ªä½œä¸ºæ¨¡æ¿ï¼Œç„¶ååœ¨ä½¿ç”¨æ—¶ç”¨ä¸€ä¸ªæŒ‰ç…§æ¨¡æ¿å·²ç»å†™å¥½çš„æ–‡ä»¶è®©å…¶è¢«è¯»å–å†™å…¥(å·²å®Œå–„)</li><li>åœ¨è®¾ç½®çš„ç®¡ç†å‘˜æ¨¡å¼ä¸­åˆ›å»ºæ–°èˆªç­æ—¶æ·»åŠ ä¸€ä¸ªæ–‡ä»¶å†™å…¥ï¼Œä½¿å¾—æ•°æ®å›ºåŒ–ï¼Œå›ºåŒ–åªé’ˆå¯¹èˆªç­è€Œä¸å¯¹å…¶å®ƒå¢åˆ æŸ¥æ”¹æ•°æ®è¿›è¡Œå›ºåŒ–ï¼ˆå·²å®Œå–„ï¼‰</li><li>åœ¨æŸ¥æ‰¾æ—¶çš„è¾“å‡ºå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸ªèˆªç­æ—¥å¿—ä¿¡æ¯ï¼Œå¯ä»¥ä¾›æŸ¥æ‰¾ï¼ˆå·²å®Œå–„ï¼Œå°±æ˜¯ç®€å•çš„æ·»åŠ ä¸€äº›æ ¼å¼åŒ–å‡½æ•°å³å¯ï¼‰</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ’åºç®—æ³•æ•´åˆ</title>
      <link href="/posts/3264712740.html"/>
      <url>/posts/3264712740.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ’åºç»¼åˆ"><a href="#æ’åºç»¼åˆ" class="headerlink" title="æ’åºç»¼åˆ"></a>æ’åºç»¼åˆ</h1><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p>ä»€ä¹ˆæ˜¯å †ï¼Ÿåˆ†ä¸ºä¸¤ç±»</p><ol><li>å¤§æ ¹å †<br>é¡¾åæ€ä¹‰ï¼Œæ»¡è¶³å®Œå…¨äºŒå‰æ ‘ï¼Œä¸”çˆ¶æ¯èŠ‚ç‚¹æ°¸è¿œæ¯”å­èŠ‚ç‚¹è¦å¤§</li><li>å°æ ¹å †<br>å’Œä¸Šé¢çš„åŒºåˆ«åªåœ¨çˆ¶æ¯èŠ‚ç‚¹æ°¸è¿œæ¯”å­èŠ‚ç‚¹è¦å°<br>é¦–å…ˆéœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜</li></ol><ul><li>å¦‚ä½•ç»™ä¸€ä¸ªæ— åºå˜æˆæœ‰åºï¼Ÿ</li><li>å¦‚ä½•å°†å †é¡¶å…ƒç´ æ’å‡ºä¹‹åè¿˜æ˜¯ä¸€ä¸ªå †ï¼Ÿ<br>è¿™é‡Œæˆ‘ä»¬å…ˆè§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œç¬¬äºŒä¸ªè§£å†³ä¹‹åç¬¬ä¸€ä¸ªé—®é¢˜å°†è¿åˆƒè€Œè§£<h3 id="å¦‚ä½•è§£ï¼Ÿ"><a href="#å¦‚ä½•è§£ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£ï¼Ÿ"></a>å¦‚ä½•è§£ï¼Ÿ</h3>A2ï¼šå°†å †é¡¶å…ƒç´ å¼¹å‡ºä¹‹åï¼Œå°†æœ€å¤§çš„å…ƒç´ ï¼ˆæœ€åä¸€ä¸ªï¼‰ç½®äºå †é¡¶ï¼Œç„¶åä¾æ¬¡é€’å½’å˜æˆå¶å­èŠ‚ç‚¹<br>A1ï¼šï¼ˆå¶å­èŠ‚ç‚¹å°±æ˜¯å †ï¼‰ï¼ˆæ–¹æ³•æ˜¯åå¤ç­›é€‰ï¼‰ä»æœ€åæ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ˜¯å¶å­çš„èŠ‚ç‚¹ï¼ˆn/2ï¼‰ï¼Œç„¶åä¾æ¬¡ä»n/2â€”-&gt;åˆ° 1 ä¾æ¬¡è°ƒæ•´å³å¯ï¼Œæ³¨æ„ä»ä¸Šå‘ä¸‹çš„å¿…é¡»è°ƒæ•´åˆ°å¶å­æ‰è¡Œ<br>è¡¥å……ä¸€ä¸ªå°çŸ¥è¯†ç‚¹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹åºå·ä¸ºnï¼Œé‚£ä¹ˆä»–çš„çˆ¶æ¯èŠ‚ç‚¹ä¸€å®šæ˜¯n/2ï¼Œå³å¯ä»¥æ¨å‡ºæœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å°±æ˜¯n/2<br>å †æ’åºç®—æ³•æ€§èƒ½åˆ†æï¼š</li><li>æ—¶é—´å¤æ‚åº¦ä¼˜åŠ¿ï¼šç¨³å®š ä¸€ç›´éƒ½æ˜¯O(nlog2(n))</li><li>ç©ºé—´å¤æ‚åº¦ï¼šä¸éœ€è¦é¢å¤–ç©ºé—´O(1)</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§„åˆ’</title>
      <link href="/posts/2845550790.html"/>
      <url>/posts/2845550790.html</url>
      
        <content type="html"><![CDATA[<h2 id="è§„åˆ’-è®¾è®¡"><a href="#è§„åˆ’-è®¾è®¡" class="headerlink" title="è§„åˆ’==è®¾è®¡"></a>è§„åˆ’==è®¾è®¡</h2><p>è®¾è®¡å¾ˆéš¾ï¼Œä½†æ˜¯æ¬ç –ä¸éš¾</p><p>è¦åšåˆ°ä¸å†…è€—çš„å»åšæŸäº›äº‹ï¼Œå°±ä¸€å®šè¦å­¦ä¼šå»è®¾è®¡ï¼Œé€šè¿‡åº•å±‚é€»è¾‘å»è®¾è®¡ä¸€ä¸ªè®©è‡ªå·±ç»å¯¹ç›¸ä¿¡çš„æµç¨‹ï¼Œç„¶åç…§æ¬å»åšã€‚</p><p>ä¸å†…è€—ï¼Œæ ¼å±€è§†é‡æ”¾å¤§ï¼Œç›®å…‰ä¸å±€é™åœ¨èº«è¾¹ï¼Œæˆ‘éœ€è¦åšä»€ä¹ˆäº‹ï¼Œè¿™ä»¶äº‹å¯¹æˆ‘æœ‰æ•ˆï¼Œæ»¡è¶³å¯ä»¥è®©æˆ‘è¾¾åˆ°ç›®æ ‡ï¼Œå°±å»æ‰§è¡Œï¼Œå…¶å®ƒä¸€åˆ‡éƒ½å°†è®©è·¯</p><p>è‡ªå¾‹æ˜¯ä¸ªä¼ªæ¦‚å¿µï¼Œéœ€è¦æ”¹å˜çš„æ˜¯è‡ªæˆ‘çš„è®¤çŸ¥ï¼Œåšäº‹ä¹‹å‰å…ˆå»è€ƒè™‘è¿™ä»¶äº‹å¯¹æˆ‘çš„ç›®æ ‡æœ‰ä»€ä¹ˆå¸®åŠ© åœ¨æƒ³æ³•å’Œè¡ŒåŠ¨ä¸­é—´æ·»ä¸€ä¸ªæµç¨‹å°±æ˜¯é€‰æ‹©<br><strong>è§‚å¿µâ€”-æƒ³æ³•â€”-é€‰æ‹©â€”-è¡ŒåŠ¨</strong></p><p>æ”¹å˜ï¼Ÿ<strong>æ€è·¯ä¸æ¸…æ™°ï¼Œåšäº‹æ‹–æ‹‰ï¼Œç›®æ ‡ä¸å¤Ÿæ˜ç¡®ï¼Œæ²¡æœ‰ä¸€ä¸ªæ˜ç¡®å¯ä»¥æ‰§è¡Œçš„æµç¨‹æ€»æ˜¯åœ¨åšæŠ‰æ‹©å¯¼è‡´å†…è€—</strong></p><p>å‡æœŸæ®‹ç•™äº‹åŠ¡ï¼š</p><ol><li>äºŒæ‰‹å¸‚åœºåå°å¼€å‘ï¼ˆå­¦ä¹ å¦‚ä½•é€šè¿‡æ¥å£å»é‡æ„ï¼‰ï¼ˆæ¥å£é‡æ„ï¼ŒèŠ±è´¹6å¤©æ—¶é—´ï¼‰â€”-&gt;æ”¹ä¸ºé»‘é©¬å¤–å–é¡¹ç›®ï¼Œæ‰“ç‰¢curdçš„åŸºç¡€ï¼Œä¸‹å­¦æœŸçš„é‡å¿ƒå°±ä¸åœ¨è¿™ä¸Šé¢äº†</li><li><em>rediså®æˆ˜é¡¹ç›® ï¼ˆèŠœæ¹–ç»“æŸ~ï¼‰</em></li><li>åšå®¢ç¾åŒ–ç»§ç»­ï¼Œç›®å‰æ˜¯åªæœ‰æ–‡ç« ä¸­å†™çš„é‚£äº›éœ€æ±‚</li><li><em>æ•°æ®ç»“æ„è¯¾ç¨‹è®¾è®¡ï¼ˆå·²å®Œæˆï¼æ–‡ä»¶æµå®Œå–„ï¼Œä»£ç bugä¿®å¤ï¼Œç•Œé¢æ”¹åŠ¨ï¼‰</em></li><li>å­¦ä¹ è¯¾å†…å†…å®¹ï¼Œä»æ•°å­—é€»è¾‘å­¦åˆ°æœºç»„</li><li>æ¦‚ç‡è®ºå‰©ä¸‹å†…å®¹çš„è¡¥é½</li><li>è‹±è¯­çš„å¬åŠ›è®­ç»ƒï¼ˆå¦‚æœä¸å¼€å§‹ï¼Œæ°¸è¿œä¸ä¼šçœŸæ­£æŒæ¡ï¼‰</li></ol><p>æ—¥å¸¸ï¼š</p><ol><li>é”»ç‚¼ å‡ å¹´æ²¡å˜é‡çš„æˆ‘ï¼Œå¤§å­¦å±…ç„¶å˜é‡äº†ï¼Œå¾ˆç¦»è°±ï¼Œè¯¥å‹ä¸€å‹äº†</li><li>å†¥æƒ³</li><li>å•è¯è®°å¿†</li></ol><p>å‡æœŸæ—¶é—´è§„åˆ’ï¼šæ¯æ—¥æœ‰æ•ˆæ—¶é•¿å¯ä»¥è¾¾åˆ°æ¯æ—¥çš„å››åˆ†ä¹‹ä¸€ï¼Œå³6å°æ—¶<br>å…¶ä½™æ—¶é—´è¦æœ‰æ„è¯†çš„å»è®¾ç½®ï¼Œè€Œééšå¿ƒéšæ€§ï¼Œå³è‡ªå·±éœ€è¦çŸ¥é“è‡ªå·±è¿™ä¸ªæ—¶é—´åšçš„æ˜¯ä»€ä¹ˆï¼Œä¹‹å‰ç›¸ä¿¡çš„é“ç†å¯ä»¥æ’ä¸Šç”¨åœºäº†ã€‚</p><p>æ—¥å¸¸çäº‹åŒºï¼š</p><ol><li>ç»™ä¸«å¤´è´­ä¹°è·³ç»³ï¼ˆï¼‰</li><li>æ‰¾ä¸ªæ—¶é—´æ·»åŠ ä¸€ä¸‹åšå®¢çš„åŒæ¨¡å¼ï¼Œä»¥åŠæ·»åŠ ä¸€ä¸ªä¸ªäººè¯´è¯´é¡µé¢ã€‚</li></ol><hr><h2 id="æˆ‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æˆ‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"></a><strong>æˆ‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h2><p>æˆä¸ºä¸€ä¸ªç†æ€§æ²‰ç¨³ä¸”è‡ªä¿¡ï¼Œå€¼å¾—ä¾é ï¼Œæ— å†…è€—ï¼Œå¹¶ä¸”åœ¨ä¸ªäººé¢†åŸŸå°æœ‰æˆå°±çš„äºº<br>ç†æ€§æ˜¯æˆ‘ä¸€ç›´çš„è¿½æ±‚ï¼Œæ— å†…è€—å’Œè¿™ç‚¹ä¸Šç›¸è¾…ç›¸æˆã€‚<br>å€¼å¾—ä¾é ï¼šæ˜¯æˆ‘å¸Œæœ›æˆ‘èº«è¾¹çš„äººåœ¨æˆ‘è¿™å„¿èƒ½è·å¾—å®‰å…¨æ„Ÿï¼Œä»¥åŠä¿¡ä»»ã€‚<br>è‡ªä¿¡ï¼šä¸€ä¸ªäººæˆåŠŸçš„å¿…å¤‡å“è´¨ï¼Œæ•¢äºè¡¨è¾¾ï¼Œæ•¢äºç«äº‰ï¼Œä¸€ä¸ªäººä¸å­˜åœ¨èƒ½åŠ›ä¸Šçš„å¼±å°ï¼Œåªä¼šå­˜åœ¨äºå¿ƒç†ä¸Šçš„å¼±å°ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°å­—é€»åªå› </title>
      <link href="/posts/2906003680.html"/>
      <url>/posts/2906003680.html</url>
      
        <content type="html"><![CDATA[<p>C1æœ‰æ²¡æœ‰åœˆå†³å®šç€æ˜¯åœ¨å·¦è¾¹è™šçº¿è¿˜æ˜¯å³è¾¹ï¼ˆæœ‰å¯¹åº”ç€å³è¾¹ï¼‰<br>Dè§¦å‘å™¨<br>å·¦å³è¾“å‡ºä¸€è‡´<br>å¦‚æœå‡ºç°è¾“å…¥æ—¶åŒæ—¶å­˜åœ¨é«˜ä½ç‚¹ï¼Œæ­¤æ—¶éœ€è¦å¾€å·¦åç§»ä¸€äº›<br>JKè§¦å‘å™¨<br>JK ï¼ˆKæ˜¯å¤ä½ç«¯ï¼ŒJæ˜¯ç½®ä½ç«¯ï¼‰</p><ol><li>å¯¹åº” 1 0 è¾“å‡ºQ å·¦è¾¹å’Œå·¦è¾¹ä¸€è‡´ï¼Œä½†æ˜¯å³è¾¹å°±æ˜¯1</li><li>å¯¹åº” 0 1 è¾“å‡ºQ å·¦è¾¹ä¸€è‡´ï¼Œå³è¾¹æ˜¯0</li><li>å¯¹åº” 0 0 Qå·¦å³ ç›¸åŒ</li><li>å¯¹åº” 1 1 Qå·¦å³ ç›¸å</li></ol><p>å¤šä¸ªè§¦å‘å™¨ç›¸è¿<br>éœ€è¦æŒ¨ä¸ªåˆ†æï¼šè¦æ¸…æ¥šä¸€å¼€å§‹è¾“å…¥çš„ä¸€èˆ¬éƒ½æ˜¯0ï¼Œæ‰€ä»¥å¯ä»¥æ¨å‡ºä¸‹ä¸€æ®µï¼Œç„¶åé‡ç½®è¾“å‡ºçš„Qä¾æ¬¡åˆ¤æ–­æ¯ä¸€æ®µ</p>]]></content>
      
      
      
        <tags>
            
            <tag> åªå›  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‹±è¯­ç¬”è®°è®°å½•</title>
      <link href="/posts/4257864970.html"/>
      <url>/posts/4257864970.html</url>
      
        <content type="html"><![CDATA[<h2 id="å•è¯"><a href="#å•è¯" class="headerlink" title="å•è¯"></a>å•è¯</h2><ol><li>welfareï¼š<ul><li>ç¦åˆ©</li><li>ç”Ÿæ´»æ°´å¹³</li></ul></li><li>signaling = showing - inferred</li><li>yielded </li><li>cope</li><li>solely </li><li>investigated = explored</li><li>replication å¤åˆ¶</li><li>receipts</li><li>revealed</li><li>substitute</li><li>vast </li><li>wealthy</li></ol><h2 id="è¯ç»„"><a href="#è¯ç»„" class="headerlink" title="è¯ç»„"></a>è¯ç»„</h2><ul><li>riding on ä¾èµ–</li><li>it pays toâ€¦ å€¼å¾—</li><li>yielded insight å‘ç° == we found == we yielded </li><li>shareã€€awareness</li></ul><h2 id="æ½œè§„åˆ™-å°tips"><a href="#æ½œè§„åˆ™-å°tips" class="headerlink" title="æ½œè§„åˆ™-å°tips"></a>æ½œè§„åˆ™-å°tips</h2><ul><li>ifåé¢å¾€å¾€æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚</li><li>studyä¸€èˆ¬æ˜¯ä¸ºäº†ç»§ç»­è¯æ˜å‰é¢çš„ç‚¹</li><li>instead ä¸ºäº†è¿›ä¸€æ­¥è§£é‡Šï¼Œè€Œéå­—é¢æœ¬èº«çš„æ„æ€ ï¼ˆéåè€Œè½¬æŠ˜ï¼‰</li><li>That is ä¹Ÿæ˜¯è¿›ä¸€æ­¥è§£é‡Š</li></ul><h2 id="é˜…è¯»è§£é¢˜ï¼ˆè‡ªæˆ‘æé†’ï¼‰"><a href="#é˜…è¯»è§£é¢˜ï¼ˆè‡ªæˆ‘æé†’ï¼‰" class="headerlink" title="ã€€é˜…è¯»è§£é¢˜ï¼ˆè‡ªæˆ‘æé†’ï¼‰"></a>ã€€é˜…è¯»è§£é¢˜ï¼ˆè‡ªæˆ‘æé†’ï¼‰</h2><p>è§æ‹›æ‹†æ‹›ï¼Ÿã€€ä¸å¯</p><p>åšé¢˜éœ€è¦ã€€å®è§‚ï¼Œç³»ç»Ÿï¼Œæ›´é«˜çš„è§’åº¦</p><p>åˆ†æ¸…æ¥šé¢˜å‹ã€€ä»€ä¹ˆé¢˜å‹ï¼Ÿä¸»æ—¨é¢˜ï¼Œç»†èŠ‚é¢˜ï¼Ÿ<br>åœ¨â€œå®è§‚ã€ç³»ç»Ÿæ€§ã€æ›´é«˜è§’åº¦â€çš„é˜…è¯»ç†è§£è§£é¢˜æ€è·¯ä¸­ï¼Œé«˜è€ƒé˜…è¯»ç†è§£åªæœ‰ä¸¤ç§é¢˜å‹â€”â€”ä¸»æ—¨é¢˜å’Œç»†èŠ‚é¢˜ã€‚</p><p>æ–‡ç« çš„å†™ä½œå¯¹è±¡ï¼Ÿ å¯¹åº”ä¸»æ—¨ï¼Œä¹Ÿå¯¹åº”ç€é€‰é¡¹ä¸­éœ€è¦é¢å‘çš„å¯¹è±¡</p><p>é˜…è¯»ç†è§£è€ƒå¯Ÿä»€ä¹ˆï¼Ÿã€€å¯¹æ–‡ç« å’Œé¢˜ç›®çš„ä¸»åŠ¨æ“ä½œå’ŒæŒæ§èƒ½åŠ›</p><p><strong>é‡è¦æ€è·¯ï¼‘</strong>ï¼šåœ¨çœ‹ä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œä¸€å®šè¦æƒ³ä¸€æƒ³è¿™ç¯‡æ–‡ç« åˆ°åº•æ˜¯å†™ç»™è°çœ‹çš„ï¼Œä¹Ÿå°±æ˜¯æ–‡ç« çš„å†™ä½œå¯¹è±¡ã€‚ï¼ˆå¼€å¤´éƒ¨åˆ†ï¼‰</p><p><strong>é‡è¦æ€è·¯ï¼’</strong>ï¼šåœ¨çœ‹ä¸€ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œä¸€å®šè¦æƒ³ä¸€æƒ³è¿™ç¯‡æ–‡ç« æ˜¯ä»€ä¹ˆæ–‡ä½“ï¼Œæœ‰ä»€ä¹ˆæ ·çš„å†™ä½œç›®çš„ã€‚<br><em>å…³äºæ–‡ä½“</em><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221121223842.png" alt=""></p><p>å¯¹äºå››çº§æ¥è¯´éœ€è¦ä»¥åŠä¼šç”¨åˆ°çš„å°±åªæœ‰è¯´æ˜å’Œè®®è®ºï¼Œæ‰€ä»¥ç¢°åˆ°æ–‡ç« é¦–å…ˆéœ€è¦åˆ¤æ–­æ–‡ä½“â€”â€”â€”æ¨å‡ºæ–‡ç« çš„å†™ä½œç›®çš„ã€‚<br><strong>é‡è¦æ€è·¯ï¼“</strong>ï¼šä½ å¯ä»¥çœ‹ä¸æ‡‚å…·ä½“å†…å®¹ï¼Œä½†æ˜¯ä¸€å®šè¦çŸ¥é“ä½ çœ‹çš„å†…å®¹æ˜¯é‡è¦çš„ï¼Œè¿˜æ˜¯ä¸é‡è¦çš„ã€‚</p><p>æ¯”å¦‚å‡ºç°<strong>å¤§å†™å­—æ¯çš„äººåå’Œåœ°åã€å„ç§æ•°å­—çš„é‡‘é¢å’Œå¹´ä»½</strong>ï¼Œè¿™äº›éƒ½æ˜¯éå¸¸å…¸å‹çš„å…·ä½“äº‹ä¾‹ï¼ï¼ï¼å¯ä»¥çŸ¥é“ä½œè€…åœ¨åšä»€ä¹ˆï¼Œå°±å¤Ÿäº†</p><p><strong>é‡è¦æ€è·¯ï¼”</strong>ï¼šåœ¨é˜…è¯»ç†è§£ä¸­ï¼Œä¸€å®šè¦æ³¨æ„æŠŠæ¡ä½œè€…åœ¨å¥å­é‡Œå‘ˆç°çš„æ„Ÿæƒ…è‰²å½©ï¼Œä¹Ÿå°±æ˜¯ä½œè€…åœ¨æ–‡å­—ä¸­ä½“ç°çš„æ­£è´Ÿæ€åº¦ã€‚</p><p><strong>é‡è¦æ€è·¯ï¼•</strong>ï¼šé‡è¦ä¿¡æ¯åœ¨æ–‡ç« é‡Œä¸€å®šæœ‰ä¸åŒäºå…¶å®ƒå†…å®¹çš„ç‰¹å¾ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºé‡è¦ä½ç½®ã€é‡ç‚¹æ ‡å¿—ã€é‡å¤ç°è±¡è¿™åäºŒä¸ªå­—ã€‚</p><p>ä»æ–‡ç« çš„è§’åº¦çœ‹ï¼Œæœ‰é‡è¦æ®µè½å’Œæ¬¡è¦æ®µè½ä¹‹åˆ†ï¼›ä»æ®µè½çš„è§’åº¦çœ‹ï¼Œæœ‰é‡è¦è¯­å¥å’Œæ¬¡è¦è¯­å¥ä¹‹åˆ†ï¼›ä»è¯­å¥çš„è§’åº¦çœ‹ï¼Œæœ‰é‡è¦éƒ¨åˆ†å’Œæ¬¡è¦éƒ¨åˆ†ä¹‹åˆ†ã€‚æ‰€è°“é‡è¦ä½ç½®ï¼Œæ— å¤–ä¹æ–‡ç« é¦–å°¾æ®µã€æ®µè½é¦–å°¾å¥ã€ä¸»å¥æˆ–å¥å­ä¸»å¹²è¿™äº›ä½ç½®ï¼Œç›¸å¯¹å…¶å®ƒå†…å®¹è€Œè¨€æ›´é‡è¦ä¸€äº›ã€‚</p><p>ä½œè€…åœ¨æ–‡ç« é‡Œä¼šåˆ†æå†…åœ¨é€»è¾‘ï¼Œæ‰€ä»¥å¼ºè°ƒé‡ç‚¹çš„å› æœã€è½¬æŠ˜ã€é€’è¿›ã€å¯¹æ¯”å…³ç³»è¯å°±æ˜¯é‡è¦ä¿¡æ¯çš„æ ‡å¿—ã€‚ä½œè€…åœ¨æ–‡ç« é‡Œä¼šè¡¨è¾¾æ€åº¦ï¼Œæ‰€ä»¥ä½“ç°æ„Ÿæƒ…è‰²å½©çš„å½¢å®¹è¯å‰¯è¯å°±æ˜¯é‡è¦ä¿¡æ¯çš„æ ‡å¿—ã€‚ä½œè€…åœ¨æ–‡ç« é‡Œä¼šæå‡ºå»ºè®®å’Œè¦æ±‚ï¼Œæ‰€ä»¥ç›¸å…³çš„æƒ…æ€åŠ¨è¯æˆ–ç¥ˆä½¿å¥å°±æ˜¯é‡è¦ä¿¡æ¯çš„æ ‡å¿—ã€‚ä½œè€…åœ¨æ–‡ç« é‡Œä¼šç°èº«è¯´æ³•ç›´æ¥ä¸è¯»è€…å¯¹è¯ï¼Œæ‰€ä»¥åŒ…å«ç¬¬ä¸€äººç§°çš„è¯„è®ºæ€§è¯­å¥å°±æ˜¯é‡è¦ä¿¡æ¯çš„æ ‡å¿—ã€‚</p><p>ä½œè€…è¦ä¼ é€’ç»™è¯»è€…çš„é‡è¦ä¿¡æ¯ï¼Œä¸€å®šä¼šåœ¨æ–‡ç« ä¸­åå¤å¼ºè°ƒï¼Œæ‰€ä»¥åå¤å‡ºç°çš„ä¸ä¸»é¢˜ç›¸å…³çš„å†…å®¹ï¼ŒåŒæ ·æ˜¯é‡è¦ä¿¡æ¯çš„æç¤ºã€‚åŒæ ·çš„ä¿¡æ¯ï¼Œå‡ºç°ç¬¬ä¸€æ¬¡å¯èƒ½ä¼šè¢«å¿½ç•¥ï¼Œå‡ºç°ç¬¬äºŒæ¬¡å°±åº”è¯¥æœ‰æ„è¯†ï¼Œå‡ºç°ç¬¬ä¸‰æ¬¡å°±å¿…é¡»é‡ç‚¹å…³æ³¨ã€‚</p><p>åŒºåˆ†é‡è¦ä¿¡æ¯å’Œæ¬¡è¦ä¿¡æ¯ï¼Œå…¶æœ¬è´¨å°±æ˜¯è®©ä½ åœ¨é˜…è¯»æ–‡ç« çš„åŒæ—¶ï¼Œé™¤äº†å…³æ³¨ä¸­æ–‡ç¿»è¯‘ï¼ŒåŒæ—¶å¯¹æ–‡ç« å†…å®¹è¿›è¡Œæ€ç»´ä¸Šçš„ä¸»åŠ¨æ“ä½œï¼ŒæŠŠæ¡æ–‡ç« ä¿¡æ¯çš„èµ°åŠ¿ï¼Œä»è€Œè¾¾åˆ°å®è§‚ä¸Šç†è§£çš„è¦æ±‚ã€‚é«˜è€ƒé˜…è¯»ç†è§£çš„æ–‡ç« å¹¶ä¸å¤æ‚ï¼Œæ‰€ä»¥ç»è¿‡è®­ç»ƒï¼Œè¿™ä¸€ç‚¹æ˜¯æœ‰ä¸€å®šåŸºç¡€çš„åŒå­¦éƒ½èƒ½åšåˆ°çš„ã€‚</p><h3 id="ç±»å‹åˆ¤æ–­"><a href="#ç±»å‹åˆ¤æ–­" class="headerlink" title="ç±»å‹åˆ¤æ–­"></a>ç±»å‹åˆ¤æ–­</h3><p>å…³äº<strong>è®®è®ºæ–‡</strong>ä¸­ç±»å‹åˆ¤æ–­ï¼š</p><ul><li>ä½œè€…å†™è®®è®ºæ–‡ï¼Œä¸€å®šæ˜¯é¢å¯¹æŸäº›é—®é¢˜ï¼Œè‡ªå·±æœ‰ä¸€äº›çœ‹æ³•ä¸åä¸å¿«ã€‚å¦‚æœæ˜¯ä½œè€…è‡ªèº«èƒ½å¤Ÿè§£å†³çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸€äº›å’Œä¸ªäººç”Ÿæ´»å­¦ä¹ ä¸ºäººå¤„ä¸–ç›¸å…³çš„é—®é¢˜ï¼Œä½œè€…å°±ä¼šç›´æ¥å‘Šè¯‰è¯»è€…æ€ä¹ˆåšæ˜¯å¯¹çš„ï¼Œæ€ä¹ˆåšèƒ½å–å¾—æ›´å¥½çš„ç»“æœã€‚<strong>è¿™å°±æ˜¯ä½œè€…åœ¨ç»™è¯»è€…æå‡ºå»ºè®®ã€‚</strong></li><li>å¦‚æœæ˜¯ä½œè€…è‡ªèº«è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œæ¯”å¦‚å½“å‰ç¤¾ä¼šä¸Šçš„æŸäº›ä¸è‰¯ç°è±¡ï¼Œæˆ–è€…æ˜¯å½±å“äººç±»ç”Ÿå­˜çš„ç¯å¢ƒé—®é¢˜ï¼Œä½œè€…å°±ä¼šåœ¨æ–‡ç« é‡Œé€šè¿‡å¤§é‡åˆ—ä¸¾äº‹å®è¡¨è¾¾è‡ªå·±çš„æ‹…å¿§ï¼Œä»è€Œæ¿€å‘è¯»è€…çš„å…±é¸£ã€‚å½±å“çš„è¯»è€…è¶Šå¤šï¼Œé—®é¢˜å¾—åˆ°è§£å†³çš„å¸Œæœ›å°±æ›´å¤§ã€‚<strong>è¿™å°±æ˜¯ä½œè€…åœ¨å¼•èµ·è¯»è€…çš„é‡è§†ã€‚</strong></li></ul><h3 id="ä¸»æ—¨é¢˜"><a href="#ä¸»æ—¨é¢˜" class="headerlink" title="ä¸»æ—¨é¢˜"></a>ä¸»æ—¨é¢˜</h3><p>ä¸»æ—¨é¢˜çš„æé—®æ–¹å¼å¤šç§å¤šæ ·ï¼Œä½†æ˜¯æ¦‚æ‹¬ä¸‹æ¥å¤§æ¦‚æœ‰ä»¥ä¸‹è¿™å…­ç§ï¼š</p><p><strong>1ã€æé—®æ–‡ç« æ ‡é¢˜<br>2ã€æé—®ä½œè€…æ€åº¦<br>3ã€æé—®å†™ä½œç›®çš„æˆ–ä¸»æ—¨<br>4ã€æé—®ä½œè€…æˆ–è¯»è€…èº«ä»½<br>5ã€æé—®æ–‡ç« æ–‡ä½“æˆ–å‡ºå¤„<br>6ã€æé—®ç»†èŠ‚ä¿¡æ¯åœ¨æ–‡ç« é‡Œçš„ä½œç”¨</strong></p><p>é‡ç‚¹æ˜¯ç¬¬å…­ç‚¹ï¼Œæ³¨æ„è¿™ä¸æ˜¯ä¸ªç»†èŠ‚é¢˜æ˜¯ä¸»æ—¨é¢˜æ‰€ä»¥è¦ç”¨åˆ°è¿™ä¸ªæ€è·¯ï¼š<strong>ä½œè€…åœ¨æ–‡ç« é‡Œå†™çš„ä»»ä½•ä¿¡æ¯ï¼Œåªæœ‰ä¸€ä¸ªç›®çš„ä½œç”¨â€”â€”ä¸ºä¸»æ—¨æœåŠ¡ã€‚</strong><br>é‚£ä¹ˆä¸»æ—¨æ€ä¹ˆæ‰¾ï¼Ÿ è€ç”Ÿå¸¸è°ˆçš„å¼€å¤´ç»“å°¾ä»¥åŠå®¹æ˜“å¿½ç•¥çš„æ ‡é¢˜</p><h3 id="ç»†èŠ‚é¢˜"><a href="#ç»†èŠ‚é¢˜" class="headerlink" title="ç»†èŠ‚é¢˜"></a>ç»†èŠ‚é¢˜</h3><p>å¦‚æœå‡ºç°ä¸€æ®µå¾ˆé•¿çš„è¯ï¼Œæ­¤æ—¶æ€ä¹ˆåŠï¼Ÿ<br>ç”¨é‡ç‚¹æ€è·¯3<br>æ¯”å¦‚å‡ºç°å¤§å†™å­—æ¯äººåç­‰ï¼ŒçŸ¥é“è¿™æ˜¯ä¸ªä¾‹å­ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¸ç”¨çœ‹ï¼Œ<strong>å› ä¸ºæˆ‘ä»¬é‡ç‚¹çœ‹çš„ä¸æ˜¯ä¾‹å­æœ¬èº«ï¼Œè€Œæ˜¯ä¾‹å­è¯´æ˜çš„é—®é¢˜æˆ–æœåŠ¡çš„ç»“è®ºã€‚</strong><br>æ— è®ºæ˜¯åœ¨è¯­æ–‡é‡Œï¼Œè¿˜æ˜¯åœ¨è‹±è¯­é‡Œï¼Œé˜…è¯»æ–‡ç« éƒ½åº”è¯¥æœ‰èŠ‚å¥èµ·ä¼ï¼Œè¦åšåˆ°å¼ å¼›æœ‰åº¦ï¼Œæ”¶æ”¾è‡ªå¦‚ï¼ŒèƒŒåé çš„å°±æ˜¯é‡è¦ä¿¡æ¯å’Œä¸é‡è¦ä¿¡æ¯çš„åŒºåˆ†èƒ½åŠ›ã€‚<br>åœ¨è¯´æ˜æ–‡ä¸­å‡ºç°æœ‰å…³äººåï¼Œæ•°æ®ç­‰ç›´æ¥è§†ä½œä¸é‡è¦çš„éƒ¨åˆ†</p><p><strong>æ‰€æœ‰å†…å®¹éƒ½é‡è¦ï¼Œå°±ç­‰äºæ‰€æœ‰å†…å®¹éƒ½ä¸é‡è¦ã€‚</strong> å¦‚æœæŠ¹æ€äº†æ–‡ç« å†…å®¹çš„é‡è¦æ€§å·®å¼‚ï¼Œé‚£ä¹ˆåœ¨é˜…è¯»çš„æ—¶å€™å°±æ²¡æœ‰ä»»ä½•é’ˆå¯¹æ€§ï¼Œè§£é¢˜ä¹Ÿå°±åŒæ ·å˜æˆäº†æ¨¡ç³Šçš„æ•´ä½“æ„Ÿè§‰ï¼Œè¿™æ˜¯å’Œé˜…è¯»ç†è§£çš„å‘½é¢˜æ€è·¯æ ¹æœ¬èƒŒé“è€Œé©°çš„ã€‚</p><p>å¦‚æœå‡ºç°ä¸€ä¸ªå¥å­æ˜¯çœ‹ä¸æ‡‚çš„ï¼Œé‚£ä¹ˆç°åœ¨å¯ä»¥å¯¹å¥å­å°è¯•åŒºåˆ†é‡è¦ä¿¡æ¯å’Œä¸é‡è¦çš„éƒ¨åˆ†ï¼Œè¿™æ—¶å€™å»åˆ†è§£å¥å­ç»“æ„æ˜¯ä¸ªä¸é”™çš„æ–¹å¼ï¼Œé€šè¿‡åŒºåˆ†æ’å…¥è¯­ï¼ˆä¸¤ä¸ªé€—å·ä¹‹é—´çš„éƒ¨åˆ†ï¼‰ï¼Œä¸»ä»å¥ç­‰æ¥ä¸­ç›´æ¥åŒºåˆ†å‡ºé‡è¦çš„ä¸»å¥éƒ¨åˆ†ã€‚</p><p>è¿™ç§è§£é¢˜æ€è·¯å¹¶éæ˜¯é¼“å¹çœ‹ä¸æ‡‚ä¹Ÿèƒ½æŠŠé¢˜åšå¯¹ï¼Œè€Œæ˜¯å‘Šè¯‰ä½ åŒºåˆ†é‡è¦ä¿¡æ¯å’Œæ¬¡è¦ä¿¡æ¯å¯¹è§£é¢˜ä¼šæœ‰ä»€ä¹ˆæ ·çš„å¸®åŠ©ã€‚</p><h3 id="é˜…è¯»æ€è·¯å°ç»“"><a href="#é˜…è¯»æ€è·¯å°ç»“" class="headerlink" title="é˜…è¯»æ€è·¯å°ç»“"></a>é˜…è¯»æ€è·¯å°ç»“</h3><p>æ‰€ä»¥å½“æ‹¿åˆ°ä¸€ç¯‡æ–‡ç« æˆ‘éœ€è¦åšä»€ä¹ˆï¼Ÿ</p><ol><li>æ˜ç¡®ä½œè€…çš„å†™ä½œå¯¹è±¡</li><li>æ˜ç¡®æ–‡ç« çš„æ–‡ä½“</li><li>ç†è§£ä½œè€…çš„æ„Ÿæƒ…è‰²å½©</li><li>å¿½ç•¥æ–‡ç« ä¸­çš„æ¬¡è¦ä¿¡æ¯ä»è€Œæé«˜é˜…è¯»é€Ÿåº¦</li><li>æ­£ç¡®é€‰é¡¹å’Œæ–‡ç« çš„é‡è¦ä¿¡æ¯å¯†åˆ‡ç›¸å…³</li></ol><p>é€šè¿‡å’Œå¤§ä½¬äº¤æµæ·±åŒ–å‡ºæ¥çš„ä¸€äº›æ€è·¯ï¼š</p><ol><li>æœ‰äº›æ–‡ç« å†™ä½œå¯¹è±¡æ˜¯ä¸æ˜ç¡®çš„ï¼Œè€Œä¸”å†™ä½œå¯¹è±¡åœ¨æŸäº›åœºæ™¯ä¸‹å®é™…ç”¨é€”ä¸å¤§ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ç”¨éœ€è¦ä»é¢˜ç›®ä¸­å»åˆ¤æ–­ï¼Œé¢˜ç›®ä¸­æ˜¯å¦æ¶‰åŠåˆ°å¯¹è±¡è¿™ä¸ªç‚¹ã€‚</li><li>å››å…­çº§ä¸­å‡ºç°çš„ä¸€èˆ¬åªæœ‰è®®è®ºå’Œè¯´æ˜ï¼Œè¿˜å¯èƒ½æœ‰ä¸€ä¸ªå°±æ˜¯è®°å™æ–‡ä¸­çš„ä¸ªäººå¿ƒç†æ–¹é¢æ–‡ç« </li><li>å¯¹äºé€‰é¡¹ï¼šæˆ‘ä»¬ä¸€å¼€å§‹è¦åšçš„ä¸æ˜¯å»é€‰æ‹©ï¼Œè€Œæ˜¯åº”è¯¥å»åˆ å‡ï¼Œå‡å°‘æˆ‘ä»¬éœ€è¦é€‰æ‹©çš„é€‰æ‹©é¡¹ï¼Œè€Œå‡å°‘çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦å»æ–‡ç« ä¸­å¯»æ‰¾<ol><li>ä¸€æ˜¯çœ‹æ–‡ç« çš„æ„Ÿæƒ…è‰²å½©æ­£è´Ÿæ€åº¦</li><li>äºŒæ˜¯çœ‹æ–‡ç« ä¸­ç»†èŠ‚æ‰€å¯¹åº”æ®µè½çš„é‡ç‚¹å†…å®¹ï¼Œæ¯”å¦‚ç»†èŠ‚æ®µè½è¿ç»­å‡ºç°å¤šæ¬¡åŒä¸€ä¸ªåè¯æŠ‘æˆ–æ˜¯åŠ¨è¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çœ‹åˆ°çš„é‡ç‚¹å†…å®¹ï¼ˆå°±åƒé™¶å¤§è¯´çš„ï¼Œæ–‡ç« çš„é‡ç‚¹å†…å®¹ï¼Œä½œè€…ä¼šåƒæ–¹ç™¾è®¡çš„è®©ä½ çœ‹åˆ°ï¼‰</li><li>ä¸‰æ˜¯å¯¹åŠ¨è¯çš„æ€»ç»“ï¼Œæ–‡ç« ä¸­å¦‚æœå‡ºç°ä¸è®¤è¯†çš„åŠ¨è¯ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦æ€ä¹ˆåšï¼Ÿæ‰¾å‡ºè¿ç»­çš„åŠ¨è¯ï¼Œè¿™å…¶ä¸­å­˜åœ¨ç€è”ç³»ï¼Œè¿™ç§è”ç³»å°±æ˜¯åŠ¨ä½œé¡ºåºï¼Œå¯èƒ½ä¸€æ•´ä¸ªå¥å­æˆ‘çœ‹ä¸æ˜ç™½ï¼Œä½†æ˜¯å¦‚æœæŠŠå…¶ä¸­æ‰€æœ‰çš„åŠ¨è¯æŒ‘å‡ºæ¥ï¼Œæ’åˆ—å‡ºæ¥ï¼Œæ€è€ƒä¸‹è¿™äº›åŠ¨ä½œçš„è¿ç»­æ€§ï¼Œå†å¯¹ç…§é€‰é¡¹çœ‹ä¸€éï¼Œæ­¤æ—¶å°±å·®ä¸å¤šäº†</li><li>è¿˜æœ‰å‡ºç°çš„å½¢å®¹è¯ï¼Œè¿™ä¸ªéœ€è¦æ ¼å¤–æ³¨æ„ï¼Œå¾€å¾€ä»£è¡¨ç€è¿™ä¸€éƒ¨åˆ†ä½œè€…æ‰€è•´å«çš„æƒ…ç»ªè‰²å½©</li></ol></li></ol><p>æˆ‘ä»¬çš„å…³æ³¨ç‚¹ç©¶ç«Ÿåº”è¯¥æ˜¯ä»€ä¹ˆï¼šåšé¢˜æ—¶çš„æ€è·¯æ˜¯å¦æ¸…æ™°ï¼ˆæˆ‘ç©¶ç«Ÿè¯¥æƒ³ä»€ä¹ˆï¼‰ï¼Œåšé¢˜çš„æ—¶é—´æ˜¯å¦å¯æ§</p><p>å‡ºç°çš„é—®é¢˜ï¼š<br>æˆ‘æƒ³çš„å’Œä½œè€…æ€»æ˜¯ä¸ä¸€æ ·æ€ä¹ˆåŠï¼Ÿ<br>â€”â€”åšå®¢è§‚é¢˜åŠ¡å¿…æŠ›å¼ƒä¸»è§‚æ„è¯†ï¼Œè€è€å®å®æ‰¾å®¢è§‚ä¾æ®ã€‚â€œä½ æƒ³ä½ ä»¥ä¸ºä½ è§‰å¾—â€è¿™äº›ï¼Œä¸€ç‚¹éƒ½ä¸é‡è¦ã€‚</p><p>æˆ‘è§‰å¾—è¿™ä¸¤ä¸ªé€‰é¡¹éƒ½å¯ä»¥æ€ä¹ˆåŠï¼Ÿ<br>â€”â€”å“ªä¸ªé€‰é¡¹åœ¨æ–‡ç« é‡Œå¯¹åº”çš„ä¿¡æ¯æ›´é‡è¦ä¸€äº›å‘¢ï¼Ÿ</p><p>æˆ‘å•è¯éƒ½è®¤è¯†ä½†æ˜¯å¥å­è¯»ä¸æ‡‚æ€ä¹ˆåŠï¼Ÿ<br>â€”â€”è®­ç»ƒé•¿éš¾å¥åˆ†æï¼Œç§¯ç´¯å¥å­ç¿»è¯‘ç†è§£èƒ½åŠ›ã€‚</p><p>æ·»åŠ ä¸€ä¸ªï¼ˆæ—¶é—´å¤šçš„æƒ…å†µä¸‹ï¼‰åšé¢˜åçš„åˆ†ææ€è·¯ï¼š<br>å°±æ˜¯æ¯é¢˜çš„ç­”æ¡ˆï¼ˆå‡ºé¢˜è§’åº¦ï¼‰ä¹‹é—´å­˜åœ¨ä¸€å®šçš„è”ç³»ï¼Œç½®äºæ˜¯ä»€ä¹ˆè”ç³»ï¼Œéœ€è¦æˆ‘ä¹‹åå®è·µä¹Ÿè®¸ä¼šå¾—å‡ºâ€¦</p><p>è¿˜æœ‰ä¸€ä¸ªæ£€éªŒæ€è·¯æ˜¯å¦æ­£ç¡®çš„æ€è€ƒæ–¹å¼ï¼šåå‘æ€è€ƒ å¯¹é¢˜ç›®çº ç»“çš„æ—¶å€™å¯ä»¥å»æ€è€ƒï¼Œå¦‚æœå¯ä»¥é€‰æ‹©è¿™ä¸ªé€‰é¡¹é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ–‡ç« ä¸­æœ‰ä»€ä¹ˆ<br><em>åŒæ ·çš„æ˜¯åœ¨æ•°å­¦ä¸­å…±ä¹Ÿå¯ä»¥ä¸­åˆ°è¿™ä¸ªæ€è·¯ï¼Œä»é¢˜ç›®æ‰€ç»™çš„æ¡ä»¶åæ¨ï¼Œæœç„¶å¥½çš„æ€ç»´æ–¹å¼éƒ½æ˜¯å­¦ç§‘é€šç”¨çš„</em></p><h3 id="å…³äºæˆ‘çš„å››çº§å¤‡è€ƒç­–ç•¥å‰©ä½™æ—¶é—´å®‰æ’"><a href="#å…³äºæˆ‘çš„å››çº§å¤‡è€ƒç­–ç•¥å‰©ä½™æ—¶é—´å®‰æ’" class="headerlink" title="å…³äºæˆ‘çš„å››çº§å¤‡è€ƒç­–ç•¥å‰©ä½™æ—¶é—´å®‰æ’"></a>å…³äºæˆ‘çš„å››çº§å¤‡è€ƒç­–ç•¥å‰©ä½™æ—¶é—´å®‰æ’</h3><ol><li>å¬åŠ›éƒ¨åˆ†æ²¡ä»€ä¹ˆï¼ŒçŸ­æœŸè®­ç»ƒæ•ˆæœå¹¶ä¸æ˜æ˜¾ï¼Œå¯ä»¥ç›´æ¥æ”¾</li><li>é˜…è¯»ç†è§£è®­ç»ƒæ¯å¤©è®­ç»ƒç™¾æ–‡æ–©ï¼Œè®­ç»ƒç»“æŸä¹‹åï¼Œç»ƒä¹ å››çº§çœŸé¢˜ï¼Œå¤§æ¦‚èŠ±è´¹æ¯æ—¥1å°æ—¶åšé˜…è¯»</li><li>å•è¯éƒ¨åˆ†ï¼Œæ¯æ—¥èŠ±è´¹30min</li><li>ä½œæ–‡å’Œå•è¯ä¸€èµ·è®°å¿†ä¸€ä¸‹æ¨¡æ¿</li><li>å‰©ä¸‹ä¸€ä¸ªé€‰è¯å¡«ç©ºï¼Œåˆ†å€¼ä½ï¼Œä¸è¶³ä¸ºæƒ§</li></ol><p>åšé¢˜æœ€é‡è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><ol><li>é¦–å…ˆæ˜¯æ–‡ç« çš„æ–‡ä½“</li><li>å…¶æ¬¡æ³¨æ„æ–‡ç« çš„ç»“æ„ï¼ŒçŸ¥é“æ–‡ç« å“ªäº›æ®µè½åœ¨åšä»€ä¹ˆï¼Œåœ¨æ–‡ç« ä¸­èµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</li><li>é¢˜ç›®çš„é˜…è¯»é‡è¦æ€§ï¼Œæ³¨æ„é¢˜ç›®ä¸­çš„ç»†èŠ‚ï¼Œé‡åˆ°é¢˜ç›®å…ˆæ€è€ƒçš„æ˜¯åˆ†ç±»</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> English </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¯æ—¥è¯´è¯´é¢„å­˜é¡µ</title>
      <link href="/posts/3236242517.html"/>
      <url>/posts/3236242517.html</url>
      
        <content type="html"><![CDATA[<p>äººä¸€å®šè´±ï¼Œä½†ä¸èƒ½è ¢ï¼Œé‡è¦çš„æ˜¯è¦å­¦ä¼šå¦‚ä½•å»å…‹åˆ¶è‡ªå·±çš„è´±ï¼›<br>å¦‚æœä½ æƒ³è¦è‡ªå·±æˆä¸ºä¸€ä¸ªä»€ä¹ˆæ ·çš„äººï¼Œé¦–å…ˆåº”è¯¥å»æƒ³è±¡è‡ªå·±æˆä¸ºè¿™ä¸ªäººä¹‹åçš„çŠ¶æ€ï¼Œæ€ç»´ä»¥åŠè®¤çŸ¥æ˜¯ä»€ä¹ˆæ ·çš„ï¼›<br>ä¸€æµäººæ‰çš„è‡ªå°Šå¿ƒï¼Œä¸éœ€è¦å‘µæŠ¤ã€‚å› ä¸ºä»–ä»¬æ‹¥æœ‰ç€ç¨³å®šçš„è‡ªä¿¡ï¼ŒåŒæ—¶çŸ¥é“å¦‚ä½•ä»æ‰¹è¯„ä¸­æ”¹è¿›å’Œæå‡ï¼›<br>æˆ‘å¾ˆæ˜ç¡®çš„çŸ¥é“æˆ‘æƒ³è¦çš„æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥äº‰ä¸å¦ä¾¿ä¸€ç›®äº†ç„¶ï¼›<br>æ€è€ƒåªèƒ½å¸¦æ¥æ€§ä»·æ¯”ï¼Œæ„å¿—æ‰èƒ½å¸¦æ¥è‡ªç”±ï¼›<br>å·²ç»æœ‰å¾ˆé•¿å¾ˆé•¿çš„æ—¶é—´æ²¡æœ‰è¿›è¡Œè¿‡æ—¶é—´è®°å½•äº†ï¼Œè®¤ä¸ºæ—¶é—´è®°å½•çš„æ„ä¹‰æ— éåœ¨äºè®°å½•è‡ªå·±çš„æ—¶é—´ï¼Œæ˜ç¡®çŸ¥é“è‡ªå·±å„ä¸ªæ—¶é—´ç«¯åœ¨åšäº›ä»€ä¹ˆï¼Œä½†æ˜¯åœ¨è¿™ä¹‹ä¸­å¹¶æœªå¯¹æˆ‘ä¸ªäººèµ·åˆ°ä»€ä¹ˆæ—¶é—´ä¸Šçš„æŒ‡å¯¼æ„ä¹‰ï¼Œç”šè‡³ä¸€åº¦è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªè€—è´¹æ—¶é—´çš„ç´¯èµ˜ï¼Œä½†æ˜¯æˆ‘å‘ç°æˆ‘é”™äº†ï¼Œé”™çš„ä¸æ˜¯æˆ‘å¯¹äºè¿™ä»¶äº‹çš„çœ‹æ³•ï¼Œå•çº¯çš„çº¯ç²¹çš„è®°å½•ç¡®å®æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œå¹¶ä¸”æˆ‘ä¸å¯¹è‡ªå·±æ‰¹åˆ¤æ—¶å°±æ˜¯å¬ä¹‹ä»»ä¹‹ï¼Œæ‰€ä»¥æˆ‘é”™è¯¯çš„ç‚¹å°±åœ¨äºå¯¹äºæ—¶é—´ç¼ºä¹äº†ä¸»åŠ¨æ€§ï¼Œå½“æˆ‘è®¾å®šä¸‹æ¯æ—¥èŠ±è´¹å¤šå°‘æ—¶é—´å¹¶ä¸”å‡å°‘å†…è€—çš„å»æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šå¾ˆæœ‰æˆå°±æ„Ÿï¼ŒåŒæ—¶å¯¹è‡ªå·±çš„æ—¶é—´æœ‰ç€ç†æ€§ä¸»åŠ¨æ€§çš„å®‰æ’ï¼Œè¿™æ ·çš„è®°å½•ä¼šå­˜åœ¨å…¶æ—¶é—´è®°å½•æœ¬èº«çš„æ„ä¹‰ï¼›</p><hr><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºæœ€å°ç”Ÿæˆæ ‘</title>
      <link href="/posts/326776346.html"/>
      <url>/posts/326776346.html</url>
      
        <content type="html"><![CDATA[<h1 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h1><p><em>æ•™å­¦å…‹é²æ–¯å¡å°”ç®—æ³•ï¼Œè¿™é‡Œä¸´æ—¶è¡¥ä¸€ä¸‹å…³äºæœ€å°ç”Ÿæˆæ ‘çš„çŸ¥è¯†</em></p><h2 id="å¼•å…¥ï¼šä»€ä¹ˆæ˜¯æœ€å°ç”Ÿæˆæ ‘ï¼Ÿ"><a href="#å¼•å…¥ï¼šä»€ä¹ˆæ˜¯æœ€å°ç”Ÿæˆæ ‘ï¼Ÿ" class="headerlink" title="å¼•å…¥ï¼šä»€ä¹ˆæ˜¯æœ€å°ç”Ÿæˆæ ‘ï¼Ÿ"></a>å¼•å…¥ï¼šä»€ä¹ˆæ˜¯æœ€å°ç”Ÿæˆæ ‘ï¼Ÿ</h2><h3 id="ç”Ÿæˆæ ‘"><a href="#ç”Ÿæˆæ ‘" class="headerlink" title="ç”Ÿæˆæ ‘"></a>ç”Ÿæˆæ ‘</h3><p>ä¸¤ä¸ªå…³é”®è¯ï¼šè¿é€šï¼Œæ— å›è·¯ â€”æå°è¿é€šå­å›¾<br>è¾¹å’Œé¡¶ç‚¹å…³ç³»ï¼šn-1 nï¼Œè·¯å¾„å”¯ä¸€<br>è¾¹æ¨ç‚¹æ¡ä»¶ä¸å……è¦ï¼ˆåªæ˜¯å¿…è¦ï¼Œä½†ä¸å……åˆ†ï¼‰<br>æ·±åº¦ï¼Œå¹¿åº¦ä¼˜å…ˆ</p><ol><li>T(G) å·²ç»ç»è¿‡çš„</li><li>B(G) æœªç»è¿‡çš„<h3 id="æœ€å°ç”Ÿæˆæ ‘-1"><a href="#æœ€å°ç”Ÿæˆæ ‘-1" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h3>è¿é€šæƒå€¼æœ€å°ï¼ˆæœ€å°ä»£ä»·ç”Ÿæˆæ ‘ï¼‰<br>å»ºç«‹æ•°å­¦æ¨¡å‹<br>åº”ç”¨ï¼šå»ºç«‹é€šä¿¡ç½‘ å»ºç«‹åŸæ‘é“è·¯ ï¼ˆè´¹ç”¨å¯ä»¥ä½œä¸ºæƒå€¼ï¼‰<h3 id="MSTæ€§è´¨ï¼š"><a href="#MSTæ€§è´¨ï¼š" class="headerlink" title="MSTæ€§è´¨ï¼š"></a>MSTæ€§è´¨ï¼š</h3>what isï¼Ÿ<br>åœ¨ç”Ÿæˆæ ‘çš„æ„é€ è¿‡ç¨‹ä¸­ï¼Œå›¾ä¸­nä¸ªé¡¶ç‚¹åˆ†å±ä¸¤ä¸ªé›†åˆï¼š</li></ol><ul><li>å·²è½åœ¨ç”Ÿæˆæ ‘ä¸Šçš„é¡¶ç‚¹é›†ï¼šU</li><li>å°šæœªè½åœ¨ç”Ÿæˆæ ‘ä¸Šçš„é¡¶ç‚¹é›†ï¼šV-Uæ¥ä¸‹æ¥åˆ™åº”åœ¨æ‰€æœ‰è¿é€šUä¸­é¡¶ç‚¹å’ŒV-Uä¸­é¡¶ç‚¹çš„è¾¹ä¸­é€‰å–æƒå€¼æœ€å°çš„è¾¹ã€‚<br>å›¾ç‰‡å±•ç¤ºï¼š<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87.webp" alt=""><h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2></li><li>å…‹é²æ–¯å¡å°”ï¼ˆKruskalï¼‰</li><li>æ™®åˆ©å§†<br><em>è¿™é‡Œæˆ‘ä¸»è¦è®²çš„æ˜¯å‰è€…</em></li></ul><p>æ­¥éª¤ï¼š</p><ol><li>é¦–å…ˆå°†æ‰€æœ‰ç‚¹æ·»åŠ åˆ°Uä¸­ï¼ˆå³ç”Ÿæˆæ ‘ç‚¹é›†ä¸Šï¼‰</li><li>æ‰¾è¾¹çš„æƒå€¼æœ€å°çš„é€‰æ‹©å³å¯ï¼Œä½†æ˜¯ç›´æ¥é€‰æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ•°ç»„å»å­˜å‚¨æ‰€æœ‰çš„è¾¹ï¼ˆéšä¾¿ä½¿ç”¨ä¸€ä¸ªæ’åºï¼Œå†’æ³¡é€‰æ‹©æ’å…¥éƒ½æ˜¯å¯ä»¥çš„ï¼‰<br>è¿‡ç¨‹ä¸­éœ€è¦æ’æŸ¥ï¼Œå¦‚æœå‡ºç°ç¯å°±å¯¹è¿™æ¡è¾¹èˆå»</li><li>ä¾æ¬¡ç±»æ¨ï¼Œç›´è‡³æ‰€æœ‰ç‚¹éƒ½åœ¨ä¸€ä¸ªè¿é€šåˆ†é‡ä¸Šå³å¯ï¼ˆè¿™é‡Œå¯ä»¥ç”¨ä¸€ä¸ªæ¡ˆä¾‹å»æ¼”ç¤ºï¼‰</li></ol><h3 id="æ¼”ç¤ºæ¡ˆä¾‹ï¼š"><a href="#æ¼”ç¤ºæ¡ˆä¾‹ï¼š" class="headerlink" title="æ¼”ç¤ºæ¡ˆä¾‹ï¼š"></a>æ¼”ç¤ºæ¡ˆä¾‹ï¼š</h3><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-8.webp" alt=""><br><em>ä½¿ç”¨iodrawæ‰€ç”»</em><br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221120132637.png" alt=""><br>æœ€åçš„ç»“æœï¼š<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221120132718.png" alt=""><br>ä½†æ˜¯æœ€å°ç”Ÿæˆæ ‘å¯ä»¥ä¸å”¯ä¸€</p><p><strong>é€‚åˆï¼š</strong> ç¨€ç–å›¾ï¼ˆé€‰æ‹©è¾¹çš„æ–¹å¼ï¼‰<br>æ—¶é—´å¤æ‚åº¦ï¼šO(e loge) eæ˜¯è¾¹æ•°<br>æ¯”è¾ƒï¼š<br>æ™®åˆ©å§†ç®—æ³•å°±æ›´é€‚ç”¨äºç¨ å¯†å›¾ ï¼ˆé€‰æ‹©ç‚¹çš„æ–¹å¼ï¼‰<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) nä¸ºé¡¶ç‚¹æ•°</p><h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 9   <span class="comment">// å›¾ä¸­è¾¹çš„æ•°é‡</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> P 6   <span class="comment">// å›¾ä¸­é¡¶ç‚¹çš„æ•°é‡</span></span></span><br><span class="line"><span class="comment">//æ„å»ºè¡¨ç¤ºè¾¹çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">    <span class="comment">//ä¸€æ¡è¾¹æœ‰ 2 ä¸ªé¡¶ç‚¹</span></span><br><span class="line">    <span class="type">int</span> initial;</span><br><span class="line">    <span class="type">int</span> end;</span><br><span class="line">    <span class="comment">//è¾¹çš„æƒå€¼</span></span><br><span class="line">    <span class="type">int</span> weight;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//qsortæ’åºå‡½æ•°ä¸­ä½¿ç”¨ï¼Œä½¿edgesç»“æ„ä½“ä¸­çš„è¾¹æŒ‰ç…§æƒå€¼å¤§å°å‡åºæ’åº</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">cmp</span><span class="params">(<span class="type">const</span> <span class="type">void</span>* a, <span class="type">const</span> <span class="type">void</span>* b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>  ((<span class="keyword">struct</span> edge*)a)-&gt;weight - ((<span class="keyword">struct</span> edge*)b)-&gt;weight;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…‹é²æ–¯å¡å°”ç®—æ³•å¯»æ‰¾æœ€å°ç”Ÿæˆæ ‘ï¼Œedges å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å›¾çš„å„ä¸ªè¾¹ï¼ŒminTree ç”¨äºè®°å½•ç»„æˆæœ€å°ç”Ÿæˆæ ‘çš„å„ä¸ªè¾¹</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">kruskal_MinTree</span><span class="params">(<span class="keyword">struct</span> edge edges[], <span class="keyword">struct</span> edge minTree[])</span> &#123;</span><br><span class="line">    <span class="type">int</span> i, initial, end, elem, k;</span><br><span class="line">    <span class="comment">//æ¯ä¸ªé¡¶ç‚¹é…ç½®ä¸€ä¸ªæ ‡è®°å€¼</span></span><br><span class="line">    <span class="type">int</span> assists[P];</span><br><span class="line">    <span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ¯ä¸ªé¡¶ç‚¹çš„æ ‡è®°éƒ½ä¸ç›¸åŒ</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; P; i++) &#123;</span><br><span class="line">        assists[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ ¹æ®æƒå€¼ï¼Œå¯¹æ‰€æœ‰è¾¹è¿›è¡Œå‡åºæ’åº</span></span><br><span class="line">    qsort(edges, N, <span class="keyword">sizeof</span>(edges[<span class="number">0</span>]), cmp);</span><br><span class="line">    <span class="comment">//éå†æ‰€æœ‰çš„è¾¹</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="comment">//æ‰¾åˆ°å½“å‰è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹åœ¨ assists æ•°ç»„ä¸­çš„ä½ç½®ä¸‹æ ‡</span></span><br><span class="line">        initial = edges[i].initial - <span class="number">1</span>;</span><br><span class="line">        end = edges[i].end - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//å¦‚æœé¡¶ç‚¹ä½ç½®å­˜åœ¨ä¸”é¡¶ç‚¹çš„æ ‡è®°ä¸åŒï¼Œè¯´æ˜ä¸åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œä¸ä¼šäº§ç”Ÿå›è·¯</span></span><br><span class="line">        <span class="keyword">if</span> (assists[initial] != assists[end]) &#123;</span><br><span class="line">            <span class="comment">//è®°å½•è¯¥è¾¹ï¼Œä½œä¸ºæœ€å°ç”Ÿæˆæ ‘çš„ç»„æˆéƒ¨åˆ†</span></span><br><span class="line">            minTree[num] = edges[i];</span><br><span class="line">            <span class="comment">//è®¡æ•°+1</span></span><br><span class="line">            num++;</span><br><span class="line">            elem = assists[end];</span><br><span class="line">            <span class="comment">//å°†æ–°åŠ å…¥ç”Ÿæˆæ ‘çš„é¡¶ç‚¹æ ‡è®°å…¨éƒ¨æ”¹ä¸ºä¸€æ ·çš„</span></span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; P; k++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (assists[k] == elem) &#123;</span><br><span class="line">                    assists[k] = assists[initial];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœé€‰æ‹©çš„è¾¹çš„æ•°é‡å’Œé¡¶ç‚¹æ•°ç›¸å·®1ï¼Œè¯æ˜æœ€å°ç”Ÿæˆæ ‘å·²ç»å½¢æˆï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (num == P - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">display</span><span class="params">(<span class="keyword">struct</span> edge minTree[])</span> &#123;</span><br><span class="line">    <span class="type">int</span> cost = <span class="number">0</span>, i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æœ€å°ç”Ÿæˆæ ‘ä¸º:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; P - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d-%d  æƒå€¼ï¼š%d\n&quot;</span>, minTree[i].initial, minTree[i].end, minTree[i].weight);</span><br><span class="line">        cost += minTree[i].weight;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;æ€»æƒå€¼ä¸ºï¼š%d&quot;</span>, cost);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">edge</span> <span class="title">edges</span>[<span class="title">N</span>], <span class="title">minTree</span>[<span class="title">P</span> - 1];</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;edges[i].initial, &amp;edges[i].end, &amp;edges[i].weight);</span><br><span class="line">    &#125;</span><br><span class="line">    kruskal_MinTree(edges, minTree);</span><br><span class="line">    display(minTree);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¦‚ç‡è®ºç¬”è®°è‡ªç”¨</title>
      <link href="/posts/2131143902.html"/>
      <url>/posts/2131143902.html</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚ç‡è®º"><a href="#æ¦‚ç‡è®º" class="headerlink" title="æ¦‚ç‡è®º"></a>æ¦‚ç‡è®º</h1><h2 id="ç¦»æ•£å‹éšæœºå˜é‡"><a href="#ç¦»æ•£å‹éšæœºå˜é‡" class="headerlink" title="ç¦»æ•£å‹éšæœºå˜é‡"></a>ç¦»æ•£å‹éšæœºå˜é‡</h2><p><em>This place only note practical for me,æ–‡ç« ä¸­çš„å›¾ç‰‡å¯èƒ½è®¿é—®é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥åˆ·æ–°é‡æ–°åŠ è½½</em></p><ol><li>éœ€è¦æ³¨æ„ç¦»æ•£å‹éšæœºå˜é‡ç‚¹æ¦‚ç‡ä¸åŒï¼ŒèŒƒå›´æ¦‚ç‡æ˜¯åé™„å¸¦å‰<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221115090911.png" alt=""></li><li>å¸¸è§ç¦»æ•£å‹<ol><li>0-1åˆ†å¸ƒ</li><li>äºŒé¡¹åˆ†å¸ƒ </li><li>æ³Šæ¾åˆ†å¸ƒï¼ˆå‡ºç°æ¡ä»¶ä½¿æŸäºŒè€…æ¦‚ç‡ç›¸ç­‰å³å¯æ±‚å‡ºæœªçŸ¥Î»ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221115091534.png" alt=""></li><li>å‡ ä½•åˆ†å¸ƒ</li><li>è¶…å‡ ä½•åˆ†å¸ƒ</li></ol></li><li>æ³Šæ¾å®šç†ï¼ˆä½¿ç”¨ç‚¹åœ¨äºæ ·æœ¬é‡è¿œå¤§äºæ¦‚ç‡ï¼Œæ­¤æ—¶å†ä½¿ç”¨äºŒé¡¹åˆ†å¸ƒå°±å¾ˆéš¾è®¡ç®—ï¼Œè¿™æ—¶å¯ä»¥è½¬æ¢æˆæ³Šæ¾åˆ†å¸ƒä¾¿äºè®¡ç®—ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221115094713.png" alt=""><h2 id="è¿ç»­å‹éšæœºå˜é‡"><a href="#è¿ç»­å‹éšæœºå˜é‡" class="headerlink" title="è¿ç»­å‹éšæœºå˜é‡"></a>è¿ç»­å‹éšæœºå˜é‡</h2></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¦‚ç‡è®º </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¦‚ç‡è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ¬åœ°æ— æ³•è¿æ¥mysqlæŠ¥é”™è§£å†³</title>
      <link href="/posts/2893668416.html"/>
      <url>/posts/2893668416.html</url>
      
        <content type="html"><![CDATA[<h2 id="æœ¬åœ°æ— æ³•è¿æ¥mysqlæŠ¥é”™è§£å†³"><a href="#æœ¬åœ°æ— æ³•è¿æ¥mysqlæŠ¥é”™è§£å†³" class="headerlink" title="æœ¬åœ°æ— æ³•è¿æ¥mysqlæŠ¥é”™è§£å†³"></a>æœ¬åœ°æ— æ³•è¿æ¥mysqlæŠ¥é”™è§£å†³</h2><p>è§£å†³æ–¹æ¡ˆè®°å½•ï¼š</p><ul><li>é¦–å…ˆæŸ¥çœ‹service.msc æ˜¯å¦å­˜åœ¨MysqlæœåŠ¡</li><li>è¿è¡Œcmdå»é‡å¯mysqlæœåŠ¡ï¼Œä¸è¿‡å¯èƒ½å·²ç»è¢«ç³»ç»Ÿè‡ªåŠ¨åˆ é™¤</li><li>éœ€è¦ä»¥ç®¡ç†å‘˜èº«ä»½å»å¯åŠ¨é‡æ–°å®‰è£…mysqlæœåŠ¡ å‘½ä»¤ mysqld -install</li><li>ä¹‹åå¯åŠ¨å³å¯ å‘½ä»¤ net start mysql å³å¯</li></ul><p>== åç»­ä¼šç»§ç»­è®°å½•å…³äºé‡åˆ°çš„sqlæŠ¥é”™è§£å†³ == </p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitä½¿ç”¨</title>
      <link href="/posts/1217846903.html"/>
      <url>/posts/1217846903.html</url>
      
        <content type="html"><![CDATA[<h2 id="gitä¸Šä¼ åˆ°GitHub"><a href="#gitä¸Šä¼ åˆ°GitHub" class="headerlink" title="gitä¸Šä¼ åˆ°GitHub"></a>gitä¸Šä¼ åˆ°GitHub</h2><h5 id="é¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªä»“åº“ï¼Œå¹¶é€šè¿‡codeä¸‹è·å–åˆ°ä»“åº“çš„urlï¼Œhttpå’Œsshéƒ½æ˜¯å¯ä»¥çš„"><a href="#é¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªä»“åº“ï¼Œå¹¶é€šè¿‡codeä¸‹è·å–åˆ°ä»“åº“çš„urlï¼Œhttpå’Œsshéƒ½æ˜¯å¯ä»¥çš„" class="headerlink" title="é¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªä»“åº“ï¼Œå¹¶é€šè¿‡codeä¸‹è·å–åˆ°ä»“åº“çš„urlï¼Œhttpå’Œsshéƒ½æ˜¯å¯ä»¥çš„"></a>é¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªä»“åº“ï¼Œå¹¶é€šè¿‡codeä¸‹è·å–åˆ°ä»“åº“çš„urlï¼Œhttpå’Œsshéƒ½æ˜¯å¯ä»¥çš„</h5><h5 id="ä½¿ç”¨æŒ‡ä»¤è¿›è¡Œæ¨é€"><a href="#ä½¿ç”¨æŒ‡ä»¤è¿›è¡Œæ¨é€" class="headerlink" title="ä½¿ç”¨æŒ‡ä»¤è¿›è¡Œæ¨é€"></a>ä½¿ç”¨æŒ‡ä»¤è¿›è¡Œæ¨é€</h5><ol><li>å…ˆcloneä»“åº“åœ°å€ï¼ŒæŒ‡ä»¤ git clone â€˜urlâ€™</li><li>ä¹‹åæ˜¯è¿ç»­æŒ‡ä»¤ git init æ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªéšè—æ–‡ä»¶å¤¹.git  git add . è¡¨ç¤ºæ‰€æœ‰æ–‡ä»¶</li><li>å†æ‰§è¡Œ git commit â€˜é‡Œé¢æ˜¯ä½ æƒ³å†™çš„â€™</li><li>git pushå³å¯ <h5 id="æ­¤æ—¶å¯ä»¥ç»“æŸäº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä¼šè¿›è¡ŒæŠ¥é”™"><a href="#æ­¤æ—¶å¯ä»¥ç»“æŸäº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä¼šè¿›è¡ŒæŠ¥é”™" class="headerlink" title="æ­¤æ—¶å¯ä»¥ç»“æŸäº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä¼šè¿›è¡ŒæŠ¥é”™"></a>æ­¤æ—¶å¯ä»¥ç»“æŸäº†ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä¼šè¿›è¡ŒæŠ¥é”™</h5></li><li>è§£å†³æ–¹å¼ æŒ‡ä»¤ git remote add origin(ä¸€èˆ¬ä½¿ç”¨è¿™ä¸ªä¸ºæœ¬åœ°å) â€˜urlâ€™</li><li>æ­¤æ—¶è¾“å…¥git remote å¯ä»¥çœ‹åˆ°è‡ªå·±æœ‰çš„æœ¬åœ°å</li><li>æœ€åä¸€ä¸ªæŒ‡ä»¤ git push -u origin master (æˆ‘è‡ªå·±å»ºçš„é¡¹ç›®ï¼Œæ˜¯masterèº«ä»½ï¼Œæ‰€ä»¥æœ€åä¸€å¥å‘½ä»¤çš„è¿œç¨‹åˆ†æ”¯åå°±å†™äº†masterï¼Œå…·ä½“åº”æƒ…å†µè€Œå®š)<h5 id="å¯èƒ½åœ¨ç½‘é¡µä¼šè¿˜ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—è¦gitå’ŒGitHubå»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶è¾“å…¥å¯†ç è¿æ¥å³å¯"><a href="#å¯èƒ½åœ¨ç½‘é¡µä¼šè¿˜ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—è¦gitå’ŒGitHubå»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶è¾“å…¥å¯†ç è¿æ¥å³å¯" class="headerlink" title="å¯èƒ½åœ¨ç½‘é¡µä¼šè¿˜ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—è¦gitå’ŒGitHubå»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶è¾“å…¥å¯†ç è¿æ¥å³å¯"></a>å¯èƒ½åœ¨ç½‘é¡µä¼šè¿˜ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—è¦gitå’ŒGitHubå»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶è¾“å…¥å¯†ç è¿æ¥å³å¯</h5><h5 id="è‡³æ­¤ï¼Œåœ†æ»¡ç»“æŸ"><a href="#è‡³æ­¤ï¼Œåœ†æ»¡ç»“æŸ" class="headerlink" title="è‡³æ­¤ï¼Œåœ†æ»¡ç»“æŸ"></a>è‡³æ­¤ï¼Œåœ†æ»¡ç»“æŸ</h5></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾…ä¼˜åŒ–ğŸ¥´ğŸ˜‹</title>
      <link href="/posts/2940578226.html"/>
      <url>/posts/2940578226.html</url>
      
        <content type="html"><![CDATA[<h2 id="æœ¬ç½‘ç«™æƒ³è¦å®Œå–„çš„åœ°æ–¹"><a href="#æœ¬ç½‘ç«™æƒ³è¦å®Œå–„çš„åœ°æ–¹" class="headerlink" title="æœ¬ç½‘ç«™æƒ³è¦å®Œå–„çš„åœ°æ–¹"></a>æœ¬ç½‘ç«™æƒ³è¦å®Œå–„çš„åœ°æ–¹</h2><p><em>éœ€è¦æŠ½æ—¶é—´å®Œå–„</em></p><ol><li>æ·»åŠ å¤åˆ¶å¼¹çª—ï¼ˆ*ï¼‰</li><li>å¼•ç”¨å½©è‰²iconfontï¼ˆ*ï¼‰</li><li>å¤œæ™šç™½å¤©åŒèƒŒæ™¯ï¼ˆé¡ºä¾¿æ·»åŠ åˆ‡æ¢åŠ¨æ•ˆï¼‰ï¼ˆ*ï¼‰</li><li>ç½‘ç«™æ€§èƒ½æŒç»­ä¼˜åŒ–</li><li>æ·»åŠ è¯´è¯´æ¿å— å¹¶å°†å…¶ç½®äºé¦–é¡µæ¶ˆæ¯æ ï¼ˆ*ï¼‰</li><li>å°†ç½‘ç«™ç½®äºè‡ªå·±çš„æœåŠ¡å™¨</li><li>æ·»åŠ è®¿å®¢å¼¹çª—</li><li>â€¦â€¦</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººåšå®¢æ€§èƒ½ä¼˜åŒ–</title>
      <link href="/posts/1434177947.html"/>
      <url>/posts/1434177947.html</url>
      
        <content type="html"><![CDATA[<p><em>è¿™é‡Œç†è®ºéƒ¨åˆ†æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œå› ä¸ºæˆ‘æœ¬äººæ˜¯å­¦ä¹ åç«¯ï¼Œå‰ç«¯å°±ä¸å¤ªæ¶‰åŠï¼Œå…³äºwebé¡µé¢æ¸²æŸ“ä»¥åŠç½‘ç»œè¯·æ±‚ç­‰çŸ¥è¯†æˆ‘ä¹Ÿåªæ˜¯æµ…å°è¾„æ­¢ï¼Œè¿™é‡Œæˆ‘ç›´æ¥è¯´æˆ‘çš„å®æ“æ”¹å–„éƒ¨åˆ†</em></p><h2 id="å‹ç¼©é™æ€èµ„æº"><a href="#å‹ç¼©é™æ€èµ„æº" class="headerlink" title="å‹ç¼©é™æ€èµ„æº"></a>å‹ç¼©é™æ€èµ„æº</h2><h3 id="å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥"><a href="#å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥"></a>å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥</h3><h4 id="å›¾ç‰‡å¤šçº§å‹ç¼©"><a href="#å›¾ç‰‡å¤šçº§å‹ç¼©" class="headerlink" title="å›¾ç‰‡å¤šçº§å‹ç¼©"></a>å›¾ç‰‡å¤šçº§å‹ç¼©</h4><ul><li>å»ºè®®æ”¹æˆ webp å’Œ avifï¼ˆchrome æ¨èçš„ä¸€ç§å‹ç¼©ç‡æ›´é«˜çš„ç¼–ç æ–¹å¼ï¼‰</li></ul><h4 id="è®¾ç½®å›¾ç‰‡æ‡’åŠ è½½"><a href="#è®¾ç½®å›¾ç‰‡æ‡’åŠ è½½" class="headerlink" title="è®¾ç½®å›¾ç‰‡æ‡’åŠ è½½"></a>è®¾ç½®å›¾ç‰‡æ‡’åŠ è½½</h4><ul><li>ä¸»é¢˜å¯ä»¥è‡ªè¡Œè®¾ç½®</li></ul><h3 id="é™æ€èµ„æºï¼ˆhtmlï¼Œcssï¼Œjsç­‰ï¼‰ä½¿ç”¨gulp"><a href="#é™æ€èµ„æºï¼ˆhtmlï¼Œcssï¼Œjsç­‰ï¼‰ä½¿ç”¨gulp" class="headerlink" title="é™æ€èµ„æºï¼ˆhtmlï¼Œcssï¼Œjsç­‰ï¼‰ä½¿ç”¨gulp"></a>é™æ€èµ„æºï¼ˆhtmlï¼Œcssï¼Œjsç­‰ï¼‰ä½¿ç”¨gulp</h3><h3 id="å­—ä½“ä¼˜åŒ–"><a href="#å­—ä½“ä¼˜åŒ–" class="headerlink" title="å­—ä½“ä¼˜åŒ–"></a>å­—ä½“ä¼˜åŒ–</h3><ul><li>åˆ©ç”¨ CloudConvert å°† TTF æ ¼å¼è½¬æ¢æˆ woff2 æ ¼å¼</li></ul><h2 id="ä½¿ç”¨cdnåŠ é€Ÿ"><a href="#ä½¿ç”¨cdnåŠ é€Ÿ" class="headerlink" title="ä½¿ç”¨cdnåŠ é€Ÿ"></a>ä½¿ç”¨cdnåŠ é€Ÿ</h2><h2 id="æ­å»ºä¸ªäººå›¾åºŠ"><a href="#æ­å»ºä¸ªäººå›¾åºŠ" class="headerlink" title="æ­å»ºä¸ªäººå›¾åºŠ"></a>æ­å»ºä¸ªäººå›¾åºŠ</h2><h2 id="æµè§ˆå™¨å‚¨å­˜ä¼˜åŒ–ç­–ç•¥"><a href="#æµè§ˆå™¨å‚¨å­˜ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="æµè§ˆå™¨å‚¨å­˜ä¼˜åŒ–ç­–ç•¥"></a>æµè§ˆå™¨å‚¨å­˜ä¼˜åŒ–ç­–ç•¥</h2><h3 id="Cookieçš„åˆç†ä½¿ç”¨"><a href="#Cookieçš„åˆç†ä½¿ç”¨" class="headerlink" title="Cookieçš„åˆç†ä½¿ç”¨"></a>Cookieçš„åˆç†ä½¿ç”¨</h3><h3 id="LocalStorageï¼ˆå­˜å‚¨é™æ€ï¼‰"><a href="#LocalStorageï¼ˆå­˜å‚¨é™æ€ï¼‰" class="headerlink" title="LocalStorageï¼ˆå­˜å‚¨é™æ€ï¼‰"></a>LocalStorageï¼ˆå­˜å‚¨é™æ€ï¼‰</h3><h3 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a>SessionStorage</h3><h2 id="ä½¿ç”¨æ€§èƒ½æ£€æµ‹é’ˆå¯¹å‹ä¼˜åŒ–"><a href="#ä½¿ç”¨æ€§èƒ½æ£€æµ‹é’ˆå¯¹å‹ä¼˜åŒ–" class="headerlink" title="ä½¿ç”¨æ€§èƒ½æ£€æµ‹é’ˆå¯¹å‹ä¼˜åŒ–"></a>ä½¿ç”¨æ€§èƒ½æ£€æµ‹é’ˆå¯¹å‹ä¼˜åŒ–</h2><h3 id="ä½¿ç”¨Lighthouseå·¥å…·æµ‹è¯„ï¼ˆå†…ç½®äºchromeå¼€å‘å·¥å…·ä¸­ï¼‰"><a href="#ä½¿ç”¨Lighthouseå·¥å…·æµ‹è¯„ï¼ˆå†…ç½®äºchromeå¼€å‘å·¥å…·ä¸­ï¼‰" class="headerlink" title="ä½¿ç”¨Lighthouseå·¥å…·æµ‹è¯„ï¼ˆå†…ç½®äºchromeå¼€å‘å·¥å…·ä¸­ï¼‰"></a>ä½¿ç”¨Lighthouseå·¥å…·æµ‹è¯„ï¼ˆå†…ç½®äºchromeå¼€å‘å·¥å…·ä¸­ï¼‰</h3><h3 id="ä½¿ç”¨çµé›€"><a href="#ä½¿ç”¨çµé›€" class="headerlink" title="ä½¿ç”¨çµé›€"></a>ä½¿ç”¨çµé›€</h3><ul><li><code>https://perf.51.la/</code></li></ul><h2 id="è´­ä¹°ä¸ªäººæœåŠ¡å™¨ï¼Œæ·»åŠ åŸŸåä¼˜åŒ–"><a href="#è´­ä¹°ä¸ªäººæœåŠ¡å™¨ï¼Œæ·»åŠ åŸŸåä¼˜åŒ–" class="headerlink" title="è´­ä¹°ä¸ªäººæœåŠ¡å™¨ï¼Œæ·»åŠ åŸŸåä¼˜åŒ–"></a>è´­ä¹°ä¸ªäººæœåŠ¡å™¨ï¼Œæ·»åŠ åŸŸåä¼˜åŒ–</h2>]]></content>
      
      
      <categories>
          
          <category> hexoç¾åŒ–&amp;&amp;ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿Ÿé’</title>
      <link href="/posts/1469823541.html"/>
      <url>/posts/1469823541.html</url>
      
        <content type="html"><![CDATA[<h1 id="è¿Ÿé’"><a href="#è¿Ÿé’" class="headerlink" title="è¿Ÿé’"></a>è¿Ÿé’</h1><p><strong>æµ®èºæ˜¯æµ®èºçš„åŸå› ï¼Œä¹Ÿæ˜¯æµ®èºçš„ç»“æœ</strong><br>è¿™ä¸€å¥çœ‹ä¼¼å¾ˆå¥—å¨ƒçš„è¯ï¼Œå®é™…ä¸Šéšè—ç€æˆ‘ä»¬æƒ…ç»ªçš„åº•å±‚é€»è¾‘ã€‚</p><p>åœ¨æˆ‘å°æ—¶å€™ï¼Œç»å¸¸å¬åˆ°å®¶é•¿å’Œè€å¸ˆä»¬è¯´ï¼Œä½ å®¶å­©å­å¤šä¹ˆå¤šä¹ˆçµæ´»ï¼Œå¾ˆæœºçµï¼Œä¸€èˆ¬éƒ½æ˜¯ä½œä¸ºè¤’å¥–çš„è¯è¯­ï¼Œè¿™ä½¿æˆ‘å¾ˆé•¿æ—¶é—´ä»¥æ¥å¯¹è¿Ÿé’è¿™ä¸ªè¯æœ‰ç€æœ¬èƒ½çš„æ’æ–¥ï¼Œè§‰å¾—è¿™æ˜¯ä¸ªè´¬ä¹‰è¯ï¼Œè¿Ÿé’æ˜¾å¾—åœ¨èµ·æ­¥ä¸Šå°±è½åäºåˆ«äººï¼Œç±»ä¼¼äºå°æ—¶å€™ç»å¸¸å¬åˆ°çš„å¤©èµ‹ä¸ºé‡è®ºï¼Œéƒ¨åˆ†è€å¸ˆå’Œå®¶é•¿éƒ½çœ‹é‡çš„æ˜¯ä½ è¿™ä¸ªå­©å­æ˜¯å¦èªæ˜è€Œå¦å®šå…¶å®ƒå¾ˆå¤šï¼Œä¹Ÿä½¿å¾—å¾ˆå¤šäººå°æ—¶å€™ä¸ºäº†æ˜¾ç¤ºè‡ªå·±å¤šä¹ˆå¤šä¹ˆæœ‰å¤©èµ‹ï¼Œå¤šèªæ˜åšå‡ºä¸å°‘è ¢äº‹ï¼Œæˆ‘ä¹Ÿæœ‰è¿‡ç±»ä¼¼çš„ç»å†ã€‚</p><h2 id="é‚£ä¹ˆè¿Ÿé’ï¼ŒçœŸçš„æ˜¯ä¸€ä»¶åäº‹å—ï¼Ÿ"><a href="#é‚£ä¹ˆè¿Ÿé’ï¼ŒçœŸçš„æ˜¯ä¸€ä»¶åäº‹å—ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆè¿Ÿé’ï¼ŒçœŸçš„æ˜¯ä¸€ä»¶åäº‹å—ï¼Ÿ"></a>é‚£ä¹ˆè¿Ÿé’ï¼ŒçœŸçš„æ˜¯ä¸€ä»¶åäº‹å—ï¼Ÿ</h2><p>å¤å…¸æ›¾æå‡ºè¿‡ä¸€ä¸ªè§‚å¿µï¼Œå«ã€Œè¿Ÿé’è€Œæœ‰è¶£ã€ã€‚</p><p>ã€Šè·ƒè¿ã€‹ä¸­æåˆ°ï¼Œåœ¨ä¸€ä¸ªèµ„æºå¾ˆå¤šï¼Œå¤šé‡åšå¼ˆçš„ä¸–ç•Œï¼Œç¼“æ…¢ååº”çš„èƒ½åŠ›æ¯”æ•æ„Ÿæœ‰æ•ˆå¾ˆå¤šï¼Œè¿Ÿé’æ¯”æ•æ·æ›´åŠ é‡è¦ï¼Œåœ¨ç®¡ç†å¤æ‚ç³»ç»Ÿæ—¶ï¼Œè¿Ÿé’å¯ä»¥ç®—æ˜¯ä¸€ç§ç”Ÿå­˜èƒ½åŠ›äº†ã€‚<br>å› ä¸ºæˆ‘ä»¬çš„ç”Ÿæ´»æ˜¯ä¸ªåºå¤§ã€å¤æ‚çš„ç³»ç»Ÿã€‚è€Œè¶Šæ˜¯è¿™ç§åºå¤§ã€å¤æ‚çš„ç³»ç»Ÿï¼Œåé¦ˆçš„å‘¨æœŸå°±è¶Šé•¿ï¼ŒçŸ­æœŸå†…çš„ç»“æœæ ¹æœ¬å½±å“ä¸äº†é•¿æœŸçš„èµ°å‘ï¼Œè¶Šæ˜¯æƒ³æ§å±€ï¼Œå°±è¶Šéœ€è¦æ—¶é—´å’Œè€å¿ƒã€‚</p><p>æˆ‘ä»¬èº«è¾¹éšæ—¶éƒ½å……æ–¥ç€æœ‰è®¸å¤šè¯±æƒ‘å’Œæœºä¼šï¼Œçœ‹ä¼¼å¼ƒä¹‹å¯æƒœã€‚ä½†é•¿æœŸæ¥çœ‹ï¼Œé”™è¿‡äº†è¿™äº›ï¼Œå…¶å®ä¹Ÿæ ¹æœ¬æ²¡ä»€ä¹ˆã€‚ï¼ˆä½ ä¼šåœ¨æ„è‡ªå·±ä¸€ä¸ªæœˆå‰æœ‰æ²¡æœ‰æ‰“ç‹è€…å’Œåƒé¸¡å—ï¼Ÿï¼‰</p><p>ã€Œäººç±»æ˜¯å”¯ä¸€ä¼šæ€è€ƒé¥è¿œæœªæ¥çš„åŠ¨ç‰©ã€‚ã€</p><p>é¸Ÿä¼šç­‘å·¢ã€æ°´ç­ä¼šç­‘å ¤åã€æ¾é¼ ä¼šå‚¨å­˜æ¾æœï¼Œä½†å®ƒä»¬åªæ˜¯ä¸ºäº†ç”Ÿå­˜ï¼Œå‡ºäºæœ¬èƒ½å»è¿™ä¹ˆåšï¼Œæˆ–è®¸åªæ˜¯ä¸ºäº†çœ¼å‰æœ‰ä¸€ä¸ªä½å¤„ï¼Œæˆ–æ˜¯èƒ½å¤Ÿå­˜æ´»è¿‡ä¸€ä¸ªå†¬å¤©ã€‚åœ¨çŸ­æš‚çš„æ—¶é—´é‡Œï¼Œäººå’ŒåŠ¨ç‰©å¹¶æ— ä¼˜åŠ¿ï¼Œæˆ‘ä»¬çš„ä¼˜åŠ¿åœ¨æ›´è¿œçš„æ—¶é—´é‡Œã€‚</p><p>åªæœ‰äººç±»ï¼Œèƒ½å¤Ÿæ‘†è„±åŠ¨ç‰©æ€§ï¼Œæœ‰èƒ½åŠ›æ€è€ƒé¥è¿œçš„æœªæ¥ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œäººç±»æ³¨é‡æœªæ¥çš„ç†ç”±æ˜¯ä¸ºäº†è®©è‡ªå·±èƒ½åœ¨æœªæ¥ç”Ÿæ´»çš„æ›´å¥½ï¼Œè·å–åˆ°å¤šå€äºå½“ä¸‹çš„åˆ©ç›Šï¼Œåˆæˆ–è€…æ˜¯å°†æŸäº›é£é™©é˜²æ‚£äºæœªç„¶ã€‚</p><p><strong>è€Œæ€è€ƒé¥è¿œæœªæ¥çš„èƒ½åŠ›ï¼Œåˆ™éœ€è¦é’æ„ŸåŠ›çš„ååŠ©ã€‚</strong> åªæœ‰èƒ½å¤Ÿå¯¹çœ¼å‰çš„çŸ­æœŸåˆºæ¿€åšåˆ°ä¸åœ¨æ„ï¼Œæ‰èƒ½å°†æ›´å¤šçš„ç²¾åŠ›ç”¨äºå»ºè®¾æœªæ¥ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬å¯¹èº«è¾¹çš„ä¸€åˆ‡éƒ½è¿™ä¹ˆæ•æ„Ÿï¼Œæˆ‘ä»¬çš„æ³¨æ„åŠ›åªä¼šè¢«å„ç§ä¹±ä¸ƒå…«ç³Ÿçš„äº‹æ¶ˆç£¨æ®†å°½ï¼Œå˜å¾—æµ®èºï¼Œä¸€äº‹æ— æˆã€‚</p><p>å¯ä»¥è¿™ä¹ˆè¯´ï¼š<strong>æ“è¶Šå¤§çš„ç›˜ï¼Œå°±è¶Šéœ€è¦å¯¹çŸ­æœŸä½“éªŒçš„è¿Ÿé’ï¼Œå¯¹é•¿æœŸæ”¶ç›Šçš„æƒ³è±¡åŠ›ã€‚</strong> è¿Ÿé’ç‚¹ä¼¼ä¹ä¹Ÿä¸åã€‚å®ƒè®©æˆ‘ä»¬ä¸åœ¨æ„çŸ­æœŸå¾—å¤±ï¼Œä¸è¢«çŸ­æœŸå¿«æ„Ÿè¯±æƒ‘ï¼Œå˜å¾—ä¸“æ³¨ï¼Œæœ‰å®šåŠ›ã€‚</p><h2 id="å¦‚ä½•å»åšï¼Ÿ"><a href="#å¦‚ä½•å»åšï¼Ÿ" class="headerlink" title="å¦‚ä½•å»åšï¼Ÿ"></a>å¦‚ä½•å»åšï¼Ÿ</h2><p>æœ‰å¼ å›¾ï¼Œå¾ˆæœ‰æ„æ€ï¼Œæœ‰äº›å¤¸å¼ ï¼Œä½†ä¹Ÿèƒ½ååº”å‡ºç°å¦‚ä»Šä¸å°‘äººçš„ç°çŠ¶<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221111091446.png" alt=""><br>æœ‰æ—¶å€™æ•…æ„è¿Ÿé’ç‚¹,ç­‰ä¸€ç­‰,åœ¨è¿™ä¸ªæµ®èº,é£å¿«çš„ä¸–ç•Œé‡Œ,å¯èƒ½åè€Œæ‰æ˜¯æ­£ç¡®è§£æ³•ã€‚</p><p>å¯ä»¥è¯•ç€è¯•ç€å…³é—­è‡ªå·±çš„æ„ŸçŸ¥ï¼Œä»å½“ä¸‹è„±ç¦»å‡ºå»ï¼Œä»è‡ªæˆ‘æŠ½ç¦»å¼€æ¥ï¼Œä¸å†éšç€è‡ªå·±çš„ç¬¬ä¸€æ„Ÿè§‰å»åšäº‹å»è¡ŒåŠ¨ï¼Œå¾ˆå¤šäº‹ä¹Ÿä¼šéšä¹‹é¿å…ã€‚</p><p>å¾ˆå¤šå·²ç»å‘ç”Ÿçš„äº‹å¦‚æœä½ èƒ½åŠæ—¶è·³è„±å‡ºæ¥ï¼Œä»ã€Œå½“äº‹äººã€è§†è§’è¿›å…¥ã€Œæ—è§‚è€…ã€è§†è§’ï¼Œä½ å°±èƒ½å¤Ÿæ¸…æ™°çš„ã€æ¯«æ— é—æ¼çš„çœ‹åˆ°æ­£å‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šçš„ä¸€åˆ‡ï¼Œä¸€ç§’å›å½’ç†æ™ºã€‚</p><p>æ‰€ä»¥ï¼Œå…³é—­æ„ŸçŸ¥å°±æ˜¯ç»™äº†è‡ªå·±ä¸€ä¸ªã€Œå»¶è¿Ÿååº”ã€çš„æ—¶é—´ï¼Œè®©è‡ªå·±èƒ½å¤Ÿå¯Ÿè§‰åˆ°å½“ä¸‹çš„æƒ…ç»ªï¼Œå¹¶ä¸”æƒ³æ˜ç™½äº†å†å»åšå†³å®šã€‚å¦‚æœä½ èƒ½è§‚å¯Ÿåˆ°è‡ªå·±æƒ…ç»ªçš„å¾®å¦™å˜åŒ–ï¼Œè§‚å¯Ÿåˆ°è‡ªå·±æ¯ä¸€æ¬¡ä¸ç»æ„é—´å‡èµ·çš„æƒ…ç»ªæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè§‚å¯Ÿåˆ°å®ƒæ˜¯å¦‚ä½•å‡ºç°çš„ï¼Œä»¥åŠå®ƒç©¶ç«Ÿç»™ä½ å¸¦æ¥äº†ä»€ä¹ˆæ ·çš„å½±å“ï¼Œä½ è‡ªç„¶å°±èƒ½å›å½’å¹³é™ä¸ç†æ™ºã€‚</p><p>åœ¨è¿™ç¯‡åšå®¢çš„æœ€åï¼Œå¼•ä¸€å¥å¤§ä½¬çš„è¯<br><em>è€Œä½†å‡¡æ˜¯èƒ½å¤Ÿæ¸…æ™°è§‰çŸ¥åˆ°çš„æƒ…ç»ªçŠ¶æ€ï¼Œå¤§å¤šéƒ½èƒ½è‡ªç„¶è€Œç„¶å¾—æ¶ˆå¤±ã€‚â€”â€”è‰¾è²</em></p><p>è‡³æ­¤ï¼Œå…¨æ–‡ç»“ï¼Œæœ¬æ–‡ç”¨äºå¯¹æˆ‘è‡ªèº«çš„åçœï¼Œå­˜äºæœ¬ç«™ï¼Œçœ‹åˆ°ä¹Ÿå¯ä»¥æ—¶åˆ»æé†’æˆ‘è§‰çŸ¥æˆ‘çš„ä¸ªäººæƒ…ç»ªï¼Œå¸Œæœ›æˆ‘çš„è¾“å‡ºå¯¹ä½ ä»¬æœ‰å¸®åŠ©ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æœ‰å…³äºä¸ªäººæˆé•¿ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¿Ÿé’ </tag>
            
            <tag> é™ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatisPlus</title>
      <link href="/posts/134766740.html"/>
      <url>/posts/134766740.html</url>
      
        <content type="html"><![CDATA[<h2 id="MyBatisPlus"><a href="#MyBatisPlus" class="headerlink" title="MyBatisPlus"></a>MyBatisPlus</h2><p><strong>å­¦ä¹ ç›®æ ‡</strong></p><blockquote><p>åŸºäºMyBatisPluså®Œæˆæ ‡å‡†Daoçš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½</p><p>æŒæ¡MyBatisPlusä¸­çš„åˆ†é¡µåŠæ¡ä»¶æŸ¥è¯¢æ„å»º</p><p>æŒæ¡ä¸»é”®IDçš„ç”Ÿæˆç­–ç•¥</p><p>äº†è§£MyBatisPlusçš„ä»£ç ç”Ÿæˆå™¨</p></blockquote><h2 id="1ï¼ŒMyBatisPluså…¥é—¨æ¡ˆä¾‹ä¸ç®€ä»‹"><a href="#1ï¼ŒMyBatisPluså…¥é—¨æ¡ˆä¾‹ä¸ç®€ä»‹" class="headerlink" title="1ï¼ŒMyBatisPluså…¥é—¨æ¡ˆä¾‹ä¸ç®€ä»‹"></a>1ï¼ŒMyBatisPluså…¥é—¨æ¡ˆä¾‹ä¸ç®€ä»‹</h2><p>è¿™é‡Œæ˜¯å…ˆå†™ä¸ªå…¥é—¨æ¡ˆä¾‹ï¼Œä¸ºä»€ä¹ˆè¦å…ˆå»å†™è¿™ä¸ªå…¥é—¨æ¡ˆä¾‹å‘¢ï¼Ÿä¸»è¦çš„åŸå› MyBatisPlusä¸»è¦æ˜¯å¯¹MyBatisçš„ç®€åŒ–ï¼Œæ‰€æœ‰æˆ‘ä»¬å…ˆä½“ä¼šä¸‹å®ƒç®€åŒ–åœ¨å“ªï¼Œç„¶åå†å­¦ä¹ å®ƒæ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒå¸®æˆ‘ä»¬éƒ½åšå“ªäº›äº‹ã€‚</p><h3 id="1-1-å…¥é—¨æ¡ˆä¾‹"><a href="#1-1-å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="1.1 å…¥é—¨æ¡ˆä¾‹"></a>1.1 å…¥é—¨æ¡ˆä¾‹</h3><ul><li><p>MybatisPlus(ç®€ç§°MP)æ˜¯åŸºäºMyBatisæ¡†æ¶åŸºç¡€ä¸Šå¼€å‘çš„å¢å¼ºå‹å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ–å¼€å‘ã€æä¾›æ•ˆç‡ã€‚</p></li><li><p>å¼€å‘æ–¹å¼</p><ul><li>åŸºäºMyBatisä½¿ç”¨MyBatisPlus</li><li>åŸºäºSpringä½¿ç”¨MyBatisPlus</li><li>==åŸºäºSpringBootä½¿ç”¨MyBatisPlus==</li></ul></li></ul><p>SpringBootåˆšåˆšæˆ‘ä»¬å­¦ä¹ å®Œæˆï¼Œå®ƒèƒ½å¿«é€Ÿæ„å»ºSpringå¼€å‘ç¯å¢ƒç”¨ä»¥æ•´åˆå…¶ä»–æŠ€æœ¯ï¼Œä½¿ç”¨èµ·æ¥æ˜¯éå¸¸ç®€å•ï¼Œå¯¹äºMPçš„å­¦ä¹ ï¼Œæˆ‘ä»¬ä¹ŸåŸºäºSpringBootæ¥æ„å»ºå­¦ä¹ ã€‚</p><h4 id="æ­¥éª¤1-åˆ›å»ºæ•°æ®åº“åŠè¡¨"><a href="#æ­¥éª¤1-åˆ›å»ºæ•°æ®åº“åŠè¡¨" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºæ•°æ®åº“åŠè¡¨"></a>æ­¥éª¤1:åˆ›å»ºæ•°æ®åº“åŠè¡¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> mybatisplus_db <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line">use mybatisplus_db;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    id <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    password  <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age <span class="type">int</span>(<span class="number">3</span>) <span class="keyword">not</span> <span class="keyword">null</span> ,</span><br><span class="line">    tel <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;18866668888&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;Jerry&#x27;</span>,<span class="string">&#x27;jerry&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;16688886666&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;Jock&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="number">41</span>,<span class="string">&#x27;18812345678&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;ä¼ æ™ºæ’­å®¢&#x27;</span>,<span class="string">&#x27;itcast&#x27;</span>,<span class="number">15</span>,<span class="string">&#x27;4006184000&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤2-åˆ›å»ºSpringBootå·¥ç¨‹"><a href="#æ­¥éª¤2-åˆ›å»ºSpringBootå·¥ç¨‹" class="headerlink" title="æ­¥éª¤2:åˆ›å»ºSpringBootå·¥ç¨‹"></a>æ­¥éª¤2:åˆ›å»ºSpringBootå·¥ç¨‹</h4><p>å‚ç…§ä¹‹å‰çš„æ•™ç¨‹åˆ›å»ºä¸€ä¸ªspringbootå·¥ç¨‹</p><h4 id="æ­¥éª¤3-å‹¾é€‰é…ç½®ä½¿ç”¨æŠ€æœ¯"><a href="#æ­¥éª¤3-å‹¾é€‰é…ç½®ä½¿ç”¨æŠ€æœ¯" class="headerlink" title="æ­¥éª¤3:å‹¾é€‰é…ç½®ä½¿ç”¨æŠ€æœ¯"></a>æ­¥éª¤3:å‹¾é€‰é…ç½®ä½¿ç”¨æŠ€æœ¯</h4><p>åªéœ€è¦ä¸€ä¸ªMysqlçš„</p><p><strong>è¯´æ˜:</strong></p><ul><li>ç”±äºMPå¹¶æœªè¢«æ”¶å½•åˆ°ideaçš„ç³»ç»Ÿå†…ç½®é…ç½®ï¼Œæ— æ³•ç›´æ¥é€‰æ‹©åŠ å…¥ï¼Œéœ€è¦æ‰‹åŠ¨åœ¨pom.xmlä¸­é…ç½®æ·»åŠ </li></ul><h4 id="æ­¥éª¤4-pom-xmlè¡¥å…¨ä¾èµ–"><a href="#æ­¥éª¤4-pom-xmlè¡¥å…¨ä¾èµ–" class="headerlink" title="æ­¥éª¤4:pom.xmlè¡¥å…¨ä¾èµ–"></a>æ­¥éª¤4:pom.xmlè¡¥å…¨ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ul><li><p>druidæ•°æ®æºå¯ä»¥åŠ ä¹Ÿå¯ä»¥ä¸åŠ ï¼ŒSpringBootæœ‰å†…ç½®çš„æ•°æ®æºï¼Œå¯ä»¥é…ç½®æˆä½¿ç”¨Druidæ•°æ®æº</p></li><li><p>ä»MPçš„ä¾èµ–å…³ç³»å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡ä¾èµ–ä¼ é€’å·²ç»å°†MyBatisä¸MyBatisæ•´åˆSpringçš„jaråŒ…å¯¼å…¥ï¼Œæˆ‘ä»¬ä¸éœ€è¦é¢å¤–åœ¨æ·»åŠ MyBatisçš„ç›¸å…³jaråŒ…</p></li></ul><h4 id="æ­¥éª¤5-æ·»åŠ MPçš„ç›¸å…³é…ç½®ä¿¡æ¯"><a href="#æ­¥éª¤5-æ·»åŠ MPçš„ç›¸å…³é…ç½®ä¿¡æ¯" class="headerlink" title="æ­¥éª¤5:æ·»åŠ MPçš„ç›¸å…³é…ç½®ä¿¡æ¯"></a>æ­¥éª¤5:æ·»åŠ MPçš„ç›¸å…³é…ç½®ä¿¡æ¯</h4><p>resourcesé»˜è®¤ç”Ÿæˆçš„æ˜¯propertiesé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å°†å…¶æ›¿æ¢æˆymlæ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¸­é…ç½®æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯:<code>application.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatisplus_db?serverTimezone=UTC</span> </span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong>==serverTimezoneæ˜¯ç”¨æ¥è®¾ç½®æ—¶åŒºï¼ŒUTCæ˜¯æ ‡å‡†æ—¶åŒºï¼Œå’Œå’±ä»¬çš„æ—¶é—´å·®8å°æ—¶ï¼Œæ‰€ä»¥å¯ä»¥å°†å…¶ä¿®æ”¹ä¸º<code>Asia/Shanghai</code>==</p><h4 id="æ­¥éª¤6-æ ¹æ®æ•°æ®åº“è¡¨åˆ›å»ºå®ä½“ç±»"><a href="#æ­¥éª¤6-æ ¹æ®æ•°æ®åº“è¡¨åˆ›å»ºå®ä½“ç±»" class="headerlink" title="æ­¥éª¤6:æ ¹æ®æ•°æ®åº“è¡¨åˆ›å»ºå®ä½“ç±»"></a>æ­¥éª¤6:æ ¹æ®æ•°æ®åº“è¡¨åˆ›å»ºå®ä½“ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;   </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="comment">//setter...getter...toStringæ–¹æ³•ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤7-åˆ›å»ºDaoæ¥å£"><a href="#æ­¥éª¤7-åˆ›å»ºDaoæ¥å£" class="headerlink" title="æ­¥éª¤7:åˆ›å»ºDaoæ¥å£"></a>æ­¥éª¤7:åˆ›å»ºDaoæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt;&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤8-ç¼–å†™å¼•å¯¼ç±»"><a href="#æ­¥éª¤8-ç¼–å†™å¼•å¯¼ç±»" class="headerlink" title="æ­¥éª¤8:ç¼–å†™å¼•å¯¼ç±»"></a>æ­¥éª¤8:ç¼–å†™å¼•å¯¼ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">//@MapperScan(&quot;com.Blog-test.dao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Mybatisplus01QuickstartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong> Daoæ¥å£è¦æƒ³è¢«å®¹å™¨æ‰«æåˆ°ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ:</p><ul><li>æ–¹æ¡ˆä¸€:åœ¨Daoæ¥å£ä¸Šæ·»åŠ <code>@Mapper</code>æ³¨è§£ï¼Œå¹¶ä¸”ç¡®ä¿Daoå¤„åœ¨å¼•å¯¼ç±»æ‰€åœ¨åŒ…æˆ–å…¶å­åŒ…ä¸­<ul><li>è¯¥æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯éœ€è¦åœ¨æ¯ä¸€Daoæ¥å£ä¸­æ·»åŠ æ³¨è§£</li></ul></li><li>æ–¹æ¡ˆäºŒ:åœ¨å¼•å¯¼ç±»ä¸Šæ·»åŠ <code>@MapperScan</code>æ³¨è§£ï¼Œå…¶å±æ€§ä¸ºæ‰€è¦æ‰«æçš„Daoæ‰€åœ¨åŒ…<ul><li>è¯¥æ–¹æ¡ˆçš„å¥½å¤„æ˜¯åªéœ€è¦å†™ä¸€æ¬¡ï¼Œåˆ™æŒ‡å®šåŒ…ä¸‹çš„æ‰€æœ‰Daoæ¥å£éƒ½èƒ½è¢«æ‰«æåˆ°ï¼Œ<code>@Mapper</code>å°±å¯ä»¥ä¸å†™ã€‚</li></ul></li></ul><h4 id="æ­¥éª¤9-ç¼–å†™æµ‹è¯•ç±»"><a href="#æ­¥éª¤9-ç¼–å†™æµ‹è¯•ç±»" class="headerlink" title="æ­¥éª¤9:ç¼–å†™æµ‹è¯•ç±»"></a>æ­¥éª¤9:ç¼–å†™æµ‹è¯•ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MpDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span> &#123;</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(<span class="literal">null</span>);</span><br><span class="line">System.out.println(userList);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong> </p><p>userDaoæ³¨å…¥çš„æ—¶å€™ä¸‹é¢æœ‰çº¢çº¿æç¤ºçš„åŸå› æ˜¯ä»€ä¹ˆ?</p><ul><li><p>UserDaoæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸èƒ½å®ä¾‹åŒ–å¯¹è±¡</p></li><li><p>åªæœ‰åœ¨æœåŠ¡å™¨å¯åŠ¨IOCå®¹å™¨åˆå§‹åŒ–åï¼Œç”±æ¡†æ¶åˆ›å»ºDAOæ¥å£çš„ä»£ç†å¯¹è±¡æ¥æ³¨å…¥</p></li><li>ç°åœ¨æœåŠ¡å™¨å¹¶æœªå¯åŠ¨ï¼Œæ‰€ä»¥ä»£ç†å¯¹è±¡ä¹Ÿæœªåˆ›å»ºï¼ŒIDEAæŸ¥æ‰¾ä¸åˆ°å¯¹åº”çš„å¯¹è±¡æ³¨å…¥ï¼Œæ‰€ä»¥æç¤ºæŠ¥çº¢</li><li>ä¸€æ—¦æœåŠ¡å¯åŠ¨ï¼Œå°±èƒ½æ³¨å…¥å…¶ä»£ç†å¯¹è±¡ï¼Œæ‰€ä»¥è¯¥é”™è¯¯æç¤ºä¸å½±å“æ­£å¸¸è¿è¡Œã€‚</li></ul><p>æŸ¥çœ‹è¿è¡Œç»“æœï¼Œä¼šå‘ç°æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><p>è·Ÿä¹‹å‰æ•´åˆMyBatisç›¸æ¯”ï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬ä¸éœ€è¦åœ¨DAOæ¥å£ä¸­ç¼–å†™æ–¹æ³•å’ŒSQLè¯­å¥äº†ï¼Œåªéœ€è¦ç»§æ‰¿<code>BaseMapper</code>æ¥å£å³å¯ã€‚æ•´ä½“æ¥è¯´ç®€åŒ–å¾ˆå¤šã€‚</p><h3 id="1-2-MybatisPlusç®€ä»‹"><a href="#1-2-MybatisPlusç®€ä»‹" class="headerlink" title="1.2 MybatisPlusç®€ä»‹"></a>1.2 MybatisPlusç®€ä»‹</h3><p>MyBatisPlusï¼ˆç®€ç§°MPï¼‰æ˜¯åŸºäºMyBatisæ¡†æ¶åŸºç¡€ä¸Šå¼€å‘çš„å¢å¼ºå‹å·¥å…·ï¼Œæ—¨åœ¨==ç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡==</p><p>é€šè¿‡åˆšæ‰çš„æ¡ˆä¾‹ï¼Œç›¸ä¿¡å¤§å®¶èƒ½å¤Ÿä½“ä¼šç®€åŒ–å¼€å‘å’Œæé«˜æ•ˆç‡è¿™ä¸¤ä¸ªæ–¹é¢çš„ä¼˜ç‚¹ã€‚</p><p>MyBatisPlusçš„å®˜ç½‘ä¸º:<code>https://mp.baomidou.com/</code></p><p><strong>è¯´æ˜:</strong></p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116183714.png" alt=""></p><p>ç°åœ¨çš„é¡µé¢ä¸­ï¼Œè¿™ä¸€è¡Œå·²ç»è¢«åˆ é™¤ï¼Œç°åœ¨å†å»è®¿é—®<code>https://mybatis.plus</code>ä¼šå‘ç°è®¿é—®ä¸åˆ°ï¼Œè¿™ä¸ªå°±æœ‰å¾ˆå¤šå¯èƒ½æ€§ä¾›æˆ‘ä»¬çŒœæƒ³äº†ï¼Œæ‰€ä»¥å¤§å®¶ä½¿ç”¨baomidouçš„ç½‘å€è¿›è¡Œè®¿é—®å³å¯ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ä¸­æœ‰ä¸€å¼ å¾ˆå¤šå°ä¼™ä¼´æ¯”è¾ƒç†Ÿæ‚‰çš„å›¾ç‰‡:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116183600.png" alt=""></p><p>ä»è¿™å¼ å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºMPæ—¨åœ¨æˆä¸ºMyBatisçš„æœ€å¥½æ­æ¡£ï¼Œè€Œä¸æ˜¯æ›¿æ¢MyBatis,æ‰€ä»¥å¯ä»¥ç†è§£ä¸ºMPæ˜¯MyBatisçš„ä¸€å¥—å¢å¼ºå·¥å…·ï¼Œå®ƒæ˜¯åœ¨MyBatisçš„åŸºç¡€ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæˆ‘ä»¬è™½ç„¶ä½¿ç”¨MPä½†æ˜¯åº•å±‚ä¾ç„¶æ˜¯MyBatisçš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨MPä¸­å†™MyBatisçš„å†…å®¹ã€‚</p><p>å¯¹äºMPçš„å­¦ä¹ ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒç€å®˜æ–¹æ–‡æ¡£æ¥è¿›è¡Œå­¦ä¹ ï¼Œé‡Œé¢éƒ½æœ‰è¯¦ç»†çš„ä»£ç æ¡ˆä¾‹ã€‚</p><p>MPçš„ç‰¹æ€§:</p><ul><li>æ— ä¾µå…¥ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“</li><li>å¼ºå¤§çš„ CRUD æ“ä½œï¼šå†…ç½®é€šç”¨ Mapperï¼Œå°‘é‡é…ç½®å³å¯å®ç°å•è¡¨CRUD æ“ä½œ</li><li>æ”¯æŒ Lambdaï¼šç¼–å†™æŸ¥è¯¢æ¡ä»¶æ— éœ€æ‹…å¿ƒå­—æ®µå†™é”™</li><li>æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</li><li>å†…ç½®åˆ†é¡µæ’ä»¶</li><li>â€¦â€¦</li></ul><h2 id="2ï¼Œæ ‡å‡†æ•°æ®å±‚å¼€å‘"><a href="#2ï¼Œæ ‡å‡†æ•°æ®å±‚å¼€å‘" class="headerlink" title="2ï¼Œæ ‡å‡†æ•°æ®å±‚å¼€å‘"></a>2ï¼Œæ ‡å‡†æ•°æ®å±‚å¼€å‘</h2><p>åœ¨è¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬é‡ç‚¹å­¦ä¹ çš„æ˜¯æ•°æ®å±‚æ ‡å‡†çš„CRUD(å¢åˆ æ”¹æŸ¥)çš„å®ç°ä¸åˆ†é¡µåŠŸèƒ½ã€‚ä»£ç æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥å­¦ä¹ ã€‚</p><h3 id="2-1-æ ‡å‡†CRUDä½¿ç”¨"><a href="#2-1-æ ‡å‡†CRUDä½¿ç”¨" class="headerlink" title="2.1 æ ‡å‡†CRUDä½¿ç”¨"></a>2.1 æ ‡å‡†CRUDä½¿ç”¨</h3><p>å¯¹äºæ ‡å‡†çš„CRUDåŠŸèƒ½éƒ½æœ‰å“ªäº›ä»¥åŠMPéƒ½æä¾›äº†å“ªäº›æ–¹æ³•å¯ä»¥ä½¿ç”¨å‘¢?</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹å¼ å›¾:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116183740.png" alt=""></p><p>å¯¹äºè¿™å¼ å›¾çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æŒ¨ä¸ªæ¥æ¼”ç¤ºä¸‹:</p><p>é¦–å…ˆè¯´ä¸‹ï¼Œæ¡ˆä¾‹ä¸­çš„ç¯å¢ƒå°±æ˜¯å’±ä»¬å…¥é—¨æ¡ˆä¾‹çš„å†…å®¹ï¼Œç¬¬ä¸€ä¸ªå…ˆæ¥å®Œæˆ<code>æ–°å¢</code>åŠŸèƒ½</p><h3 id="2-2-æ–°å¢"><a href="#2-2-æ–°å¢" class="headerlink" title="2.2 æ–°å¢"></a>2.2 æ–°å¢</h3><p>åœ¨è¿›è¡Œæ–°å¢ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸‹æ–°å¢çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">insert</span> <span class="params">(T t)</span></span><br></pre></td></tr></table></figure><ul><li><p>T:æ³›å‹ï¼Œæ–°å¢ç”¨æ¥ä¿å­˜æ–°å¢æ•°æ®</p></li><li><p>int:è¿”å›å€¼ï¼Œæ–°å¢æˆåŠŸåè¿”å›1ï¼Œæ²¡æœ‰æ–°å¢æˆåŠŸè¿”å›çš„æ˜¯0</p></li></ul><p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œæ–°å¢æ“ä½œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;é»‘é©¬ç¨‹åºå‘˜&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;Blog-test&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">12</span>);</span><br><span class="line">        user.setTel(<span class="string">&quot;4006184000&quot;</span>);</span><br><span class="line">        userDao.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæµ‹è¯•åï¼Œæ•°æ®åº“è¡¨ä¸­å°±ä¼šæ·»åŠ ä¸€æ¡æ•°æ®ï¼Œå¯¹åº”ä¸Šæˆ‘ä»¬setçš„å„ä¸ªå±æ€§</p><p>ä½†æ˜¯æ•°æ®ä¸­çš„ä¸»é”®IDï¼Œæœ‰ç‚¹é•¿ï¼Œé‚£è¿™ä¸ªä¸»é”®IDæ˜¯å¦‚ä½•æ¥çš„?æˆ‘ä»¬æ›´æƒ³è¦çš„æ˜¯ä¸»é”®è‡ªå¢ï¼Œåº”è¯¥æ˜¯5æ‰å¯¹ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬åé¢è¦å­¦ä¹ çš„ä¸»é”®IDç”Ÿæˆç­–ç•¥ï¼Œè¿™å—çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆæ”¾æ”¾ã€‚</p><h3 id="2-3-åˆ é™¤"><a href="#2-3-åˆ é™¤" class="headerlink" title="2.3 åˆ é™¤"></a>2.3 åˆ é™¤</h3><p>åœ¨è¿›è¡Œåˆ é™¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸‹åˆ é™¤çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteById</span> <span class="params">(Serializable id)</span></span><br></pre></td></tr></table></figure><ul><li><p>Serializableï¼šå‚æ•°ç±»å‹</p><ul><li><p>æ€è€ƒ:å‚æ•°ç±»å‹ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªåºåˆ—åŒ–ç±»?</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117131034.png" alt=""></p><p>ä»è¿™å¼ å›¾å¯ä»¥çœ‹å‡ºï¼Œ</p><ul><li>Stringå’ŒNumberæ˜¯Serializableçš„å­ç±»ï¼Œ</li><li>Numberåˆæ˜¯Float,Double,Integerç­‰ç±»çš„çˆ¶ç±»ï¼Œ</li><li>èƒ½ä½œä¸ºä¸»é”®çš„æ•°æ®ç±»å‹éƒ½å·²ç»æ˜¯Serializableçš„å­ç±»ï¼Œ</li><li>MPä½¿ç”¨Serializableä½œä¸ºå‚æ•°ç±»å‹ï¼Œå°±å¥½æ¯”æˆ‘ä»¬å¯ä»¥ç”¨Objectæ¥æ”¶ä»»ä½•æ•°æ®ç±»å‹ä¸€æ ·ã€‚</li></ul></li></ul></li><li><p>int:è¿”å›å€¼ç±»å‹ï¼Œæ•°æ®åˆ é™¤æˆåŠŸè¿”å›1ï¼Œæœªåˆ é™¤æ•°æ®è¿”å›0ã€‚</p></li></ul><p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œæ–°å¢æ“ä½œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.deleteById(<span class="number">1401856123725713409L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¸ºä»€ä¹ˆè¦æ·»åŠ ä¸€ä¸ªLï¼Œå› ä¸ºæ˜¯longå‹çš„æ•°æ® </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-4-ä¿®æ”¹"><a href="#2-4-ä¿®æ”¹" class="headerlink" title="2.4 ä¿®æ”¹"></a>2.4 ä¿®æ”¹</h3><p>åœ¨è¿›è¡Œä¿®æ”¹ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸‹ä¿®æ”¹çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">updateById</span><span class="params">(T t)</span>;</span><br></pre></td></tr></table></figure><ul><li><p>T:æ³›å‹ï¼Œéœ€è¦ä¿®æ”¹çš„æ•°æ®å†…å®¹ï¼Œæ³¨æ„å› ä¸ºæ˜¯æ ¹æ®IDè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥ä¼ å…¥çš„å¯¹è±¡ä¸­éœ€è¦æœ‰IDå±æ€§å€¼</p></li><li><p>int:è¿”å›å€¼ï¼Œä¿®æ”¹æˆåŠŸåè¿”å›1ï¼Œæœªä¿®æ”¹æ•°æ®è¿”å›0</p></li></ul><p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œæ–°å¢æ“ä½œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1L</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;Tom888&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;tom888&quot;</span>);</span><br><span class="line">        userDao.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong> ä¿®æ”¹çš„æ—¶å€™ï¼Œåªä¿®æ”¹å®ä½“å¯¹è±¡ä¸­æœ‰å€¼çš„å­—æ®µï¼Œæ˜æ˜¾ç®€åŒ–äº†å¼€å‘çš„æ–¹å¼ï¼Œxmlä¸­é…ç½®sqlä¸­è¿˜éœ€è¦ä½¿ç”¨ifæ¥æ’é™¤å¯¹åº”æƒ…å†µã€‚</p><h3 id="2-5-æ ¹æ®IDæŸ¥è¯¢"><a href="#2-5-æ ¹æ®IDæŸ¥è¯¢" class="headerlink" title="2.5 æ ¹æ®IDæŸ¥è¯¢"></a>2.5 æ ¹æ®IDæŸ¥è¯¢</h3><p>åœ¨è¿›è¡Œæ ¹æ®IDæŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸‹æ ¹æ®IDæŸ¥è¯¢çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T <span class="title function_">selectById</span> <span class="params">(Serializable id)</span></span><br></pre></td></tr></table></figure><ul><li>Serializableï¼šå‚æ•°ç±»å‹,ä¸»é”®IDçš„å€¼</li><li>T:æ ¹æ®IDæŸ¥è¯¢åªä¼šè¿”å›ä¸€æ¡æ•°æ®</li></ul><p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œæ–°å¢æ“ä½œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectById(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-æŸ¥è¯¢æ‰€æœ‰"><a href="#2-6-æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="2.6 æŸ¥è¯¢æ‰€æœ‰"></a>2.6 æŸ¥è¯¢æ‰€æœ‰</h3><p>åœ¨è¿›è¡ŒæŸ¥è¯¢æ‰€æœ‰ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æä¸‹æŸ¥è¯¢æ‰€æœ‰çš„æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(Wrapper&lt;T&gt; queryWrapper)</span></span><br></pre></td></tr></table></figure><ul><li>Wrapperï¼šç”¨æ¥æ„å»ºæ¡ä»¶æŸ¥è¯¢çš„æ¡ä»¶ï¼Œç›®å‰æˆ‘ä»¬æ²¡æœ‰å¯ç›´æ¥ä¼ ä¸ºNull</li><li>List<T>:å› ä¸ºæŸ¥è¯¢çš„æ˜¯æ‰€æœ‰ï¼Œæ‰€ä»¥è¿”å›çš„æ•°æ®æ˜¯ä¸€ä¸ªé›†åˆ</li></ul><p>åœ¨æµ‹è¯•ç±»ä¸­è¿›è¡Œæ–°å¢æ“ä½œ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(<span class="literal">null</span>);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ‰€è°ƒç”¨çš„æ–¹æ³•éƒ½æ˜¯æ¥è‡ªäºDAOæ¥å£ç»§æ‰¿çš„BaseMapperç±»ä¸­ã€‚é‡Œé¢çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬åé¢ä¼šæ…¢æ…¢å»å­¦ä¹ é‡Œé¢çš„å†…å®¹ã€‚</p><h3 id="2-7-Lombok"><a href="#2-7-Lombok" class="headerlink" title="2.7 Lombok"></a>2.7 Lombok</h3><p>ä»£ç å†™åˆ°è¿™ï¼Œæˆ‘ä»¬ä¼šå‘ç°DAOæ¥å£ç±»çš„ç¼–å†™ç°åœ¨å˜æˆæœ€ç®€å•çš„äº†ï¼Œé‡Œé¢ä»€ä¹ˆéƒ½ä¸ç”¨å†™ã€‚åè¿‡æ¥çœ‹çœ‹æ¨¡å‹ç±»çš„ç¼–å†™éƒ½éœ€è¦å“ªäº›å†…å®¹:</p><ul><li>ç§æœ‰å±æ€§</li><li>setterâ€¦getterâ€¦æ–¹æ³•</li><li>toStringæ–¹æ³•</li><li>æ„é€ å‡½æ•°</li></ul><p>è™½ç„¶è¿™äº›å†…å®¹ä¸éš¾ï¼ŒåŒæ—¶ä¹Ÿéƒ½æ˜¯é€šè¿‡IDEAå·¥å…·ç”Ÿæˆçš„ï¼Œä½†æ˜¯è¿‡ç¨‹è¿˜æ˜¯å¿…é¡»å¾—èµ°ä¸€éï¼Œé‚£ä¹ˆå¯¹äºæ¨¡å‹ç±»çš„ç¼–å†™æœ‰æ²¡æœ‰ä»€ä¹ˆä¼˜åŒ–æ–¹æ³•?å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„Lombokã€‚</p><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><ul><li>Lombokï¼Œä¸€ä¸ªJavaç±»åº“ï¼Œæä¾›äº†ä¸€ç»„æ³¨è§£ï¼Œç®€åŒ–POJOå®ä½“ç±»å¼€å‘ã€‚</li></ul><h4 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h4><h5 id="æ­¥éª¤1-æ·»åŠ lombokä¾èµ–"><a href="#æ­¥éª¤1-æ·»åŠ lombokä¾èµ–" class="headerlink" title="æ­¥éª¤1:æ·»åŠ lombokä¾èµ–"></a>æ­¥éª¤1:æ·»åŠ lombokä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;version&gt;1.18.12&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> ç‰ˆæœ¬å¯ä»¥ä¸ç”¨å†™ï¼Œå› ä¸ºSpringBootä¸­å·²ç»ç®¡ç†äº†lombokçš„ç‰ˆæœ¬ã€‚</p><h5 id="æ­¥éª¤2-å®‰è£…Lombokçš„æ’ä»¶"><a href="#æ­¥éª¤2-å®‰è£…Lombokçš„æ’ä»¶" class="headerlink" title="æ­¥éª¤2:å®‰è£…Lombokçš„æ’ä»¶"></a>æ­¥éª¤2:å®‰è£…Lombokçš„æ’ä»¶</h5><p>==æ–°ç‰ˆæœ¬IDEAå·²ç»å†…ç½®äº†è¯¥æ’ä»¶ï¼Œå¦‚æœåˆ é™¤setterå’Œgetteræ–¹æ³•ç¨‹åºæœ‰æŠ¥çº¢ï¼Œåˆ™éœ€è¦å®‰è£…æ’ä»¶==</p><p>åˆ°settingçš„pluginså¯»æ‰¾æ’ä»¶lombok</p><p>å¦‚æœåœ¨IDEAä¸­æ‰¾ä¸åˆ°lombokæ’ä»¶ï¼Œå¯ä»¥è®¿é—®å¦‚ä¸‹ç½‘ç«™</p><p><code>https://plugins.jetbrains.com/plugin/6317-lombok/versions</code></p><p>æ ¹æ®è‡ªå·±IDEAçš„ç‰ˆæœ¬ä¸‹è½½å¯¹åº”çš„lombokæ’ä»¶ï¼Œä¸‹è½½æˆåŠŸåï¼Œåœ¨IDEAä¸­é‡‡ç”¨ç¦»çº¿å®‰è£…çš„æ–¹å¼è¿›è¡Œå®‰è£…<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116190139.png" alt=""></p><h5 id="æ­¥éª¤3-æ¨¡å‹ç±»ä¸Šæ·»åŠ æ³¨è§£"><a href="#æ­¥éª¤3-æ¨¡å‹ç±»ä¸Šæ·»åŠ æ³¨è§£" class="headerlink" title="æ­¥éª¤3:æ¨¡å‹ç±»ä¸Šæ·»åŠ æ³¨è§£"></a>æ­¥éª¤3:æ¨¡å‹ç±»ä¸Šæ·»åŠ æ³¨è§£</h5><p>Lombokå¸¸è§çš„æ³¨è§£æœ‰:</p><ul><li>@Setter:ä¸ºæ¨¡å‹ç±»çš„å±æ€§æä¾›setteræ–¹æ³•</li><li>@Getter:ä¸ºæ¨¡å‹ç±»çš„å±æ€§æä¾›getteræ–¹æ³•</li><li>@ToString:ä¸ºæ¨¡å‹ç±»çš„å±æ€§æä¾›toStringæ–¹æ³•</li><li>@EqualsAndHashCode:ä¸ºæ¨¡å‹ç±»çš„å±æ€§æä¾›equalså’Œhashcodeæ–¹æ³•</li><li>==@Data:æ˜¯ä¸ªç»„åˆæ³¨è§£ï¼ŒåŒ…å«ä¸Šé¢çš„æ³¨è§£çš„åŠŸèƒ½==</li><li>==@NoArgsConstructor:æä¾›ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°==</li><li>==@AllArgsConstructor:æä¾›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å‚æ•°çš„æ„é€ å‡½æ•°==</li></ul><p>Lombokçš„æ³¨è§£è¿˜æœ‰å¾ˆå¤šï¼Œä¸Šé¢æ ‡æ³¨çš„ä¸‰ä¸ªæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ï¼Œå…¶ä»–çš„å¤§å®¶åæœŸç”¨åˆ°äº†ï¼Œå†å»è¡¥å……å­¦ä¹ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><p>Lombokåªæ˜¯ç®€åŒ–æ¨¡å‹ç±»çš„ç¼–å†™ï¼Œæˆ‘ä»¬ä¹‹å‰çš„æ–¹æ³•ä¹Ÿèƒ½ç”¨ï¼Œæ¯”å¦‚æœ‰äººä¼šé—®:æˆ‘å¦‚æœåªæƒ³è¦æœ‰nameå’Œpasswordçš„æ„é€ å‡½æ•°ï¼Œè¯¥å¦‚ä½•ç¼–å†™?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æ˜¯è¢«å…è®¸çš„ã€‚</p><h3 id="2-8-åˆ†é¡µåŠŸèƒ½"><a href="#2-8-åˆ†é¡µåŠŸèƒ½" class="headerlink" title="2.8 åˆ†é¡µåŠŸèƒ½"></a>2.8 åˆ†é¡µåŠŸèƒ½</h3><p>åŸºç¡€çš„å¢åˆ æ”¹æŸ¥å°±å·²ç»å­¦ä¹ å®Œäº†ï¼Œåˆšæ‰æˆ‘ä»¬åœ¨åˆ†æåŸºç¡€å¼€å‘çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåˆ†é¡µåŠŸèƒ½è¿˜æ²¡æœ‰å®ç°ï¼Œåœ¨MPä¸­å¦‚ä½•å®ç°åˆ†é¡µåŠŸèƒ½ï¼Œå°±æ˜¯å’±ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„å†…å®¹ã€‚</p><p>åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨çš„æ–¹æ³•æ˜¯:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IPage&lt;T&gt; <span class="title function_">selectPage</span><span class="params">(IPage&lt;T&gt; page, Wrapper&lt;T&gt; queryWrapper)</span></span><br></pre></td></tr></table></figure><ul><li>IPage:ç”¨æ¥æ„å»ºåˆ†é¡µæŸ¥è¯¢æ¡ä»¶</li><li>Wrapperï¼šç”¨æ¥æ„å»ºæ¡ä»¶æŸ¥è¯¢çš„æ¡ä»¶ï¼Œç›®å‰æˆ‘ä»¬æ²¡æœ‰å¯ç›´æ¥ä¼ ä¸ºNull</li><li>IPage:è¿”å›å€¼ï¼Œä½ ä¼šå‘ç°æ„å»ºåˆ†é¡µæ¡ä»¶å’Œæ–¹æ³•çš„è¿”å›å€¼éƒ½æ˜¯IPage</li></ul><p>IPageæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å®ƒçš„å®ç°ç±»æ¥æ„å»ºå®ƒï¼Œå…·ä½“çš„å®ç°ç±»ï¼Œå¯ä»¥è¿›å…¥åˆ°IPageç±»ä¸­æŒ‰ctrl+hï¼ˆæ˜¾ç¤ºhierarchyï¼‰,ä¼šæ‰¾åˆ°å…¶æœ‰ä¸€ä¸ªå®ç°ç±»ä¸º<code>Page</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®ç°å®ƒã€‚</p><h4 id="æ­¥éª¤1-è°ƒç”¨æ–¹æ³•ä¼ å…¥å‚æ•°è·å–è¿”å›å€¼"><a href="#æ­¥éª¤1-è°ƒç”¨æ–¹æ³•ä¼ å…¥å‚æ•°è·å–è¿”å›å€¼" class="headerlink" title="æ­¥éª¤1:è°ƒç”¨æ–¹æ³•ä¼ å…¥å‚æ•°è·å–è¿”å›å€¼"></a>æ­¥éª¤1:è°ƒç”¨æ–¹æ³•ä¼ å…¥å‚æ•°è·å–è¿”å›å€¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus01QuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSelectPage</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1 åˆ›å»ºIPageåˆ†é¡µå¯¹è±¡,è®¾ç½®åˆ†é¡µå‚æ•°,1ä¸ºå½“å‰é¡µç ï¼Œ3ä¸ºæ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°</span></span><br><span class="line">        IPage&lt;User&gt; page=<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//2 æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">        userDao.selectPage(page,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//3 è·å–åˆ†é¡µç»“æœ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰é¡µç å€¼ï¼š&quot;</span>+page.getCurrent());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¯é¡µæ˜¾ç¤ºæ•°ï¼š&quot;</span>+page.getSize());</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸€å…±å¤šå°‘é¡µï¼š&quot;</span>+page.getPages());</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸€å…±å¤šå°‘æ¡æ•°æ®ï¼š&quot;</span>+page.getTotal());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ•°æ®ï¼š&quot;</span>+page.getRecords());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤2-è®¾ç½®åˆ†é¡µæ‹¦æˆªå™¨"><a href="#æ­¥éª¤2-è®¾ç½®åˆ†é¡µæ‹¦æˆªå™¨" class="headerlink" title="æ­¥éª¤2:è®¾ç½®åˆ†é¡µæ‹¦æˆªå™¨"></a>æ­¥éª¤2:è®¾ç½®åˆ†é¡µæ‹¦æˆªå™¨</h4><p>è¿™ä¸ªæ‹¦æˆªå™¨MPå·²ç»ä¸ºæˆ‘ä»¬æä¾›å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å…¶é…ç½®æˆSpringç®¡ç†çš„beanå¯¹è±¡å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†è¿™ä¸ªæ‹¦æˆªå™¨è§†ä½œä¸€ä¸ªbeanè¢«springç®¡ç†</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨é¦–å…ˆæ˜¯ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.è·å–æ•´ä¸ªmpçš„æ‹¦æˆªå™¨</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//2.åœ¨è·å–çš„æ•´ä¸ªæ‹¦æˆªå™¨ä¸­å†å»æ·»åŠ å¯¹åº”çš„ä¸“å±æ‹¦æˆªå™¨,è¾“å…¥pagå°±ä¼šå‡ºç°äº†</span></span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong> ä¸Šé¢çš„ä»£ç è®°ä¸ä½å’‹åŠå‘¢?</p><p>è¿™äº›å†…å®¹åœ¨MPçš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ç±»é…ç½®</p><h4 id="æ­¥éª¤3-è¿è¡Œæµ‹è¯•ç¨‹åº"><a href="#æ­¥éª¤3-è¿è¡Œæµ‹è¯•ç¨‹åº" class="headerlink" title="æ­¥éª¤3:è¿è¡Œæµ‹è¯•ç¨‹åº"></a>æ­¥éª¤3:è¿è¡Œæµ‹è¯•ç¨‹åº</h4><p>å¦‚æœæƒ³æŸ¥çœ‹MPæ‰§è¡Œçš„SQLè¯­å¥ï¼Œå¯ä»¥ä¿®æ”¹application.ymlé…ç½®æ–‡ä»¶ï¼Œ</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment">#å°†sqlæ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€æ—¥å¿—åï¼Œå°±å¯ä»¥åœ¨æ§åˆ¶å°æ‰“å°å‡ºå¯¹åº”çš„SQLè¯­å¥ï¼Œå¼€å¯æ—¥å¿—åŠŸèƒ½æ€§èƒ½å°±ä¼šå—åˆ°å½±å“ï¼Œè°ƒè¯•å®Œåè®°å¾—å…³é—­ã€‚</p><h2 id="3ï¼ŒDQLç¼–ç¨‹æ§åˆ¶"><a href="#3ï¼ŒDQLç¼–ç¨‹æ§åˆ¶" class="headerlink" title="3ï¼ŒDQLç¼–ç¨‹æ§åˆ¶"></a>3ï¼ŒDQLç¼–ç¨‹æ§åˆ¶</h2><p>å¢åˆ æ”¹æŸ¥å››ä¸ªæ“ä½œä¸­ï¼ŒæŸ¥è¯¢æ˜¯éå¸¸é‡è¦çš„ä¹Ÿæ˜¯éå¸¸å¤æ‚çš„æ“ä½œï¼Œè¿™å—éœ€è¦æˆ‘ä»¬é‡ç‚¹å­¦ä¹ ä¸‹ï¼Œè¿™èŠ‚æˆ‘ä»¬ä¸»è¦å­¦ä¹ çš„å†…å®¹æœ‰:</p><ul><li>æ¡ä»¶æŸ¥è¯¢æ–¹å¼</li><li>æŸ¥è¯¢æŠ•å½±</li><li>æŸ¥è¯¢æ¡ä»¶è®¾å®š</li><li>å­—æ®µæ˜ å°„ä¸è¡¨åæ˜ å°„</li></ul><h3 id="3-1-æ¡ä»¶æŸ¥è¯¢"><a href="#3-1-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="3.1 æ¡ä»¶æŸ¥è¯¢"></a>3.1 æ¡ä»¶æŸ¥è¯¢</h3><h4 id="3-1-1-æ¡ä»¶æŸ¥è¯¢çš„ç±»"><a href="#3-1-1-æ¡ä»¶æŸ¥è¯¢çš„ç±»" class="headerlink" title="3.1.1 æ¡ä»¶æŸ¥è¯¢çš„ç±»"></a>3.1.1 æ¡ä»¶æŸ¥è¯¢çš„ç±»</h4><ul><li>MyBatisPluså°†ä¹¦å†™å¤æ‚çš„SQLæŸ¥è¯¢æ¡ä»¶è¿›è¡Œäº†å°è£…ï¼Œä½¿ç”¨ç¼–ç¨‹çš„å½¢å¼å®ŒæˆæŸ¥è¯¢æ¡ä»¶çš„ç»„åˆã€‚</li></ul><p>è¿™ä¸ªæˆ‘ä»¬åœ¨å‰é¢éƒ½æœ‰è§è¿‡ï¼Œæ¯”å¦‚æŸ¥è¯¢æ‰€æœ‰å’Œåˆ†é¡µæŸ¥è¯¢çš„æ—¶å€™ï¼Œéƒ½æœ‰çœ‹åˆ°è¿‡ä¸€ä¸ª<code>Wrapper</code>ç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯ç”¨æ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116195318.png" alt=""></p><p>é‚£ä¹ˆæ¡ä»¶æŸ¥è¯¢å¦‚ä½•ä½¿ç”¨Wrapperæ¥æ„å»ºå‘¢?</p><h4 id="3-1-2-ç¯å¢ƒæ„å»º"><a href="#3-1-2-ç¯å¢ƒæ„å»º" class="headerlink" title="3.1.2 ç¯å¢ƒæ„å»º"></a>3.1.2 ç¯å¢ƒæ„å»º</h4><p>åœ¨æ„å»ºæ¡ä»¶æŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å¯¹åº”çš„ç¯å¢ƒç»™å‡†å¤‡å¥½ï¼Œæˆ‘çš„å»ºè®®æ˜¯ç›´æ¥copyä¸Šé¢çš„é¡¹ç›®ç»“æ„ï¼Œå› ä¸ºæ–¹ä¾¿å¤„ç†ï¼Œä¸åŒçš„ç‚¹å°±æ˜¯å°†pageæŸ¥è¯¢ç­‰éƒ½åˆ é™¤äº†ï¼Œåªç•™ä¸‹äº†ä¸€ä¸ªgetAllã€‚</p><ul><li><p>æµ‹è¯•çš„æ—¶å€™ï¼Œæ§åˆ¶å°æ‰“å°çš„æ—¥å¿—æ¯”è¾ƒå¤šï¼Œé€Ÿåº¦æœ‰ç‚¹æ…¢è€Œä¸”ä¸åˆ©äºæŸ¥çœ‹è¿è¡Œç»“æœï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠè¿™ä¸ªæ—¥å¿—å¤„ç†ä¸‹:</p><ul><li><p>å–æ¶ˆåˆå§‹åŒ–springæ—¥å¿—æ‰“å°ï¼Œresourcesç›®å½•ä¸‹æ·»åŠ logback.xmlï¼Œåç§°å›ºå®šï¼Œå†…å®¹å¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong> logback.xmlçš„é…ç½®å†…å®¹ï¼Œä¸æ˜¯æˆ‘ä»¬Mybatisplusçš„å†…å®¹ï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œç™¾åº¦æŸ¥è¯¢ã€‚</p></li><li><p>å–æ¶ˆMybatisPluså¯åŠ¨bannerå›¾æ ‡</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116195847.png" alt=""></p><p>application.ymlæ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mybatis-plusæ—¥å¿—æ§åˆ¶å°è¾“å‡º</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">    <span class="attr">global-config:</span></span><br><span class="line">         <span class="attr">banner:</span> <span class="string">off</span></span><br></pre></td></tr></table></figure></li><li><p>åŒæ—¶ä¹Ÿå¯ä»¥å–æ¶ˆSpringBootçš„logæ‰“å°<br>application.ymlæ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">banner-mode:</span> <span class="string">off</span> <span class="comment"># å…³é—­SpringBootå¯åŠ¨å›¾æ ‡(banner)</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>è§£å†³æ§åˆ¶å°æ‰“å°æ—¥å¿—è¿‡å¤šçš„ç›¸å…³æ“ä½œå¯ä»¥ä¸ç”¨å»åšï¼Œä¸€èˆ¬ä¼šè¢«ç”¨æ¥æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹ç¨‹åºè¿è¡Œçš„ç»“æœã€‚</p><h4 id="3-1-3-æ„å»ºæ¡ä»¶æŸ¥è¯¢"><a href="#3-1-3-æ„å»ºæ¡ä»¶æŸ¥è¯¢" class="headerlink" title="3.1.3 æ„å»ºæ¡ä»¶æŸ¥è¯¢"></a>3.1.3 æ„å»ºæ¡ä»¶æŸ¥è¯¢</h4><p>åœ¨è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„å…¥å£æ˜¯åœ¨Wrapperè¿™ä¸ªç±»ä¸Šï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ‰¾å®ƒå¯¹åº”çš„å®ç°ç±»ï¼Œå…³äºå®ç°ç±»ä¹Ÿæœ‰å¾ˆå¤šï¼Œè¯´æ˜æˆ‘ä»¬æœ‰å¤šç§æ„å»ºæŸ¥è¯¢æ¡ä»¶å¯¹è±¡çš„æ–¹å¼</p><ol><li>å…ˆæ¥çœ‹ç¬¬ä¸€ç§:==QueryWrapper==</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">QueryWrapper</span> <span class="variable">qw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>();</span><br><span class="line">        qw.lt(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(qw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>lt: å°äº(&lt;) ,æœ€ç»ˆçš„sqlè¯­å¥ä¸º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,password,age,tel <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (age <span class="operator">&lt;</span> ?)</span><br></pre></td></tr></table></figure></li></ul><p>ç¬¬ä¸€ç§æ–¹å¼ä»‹ç»å®Œåï¼Œæœ‰ä¸ªå°é—®é¢˜å°±æ˜¯åœ¨å†™æ¡ä»¶çš„æ—¶å€™ï¼Œå®¹æ˜“å‡ºé”™ï¼Œæ¯”å¦‚ageå†™é”™ï¼Œå°±ä¼šå¯¼è‡´æŸ¥è¯¢ä¸æˆåŠŸ</p><ol><li>æ¥ç€æ¥çœ‹ç¬¬äºŒç§:==QueryWrapperçš„åŸºç¡€ä¸Šä½¿ç”¨lambda==</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; qw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        qw.lambda().lt(User::getAge, <span class="number">10</span>);<span class="comment">//æ·»åŠ æ¡ä»¶</span></span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(qw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>User::getAget,ä¸ºlambdaè¡¨è¾¾å¼ä¸­çš„ï¼Œç±»å::æ–¹æ³•åï¼Œæœ€ç»ˆçš„sqlè¯­å¥ä¸º:</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,password,age,tel <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (age <span class="operator">&lt;</span> ?)</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> æ„å»ºLambdaQueryWrapperçš„æ—¶å€™æ³›å‹ä¸èƒ½çœã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬å†æ¬¡ç¼–å†™æ¡ä»¶çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå­˜åœ¨å†™é”™åç§°çš„æƒ…å†µï¼Œä½†æ˜¯qwåé¢å¤šäº†ä¸€å±‚lambda()è°ƒç”¨</p><ol><li>æ¥ç€æ¥çœ‹ç¬¬ä¸‰ç§:==LambdaQueryWrapper==</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.lt(User::getAge, <span class="number">10</span>);</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼å°±è§£å†³äº†ä¸Šä¸€ç§æ–¹å¼æ‰€å­˜åœ¨çš„é—®é¢˜ã€‚</p><h4 id="3-1-4-å¤šæ¡ä»¶æ„å»º"><a href="#3-1-4-å¤šæ¡ä»¶æ„å»º" class="headerlink" title="3.1.4 å¤šæ¡ä»¶æ„å»º"></a>3.1.4 å¤šæ¡ä»¶æ„å»º</h4><p>å­¦å®Œäº†ä¸‰ç§æ„å»ºæŸ¥è¯¢å¯¹è±¡çš„æ–¹å¼ï¼Œæ¯ä¸€ç§éƒ½æœ‰è‡ªå·±çš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥ç”¨å“ªä¸€ç§éƒ½è¡Œï¼Œåˆšæ‰éƒ½æ˜¯ä¸€ä¸ªæ¡ä»¶ï¼Œé‚£å¦‚æœæœ‰å¤šä¸ªæ¡ä»¶è¯¥å¦‚ä½•æ„å»ºå‘¢?</p><blockquote><p>éœ€æ±‚:æŸ¥è¯¢æ•°æ®åº“è¡¨ä¸­ï¼Œå¹´é¾„åœ¨10å²åˆ°30å²ä¹‹é—´çš„ç”¨æˆ·ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.lt(User::getAge, <span class="number">30</span>);</span><br><span class="line">        lqw.gt(User::getAge, <span class="number">10</span>);</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>gtï¼šå¤§äº(&gt;),æœ€ç»ˆçš„SQLè¯­å¥ä¸º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,password,age,tel <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (age <span class="operator">&lt;</span> ? <span class="keyword">AND</span> age <span class="operator">&gt;</span> ?)</span><br></pre></td></tr></table></figure></li><li><p>æ„å»ºå¤šæ¡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥æ”¯æŒé“¾å¼ç¼–ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">lqw.lt(User::getAge, <span class="number">30</span>).gt(User::getAge, <span class="number">10</span>);</span><br><span class="line">List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>éœ€æ±‚:æŸ¥è¯¢æ•°æ®åº“è¡¨ä¸­ï¼Œå¹´é¾„å°äº10æˆ–å¹´é¾„å¤§äº30çš„æ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.lt(User::getAge, <span class="number">10</span>).or().gt(User::getAge, <span class="number">30</span>);</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>or()å°±ç›¸å½“äºæˆ‘ä»¬sqlè¯­å¥ä¸­çš„<code>or</code>å…³é”®å­—,ä¸åŠ é»˜è®¤æ˜¯<code>and</code>ï¼Œæœ€ç»ˆçš„sqlè¯­å¥ä¸º:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,password,age,tel <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (age <span class="operator">&lt;</span> ? <span class="keyword">OR</span> age <span class="operator">&gt;</span> ?)</span><br></pre></td></tr></table></figure></li><li>å°å°ç»“ï¼š</li></ul><ul><li><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116201617.png" alt=""></li><li><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221116201931.png" alt=""></li></ul><h4 id="3-1-5-nullåˆ¤å®š"><a href="#3-1-5-nullåˆ¤å®š" class="headerlink" title="3.1.5 nullåˆ¤å®š"></a>3.1.5 nullåˆ¤å®š</h4><p>å¼•å…¥ï¼š</p><ul><li>æˆ‘ä»¬åœ¨åšæ¡ä»¶æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæœ‰å¾ˆå¤šæ¡ä»¶å¯ä»¥ä¾›ç”¨æˆ·è¿›è¡Œé€‰æ‹©æŸ¥è¯¢ã€‚</li><li>è¿™äº›æ¡ä»¶ç”¨æˆ·å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¹Ÿå¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨ï¼Œæ¯”å¦‚æˆ‘è¦æŸ¥è¯¢ä»·æ ¼åœ¨8000ä»¥ä¸Šçš„æ‰‹æœº</li><li>åœ¨è¾“å…¥æ¡ä»¶çš„æ—¶å€™ï¼Œä»·æ ¼æœ‰ä¸€ä¸ªåŒºé—´èŒƒå›´ï¼ŒæŒ‰ç…§éœ€æ±‚åªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªä»·æ ¼è¾“å…¥æ¡†ä¸­è¾“å…¥8000</li><li>åå°åœ¨åšä»·æ ¼æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šè®© price&gt;å€¼1 and price &lt;å€¼2</li><li>å› ä¸ºå‰ç«¯æ²¡æœ‰è¾“å…¥å€¼2ï¼Œæ‰€ä»¥å¦‚æœä¸å¤„ç†çš„è¯ï¼Œå°±ä¼šå‡ºç° price&gt;8000 and price &lt; nullé—®é¢˜</li><li>è¿™ä¸ªæ—¶å€™æŸ¥è¯¢çš„ç»“æœå°±ä¼šå‡ºé—®é¢˜ï¼Œå…·ä½“è¯¥å¦‚ä½•è§£å†³?</li></ul><blockquote><p>éœ€æ±‚:æŸ¥è¯¢æ•°æ®åº“è¡¨ä¸­ï¼Œæ ¹æ®è¾“å…¥å¹´é¾„èŒƒå›´æ¥æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„è®°å½•</p><p>ç”¨æˆ·åœ¨è¾“å…¥å€¼çš„æ—¶å€™ï¼Œ</p><p>â€‹    å¦‚æœåªè¾“å…¥ç¬¬ä¸€ä¸ªæ¡†ï¼Œè¯´æ˜è¦æŸ¥è¯¢å¤§äºè¯¥å¹´é¾„çš„ç”¨æˆ·</p><p>â€‹    å¦‚æœåªè¾“å…¥ç¬¬äºŒä¸ªæ¡†ï¼Œè¯´æ˜è¦æŸ¥è¯¢å°äºè¯¥å¹´é¾„çš„ç”¨æˆ·</p><p>â€‹    å¦‚æœä¸¤ä¸ªæ¡†éƒ½è¾“å…¥äº†ï¼Œè¯´æ˜è¦æŸ¥è¯¢å¹´é¾„åœ¨ä¸¤ä¸ªèŒƒå›´ä¹‹é—´çš„ç”¨æˆ·</p></blockquote><p>æ€è€ƒç¬¬ä¸€ä¸ªé—®é¢˜ï¼šåå°å¦‚æœæƒ³æ¥æ”¶å‰ç«¯çš„ä¸¤ä¸ªæ•°æ®ï¼Œè¯¥å¦‚ä½•æ¥æ”¶?</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç®€å•æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¨¡å‹ç±»ï¼Œä½†æ˜¯Userç±»ä¸­ç›®å‰åªæœ‰ä¸€ä¸ªageå±æ€§,å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€ä¸ªageå±æ€§ï¼Œå¦‚ä½•å»æ¥æ”¶é¡µé¢ä¸Šçš„ä¸¤ä¸ªå€¼å‘¢?è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æœ‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆ</p><p>æ–¹æ¡ˆä¸€:æ·»åŠ å±æ€§age2,è¿™ç§åšæ³•å¯ä»¥ä½†æ˜¯ä¼šå½±å“åˆ°åŸæ¨¡å‹ç±»çš„å±æ€§å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> Integer age2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆäºŒ:æ–°å»ºä¸€ä¸ªæ¨¡å‹ç±»,è®©å…¶ç»§æ‰¿Userç±»ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ age2å±æ€§ï¼ŒUserQueryåœ¨æ‹¥æœ‰Userå±æ€§ååŒæ—¶æ·»åŠ äº†age2å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer age2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå‡†å¤‡å¥½åï¼Œæˆ‘ä»¬æ¥å®ç°ä¸‹åˆšæ‰çš„éœ€æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿé¡µé¢ä¼ é€’è¿‡æ¥çš„æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        <span class="type">UserQuery</span> <span class="variable">uq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>();</span><br><span class="line">        uq.setAge(<span class="number">10</span>);</span><br><span class="line">        uq.setAge2(<span class="number">30</span>);</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">null</span> != uq.getAge2())&#123;</span><br><span class="line">            lqw.lt(User::getAge, uq.getAge2());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( <span class="literal">null</span> != uq.getAge()) &#123;</span><br><span class="line">            lqw.gt(User::getAge, uq.getAge());</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å†™æ³•å¯ä»¥å®Œæˆæ¡ä»¶ä¸ºéç©ºçš„åˆ¤æ–­ï¼Œä½†æ˜¯é—®é¢˜å¾ˆæ˜æ˜¾ï¼Œå¦‚æœæ¡ä»¶å¤šçš„è¯ï¼Œæ¯ä¸ªæ¡ä»¶éƒ½éœ€è¦åˆ¤æ–­ï¼Œä»£ç é‡å°±æ¯”è¾ƒå¤§ï¼Œæ¥çœ‹MPç»™æˆ‘ä»¬æä¾›çš„ç®€åŒ–æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿé¡µé¢ä¼ é€’è¿‡æ¥çš„æŸ¥è¯¢æ•°æ®</span></span><br><span class="line">        <span class="type">UserQuery</span> <span class="variable">uq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>();</span><br><span class="line">        uq.setAge(<span class="number">10</span>);</span><br><span class="line">        uq.setAge2(<span class="number">30</span>);</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.lt(<span class="literal">null</span>!=uq.getAge2(),User::getAge, uq.getAge2());</span><br><span class="line">        lqw.gt(<span class="literal">null</span>!=uq.getAge(),User::getAge, uq.getAge());</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>nullåˆ¤æ–­å°ç»“ï¼š</p><p>æ·»åŠ ä¸€ä¸ªç©ºå€¼åˆ¤å®š null!=uq.getAge2() ä¸ºç¬¬ä¸€ä¸ªvalue</p><p>conditionä¸ºbooleanç±»å‹ï¼Œè¿”å›trueï¼Œåˆ™æ·»åŠ æ¡ä»¶ï¼Œè¿”å›falseåˆ™ä¸æ·»åŠ æ¡ä»¶</p></li></ul><h3 id="3-2-æŸ¥è¯¢æŠ•å½±"><a href="#3-2-æŸ¥è¯¢æŠ•å½±" class="headerlink" title="3.2 æŸ¥è¯¢æŠ•å½±"></a>3.2 æŸ¥è¯¢æŠ•å½±</h3><h4 id="3-2-1-æŸ¥è¯¢æŒ‡å®šå­—æ®µ"><a href="#3-2-1-æŸ¥è¯¢æŒ‡å®šå­—æ®µ" class="headerlink" title="3.2.1 æŸ¥è¯¢æŒ‡å®šå­—æ®µ"></a>3.2.1 æŸ¥è¯¢æŒ‡å®šå­—æ®µ</h4><p>ç›®å‰æˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰åšé»˜è®¤å°±æ˜¯æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰å­—æ®µçš„å†…å®¹ï¼Œæˆ‘ä»¬æ‰€è¯´çš„æŸ¥è¯¢æŠ•å½±å³ä¸æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼ŒåªæŸ¥è¯¢å‡ºæŒ‡å®šå†…å®¹çš„æ•°æ®ã€‚</p><p>å…·ä½“å¦‚ä½•æ¥å®ç°?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.select(User::getId,User::getName,User::getAge);</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>select(â€¦)æ–¹æ³•ç”¨æ¥è®¾ç½®æŸ¥è¯¢çš„å­—æ®µåˆ—ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œæœ€ç»ˆçš„sqlè¯­å¥ä¸º:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,age <span class="keyword">FROM</span> <span class="keyword">user</span></span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœä½¿ç”¨çš„ä¸æ˜¯lambdaï¼Œå°±éœ€è¦æ‰‹åŠ¨æŒ‡å®šå­—æ®µï¼Œä½¿ç”¨å­—ç¬¦ä¸²çš„å½¢å¼è¡¨ç¤º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;tel&quot;</span>);</span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€ç»ˆçš„sqlè¯­å¥ä¸º:SELECT id,name,age,tel FROM user</li></ul></li><li><p>å¦‚æœæƒ³è¦æŸ¥è¯¢å…¨éƒ¨å¹¶è®¡æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// æŸ¥è¯¢æŠ•å½±</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">lambdaQueryWrapper.select(User::getAge,User::getId);</span><br><span class="line">QueryWrapper&lt;User&gt; qw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">QueryWrapper&lt;User&gt; qm = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">qw.select(<span class="string">&quot;count(*) as count&quot;</span>);<span class="comment">//è¿™é‡Œæ˜¯è®¾ç½®åˆ«å</span></span><br><span class="line">qm.select(<span class="string">&quot;count(*) as count, tel&quot;</span>);</span><br><span class="line">qm.groupBy(<span class="string">&quot;tel&quot;</span>);<span class="comment">//åˆ†é¡µï¼Œä»¥åŠcountå’Œtelå¯¹åº”</span></span><br><span class="line">List&lt;User&gt; list = userDao.selectList(lambdaQueryWrapper);</span><br><span class="line">System.out.println(list);</span><br><span class="line">System.out.println(<span class="string">&quot;------------------------------------------------------&quot;</span>);</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; maps = userDao.selectMaps(qm);</span><br><span class="line">System.out.println(maps);</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> è¿™é‡Œå¦‚æœä½¿ç”¨listçš„è¯æ˜¯æ— æ³•è¿›è¡Œè®¡æ•°çš„ï¼ŒUseræ— æ³•åœ¨æ­¤å¤„ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨MPå†…ç½®çš„Mapæ¥ä½œä¸ºå®¹å™¨ã€‚</p></li></ul><p><em>å…³äºèŒƒå›´çš„æŸ¥è¯¢ä¸æ­¢è¿™äº›ï¼šltï¼Œleï¼Œgtï¼Œgeï¼Œbetweenï¼Œç”šè‡³eqä¹Ÿç®—æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚</em></p><h4 id="3-2-2-èšåˆæŸ¥è¯¢"><a href="#3-2-2-èšåˆæŸ¥è¯¢" class="headerlink" title="3.2.2 èšåˆæŸ¥è¯¢"></a>3.2.2 èšåˆæŸ¥è¯¢</h4><blockquote><p>éœ€æ±‚:èšåˆå‡½æ•°æŸ¥è¯¢ï¼Œå®Œæˆcountã€maxã€minã€avgã€sumçš„ä½¿ç”¨</p><p>count:æ€»è®°å½•æ•°</p><p>max:æœ€å¤§å€¼</p><p>min:æœ€å°å€¼</p><p>avg:å¹³å‡å€¼</p><p>sum:æ±‚å’Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        <span class="comment">//lqw.select(&quot;count(*) as count&quot;);</span></span><br><span class="line">        <span class="comment">//SELECT count(*) as count FROM user</span></span><br><span class="line">        <span class="comment">//lqw.select(&quot;max(age) as maxAge&quot;);</span></span><br><span class="line">        <span class="comment">//SELECT max(age) as maxAge FROM user</span></span><br><span class="line">        <span class="comment">//lqw.select(&quot;min(age) as minAge&quot;);</span></span><br><span class="line">        <span class="comment">//SELECT min(age) as minAge FROM user</span></span><br><span class="line">        <span class="comment">//lqw.select(&quot;sum(age) as sumAge&quot;);</span></span><br><span class="line">        <span class="comment">//SELECT sum(age) as sumAge FROM user</span></span><br><span class="line">        lqw.select(<span class="string">&quot;avg(age) as avgAge&quot;</span>);</span><br><span class="line">        <span class="comment">//SELECT avg(age) as avgAge FROM user</span></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; userList = userDao.selectMaps(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†åœ¨åšç»“æœå°è£…çš„æ—¶å€™èƒ½å¤Ÿæ›´ç®€å•ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„èšåˆå‡½æ•°éƒ½èµ·äº†ä¸ªåç§°ï¼Œæ–¹é¢åæœŸæ¥è·å–è¿™äº›æ•°æ®</p><h4 id="3-2-3-åˆ†ç»„æŸ¥è¯¢"><a href="#3-2-3-åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="3.2.3 åˆ†ç»„æŸ¥è¯¢"></a>3.2.3 åˆ†ç»„æŸ¥è¯¢</h4><blockquote><p>éœ€æ±‚:åˆ†ç»„æŸ¥è¯¢ï¼Œå®Œæˆ group byçš„æŸ¥è¯¢ä½¿ç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        QueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.select(<span class="string">&quot;count(*) as count,tel&quot;</span>);</span><br><span class="line">        lqw.groupBy(<span class="string">&quot;tel&quot;</span>);</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = userDao.selectMaps(lqw);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>groupByä¸ºåˆ†ç»„ï¼Œæœ€ç»ˆçš„sqlè¯­å¥ä¸º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> count,tel <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> tel</span><br></pre></td></tr></table></figure></li></ul><p><strong>æ³¨æ„:</strong></p><ul><li>èšåˆä¸åˆ†ç»„æŸ¥è¯¢ï¼Œæ— æ³•ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥å®Œæˆ</li><li>MPåªæ˜¯å¯¹MyBatisçš„å¢å¼ºï¼Œå¦‚æœMPå®ç°ä¸äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨DAOæ¥å£ä¸­ä½¿ç”¨MyBatisçš„æ–¹å¼å®ç°</li></ul><h3 id="3-3-æŸ¥è¯¢æ¡ä»¶"><a href="#3-3-æŸ¥è¯¢æ¡ä»¶" class="headerlink" title="3.3 æŸ¥è¯¢æ¡ä»¶"></a>3.3 æŸ¥è¯¢æ¡ä»¶</h3><p>å‰é¢æˆ‘ä»¬åªä½¿ç”¨äº†lt()å’Œgt(),é™¤äº†è¿™ä¸¤ä¸ªæ–¹æ³•å¤–ï¼ŒMPè¿˜å°è£…äº†å¾ˆå¤šæ¡ä»¶å¯¹åº”çš„æ–¹æ³•ï¼Œè¿™ä¸€èŠ‚æˆ‘ä»¬é‡ç‚¹æŠŠMPæä¾›çš„æŸ¥è¯¢æ¡ä»¶æ–¹æ³•è¿›è¡Œå­¦ä¹ ä¸‹ã€‚</p><p>MPçš„æŸ¥è¯¢æ¡ä»¶æœ‰å¾ˆå¤š:</p><ul><li>èŒƒå›´åŒ¹é…ï¼ˆ&gt; ã€ = ã€betweenï¼‰</li><li>æ¨¡ç³ŠåŒ¹é…ï¼ˆlikeï¼‰</li><li>ç©ºåˆ¤å®šï¼ˆnullï¼‰</li><li>åŒ…å«æ€§åŒ¹é…ï¼ˆinï¼‰</li><li>åˆ†ç»„ï¼ˆgroupï¼‰</li><li>æ’åºï¼ˆorderï¼‰</li><li>â€¦â€¦</li></ul><h4 id="3-3-1-ç­‰å€¼æŸ¥è¯¢"><a href="#3-3-1-ç­‰å€¼æŸ¥è¯¢" class="headerlink" title="3.3.1 ç­‰å€¼æŸ¥è¯¢"></a>3.3.1 ç­‰å€¼æŸ¥è¯¢</h4><blockquote><p>éœ€æ±‚:æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.eq(User::getName, <span class="string">&quot;Jerry&quot;</span>).eq(User::getPassword, <span class="string">&quot;jerry&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">loginUser</span> <span class="operator">=</span> userDao.selectOne(lqw);</span><br><span class="line">        System.out.println(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>eq()ï¼š ç›¸å½“äº <code>=</code>,å¯¹åº”çš„sqlè¯­å¥ä¸º</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,name,password,age,tel <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> (name <span class="operator">=</span> ? <span class="keyword">AND</span> password <span class="operator">=</span> ?)</span><br></pre></td></tr></table></figure></li><li><p>selectListï¼šæŸ¥è¯¢ç»“æœä¸ºå¤šä¸ªæˆ–è€…å•ä¸ª</p></li><li><p>selectOne:æŸ¥è¯¢ç»“æœä¸ºå•ä¸ª</p></li></ul><h4 id="3-3-2-èŒƒå›´æŸ¥è¯¢"><a href="#3-3-2-èŒƒå›´æŸ¥è¯¢" class="headerlink" title="3.3.2 èŒƒå›´æŸ¥è¯¢"></a>3.3.2 èŒƒå›´æŸ¥è¯¢</h4><blockquote><p>éœ€æ±‚:å¯¹å¹´é¾„è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä½¿ç”¨lt()ã€le()ã€gt()ã€ge()ã€between()è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.between(User::getAge, <span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">        <span class="comment">//SELECT id,name,password,age,tel FROM user WHERE (age BETWEEN ? AND ?)</span></span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>gt():å¤§äº(&gt;)</li><li>ge():å¤§äºç­‰äº(&gt;=)</li><li>lt():å°äº(&lt;)</li><li>lte():å°äºç­‰äº(&lt;=)</li><li>between():between ? and ?</li></ul><h4 id="3-3-3-æ¨¡ç³ŠæŸ¥è¯¢"><a href="#3-3-3-æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="3.3.3 æ¨¡ç³ŠæŸ¥è¯¢"></a>3.3.3 æ¨¡ç³ŠæŸ¥è¯¢</h4><blockquote><p>éœ€æ±‚:æŸ¥è¯¢è¡¨ä¸­nameå±æ€§çš„å€¼ä»¥<code>J</code>å¼€å¤´çš„ç”¨æˆ·ä¿¡æ¯,ä½¿ç”¨likeè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;();</span><br><span class="line">        lqw.likeLeft(User::getName, <span class="string">&quot;J&quot;</span>);</span><br><span class="line">        <span class="comment">//SELECT id,name,password,age,tel FROM user WHERE (name LIKE ?)</span></span><br><span class="line">        List&lt;User&gt; userList = userDao.selectList(lqw);</span><br><span class="line">        System.out.println(userList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>like():å‰ååŠ ç™¾åˆ†å·,å¦‚ %J%</li><li>likeLeft():å‰é¢åŠ ç™¾åˆ†å·,å¦‚ %J</li><li>likeRight():åé¢åŠ ç™¾åˆ†å·,å¦‚ J%</li></ul><h4 id="3-3-4-æ’åºæŸ¥è¯¢"><a href="#3-3-4-æ’åºæŸ¥è¯¢" class="headerlink" title="3.3.4 æ’åºæŸ¥è¯¢"></a>3.3.4 æ’åºæŸ¥è¯¢</h4><blockquote><p>éœ€æ±‚:æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œç„¶åæŒ‰ç…§idé™åº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus02DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; lwq = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * condition ï¼šæ¡ä»¶ï¼Œè¿”å›booleanï¼Œ</span></span><br><span class="line"><span class="comment">         å½“conditionä¸ºtrueï¼Œè¿›è¡Œæ’åºï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™ä¸æ’åº</span></span><br><span class="line"><span class="comment">         * isAsc:æ˜¯å¦ä¸ºå‡åºï¼Œtrueä¸ºå‡åºï¼Œfalseä¸ºé™åº</span></span><br><span class="line"><span class="comment">         * columnsï¼šéœ€è¦æ“ä½œçš„åˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        lwq.orderBy(<span class="literal">true</span>,<span class="literal">false</span>, User::getId);</span><br><span class="line"></span><br><span class="line">        userDao.selectList(lw);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸Šé¢æ¼”ç¤ºçš„è¿™ç§å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ’åºæ–¹æ³•å¯ä»¥è¢«è°ƒç”¨,å¦‚ä¸‹ï¼š</p><ul><li>orderByæ’åº<ul><li>condition:æ¡ä»¶ï¼Œtrueåˆ™æ·»åŠ æ’åºï¼Œfalseåˆ™ä¸æ·»åŠ æ’åº</li><li>isAsc:æ˜¯å¦ä¸ºå‡åºï¼Œtrueå‡åºï¼Œfalseé™åº</li><li>columns:æ’åºå­—æ®µï¼Œå¯ä»¥æœ‰å¤šä¸ª</li></ul></li><li>orderByAsc/Desc(å•ä¸ªcolumn):æŒ‰ç…§æŒ‡å®šå­—æ®µè¿›è¡Œå‡åº/é™åº</li><li>orderByAsc/Desc(å¤šä¸ªcolumn):æŒ‰ç…§å¤šä¸ªå­—æ®µè¿›è¡Œå‡åº/é™åº</li><li>orderByAsc/Desc<ul><li>condition:æ¡ä»¶ï¼Œtrueæ·»åŠ æ’åºï¼Œfalseä¸æ·»åŠ æ’åº</li><li>å¤šä¸ªcolumnsï¼šæŒ‰ç…§å¤šä¸ªå­—æ®µè¿›è¡Œæ’åº</li></ul></li></ul><p>é™¤äº†ä¸Šé¢ä»‹ç»çš„è¿™å‡ ç§æŸ¥è¯¢æ¡ä»¶æ„å»ºæ–¹æ³•ä»¥å¤–è¿˜ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚isNull,isNotNull,in,notInç­‰ç­‰æ–¹æ³•å¯ä¾›é€‰æ‹©ï¼Œå…·ä½“å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„æ¡ä»¶æ„é€ å™¨æ¥å­¦ä¹ ä½¿ç”¨ï¼Œå…·ä½“çš„ç½‘å€ä¸º:</p><p><code>https://mp.baomidou.com/guide/wrapper.html#abstractwrapper</code></p><h3 id="3-4-æ˜ å°„åŒ¹é…å…¼å®¹æ€§"><a href="#3-4-æ˜ å°„åŒ¹é…å…¼å®¹æ€§" class="headerlink" title="3.4 æ˜ å°„åŒ¹é…å…¼å®¹æ€§"></a>3.4 æ˜ å°„åŒ¹é…å…¼å®¹æ€§</h3><p>å‰é¢æˆ‘ä»¬å·²ç»èƒ½ä»è¡¨ä¸­æŸ¥è¯¢å‡ºæ•°æ®ï¼Œå¹¶å°†æ•°æ®å°è£…åˆ°æ¨¡å‹ç±»ä¸­ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°ä¸€å¼ è¡¨å’Œä¸€ä¸ªæ¨¡å‹ç±»:</p><ol><li>sqlè¡¨</li><li>åœ¨domainä¸­åˆ›å»ºçš„æ¨¡å‹ç±»</li></ol><p>ä¹‹æ‰€ä»¥æ•°æ®èƒ½å¤ŸæˆåŠŸçš„ä»è¡¨ä¸­è·å–å¹¶å°è£…åˆ°æ¨¡å‹å¯¹è±¡ä¸­ï¼ŒåŸå› æ˜¯è¡¨çš„å­—æ®µåˆ—åå’Œæ¨¡å‹ç±»çš„å±æ€§åä¸€æ ·ã€‚</p><p>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†:</p><h4 id="é—®é¢˜1-è¡¨å­—æ®µä¸ç¼–ç å±æ€§è®¾è®¡ä¸åŒæ­¥"><a href="#é—®é¢˜1-è¡¨å­—æ®µä¸ç¼–ç å±æ€§è®¾è®¡ä¸åŒæ­¥" class="headerlink" title="é—®é¢˜1:è¡¨å­—æ®µä¸ç¼–ç å±æ€§è®¾è®¡ä¸åŒæ­¥"></a>é—®é¢˜1:è¡¨å­—æ®µä¸ç¼–ç å±æ€§è®¾è®¡ä¸åŒæ­¥</h4><p>å½“è¡¨çš„åˆ—åå’Œæ¨¡å‹ç±»çš„å±æ€§åå‘ç”Ÿä¸ä¸€è‡´ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®å°è£…ä¸åˆ°æ¨¡å‹å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å…¶ä¸­ä¸€æ–¹åšå‡ºä¿®æ”¹ï¼Œé‚£å¦‚æœå‰ææ˜¯ä¸¤è¾¹éƒ½ä¸èƒ½æ”¹åˆè¯¥å¦‚ä½•è§£å†³?</p><p>MPç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ³¨è§£<code>@TableField</code>,ä½¿ç”¨è¯¥æ³¨è§£å¯ä»¥å®ç°æ¨¡å‹ç±»å±æ€§åå’Œè¡¨çš„åˆ—åä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼ˆä¸‹é¢ä¼šåšå‡ºä»£ç æ¼”ç¤ºï¼‰</p><h4 id="é—®é¢˜2-ç¼–ç ä¸­æ·»åŠ äº†æ•°æ®åº“ä¸­æœªå®šä¹‰çš„å±æ€§"><a href="#é—®é¢˜2-ç¼–ç ä¸­æ·»åŠ äº†æ•°æ®åº“ä¸­æœªå®šä¹‰çš„å±æ€§" class="headerlink" title="é—®é¢˜2:ç¼–ç ä¸­æ·»åŠ äº†æ•°æ®åº“ä¸­æœªå®šä¹‰çš„å±æ€§"></a>é—®é¢˜2:ç¼–ç ä¸­æ·»åŠ äº†æ•°æ®åº“ä¸­æœªå®šä¹‰çš„å±æ€§</h4><p>å½“æ¨¡å‹ç±»ä¸­å¤šäº†ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸å­˜åœ¨çš„å­—æ®µï¼Œå°±ä¼šå¯¼è‡´ç”Ÿæˆçš„sqlè¯­å¥ä¸­åœ¨selectçš„æ—¶å€™æŸ¥è¯¢äº†æ•°æ®åº“ä¸å­˜åœ¨çš„å­—æ®µï¼Œç¨‹åºè¿è¡Œå°±ä¼šæŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯ä¸º:</p><p>==Unknown column â€˜å¤šå‡ºæ¥çš„å­—æ®µåç§°â€™ in â€˜field listâ€™==</p><p>å…·ä½“çš„è§£å†³æ–¹æ¡ˆç”¨åˆ°çš„è¿˜æ˜¯<code>@TableField</code>æ³¨è§£ï¼Œå®ƒæœ‰ä¸€ä¸ªå±æ€§å«<code>exist</code>ï¼Œè®¾ç½®è¯¥å­—æ®µæ˜¯å¦åœ¨æ•°æ®åº“è¡¨ä¸­å­˜åœ¨ï¼Œå¦‚æœè®¾ç½®ä¸ºfalseåˆ™ä¸å­˜åœ¨ï¼Œç”Ÿæˆsqlè¯­å¥æŸ¥è¯¢çš„æ—¶å€™ï¼Œå°±ä¸ä¼šå†æŸ¥è¯¢è¯¥å­—æ®µäº†ã€‚ï¼ˆåŒæ ·çš„åœ¨ä¸‹é¢åšå‡ºä»£ç æ¼”ç¤ºï¼‰</p><h4 id="é—®é¢˜3ï¼šé‡‡ç”¨é»˜è®¤æŸ¥è¯¢å¼€æ”¾äº†æ›´å¤šçš„å­—æ®µæŸ¥çœ‹æƒé™"><a href="#é—®é¢˜3ï¼šé‡‡ç”¨é»˜è®¤æŸ¥è¯¢å¼€æ”¾äº†æ›´å¤šçš„å­—æ®µæŸ¥çœ‹æƒé™" class="headerlink" title="é—®é¢˜3ï¼šé‡‡ç”¨é»˜è®¤æŸ¥è¯¢å¼€æ”¾äº†æ›´å¤šçš„å­—æ®µæŸ¥çœ‹æƒé™"></a>é—®é¢˜3ï¼šé‡‡ç”¨é»˜è®¤æŸ¥è¯¢å¼€æ”¾äº†æ›´å¤šçš„å­—æ®µæŸ¥çœ‹æƒé™</h4><p>æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰çš„åˆ—çš„æ•°æ®ï¼Œå°±å¯èƒ½æŠŠä¸€äº›æ•æ„Ÿæ•°æ®æŸ¥è¯¢åˆ°è¿”å›ç»™å‰ç«¯ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦é™åˆ¶å“ªäº›å­—æ®µé»˜è®¤ä¸è¦è¿›è¡ŒæŸ¥è¯¢ã€‚è§£å†³æ–¹æ¡ˆæ˜¯<code>@TableField</code>æ³¨è§£çš„ä¸€ä¸ªå±æ€§å«<code>select</code>ï¼Œè¯¥å±æ€§è®¾ç½®é»˜è®¤æ˜¯å¦éœ€è¦æŸ¥è¯¢è¯¥å­—æ®µçš„å€¼ï¼Œtrue(é»˜è®¤å€¼)è¡¨ç¤ºé»˜è®¤æŸ¥è¯¢è¯¥å­—æ®µï¼Œfalseè¡¨ç¤ºé»˜è®¤ä¸æŸ¥è¯¢è¯¥å­—æ®µã€‚</p><h4 id="çŸ¥è¯†ç‚¹1ï¼š-TableField"><a href="#çŸ¥è¯†ç‚¹1ï¼š-TableField" class="headerlink" title="çŸ¥è¯†ç‚¹1ï¼š@TableField"></a>çŸ¥è¯†ç‚¹1ï¼š@TableField</h4><div class="table-container"><table><thead><tr><th>åç§°</th><th>@TableField</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>==å±æ€§æ³¨è§£==</td></tr><tr><td>ä½ç½®</td><td>æ¨¡å‹ç±»å±æ€§å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰å±æ€§å¯¹åº”çš„æ•°æ®åº“è¡¨ä¸­çš„å­—æ®µå…³ç³»</td></tr><tr><td>ç›¸å…³å±æ€§</td><td>value(é»˜è®¤)ï¼šè®¾ç½®æ•°æ®åº“è¡¨å­—æ®µåç§°<br/>exist:è®¾ç½®å±æ€§åœ¨æ•°æ®åº“è¡¨å­—æ®µä¸­æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤ä¸ºtrueï¼Œæ­¤å±æ€§ä¸èƒ½ä¸valueåˆå¹¶ä½¿ç”¨<br/>select:è®¾ç½®å±æ€§æ˜¯å¦å‚ä¸æŸ¥è¯¢ï¼Œæ­¤å±æ€§ä¸select()æ˜ å°„é…ç½®ä¸å†²çª</td></tr></tbody></table></div><h4 id="é—®é¢˜4-è¡¨åä¸ç¼–ç å¼€å‘è®¾è®¡ä¸åŒæ­¥"><a href="#é—®é¢˜4-è¡¨åä¸ç¼–ç å¼€å‘è®¾è®¡ä¸åŒæ­¥" class="headerlink" title="é—®é¢˜4:è¡¨åä¸ç¼–ç å¼€å‘è®¾è®¡ä¸åŒæ­¥"></a>é—®é¢˜4:è¡¨åä¸ç¼–ç å¼€å‘è®¾è®¡ä¸åŒæ­¥</h4><p>è¯¥é—®é¢˜ä¸»è¦æ˜¯è¡¨çš„åç§°å’Œæ¨¡å‹ç±»çš„åç§°ä¸ä¸€è‡´ï¼Œå¯¼è‡´æŸ¥è¯¢å¤±è´¥ï¼Œè¿™ä¸ªæ—¶å€™é€šå¸¸ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ä¿¡æ¯:</p><p>==Table â€˜databaseName.tableNaemâ€™ doesnâ€™t exist==,ç¿»è¯‘è¿‡æ¥å°±æ˜¯æ•°æ®åº“ä¸­çš„è¡¨ä¸å­˜åœ¨ã€‚</p><p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨MPæä¾›çš„å¦å¤–ä¸€ä¸ªæ³¨è§£<code>@TableName</code>æ¥è®¾ç½®è¡¨ä¸æ¨¡å‹ç±»ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚</p><h4 id="çŸ¥è¯†ç‚¹2ï¼š-TableName"><a href="#çŸ¥è¯†ç‚¹2ï¼š-TableName" class="headerlink" title="çŸ¥è¯†ç‚¹2ï¼š@TableName"></a>çŸ¥è¯†ç‚¹2ï¼š@TableName</h4><div class="table-container"><table><thead><tr><th>åç§°</th><th>@TableName</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>==ç±»æ³¨è§£==</td></tr><tr><td>ä½ç½®</td><td>æ¨¡å‹ç±»å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰ç±»å¯¹åº”äºæ•°æ®åº“è¡¨å…³ç³»</td></tr><tr><td>ç›¸å…³å±æ€§</td><td>value(é»˜è®¤)ï¼šè®¾ç½®æ•°æ®åº“è¡¨åç§°</td></tr></tbody></table></div><h4 id="ä»£ç æ¼”ç¤º"><a href="#ä»£ç æ¼”ç¤º" class="headerlink" title="ä»£ç æ¼”ç¤º"></a>ä»£ç æ¼”ç¤º</h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨æ¡ˆä¾‹çš„æ–¹å¼æŠŠåˆšæ‰çš„çŸ¥è¯†æ¼”ç¤ºä¸‹:</p><h5 id="æ­¥éª¤1-ä¿®æ”¹æ•°æ®åº“è¡¨userä¸ºtbl-user"><a href="#æ­¥éª¤1-ä¿®æ”¹æ•°æ®åº“è¡¨userä¸ºtbl-user" class="headerlink" title="æ­¥éª¤1:ä¿®æ”¹æ•°æ®åº“è¡¨userä¸ºtbl_user"></a>æ­¥éª¤1:ä¿®æ”¹æ•°æ®åº“è¡¨userä¸ºtbl_user</h5><p>ç›´æ¥æŸ¥è¯¢ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯MPé»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨æ¨¡å‹ç±»çš„ç±»åé¦–å­—æ¯å°å†™å½“è¡¨åä½¿ç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨ç ‚é”…é¢çš„æ³¨è§£æ·»åŠ å¯¹åº”çš„è¡¨åã€‚</p><h5 id="æ­¥éª¤2-æ¨¡å‹ç±»æ·»åŠ -TableNameæ³¨è§£"><a href="#æ­¥éª¤2-æ¨¡å‹ç±»æ·»åŠ -TableNameæ³¨è§£" class="headerlink" title="æ­¥éª¤2:æ¨¡å‹ç±»æ·»åŠ @TableNameæ³¨è§£"></a>æ­¥éª¤2:æ¨¡å‹ç±»æ·»åŠ @TableNameæ³¨è§£</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3-å°†å­—æ®µpasswordä¿®æ”¹æˆpwd"><a href="#æ­¥éª¤3-å°†å­—æ®µpasswordä¿®æ”¹æˆpwd" class="headerlink" title="æ­¥éª¤3:å°†å­—æ®µpasswordä¿®æ”¹æˆpwd"></a>æ­¥éª¤3:å°†å­—æ®µpasswordä¿®æ”¹æˆpwd</h5><p>ç›´æ¥æŸ¥è¯¢ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯MPé»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨æ¨¡å‹ç±»çš„å±æ€§åå½“åšè¡¨çš„åˆ—åä½¿ç”¨</p><h5 id="æ­¥éª¤4ï¼šä½¿ç”¨-TableFieldæ˜ å°„å…³ç³»"><a href="#æ­¥éª¤4ï¼šä½¿ç”¨-TableFieldæ˜ å°„å…³ç³»" class="headerlink" title="æ­¥éª¤4ï¼šä½¿ç”¨@TableFieldæ˜ å°„å…³ç³»"></a>æ­¥éª¤4ï¼šä½¿ç”¨@TableFieldæ˜ å°„å…³ç³»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤5-æ·»åŠ ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸å­˜åœ¨çš„å­—æ®µ"><a href="#æ­¥éª¤5-æ·»åŠ ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸å­˜åœ¨çš„å­—æ®µ" class="headerlink" title="æ­¥éª¤5:æ·»åŠ ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸å­˜åœ¨çš„å­—æ®µ"></a>æ­¥éª¤5:æ·»åŠ ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸å­˜åœ¨çš„å­—æ®µ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æŸ¥è¯¢ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯MPé»˜è®¤æƒ…å†µä¸‹ä¼šæŸ¥è¯¢æ¨¡å‹ç±»çš„æ‰€æœ‰å±æ€§å¯¹åº”çš„æ•°æ®åº“è¡¨çš„åˆ—ï¼Œè€Œonlineä¸å­˜åœ¨ã€‚</p><h5 id="æ­¥éª¤6ï¼šä½¿ç”¨-TableFieldæ’é™¤å­—æ®µ"><a href="#æ­¥éª¤6ï¼šä½¿ç”¨-TableFieldæ’é™¤å­—æ®µ" class="headerlink" title="æ­¥éª¤6ï¼šä½¿ç”¨@TableFieldæ’é™¤å­—æ®µ"></a>æ­¥éª¤6ï¼šä½¿ç”¨@TableFieldæ’é™¤å­—æ®µ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤7-æŸ¥è¯¢æ—¶å°†pwdéšè—"><a href="#æ­¥éª¤7-æŸ¥è¯¢æ—¶å°†pwdéšè—" class="headerlink" title="æ­¥éª¤7:æŸ¥è¯¢æ—¶å°†pwdéšè—"></a>æ­¥éª¤7:æŸ¥è¯¢æ—¶å°†pwdéšè—</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ï¼ŒDMLç¼–ç¨‹æ§åˆ¶"><a href="#4ï¼ŒDMLç¼–ç¨‹æ§åˆ¶" class="headerlink" title="4ï¼ŒDMLç¼–ç¨‹æ§åˆ¶"></a>4ï¼ŒDMLç¼–ç¨‹æ§åˆ¶</h2><p>æŸ¥è¯¢ç›¸å…³çš„æ“ä½œæˆ‘ä»¬å·²ç»ä»‹ç»å®Œäº†ï¼Œç´§æ¥ç€æˆ‘ä»¬éœ€è¦å¯¹å¦å¤–ä¸‰ä¸ªï¼Œå¢åˆ æ”¹è¿›è¡Œå†…å®¹çš„è®²è§£ã€‚æŒ¨ä¸ªæ¥è¯´æ˜ä¸‹ï¼Œé¦–å…ˆæ˜¯æ–°å¢(insert)ä¸­çš„å†…å®¹ã€‚</p><h3 id="4-1-idç”Ÿæˆç­–ç•¥æ§åˆ¶"><a href="#4-1-idç”Ÿæˆç­–ç•¥æ§åˆ¶" class="headerlink" title="4.1 idç”Ÿæˆç­–ç•¥æ§åˆ¶"></a>4.1 idç”Ÿæˆç­–ç•¥æ§åˆ¶</h3><p>å‰é¢æˆ‘ä»¬åœ¨æ–°å¢çš„æ—¶å€™ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ–°å¢æˆåŠŸåï¼Œä¸»é”®IDæ˜¯ä¸€ä¸ªå¾ˆé•¿ä¸²çš„å†…å®¹ï¼Œæˆ‘ä»¬æ›´æƒ³è¦çš„æ˜¯æŒ‰ç…§æ•°æ®åº“è¡¨å­—æ®µè¿›è¡Œè‡ªå¢é•¿ï¼Œåœ¨è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹IDè¯¥å¦‚ä½•é€‰æ‹©:</p><ul><li>ä¸åŒçš„è¡¨åº”ç”¨ä¸åŒçš„idç”Ÿæˆç­–ç•¥<ul><li>æ—¥å¿—ï¼šè‡ªå¢ï¼ˆ1,2,3,4ï¼Œâ€¦â€¦ï¼‰</li><li>è´­ç‰©è®¢å•ï¼šç‰¹æ®Šè§„åˆ™ï¼ˆFQ23948AK3843ï¼‰</li><li>å¤–å–å•ï¼šå…³è”åœ°åŒºæ—¥æœŸç­‰ä¿¡æ¯ï¼ˆ10 04 20200314 34 91ï¼‰</li><li>å…³ç³»è¡¨ï¼šå¯çœç•¥id</li><li>â€¦â€¦</li></ul></li></ul><p>ä¸åŒçš„ä¸šåŠ¡é‡‡ç”¨çš„IDç”Ÿæˆæ–¹å¼åº”è¯¥æ˜¯ä¸ä¸€æ ·çš„ï¼Œé‚£ä¹ˆåœ¨MPä¸­éƒ½æä¾›äº†å“ªäº›ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼Œä»¥åŠæˆ‘ä»¬è¯¥å¦‚ä½•è¿›è¡Œé€‰æ‹©?</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬åˆéœ€è¦ç”¨åˆ°MPçš„ä¸€ä¸ªæ³¨è§£å«<code>@TableId</code></p><h4 id="çŸ¥è¯†ç‚¹1ï¼š-TableId"><a href="#çŸ¥è¯†ç‚¹1ï¼š-TableId" class="headerlink" title="çŸ¥è¯†ç‚¹1ï¼š@TableId"></a>çŸ¥è¯†ç‚¹1ï¼š@TableId</h4><div class="table-container"><table><thead><tr><th>åç§°</th><th>@TableId</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>==å±æ€§æ³¨è§£==</td></tr><tr><td>ä½ç½®</td><td>æ¨¡å‹ç±»ä¸­ç”¨äºè¡¨ç¤ºä¸»é”®çš„å±æ€§å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰ç±»ä¸­ä¸»é”®å±æ€§çš„ç”Ÿæˆç­–ç•¥</td></tr><tr><td>ç›¸å…³å±æ€§</td><td>value(é»˜è®¤)ï¼šè®¾ç½®æ•°æ®åº“è¡¨ä¸»é”®åç§°<br/>type:è®¾ç½®ä¸»é”®å±æ€§çš„ç”Ÿæˆç­–ç•¥ï¼Œå€¼æŸ¥ç…§IdTypeçš„æšä¸¾å€¼</td></tr></tbody></table></div><h4 id="4-1-1-ç¯å¢ƒæ„å»º"><a href="#4-1-1-ç¯å¢ƒæ„å»º" class="headerlink" title="4.1.1 ç¯å¢ƒæ„å»º"></a>4.1.1 ç¯å¢ƒæ„å»º</h4><p>åœ¨æ„å»ºæ¡ä»¶æŸ¥è¯¢ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å‡†å¤‡ä¸‹ç¯å¢ƒï¼Œå¦‚åŒä»¥ä¸Šï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨copyï¼Œä¸å†å¤šåšèµ˜è¿°</p><h4 id="4-1-2-ä»£ç æ¼”ç¤º"><a href="#4-1-2-ä»£ç æ¼”ç¤º" class="headerlink" title="4.1.2 ä»£ç æ¼”ç¤º"></a>4.1.2 ä»£ç æ¼”ç¤º</h4><h5 id="AUTOç­–ç•¥"><a href="#AUTOç­–ç•¥" class="headerlink" title="AUTOç­–ç•¥"></a>AUTOç­–ç•¥</h5><h6 id="æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºAUTO"><a href="#æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºAUTO" class="headerlink" title="æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºAUTO"></a>æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºAUTO</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ­¥éª¤2-åˆ é™¤æµ‹è¯•æ•°æ®å¹¶ä¿®æ”¹è‡ªå¢å€¼"><a href="#æ­¥éª¤2-åˆ é™¤æµ‹è¯•æ•°æ®å¹¶ä¿®æ”¹è‡ªå¢å€¼" class="headerlink" title="æ­¥éª¤2:åˆ é™¤æµ‹è¯•æ•°æ®å¹¶ä¿®æ”¹è‡ªå¢å€¼"></a>æ­¥éª¤2:åˆ é™¤æµ‹è¯•æ•°æ®å¹¶ä¿®æ”¹è‡ªå¢å€¼</h6><ul><li><p>åˆ é™¤ä¹‹å‰æ’å…¥çš„æµ‹è¯•æ•°æ®</p></li><li><p>å› ä¸ºä¹‹å‰ç”Ÿæˆä¸»é”®IDçš„å€¼æ¯”è¾ƒé•¿ï¼Œä¼šæŠŠMySQLçš„è‡ªåŠ¨å¢é•¿çš„å€¼å˜çš„å¾ˆå¤§ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶è°ƒæ•´ä¸ºç›®å‰æœ€æ–°çš„idå€¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117201055.png" alt=""></p></li></ul><h6 id="æ­¥éª¤3-è¿è¡Œæ–°å¢æ–¹æ³•"><a href="#æ­¥éª¤3-è¿è¡Œæ–°å¢æ–¹æ³•" class="headerlink" title="æ­¥éª¤3:è¿è¡Œæ–°å¢æ–¹æ³•"></a>æ­¥éª¤3:è¿è¡Œæ–°å¢æ–¹æ³•</h6><p>ä¼šå‘ç°ï¼Œæ–°å¢æˆåŠŸï¼Œå¹¶ä¸”ä¸»é”®idä¹Ÿæ˜¯ä»5å¼€å§‹</p><p>ç»è¿‡è¿™ä¸‰æ­¥çš„æ¼”ç¤ºï¼Œä¼šå‘ç°<code>AUTO</code>çš„ä½œç”¨æ˜¯==ä½¿ç”¨æ•°æ®åº“IDè‡ªå¢==ï¼Œåœ¨ä½¿ç”¨è¯¥ç­–ç•¥çš„æ—¶å€™ä¸€å®šè¦ç¡®ä¿å¯¹åº”çš„æ•°æ®åº“è¡¨è®¾ç½®äº†IDä¸»é”®è‡ªå¢ï¼Œå¦åˆ™æ— æ•ˆã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥æºç æŸ¥çœ‹ä¸‹IDçš„ç”Ÿæˆç­–ç•¥æœ‰å“ªäº›?</p><p>æ‰“å¼€æºç åï¼Œä½ ä¼šå‘ç°å¹¶æ²¡æœ‰çœ‹åˆ°ä¸­æ–‡æ³¨é‡Šï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬ç‚¹å‡»å³ä¸Šè§’çš„<code>Download Sources</code>,ä¼šè‡ªåŠ¨å¸®ä½ æŠŠè¿™ä¸ªç±»çš„javaæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°å…·ä½“çš„æ³¨é‡Šå†…å®¹ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯æ˜¯å›½äººåˆ¶ä½œçš„ï¼Œæ‰€ä»¥ä»–ä»£ç ä¸­çš„æ³¨é‡Šè¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚çš„ã€‚<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117201142.png" alt=""></p><p>å½“æŠŠæºç ä¸‹è½½å®Œåï¼Œå°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117201156.png" alt=""></p><p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†AUTOè¿™ä¸ªç­–ç•¥ä»¥å¤–ï¼Œè¿˜æœ‰å¦‚ä¸‹å‡ ç§ç”Ÿæˆç­–ç•¥:</p><ul><li>NONE: ä¸è®¾ç½®idç”Ÿæˆç­–ç•¥</li><li>INPUT:ç”¨æˆ·æ‰‹å·¥è¾“å…¥id</li><li>ASSIGN_ID:é›ªèŠ±ç®—æ³•ç”Ÿæˆid(å¯å…¼å®¹æ•°å€¼å‹ä¸å­—ç¬¦ä¸²å‹)</li><li>ASSIGN_UUID:ä»¥UUIDç”Ÿæˆç®—æ³•ä½œä¸ºidç”Ÿæˆç­–ç•¥</li><li>å…¶ä»–çš„å‡ ä¸ªç­–ç•¥å‡å·²è¿‡æ—¶ï¼Œéƒ½å°†è¢«ASSIGN_IDå’ŒASSIGN_UUIDä»£æ›¿æ‰ã€‚</li></ul><p><strong>æ‹“å±•:</strong></p><p>åˆ†å¸ƒå¼IDæ˜¯ä»€ä¹ˆ?</p><ul><li>å½“æ•°æ®é‡è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œä¸€å°æ•°æ®åº“æœåŠ¡å™¨å­˜å‚¨ä¸ä¸‹ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¤šå°æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œå­˜å‚¨</li><li>æ¯”å¦‚è®¢å•è¡¨å°±æœ‰å¯èƒ½è¢«å­˜å‚¨åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š</li><li>å¦‚æœç”¨æ•°æ®åº“è¡¨çš„è‡ªå¢ä¸»é”®ï¼Œå› ä¸ºåœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šæ‰€ä»¥ä¼šå‡ºç°å†²çª</li><li>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ªå…¨å±€å”¯ä¸€ID,è¿™ä¸ªIDå°±æ˜¯åˆ†å¸ƒå¼IDã€‚</li></ul><h5 id="INPUTç­–ç•¥"><a href="#INPUTç­–ç•¥" class="headerlink" title="INPUTç­–ç•¥"></a>INPUTç­–ç•¥</h5><h6 id="æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºINPUT"><a href="#æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºINPUT" class="headerlink" title="æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºINPUT"></a>æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºINPUT</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> è¿™ç§IDç”Ÿæˆç­–ç•¥ï¼Œéœ€è¦å°†è¡¨çš„è‡ªå¢ç­–ç•¥åˆ é™¤æ‰<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117201237.png" alt=""></p><h6 id="æ­¥éª¤2-æ·»åŠ æ•°æ®æ‰‹åŠ¨è®¾ç½®ID"><a href="#æ­¥éª¤2-æ·»åŠ æ•°æ®æ‰‹åŠ¨è®¾ç½®ID" class="headerlink" title="æ­¥éª¤2:æ·»åŠ æ•°æ®æ‰‹åŠ¨è®¾ç½®ID"></a>æ­¥éª¤2:æ·»åŠ æ•°æ®æ‰‹åŠ¨è®¾ç½®ID</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="string">&quot;666L&quot;</span>);</span><br><span class="line">        user.setTel(<span class="string">&quot;45455&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;1234567899&quot;</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;Blogæ¡ˆä¾‹&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">13</span>);</span><br><span class="line">        userDao.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ­¥éª¤3-è¿è¡Œæ–°å¢æ–¹æ³•-1"><a href="#æ­¥éª¤3-è¿è¡Œæ–°å¢æ–¹æ³•-1" class="headerlink" title="æ­¥éª¤3:è¿è¡Œæ–°å¢æ–¹æ³•"></a>æ­¥éª¤3:è¿è¡Œæ–°å¢æ–¹æ³•</h6><p>å¦‚æœæ²¡æœ‰è®¾ç½®ä¸»é”®IDçš„å€¼ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œé”™è¯¯æç¤ºå°±æ˜¯ä¸»é”®IDæ²¡æœ‰ç»™å€¼,è®¾ç½®äº†ä¸»é”®ID,åˆ™æ•°æ®æ·»åŠ æˆåŠŸã€‚</p><h5 id="ASSIGN-IDç­–ç•¥"><a href="#ASSIGN-IDç­–ç•¥" class="headerlink" title="ASSIGN_IDç­–ç•¥"></a>ASSIGN_IDç­–ç•¥</h5><h6 id="æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN-ID"><a href="#æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN-ID" class="headerlink" title="æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN_ID"></a>æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN_ID</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ­¥éª¤2-æ·»åŠ æ•°æ®ä¸è®¾ç½®ID"><a href="#æ­¥éª¤2-æ·»åŠ æ•°æ®ä¸è®¾ç½®ID" class="headerlink" title="æ­¥éª¤2:æ·»åŠ æ•°æ®ä¸è®¾ç½®ID"></a>æ­¥éª¤2:æ·»åŠ æ•°æ®ä¸è®¾ç½®ID</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;blog&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;Blog-test&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">12</span>);</span><br><span class="line">        user.setTel(<span class="string">&quot;4006184000&quot;</span>);</span><br><span class="line">        userDao.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> è¿™ç§ç”Ÿæˆç­–ç•¥ï¼Œä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®IDï¼Œå¦‚æœæ‰‹åŠ¨è®¾ç½®IDï¼Œåˆ™ä¼šä½¿ç”¨è‡ªå·±è®¾ç½®çš„å€¼ã€‚</p><h6 id="æ­¥éª¤3-è¿è¡Œæ–°å¢æ–¹æ³•-2"><a href="#æ­¥éª¤3-è¿è¡Œæ–°å¢æ–¹æ³•-2" class="headerlink" title="æ­¥éª¤3:è¿è¡Œæ–°å¢æ–¹æ³•"></a>æ­¥éª¤3:è¿è¡Œæ–°å¢æ–¹æ³•</h6><p>ç”Ÿæˆçš„IDå°±æ˜¯ä¸€ä¸ªLongç±»å‹çš„æ•°æ®ã€‚</p><h5 id="ASSIGN-UUIDç­–ç•¥"><a href="#ASSIGN-UUIDç­–ç•¥" class="headerlink" title="ASSIGN_UUIDç­–ç•¥"></a>ASSIGN_UUIDç­–ç•¥</h5><h6 id="æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN-UUID"><a href="#æ­¥éª¤1-è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN-UUID" class="headerlink" title="æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN_UUID"></a>æ­¥éª¤1:è®¾ç½®ç”Ÿæˆç­–ç•¥ä¸ºASSIGN_UUID</h6><p>ä½¿ç”¨uuidéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸»é”®çš„ç±»å‹ä¸èƒ½æ˜¯Longï¼Œè€Œåº”è¯¥æ”¹æˆStringç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;tbl_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_UUID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ­¥éª¤2-ä¿®æ”¹è¡¨çš„ä¸»é”®ç±»å‹"><a href="#æ­¥éª¤2-ä¿®æ”¹è¡¨çš„ä¸»é”®ç±»å‹" class="headerlink" title="æ­¥éª¤2:ä¿®æ”¹è¡¨çš„ä¸»é”®ç±»å‹"></a>æ­¥éª¤2:ä¿®æ”¹è¡¨çš„ä¸»é”®ç±»å‹</h6><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117201611.png" alt=""></p><p>ä¸»é”®ç±»å‹è®¾ç½®ä¸ºvarcharï¼Œé•¿åº¦è¦å¤§äº32ï¼Œå› ä¸ºUUIDç”Ÿæˆçš„ä¸»é”®ä¸º32ä½ï¼Œå¦‚æœé•¿åº¦å°çš„è¯å°±ä¼šå¯¼è‡´æ’å…¥å¤±è´¥ã€‚</p><h6 id="æ­¥éª¤3-æ·»åŠ æ•°æ®ä¸è®¾ç½®ID"><a href="#æ­¥éª¤3-æ·»åŠ æ•°æ®ä¸è®¾ç½®ID" class="headerlink" title="æ­¥éª¤3:æ·»åŠ æ•°æ®ä¸è®¾ç½®ID"></a>æ­¥éª¤3:æ·»åŠ æ•°æ®ä¸è®¾ç½®ID</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;BLog-test&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;blog...&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">12</span>);</span><br><span class="line">        user.setTel(<span class="string">&quot;4006184000&quot;</span>);</span><br><span class="line">        userDao.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="æ­¥éª¤4-è¿è¡Œæ–°å¢æ–¹æ³•"><a href="#æ­¥éª¤4-è¿è¡Œæ–°å¢æ–¹æ³•" class="headerlink" title="æ­¥éª¤4:è¿è¡Œæ–°å¢æ–¹æ³•"></a>æ­¥éª¤4:è¿è¡Œæ–°å¢æ–¹æ³•</h6><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥èŠä¸€èŠé›ªèŠ±ç®—æ³•:</p><p>é›ªèŠ±ç®—æ³•(SnowFlake),æ˜¯Twitterå®˜æ–¹ç»™å‡ºçš„ç®—æ³•å®ç° æ˜¯ç”¨Scalaå†™çš„ã€‚å…¶ç”Ÿæˆçš„ç»“æœæ˜¯ä¸€ä¸ª64bitå¤§å°æ•´æ•°ï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹å›¾:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221117201656.png" alt=""></p><ol><li>1bit,ä¸ç”¨,å› ä¸ºäºŒè¿›åˆ¶ä¸­æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ1è¡¨ç¤ºè´Ÿæ•°ï¼Œ0è¡¨ç¤ºæ­£æ•°ã€‚ç”Ÿæˆçš„idä¸€èˆ¬éƒ½æ˜¯ç”¨æ•´æ•°ï¼Œæ‰€ä»¥æœ€é«˜ä½å›ºå®šä¸º0ã€‚</li><li>41bit-æ—¶é—´æˆ³ï¼Œç”¨æ¥è®°å½•æ—¶é—´æˆ³ï¼Œæ¯«ç§’çº§</li><li>10bit-å·¥ä½œæœºå™¨idï¼Œç”¨æ¥è®°å½•å·¥ä½œæœºå™¨id,å…¶ä¸­é«˜ä½5bitæ˜¯æ•°æ®ä¸­å¿ƒIDå…¶å–å€¼èŒƒå›´0-31ï¼Œä½ä½5bitæ˜¯å·¥ä½œèŠ‚ç‚¹IDå…¶å–å€¼èŒƒå›´0-31ï¼Œä¸¤ä¸ªç»„åˆèµ·æ¥æœ€å¤šå¯ä»¥å®¹çº³1024ä¸ªèŠ‚ç‚¹</li><li>åºåˆ—å·å ç”¨12bitï¼Œæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’0å¼€å§‹ä¸æ–­ç´¯åŠ ï¼Œæœ€å¤šå¯ä»¥ç´¯åŠ åˆ°4095ï¼Œä¸€å…±å¯ä»¥äº§ç”Ÿ4096ä¸ªID</li></ol><h4 id="4-1-3-IDç”Ÿæˆç­–ç•¥å¯¹æ¯”"><a href="#4-1-3-IDç”Ÿæˆç­–ç•¥å¯¹æ¯”" class="headerlink" title="4.1.3 IDç”Ÿæˆç­–ç•¥å¯¹æ¯”"></a>4.1.3 IDç”Ÿæˆç­–ç•¥å¯¹æ¯”</h4><p>ä»‹ç»äº†è¿™äº›ä¸»é”®IDçš„ç”Ÿæˆç­–ç•¥ï¼Œæˆ‘ä»¬ä»¥åè¯¥ç”¨å“ªä¸ªå‘¢?</p><ul><li>NONE: ä¸è®¾ç½®idç”Ÿæˆç­–ç•¥ï¼ŒMPä¸è‡ªåŠ¨ç”Ÿæˆï¼Œçº¦ç­‰äºINPUT,æ‰€ä»¥è¿™ä¸¤ç§æ–¹å¼éƒ½éœ€è¦ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼Œä½†æ˜¯æ‰‹åŠ¨è®¾ç½®ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å®¹æ˜“å‡ºç°ç›¸åŒçš„IDé€ æˆä¸»é”®å†²çªï¼Œä¸ºäº†ä¿è¯ä¸»é”®ä¸å†²çªå°±éœ€è¦åšå¾ˆå¤šåˆ¤å®šï¼Œå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚</li><li>AUTO:æ•°æ®åº“IDè‡ªå¢,è¿™ç§ç­–ç•¥é€‚åˆåœ¨æ•°æ®åº“æœåŠ¡å™¨åªæœ‰1å°çš„æƒ…å†µä¸‹ä½¿ç”¨,ä¸å¯ä½œä¸ºåˆ†å¸ƒå¼IDä½¿ç”¨</li><li>ASSIGN_UUID:å¯ä»¥åœ¨åˆ†å¸ƒå¼çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œè€Œä¸”èƒ½å¤Ÿä¿è¯å”¯ä¸€ï¼Œä½†æ˜¯ç”Ÿæˆçš„ä¸»é”®æ˜¯32ä½çš„å­—ç¬¦ä¸²ï¼Œé•¿åº¦è¿‡é•¿å ç”¨ç©ºé—´è€Œä¸”è¿˜ä¸èƒ½æ’åºï¼ŒæŸ¥è¯¢æ€§èƒ½ä¹Ÿæ…¢</li><li>ASSIGN_ID:å¯ä»¥åœ¨åˆ†å¸ƒå¼çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œç”Ÿæˆçš„æ˜¯Longç±»å‹çš„æ•°å­—ï¼Œå¯ä»¥æ’åºæ€§èƒ½ä¹Ÿé«˜ï¼Œä½†æ˜¯ç”Ÿæˆçš„ç­–ç•¥å’ŒæœåŠ¡å™¨æ—¶é—´æœ‰å…³ï¼Œå¦‚æœä¿®æ”¹äº†ç³»ç»Ÿæ—¶é—´å°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°é‡å¤ä¸»é”®</li><li>ç»¼ä¸Šæ‰€è¿°ï¼Œæ¯ä¸€ç§ä¸»é”®ç­–ç•¥éƒ½æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œæ ¹æ®è‡ªå·±é¡¹ç›®ä¸šåŠ¡çš„å®é™…æƒ…å†µæ¥é€‰æ‹©ä½¿ç”¨æ‰æ˜¯æœ€æ˜æ™ºçš„é€‰æ‹©ã€‚</li></ul><h4 id="4-1-4-ç®€åŒ–é…ç½®"><a href="#4-1-4-ç®€åŒ–é…ç½®" class="headerlink" title="4.1.4 ç®€åŒ–é…ç½®"></a>4.1.4 ç®€åŒ–é…ç½®</h4><p>å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†è¡¨å…³ç³»æ˜ å°„ã€æ•°æ®åº“ä¸»é”®ç­–ç•¥çš„è®¾ç½®ï¼Œæ¥ä¸‹æ¥å¯¹äºè¿™ä¸¤ä¸ªå†…å®¹çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å†è®²ä¸‹ä»–ä»¬çš„ç®€åŒ–é…ç½®:</p><h5 id="æ¨¡å‹ç±»ä¸»é”®ç­–ç•¥è®¾ç½®"><a href="#æ¨¡å‹ç±»ä¸»é”®ç­–ç•¥è®¾ç½®" class="headerlink" title="æ¨¡å‹ç±»ä¸»é”®ç­–ç•¥è®¾ç½®"></a>æ¨¡å‹ç±»ä¸»é”®ç­–ç•¥è®¾ç½®</h5><p>å¯¹äºä¸»é”®IDçš„ç­–ç•¥å·²ç»ä»‹ç»å®Œï¼Œä½†æ˜¯å¦‚æœè¦åœ¨é¡¹ç›®ä¸­çš„æ¯ä¸€ä¸ªæ¨¡å‹ç±»ä¸Šéƒ½éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç”Ÿæˆç­–ç•¥ï¼Œå¦‚:<img src="assets/1631245676125.png" alt="1631245676125"></p><p>ç¡®å®æ˜¯ç¨å¾®æœ‰ç‚¹ç¹çï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åœ¨æŸä¸€å¤„è¿›è¡Œé…ç½®ï¼Œå°±èƒ½è®©æ‰€æœ‰çš„æ¨¡å‹ç±»éƒ½å¯ä»¥ä½¿ç”¨è¯¥ä¸»é”®IDç­–ç•¥å‘¢?</p><p>ç­”æ¡ˆæ˜¯è‚¯å®šæœ‰ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">    <span class="attr">id-type:</span> <span class="string">assign_id</span></span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåï¼Œæ¯ä¸ªæ¨¡å‹ç±»çš„ä¸»é”®IDç­–ç•¥éƒ½å°†æˆä¸ºassign_id.</p><h5 id="æ•°æ®åº“è¡¨ä¸æ¨¡å‹ç±»çš„æ˜ å°„å…³ç³»"><a href="#æ•°æ®åº“è¡¨ä¸æ¨¡å‹ç±»çš„æ˜ å°„å…³ç³»" class="headerlink" title="æ•°æ®åº“è¡¨ä¸æ¨¡å‹ç±»çš„æ˜ å°„å…³ç³»"></a>æ•°æ®åº“è¡¨ä¸æ¨¡å‹ç±»çš„æ˜ å°„å…³ç³»</h5><p>MPä¼šé»˜è®¤å°†æ¨¡å‹ç±»çš„ç±»ååé¦–å­—æ¯å°å†™ä½œä¸ºè¡¨åä½¿ç”¨ï¼Œå‡å¦‚æ•°æ®åº“è¡¨çš„åç§°éƒ½ä»¥<code>tbl_</code>å¼€å¤´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å°†æ‰€æœ‰çš„æ¨¡å‹ç±»ä¸Šæ·»åŠ <code>@TableName</code>è®¾ç½®</p><p>é…ç½®èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒç¹çï¼Œç®€åŒ–æ–¹å¼ä¸ºåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹å†…å®¹:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">    <span class="attr">table-prefix:</span> <span class="string">tbl_</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®è¡¨çš„å‰ç¼€å†…å®¹ï¼Œè¿™æ ·MPå°±ä¼šæ‹¿ <code>tbl_</code>åŠ ä¸Šæ¨¡å‹ç±»çš„é¦–å­—æ¯å°å†™ï¼Œå°±åˆšå¥½ç»„è£…æˆæ•°æ®åº“çš„è¡¨åã€‚</p><h3 id="4-2-å¤šè®°å½•æ“ä½œ"><a href="#4-2-å¤šè®°å½•æ“ä½œ" class="headerlink" title="4.2 å¤šè®°å½•æ“ä½œ"></a>4.2 å¤šè®°å½•æ“ä½œ</h3><p>å…ˆæ¥çœ‹ä¸‹é—®é¢˜:</p><p>ä¹‹å‰æ·»åŠ äº†å¾ˆå¤šå•†å“åˆ°è´­ç‰©è½¦ï¼Œè¿‡äº†å‡ å¤©å‘ç°è¿™äº›ä¸œè¥¿åˆä¸æƒ³è¦äº†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢?</p><p>å¾ˆç®€å•åˆ é™¤æ‰ï¼Œä½†æ˜¯ä¸€ä¸ªä¸ªåˆ é™¤çš„è¯è¿˜æ˜¯æ¯”è¾ƒæ…¢å’Œè´¹äº‹çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šç»™ç”¨æˆ·ä¸€ä¸ªæ‰¹é‡æ“ä½œï¼Œä¹Ÿå°±æ˜¯å‰é¢æœ‰ä¸€ä¸ªå¤é€‰æ¡†ï¼Œç”¨æˆ·ä¸€æ¬¡å¯ä»¥å‹¾é€‰å¤šä¸ªä¹Ÿå¯ä»¥è¿›è¡Œå…¨é€‰ï¼Œç„¶ååˆ ä¸€æ¬¡å°±å¯ä»¥å°†è´­ç‰©è½¦æ¸…ç©ºï¼Œè¿™ä¸ªå°±éœ€è¦ç”¨åˆ°<code>æ‰¹é‡åˆ é™¤</code>çš„æ“ä½œäº†ã€‚</p><p>å…·ä½“è¯¥å¦‚ä½•å®ç°å¤šæ¡åˆ é™¤ï¼Œæˆ‘ä»¬æ‰¾æ‰¾å¯¹åº”çš„APIæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">deleteBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br></pre></td></tr></table></figure><p>ç¿»è¯‘æ–¹æ³•çš„å­—é¢æ„æ€ä¸º:åˆ é™¤ï¼ˆæ ¹æ®ID æ‰¹é‡åˆ é™¤ï¼‰,å‚æ•°æ˜¯ä¸€ä¸ªé›†åˆï¼Œå¯ä»¥å­˜æ”¾å¤šä¸ªidå€¼ã€‚</p><blockquote><p>éœ€æ±‚:æ ¹æ®ä¼ å…¥çš„idé›†åˆå°†æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®åˆ é™¤æ‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//åˆ é™¤æŒ‡å®šå¤šæ¡æ•°æ®</span></span><br><span class="line">        List&lt;Long&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1402551342481838081L</span>);</span><br><span class="line">        list.add(<span class="number">1402553134049501186L</span>);</span><br><span class="line">        list.add(<span class="number">1402553619611430913L</span>);</span><br><span class="line">        userDao.deleteBatchIds(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸåï¼Œæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å°±ä¼šæŒ‰ç…§æŒ‡å®šçš„idè¿›è¡Œåˆ é™¤ã€‚</p><p>é™¤äº†æŒ‰ç…§idé›†åˆè¿›è¡Œæ‰¹é‡åˆ é™¤ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§idé›†åˆè¿›è¡Œæ‰¹é‡æŸ¥è¯¢ï¼Œè¿˜æ˜¯å…ˆæ¥çœ‹ä¸‹API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;T&gt; <span class="title function_">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span>;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•åç§°ç¿»è¯‘ä¸º:æŸ¥è¯¢ï¼ˆæ ¹æ®ID æ‰¹é‡æŸ¥è¯¢ï¼‰ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªé›†åˆï¼Œå¯ä»¥å­˜æ”¾å¤šä¸ªidå€¼ã€‚</p><blockquote><p>éœ€æ±‚ï¼šæ ¹æ®ä¼ å…¥çš„IDé›†åˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetByIds</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æŒ‡å®šå¤šæ¡æ•°æ®</span></span><br><span class="line">        List&lt;Long&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1L</span>);</span><br><span class="line">        list.add(<span class="number">3L</span>);</span><br><span class="line">        list.add(<span class="number">4L</span>);</span><br><span class="line">        userDao.selectBatchIds(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœå°±ä¼šæŒ‰ç…§æŒ‡å®šä¼ å…¥çš„idå€¼è¿›è¡ŒæŸ¥è¯¢</p><h3 id="4-3-é€»è¾‘åˆ é™¤"><a href="#4-3-é€»è¾‘åˆ é™¤" class="headerlink" title="4.3 é€»è¾‘åˆ é™¤"></a>4.3 é€»è¾‘åˆ é™¤</h3><p>æ¥ä¸‹æ¥è¦è®²è§£æ˜¯åˆ é™¤ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªæ“ä½œï¼Œé€»è¾‘åˆ é™¤ï¼Œå…ˆæ¥åˆ†æä¸‹é—®é¢˜:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221118171746.png" alt=""></p><ul><li>è¿™æ˜¯ä¸€ä¸ªå‘˜å·¥å’Œå…¶æ‰€ç­¾çš„åˆåŒè¡¨ï¼Œå…³ç³»æ˜¯ä¸€ä¸ªå‘˜å·¥å¯ä»¥ç­¾å¤šä¸ªåˆåŒï¼Œæ˜¯ä¸€ä¸ªä¸€(å‘˜å·¥)å¯¹å¤š(åˆåŒ)çš„è¡¨<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221118171817.png" alt=""></li><li><p>å‘˜å·¥IDä¸º1çš„å¼ ä¸šç»©ï¼Œæ€»å…±ç­¾äº†ä¸‰ä¸ªåˆåŒï¼Œå¦‚æœæ­¤æ—¶ä»–ç¦»èŒäº†ï¼Œæˆ‘ä»¬éœ€è¦å°†å‘˜å·¥è¡¨ä¸­çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œä¼šæ‰§è¡Œdeleteæ“ä½œ</p></li><li><p>å¦‚æœè¡¨åœ¨è®¾è®¡çš„æ—¶å€™æœ‰ä¸»å¤–é”®å…³ç³»ï¼Œé‚£ä¹ˆåŒæ—¶ä¹Ÿå¾—å°†åˆåŒè¡¨ä¸­çš„å‰ä¸‰æ¡æ•°æ®ä¹Ÿåˆ é™¤æ‰</p></li><li><p>åæœŸè¦ç»Ÿè®¡æ‰€ç­¾åˆåŒçš„æ€»é‡‘é¢ï¼Œå°±ä¼šå‘ç°å¯¹ä¸ä¸Šï¼ŒåŸå› æ˜¯å·²ç»å°†å‘˜å·¥1ç­¾çš„åˆåŒä¿¡æ¯åˆ é™¤æ‰äº†</p></li><li><p>å¦‚æœåªåˆ é™¤å‘˜å·¥ä¸åˆ é™¤åˆåŒè¡¨æ•°æ®ï¼Œé‚£ä¹ˆåˆåŒçš„å‘˜å·¥ç¼–å·å¯¹åº”çš„å‘˜å·¥ä¿¡æ¯ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°åƒåœ¾æ•°æ®ï¼Œå°±ä¼šå‡ºç°æ— ä¸»åˆåŒï¼Œæ ¹æœ¬ä¸çŸ¥é“æœ‰å¼ ä¸šç»©è¿™ä¸ªäººçš„å­˜åœ¨</p></li><li><p>æ‰€ä»¥ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬ä¸åº”è¯¥å°†è¡¨ä¸­çš„æ•°æ®åˆ é™¤æ‰ï¼Œè€Œæ˜¯éœ€è¦è¿›è¡Œä¿ç•™ï¼Œä½†æ˜¯åˆå¾—æŠŠç¦»èŒçš„äººå’Œåœ¨èŒçš„äººè¿›è¡ŒåŒºåˆ†ï¼Œè¿™æ ·å°±è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œå¦‚:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221118171856.png" alt=""></p></li><li><p>åŒºåˆ†çš„æ–¹å¼ï¼Œå°±æ˜¯åœ¨å‘˜å·¥è¡¨ä¸­æ·»åŠ ä¸€åˆ—æ•°æ®<code>deleted</code>ï¼Œå¦‚æœä¸º0è¯´æ˜åœ¨èŒå‘˜å·¥ï¼Œå¦‚æœç¦»èŒåˆ™å°†å…¶æ”¹å®Œ1ï¼Œï¼ˆ0å’Œ1æ‰€ä»£è¡¨çš„å«ä¹‰æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼‰</p></li></ul><p>æ‰€ä»¥å¯¹äºåˆ é™¤æ“ä½œä¸šåŠ¡é—®é¢˜æ¥è¯´æœ‰:</p><ul><li>ç‰©ç†åˆ é™¤:ä¸šåŠ¡æ•°æ®ä»æ•°æ®åº“ä¸­ä¸¢å¼ƒï¼Œæ‰§è¡Œçš„æ˜¯deleteæ“ä½œ</li><li>é€»è¾‘åˆ é™¤:ä¸ºæ•°æ®è®¾ç½®æ˜¯å¦å¯ç”¨çŠ¶æ€å­—æ®µï¼Œåˆ é™¤æ—¶è®¾ç½®çŠ¶æ€å­—æ®µä¸ºä¸å¯ç”¨çŠ¶æ€ï¼Œæ•°æ®ä¿ç•™åœ¨æ•°æ®åº“ä¸­ï¼Œæ‰§è¡Œçš„æ˜¯updateæ“ä½œ</li></ul><p>MPä¸­é€»è¾‘åˆ é™¤å…·ä½“è¯¥å¦‚ä½•å®ç°?</p><h4 id="æ­¥éª¤1-ä¿®æ”¹æ•°æ®åº“è¡¨æ·»åŠ deletedåˆ—"><a href="#æ­¥éª¤1-ä¿®æ”¹æ•°æ®åº“è¡¨æ·»åŠ deletedåˆ—" class="headerlink" title="æ­¥éª¤1:ä¿®æ”¹æ•°æ®åº“è¡¨æ·»åŠ deletedåˆ—"></a>æ­¥éª¤1:ä¿®æ”¹æ•°æ®åº“è¡¨æ·»åŠ <code>deleted</code>åˆ—</h4><p>å­—æ®µåå¯ä»¥ä»»æ„ï¼Œå†…å®¹ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œæ¯”å¦‚<code>0</code>ä»£è¡¨æ­£å¸¸ï¼Œ<code>1</code>ä»£è¡¨åˆ é™¤ï¼Œå¯ä»¥åœ¨æ·»åŠ åˆ—çš„åŒæ—¶è®¾ç½®å…¶é»˜è®¤å€¼ä¸º<code>0</code>æ­£å¸¸ï¼Œç›´æ¥æ·»åŠ è¿™ä¸ªåˆ—å³å¯ã€‚</p><h4 id="æ­¥éª¤2-å®ä½“ç±»æ·»åŠ å±æ€§"><a href="#æ­¥éª¤2-å®ä½“ç±»æ·»åŠ å±æ€§" class="headerlink" title="æ­¥éª¤2:å®ä½“ç±»æ·»åŠ å±æ€§"></a>æ­¥éª¤2:å®ä½“ç±»æ·»åŠ å±æ€§</h4><p>(1)æ·»åŠ ä¸æ•°æ®åº“è¡¨çš„åˆ—å¯¹åº”çš„ä¸€ä¸ªå±æ€§åï¼Œåç§°å¯ä»¥ä»»æ„ï¼Œå¦‚æœå’Œæ•°æ®è¡¨åˆ—åå¯¹ä¸ä¸Šï¼Œå¯ä»¥ä½¿ç”¨@TableFieldè¿›è¡Œå…³ç³»æ˜ å°„ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™ä¼šè‡ªåŠ¨å¯¹åº”ã€‚</p><p>(2)æ ‡è¯†æ–°å¢çš„å­—æ®µä¸ºé€»è¾‘åˆ é™¤å­—æ®µï¼Œä½¿ç”¨<code>@TableLogic</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//@TableName(&quot;tbl_user&quot;) å¯ä»¥ä¸å†™æ˜¯å› ä¸ºé…ç½®äº†å…¨å±€é…ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_UUID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">    <span class="meta">@TableLogic(value=&quot;0&quot;,delval=&quot;1&quot;)</span></span><br><span class="line">    <span class="comment">//valueä¸ºæ­£å¸¸æ•°æ®çš„å€¼ï¼Œdelvalä¸ºåˆ é™¤æ•°æ®çš„å€¼</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤3-è¿è¡Œåˆ é™¤æ–¹æ³•"><a href="#æ­¥éª¤3-è¿è¡Œåˆ é™¤æ–¹æ³•" class="headerlink" title="æ­¥éª¤3:è¿è¡Œåˆ é™¤æ–¹æ³•"></a>æ­¥éª¤3:è¿è¡Œåˆ é™¤æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">       userDao.deleteById(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221118172012.png" alt=""></p><p>ä»æµ‹è¯•ç»“æœæ¥çœ‹ï¼Œé€»è¾‘åˆ é™¤æœ€åèµ°çš„æ˜¯updateæ“ä½œï¼Œä¼šå°†æŒ‡å®šçš„å­—æ®µä¿®æ”¹æˆåˆ é™¤çŠ¶æ€å¯¹åº”çš„å€¼ã€‚</p><p><strong>æ€è€ƒ</strong></p><p>é€»è¾‘åˆ é™¤ï¼Œå¯¹æŸ¥è¯¢æœ‰æ²¡æœ‰å½±å“å‘¢?</p><ul><li><p>æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFind</span><span class="params">()</span>&#123;</span><br><span class="line">       System.out.println(userDao.selectList(<span class="literal">null</span>));<span class="comment">//æŸ¥è¯¢æ‰€æœ‰çš„ç®€åŒ–æ ¼å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°æ‰“å°å‡ºæ¥çš„sqlè¯­å¥ä¸­ä¼šå¤šä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œåœ¨sqlè¯­å¥çš„åæ–¹å‡ºç°äº†ä¸€ä¸ªwhere deleted=0 è¯´æ˜å¯¹çŠ¶æ€å­—æ®µçš„æ³¨è§£èµ·äº†ä½œç”¨ã€‚</p><p>å¯æƒ³è€ŒçŸ¥ï¼ŒMPçš„é€»è¾‘åˆ é™¤ä¼šå°†æ‰€æœ‰çš„æŸ¥è¯¢éƒ½æ·»åŠ ä¸€ä¸ªæœªè¢«åˆ é™¤çš„æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯å·²ç»è¢«åˆ é™¤çš„æ•°æ®æ˜¯ä¸åº”è¯¥è¢«æŸ¥è¯¢å‡ºæ¥çš„ã€‚</p></li><li><p>å¦‚æœè¿˜æ˜¯æƒ³æŠŠå·²ç»åˆ é™¤çš„æ•°æ®éƒ½æŸ¥è¯¢å‡ºæ¥è¯¥å¦‚ä½•å®ç°å‘¢?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢æ‰€æœ‰æ•°æ®åŒ…å«å·²ç»è¢«åˆ é™¤çš„æ•°æ®</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæ¯ä¸ªè¡¨éƒ½è¦æœ‰é€»è¾‘åˆ é™¤ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨æ¯ä¸ªæ¨¡å‹ç±»çš„å±æ€§ä¸Šæ·»åŠ <code>@TableLogic</code>æ³¨è§£ï¼Œå¦‚ä½•ä¼˜åŒ–?</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å…¨å±€é…ç½®ï¼Œå¦‚ä¸‹:</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># é€»è¾‘åˆ é™¤å­—æ®µå</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">deleted</span></span><br><span class="line">      <span class="comment"># é€»è¾‘åˆ é™¤å­—é¢å€¼ï¼šæœªåˆ é™¤ä¸º0</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="comment"># é€»è¾‘åˆ é™¤å­—é¢å€¼ï¼šåˆ é™¤ä¸º1</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></li></ul><p>ä»‹ç»å®Œé€»è¾‘åˆ é™¤ï¼Œé€»è¾‘åˆ é™¤çš„æœ¬è´¨ä¸º:</p><p><strong>é€»è¾‘åˆ é™¤çš„æœ¬è´¨å…¶å®æ˜¯ä¿®æ”¹æ“ä½œã€‚å¦‚æœåŠ äº†é€»è¾‘åˆ é™¤å­—æ®µï¼ŒæŸ¥è¯¢æ•°æ®æ—¶ä¹Ÿä¼šè‡ªåŠ¨å¸¦ä¸Šé€»è¾‘åˆ é™¤å­—æ®µã€‚</strong></p><p>æ‰§è¡Œçš„SQLè¯­å¥ä¸º:</p><p>UPDATE tbl_user SET ==deleted===1 where id = ? AND ==deleted===0</p><p>ç»“æœè‡ªç„¶æ˜¯è¡¨ä¸­æ‰€æœ‰æ•°æ®éƒ½æ­£å¸¸è¢«æ˜¾ç¤ºã€‚</p><h4 id="çŸ¥è¯†ç‚¹1ï¼š-TableLogic"><a href="#çŸ¥è¯†ç‚¹1ï¼š-TableLogic" class="headerlink" title="çŸ¥è¯†ç‚¹1ï¼š@TableLogic"></a>çŸ¥è¯†ç‚¹1ï¼š@TableLogic</h4><div class="table-container"><table><thead><tr><th>åç§°</th><th>@TableLogic</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>==å±æ€§æ³¨è§£==</td></tr><tr><td>ä½ç½®</td><td>æ¨¡å‹ç±»ä¸­ç”¨äºè¡¨ç¤ºåˆ é™¤å­—æ®µçš„å±æ€§å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>æ ‡è¯†è¯¥å­—æ®µä¸ºè¿›è¡Œé€»è¾‘åˆ é™¤çš„å­—æ®µ</td></tr><tr><td>ç›¸å…³å±æ€§</td><td>valueï¼šé€»è¾‘æœªåˆ é™¤å€¼<br/>delval:é€»è¾‘åˆ é™¤å€¼</td></tr></tbody></table></div><h3 id="4-4-ä¹è§‚é”"><a href="#4-4-ä¹è§‚é”" class="headerlink" title="4.4 ä¹è§‚é”"></a>4.4 ä¹è§‚é”</h3><h4 id="4-4-1-æ¦‚å¿µ"><a href="#4-4-1-æ¦‚å¿µ" class="headerlink" title="4.4.1 æ¦‚å¿µ"></a>4.4.1 æ¦‚å¿µ</h4><p>åœ¨è®²è§£ä¹è§‚é”ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥åˆ†æä¸‹é—®é¢˜:</p><p>ä¸šåŠ¡å¹¶å‘ç°è±¡å¸¦æ¥çš„é—®é¢˜:==ç§’æ€==</p><ul><li>å‡å¦‚æœ‰100ä¸ªå•†å“æˆ–è€…ç¥¨åœ¨å‡ºå”®ï¼Œä¸ºäº†èƒ½ä¿è¯æ¯ä¸ªå•†å“æˆ–è€…ç¥¨åªèƒ½è¢«ä¸€ä¸ªäººè´­ä¹°ï¼Œå¦‚ä½•ä¿è¯ä¸ä¼šå‡ºç°è¶…ä¹°æˆ–è€…é‡å¤å–</li><li>å¯¹äºè¿™ä¸€ç±»é—®é¢˜ï¼Œå…¶å®æœ‰å¾ˆå¤šçš„è§£å†³æ–¹æ¡ˆå¯ä»¥ä½¿ç”¨</li><li>ç¬¬ä¸€ä¸ªæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯é”ï¼Œé”åœ¨ä¸€å°æœåŠ¡å™¨ä¸­æ˜¯å¯ä»¥è§£å†³çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨å¤šå°æœåŠ¡å™¨ä¸‹é”å°±æ²¡æœ‰åŠæ³•æ§åˆ¶ï¼Œæ¯”å¦‚12306æœ‰ä¸¤å°æœåŠ¡å™¨åœ¨è¿›è¡Œå–ç¥¨ï¼Œåœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šéƒ½æ·»åŠ é”çš„è¯ï¼Œé‚£ä¹Ÿæœ‰å¯èƒ½ä¼šå¯¼è‡´åœ¨åŒä¸€æ—¶åˆ»æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨è¿›è¡Œå–ç¥¨ï¼Œè¿˜æ˜¯ä¼šå‡ºç°å¹¶å‘é—®é¢˜</li><li>æˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»çš„è¿™ç§æ–¹å¼æ˜¯é’ˆå¯¹äºå°å‹ä¼ä¸šçš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºæ•°æ®åº“æœ¬èº«çš„æ€§èƒ½å°±æ˜¯ä¸ªç“¶é¢ˆï¼Œå¦‚æœå¯¹å…¶å¹¶å‘é‡è¶…è¿‡2000ä»¥ä¸Šçš„å°±éœ€è¦è€ƒè™‘å…¶ä»–çš„è§£å†³æ–¹æ¡ˆäº†ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼Œä¹è§‚é”ä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯å½“è¦æ›´æ–°ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¸Œæœ›è¿™æ¡è®°å½•æ²¡æœ‰è¢«åˆ«äººæ›´æ–°ã€‚</p><h4 id="4-4-2-å®ç°æ€è·¯"><a href="#4-4-2-å®ç°æ€è·¯" class="headerlink" title="4.4.2 å®ç°æ€è·¯"></a>4.4.2 å®ç°æ€è·¯</h4><p>ä¹è§‚é”çš„å®ç°æ–¹å¼:</p><blockquote><ul><li>æ•°æ®åº“è¡¨ä¸­æ·»åŠ versionåˆ—ï¼Œæ¯”å¦‚é»˜è®¤å€¼ç»™1</li><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¦ä¿®æ”¹æ•°æ®ä¹‹å‰ï¼Œå–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰æ•°æ®åº“ä¸­çš„version=1</li><li>ç¬¬äºŒä¸ªçº¿ç¨‹è¦ä¿®æ”¹æ•°æ®ä¹‹å‰ï¼Œå–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰æ•°æ®åº“ä¸­çš„version=1</li><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ›´æ–°æ—¶ï¼Œset version = newVersion where version = oldVersion<ul><li>newVersion = version+1  [2]</li><li>oldVersion = version  [1]</li></ul></li><li>ç¬¬äºŒä¸ªçº¿ç¨‹æ‰§è¡Œæ›´æ–°æ—¶ï¼Œset version = newVersion where version = oldVersion<ul><li>newVersion = version+1  [2]</li><li>oldVersion = version  [1]</li></ul></li><li>å‡å¦‚è¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½æ¥æ›´æ–°æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªçº¿ç¨‹éƒ½å¯èƒ½å…ˆæ‰§è¡Œ<ul><li>å‡å¦‚ç¬¬ä¸€ä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œæ›´æ–°ï¼Œä¼šæŠŠversionæ”¹ä¸º2ï¼Œ</li><li>ç¬¬äºŒä¸ªçº¿ç¨‹å†æ›´æ–°çš„æ—¶å€™ï¼Œset version = 2 where version = 1,æ­¤æ—¶æ•°æ®åº“è¡¨çš„æ•°æ®versionå·²ç»ä¸º2ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªçº¿ç¨‹ä¼šä¿®æ”¹å¤±è´¥</li><li>å‡å¦‚ç¬¬äºŒä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œæ›´æ–°ï¼Œä¼šæŠŠversionæ”¹ä¸º2ï¼Œ</li><li>ç¬¬ä¸€ä¸ªçº¿ç¨‹å†æ›´æ–°çš„æ—¶å€™ï¼Œset version = 2 where version = 1,æ­¤æ—¶æ•°æ®åº“è¡¨çš„æ•°æ®versionå·²ç»ä¸º2ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¼šä¿®æ”¹å¤±è´¥</li><li>ä¸ç®¡è°å…ˆæ‰§è¡Œéƒ½ä¼šç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ›´æ–°æ•°æ®ï¼Œè¿™å°±æ˜¯MPæä¾›çš„ä¹è§‚é”çš„å®ç°åŸç†åˆ†æã€‚</li></ul></li></ul></blockquote><p>ä¸Šé¢æ‰€è¯´çš„æ­¥éª¤å…·ä½“è¯¥å¦‚ä½•å®ç°å‘¢?</p><h4 id="4-4-3-å®ç°æ­¥éª¤"><a href="#4-4-3-å®ç°æ­¥éª¤" class="headerlink" title="4.4.3 å®ç°æ­¥éª¤"></a>4.4.3 å®ç°æ­¥éª¤</h4><p>åˆ†æå®Œæ­¥éª¤åï¼Œå…·ä½“çš„å®ç°æ­¥éª¤å¦‚ä¸‹:</p><h5 id="æ­¥éª¤1-æ•°æ®åº“è¡¨æ·»åŠ åˆ—"><a href="#æ­¥éª¤1-æ•°æ®åº“è¡¨æ·»åŠ åˆ—" class="headerlink" title="æ­¥éª¤1:æ•°æ®åº“è¡¨æ·»åŠ åˆ—"></a>æ­¥éª¤1:æ•°æ®åº“è¡¨æ·»åŠ åˆ—</h5><p>åˆ—åå¯ä»¥ä»»æ„ï¼Œæ¯”å¦‚ä½¿ç”¨<code>version</code>,ç»™åˆ—è®¾ç½®é»˜è®¤å€¼ä¸º<code>1</code></p><h5 id="æ­¥éª¤2-åœ¨æ¨¡å‹ç±»ä¸­æ·»åŠ å¯¹åº”çš„å±æ€§"><a href="#æ­¥éª¤2-åœ¨æ¨¡å‹ç±»ä¸­æ·»åŠ å¯¹åº”çš„å±æ€§" class="headerlink" title="æ­¥éª¤2:åœ¨æ¨¡å‹ç±»ä¸­æ·»åŠ å¯¹åº”çš„å±æ€§"></a>æ­¥éª¤2:åœ¨æ¨¡å‹ç±»ä¸­æ·»åŠ å¯¹åº”çš„å±æ€§</h5><p>æ ¹æ®æ·»åŠ çš„å­—æ®µåˆ—åï¼Œåœ¨æ¨¡å‹ç±»ä¸­æ·»åŠ å¯¹åº”çš„å±æ€§å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">//@TableName(&quot;tbl_user&quot;) å¯ä»¥ä¸å†™æ˜¯å› ä¸ºé…ç½®äº†å…¨å±€é…ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.ASSIGN_UUID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(value=&quot;pwd&quot;,select=false)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@TableField(exist=false)</span></span><br><span class="line">    <span class="keyword">private</span> Integer online;</span><br><span class="line">    <span class="keyword">private</span> Integer deleted;</span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Integer version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3-æ·»åŠ ä¹è§‚é”çš„æ‹¦æˆªå™¨"><a href="#æ­¥éª¤3-æ·»åŠ ä¹è§‚é”çš„æ‹¦æˆªå™¨" class="headerlink" title="æ­¥éª¤3:æ·»åŠ ä¹è§‚é”çš„æ‹¦æˆªå™¨"></a>æ­¥éª¤3:æ·»åŠ ä¹è§‚é”çš„æ‹¦æˆªå™¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mpInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1.å®šä¹‰Mpæ‹¦æˆªå™¨</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mpInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//2.æ·»åŠ ä¹è§‚é”æ‹¦æˆªå™¨</span></span><br><span class="line">        mpInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mpInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤4-æ‰§è¡Œæ›´æ–°æ“ä½œ"><a href="#æ­¥éª¤4-æ‰§è¡Œæ›´æ–°æ“ä½œ" class="headerlink" title="æ­¥éª¤4:æ‰§è¡Œæ›´æ–°æ“ä½œ"></a>æ­¥éª¤4:æ‰§è¡Œæ›´æ–°æ“ä½œ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">3L</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;Jock666&quot;</span>);</span><br><span class="line">        userDao.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œè¿™æ¬¡ä¿®æ”¹å¹¶æ²¡æœ‰æ›´æ–°versionå­—æ®µï¼ŒåŸå› æ˜¯æ²¡æœ‰æºå¸¦versionæ•°æ®ï¼Œæ¯æ¬¡éœ€è¦è·å–åˆ°è¿™ä¸ªæ•°æ®æ‰å¯ä»¥å¯¹å…¶è¿›è¡Œæ•°æ®ä¸Šçš„æ“ä½œã€‚</p><p>æ·»åŠ versionæ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">3L</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;Jock666&quot;</span>);</span><br><span class="line">        user.setVersion(<span class="number">1</span>);</span><br><span class="line">        userDao.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬ä¼ é€’çš„æ˜¯1ï¼ŒMPä¼šå°†1è¿›è¡ŒåŠ 1ï¼Œç„¶åï¼Œæ›´æ–°å›åˆ°æ•°æ®åº“è¡¨ä¸­ã€‚</p><p>æ‰€ä»¥è¦æƒ³å®ç°ä¹è§‚é”ï¼Œé¦–å…ˆç¬¬ä¸€æ­¥åº”è¯¥æ˜¯æ‹¿åˆ°è¡¨ä¸­çš„versionï¼Œç„¶åæ‹¿versionå½“æ¡ä»¶åœ¨å°†versionåŠ 1æ›´æ–°å›åˆ°æ•°æ®åº“è¡¨ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å…¶è¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testVersion</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectById(<span class="number">2L</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;BolgTest&quot;</span>);</span><br><span class="line">        userDao.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å‘ç°ï¼Œéœ€è¦å®ç°ç‰ˆæœ¬çš„æ›´æ–°é¦–å…ˆéœ€è¦è·å–åˆ°è¿™ä¸ªçŠ¶æ€å­—æ®µï¼Œè·å–æ–¹å¼</p><ol><li>æ‰‹åŠ¨è®¾å®š</li><li>ä½¿ç”¨æŸ¥è¯¢çš„æ–¹å¼</li><li>â€¦<br>å¤§æ¦‚åˆ†æå®Œä¹è§‚é”çš„å®ç°æ­¥éª¤ä»¥åï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ç§åŠ é”çš„æƒ…å†µï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å®ç°å¤šä¸ªäººä¿®æ”¹åŒä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œåªèƒ½æœ‰ä¸€ä¸ªäººä¿®æ”¹æˆåŠŸã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus03DqlApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//1.å…ˆé€šè¿‡è¦ä¿®æ”¹çš„æ•°æ®idå°†å½“å‰æ•°æ®æŸ¥è¯¢å‡ºæ¥</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectById(<span class="number">3L</span>);     <span class="comment">//version=3</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> userDao.selectById(<span class="number">3L</span>);    <span class="comment">//version=3</span></span><br><span class="line">        user2.setName(<span class="string">&quot;Jock aaa&quot;</span>);</span><br><span class="line">        userDao.updateById(user2);              <span class="comment">//version=&gt;4</span></span><br><span class="line">        user.setName(<span class="string">&quot;Jock bbb&quot;</span>);</span><br><span class="line">        userDao.updateById(user);               <span class="comment">//verion=3?æ¡ä»¶è¿˜æˆç«‹å—ï¼Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå‡ºç»“æœä¼šå‘ç°:<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-2.webp" alt=""><br>è¿™é‡Œæç¤ºå‡ºï¼Œæ˜æ˜¾åªæœ‰ç¬¬ä¸€ä¸ªç‰ˆæœ¬è¢«æ›´æ–°æˆåŠŸ</p><ul><li>ä¹è§‚é”ï¼š<br>å®é™…ä¸Šå®ç°å°±åªéœ€è¦ä¸‰æ­¥ï¼š</li></ul><ol><li>æ·»åŠ å­—æ®µ</li><li>æ·»åŠ Versionæ³¨è§£</li><li>æ·»åŠ æ‹¦æˆªå™¨å®ç°åŠ¨æ€sqlæ‹¼è£…<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-1.webp" alt=""></li></ol><p>ä¹è§‚é”å°±å·²ç»å®ç°å®Œæˆäº†ï¼Œå¦‚æœå¯¹äºä¸Šé¢çš„è¿™äº›æ­¥éª¤è¿˜æ˜¯è®°ä¸ä½å’‹åŠå‘¢?</p><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£æ¥å®ç°:</p><p><code>https://mp.baomidou.com/guide/interceptor-optimistic-locker.html#optimisticlockerinnerinterceptor</code></p><h2 id="5ï¼Œå¿«é€Ÿå¼€å‘"><a href="#5ï¼Œå¿«é€Ÿå¼€å‘" class="headerlink" title="5ï¼Œå¿«é€Ÿå¼€å‘"></a>5ï¼Œå¿«é€Ÿå¼€å‘</h2><h3 id="5-1-ä»£ç ç”Ÿæˆå™¨åŸç†åˆ†æ"><a href="#5-1-ä»£ç ç”Ÿæˆå™¨åŸç†åˆ†æ" class="headerlink" title="5.1 ä»£ç ç”Ÿæˆå™¨åŸç†åˆ†æ"></a>5.1 ä»£ç ç”Ÿæˆå™¨åŸç†åˆ†æ</h3><p>æˆ‘ä»¬ç»è¿‡MPçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆé¡¹ç›®çš„å¼€å‘ï¼Œéƒ½æœ‰ä¸€å¥—å›ºå®šæ­»æ¿çš„ä»£ç ï¼Œéƒ½æ˜¯é‡å¤å†…å¼„ï¼Œè€Œè¿™äº›å†…å®¹åœ¨æˆ‘ä»¬å­¦ä¹ é˜¶æ®µè¿˜å¥½ï¼Œä½†æ˜¯å¦‚æœåˆ°å®é™…å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å¯¹è¿™äº›å›ºå®šé‡å¤çš„å†…å®¹å¦‚æœè¿˜æ‰‹æ‰“å°±ä¼šèŠ±è´¹ä¸å°‘çš„æ—¶é—´ï¼Œé‚£æˆ‘ä»¬å°±æƒ³ï¼Œå¦‚æœæˆ‘æƒ³åšä¸€ä¸ªBookæ¨¡å—çš„å¼€å‘ï¼Œæ˜¯ä¸æ˜¯åªéœ€è¦å°†çº¢è‰²éƒ¨åˆ†çš„å†…å®¹å…¨éƒ¨æ›´æ¢æˆ<code>Book</code>å³å¯ï¼Œå¦‚ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-3.webp" alt=""></p><p>æ‰€ä»¥æˆ‘ä»¬ä¼šå‘ç°ï¼Œåšä»»ä½•æ¨¡å—çš„å¼€å‘ï¼Œå¯¹äºè¿™æ®µä»£ç ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å¯¹çº¢è‰²éƒ¨åˆ†çš„è°ƒæ•´ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå»æ‰çº¢è‰²å†…å®¹çš„ä¸œè¥¿ç§°ä¹‹ä¸º==æ¨¡æ¿==ï¼Œçº¢è‰²éƒ¨åˆ†ç§°ä¹‹ä¸º==å‚æ•°==ï¼Œä»¥ååªéœ€è¦ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œå°±å¯ä»¥æ ¹æ®æ¨¡æ¿åˆ›å»ºå‡ºä¸åŒæ¨¡å—çš„daoä»£ç ã€‚</p><p>é™¤äº†Daoå¯ä»¥æŠ½å–æ¨¡å—ï¼Œå…¶å®æˆ‘ä»¬å¸¸è§çš„ç±»éƒ½å¯ä»¥è¿›è¡ŒæŠ½å–ï¼Œåªè¦ä»–ä»¬æœ‰å…¬å…±éƒ¨åˆ†å³å¯ã€‚å†æ¥çœ‹ä¸‹æ¨¡å‹ç±»çš„æ¨¡æ¿ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-4.webp" alt=""><br><em>è¿™é‡Œå€Ÿç”¨æè€å¸ˆçš„å›¾ç‰‡</em></p><ul><li>â‘  å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨çš„è¡¨åæ¥å¡«å……</li><li>â‘¡ å¯ä»¥æ ¹æ®ç”¨æˆ·çš„é…ç½®æ¥ç”ŸæˆIDç”Ÿæˆç­–ç•¥</li><li>â‘¢åˆ°â‘¨å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨å­—æ®µåç§°æ¥å¡«å……</li></ul><p>æ‰€ä»¥åªè¦æˆ‘ä»¬çŸ¥é“æ˜¯å¯¹å“ªå¼ è¡¨è¿›è¡Œä»£ç ç”Ÿæˆï¼Œè¿™äº›å†…å®¹æˆ‘ä»¬éƒ½å¯ä»¥è¿›è¡Œå¡«å……ã€‚</p><p>åˆ†æå®Œåï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¦æƒ³å®Œæˆä»£ç è‡ªåŠ¨ç”Ÿæˆï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä»¥ä¸‹å†…å®¹:</p><ul><li>æ¨¡æ¿: MyBatisPlusæä¾›ï¼Œå¯ä»¥è‡ªå·±æä¾›ï¼Œä½†æ˜¯éº»çƒ¦ï¼Œä¸å»ºè®®</li><li>æ•°æ®åº“ç›¸å…³é…ç½®:è¯»å–æ•°æ®åº“è·å–è¡¨å’Œå­—æ®µä¿¡æ¯</li><li>å¼€å‘è€…è‡ªå®šä¹‰é…ç½®:æ‰‹å·¥é…ç½®ï¼Œæ¯”å¦‚IDç”Ÿæˆç­–ç•¥</li></ul><h3 id="5-2-ä»£ç ç”Ÿæˆå™¨å®ç°"><a href="#5-2-ä»£ç ç”Ÿæˆå™¨å®ç°" class="headerlink" title="5.2 ä»£ç ç”Ÿæˆå™¨å®ç°"></a>5.2 ä»£ç ç”Ÿæˆå™¨å®ç°</h3><h4 id="æ­¥éª¤1-åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®"><a href="#æ­¥éª¤1-åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®"></a>æ­¥éª¤1:åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®</h4><h4 id="ä»£ç 2-å¯¼å…¥å¯¹åº”çš„jaråŒ…"><a href="#ä»£ç 2-å¯¼å…¥å¯¹åº”çš„jaråŒ…" class="headerlink" title="ä»£ç 2:å¯¼å…¥å¯¹åº”çš„jaråŒ…"></a>ä»£ç 2:å¯¼å…¥å¯¹åº”çš„jaråŒ…</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.Blog-test<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatisplus_04_generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring webmvc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mybatisplus--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--druid--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--ä»£ç ç”Ÿæˆå™¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--velocityæ¨¡æ¿å¼•æ“--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤3-ç¼–å†™å¼•å¯¼ç±»"><a href="#æ­¥éª¤3-ç¼–å†™å¼•å¯¼ç±»" class="headerlink" title="æ­¥éª¤3:ç¼–å†™å¼•å¯¼ç±»"></a>æ­¥éª¤3:ç¼–å†™å¼•å¯¼ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Mybatisplus04GeneratorApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Mybatisplus04GeneratorApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤4-åˆ›å»ºä»£ç ç”Ÿæˆç±»"><a href="#æ­¥éª¤4-åˆ›å»ºä»£ç ç”Ÿæˆç±»" class="headerlink" title="æ­¥éª¤4:åˆ›å»ºä»£ç ç”Ÿæˆç±»"></a>æ­¥éª¤4:åˆ›å»ºä»£ç ç”Ÿæˆç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//1.è·å–ä»£ç ç”Ÿæˆå™¨çš„å¯¹è±¡</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®æ•°æ®åº“ç›¸å…³é…ç½®</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dataSource.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatisplus_db?serverTimezone=UTC&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        autoGenerator.setDataSource(dataSource);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®å…¨å±€é…ç½®</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">globalConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        globalConfig.setOutputDir(System.getProperty(<span class="string">&quot;user.dir&quot;</span>)+<span class="string">&quot;/mybatisplus_04_generator/src/main/java&quot;</span>);    <span class="comment">//è®¾ç½®ä»£ç ç”Ÿæˆä½ç½®</span></span><br><span class="line">        globalConfig.setOpen(<span class="literal">false</span>);    <span class="comment">//è®¾ç½®ç”Ÿæˆå®Œæ¯•åæ˜¯å¦æ‰“å¼€ç”Ÿæˆä»£ç æ‰€åœ¨çš„ç›®å½•</span></span><br><span class="line">        globalConfig.setAuthor(<span class="string">&quot;Bolg_test&quot;</span>);    <span class="comment">//è®¾ç½®ä½œè€…</span></span><br><span class="line">        globalConfig.setFileOverride(<span class="literal">true</span>);     <span class="comment">//è®¾ç½®æ˜¯å¦è¦†ç›–åŸå§‹ç”Ÿæˆçš„æ–‡ä»¶</span></span><br><span class="line">        globalConfig.setMapperName(<span class="string">&quot;%sDao&quot;</span>);    <span class="comment">//è®¾ç½®æ•°æ®å±‚æ¥å£åï¼Œ%sä¸ºå ä½ç¬¦ï¼ŒæŒ‡ä»£æ¨¡å—åç§°</span></span><br><span class="line">        globalConfig.setIdType(IdType.ASSIGN_ID);   <span class="comment">//è®¾ç½®Idç”Ÿæˆç­–ç•¥</span></span><br><span class="line">        autoGenerator.setGlobalConfig(globalConfig);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®åŒ…åç›¸å…³é…ç½®</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">packageInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        packageInfo.setParent(<span class="string">&quot;com.aaa&quot;</span>);   <span class="comment">//è®¾ç½®ç”Ÿæˆçš„åŒ…åï¼Œä¸ä»£ç æ‰€åœ¨ä½ç½®ä¸å†²çªï¼ŒäºŒè€…å åŠ ç»„æˆå®Œæ•´è·¯å¾„</span></span><br><span class="line">        packageInfo.setEntity(<span class="string">&quot;domain&quot;</span>);    <span class="comment">//è®¾ç½®å®ä½“ç±»åŒ…å</span></span><br><span class="line">        packageInfo.setMapper(<span class="string">&quot;dao&quot;</span>);   <span class="comment">//è®¾ç½®æ•°æ®å±‚åŒ…å</span></span><br><span class="line">        autoGenerator.setPackageInfo(packageInfo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç­–ç•¥è®¾ç½®</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategyConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategyConfig.setInclude(<span class="string">&quot;tbl_user&quot;</span>);  <span class="comment">//è®¾ç½®å½“å‰å‚ä¸ç”Ÿæˆçš„è¡¨åï¼Œå‚æ•°ä¸ºå¯å˜å‚æ•°</span></span><br><span class="line">        strategyConfig.setTablePrefix(<span class="string">&quot;tbl_&quot;</span>);  <span class="comment">//è®¾ç½®æ•°æ®åº“è¡¨çš„å‰ç¼€åç§°ï¼Œæ¨¡å—å = æ•°æ®åº“è¡¨å - å‰ç¼€å  ä¾‹å¦‚ï¼š User = tbl_user - tbl_</span></span><br><span class="line">        strategyConfig.setRestControllerStyle(<span class="literal">true</span>);    <span class="comment">//è®¾ç½®æ˜¯å¦å¯ç”¨Resté£æ ¼</span></span><br><span class="line">        strategyConfig.setVersionFieldName(<span class="string">&quot;version&quot;</span>);  <span class="comment">//è®¾ç½®ä¹è§‚é”å­—æ®µå</span></span><br><span class="line">        strategyConfig.setLogicDeleteFieldName(<span class="string">&quot;deleted&quot;</span>);  <span class="comment">//è®¾ç½®é€»è¾‘åˆ é™¤å­—æ®µå</span></span><br><span class="line">        strategyConfig.setEntityLombokModel(<span class="literal">true</span>);  <span class="comment">//è®¾ç½®æ˜¯å¦å¯ç”¨lombok</span></span><br><span class="line">        autoGenerator.setStrategy(strategyConfig);</span><br><span class="line">        <span class="comment">//2.æ‰§è¡Œç”Ÿæˆæ“ä½œ</span></span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºä»£ç ç”Ÿæˆå™¨ä¸­çš„ä»£ç å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»å®˜æ–¹æ–‡æ¡£ä¸­è·å–ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œ</p><p><code>https://mp.baomidou.com/guide/generator.html</code></p><h4 id="æ­¥éª¤5-è¿è¡Œç¨‹åº"><a href="#æ­¥éª¤5-è¿è¡Œç¨‹åº" class="headerlink" title="æ­¥éª¤5:è¿è¡Œç¨‹åº"></a>æ­¥éª¤5:è¿è¡Œç¨‹åº</h4><p>è¿è¡ŒæˆåŠŸåï¼Œä¼šåœ¨å½“å‰é¡¹ç›®ä¸­ç”Ÿæˆå¾ˆå¤šä»£ç ï¼Œä»£ç åŒ…å«<code>controller</code>,<code>service</code>ï¼Œ<code>mapper</code>å’Œ<code>entity</code></p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-5.webp" alt=""></p><p>è‡³æ­¤ä»£ç ç”Ÿæˆå™¨å°±å·²ç»å®Œæˆå·¥ä½œï¼Œæˆ‘ä»¬èƒ½å¿«é€Ÿæ ¹æ®æ•°æ®åº“è¡¨æ¥åˆ›å»ºå¯¹åº”çš„ç±»ï¼Œç®€åŒ–æˆ‘ä»¬çš„ä»£ç å¼€å‘ã€‚</p><h3 id="5-3-MPä¸­Serviceçš„CRUD"><a href="#5-3-MPä¸­Serviceçš„CRUD" class="headerlink" title="5.3 MPä¸­Serviceçš„CRUD"></a>5.3 MPä¸­Serviceçš„CRUD</h3><p>å›é¡¾æˆ‘ä»¬ä¹‹å‰ä¸šåŠ¡å±‚ä»£ç çš„ç¼–å†™ï¼Œç¼–å†™æ¥å£å’Œå¯¹åº”çš„å®ç°ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£å’Œå®ç°ç±»æœ‰äº†ä»¥åï¼Œéœ€è¦åœ¨æ¥å£å’Œå®ç°ç±»ä¸­å£°æ˜æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.selectList(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MPçœ‹åˆ°ä¸Šé¢çš„ä»£ç ä»¥åå°±è¯´è¿™äº›æ–¹æ³•ä¹Ÿæ˜¯æ¯”è¾ƒå›ºå®šå’Œé€šç”¨çš„ï¼Œé‚£æˆ‘æ¥å¸®ä½ æŠ½å–ä¸‹ï¼Œæ‰€ä»¥MPæä¾›äº†ä¸€ä¸ªServiceæ¥å£å’Œå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯:<code>IService</code>å’Œ<code>ServiceImpl</code>,åè€…æ˜¯å¯¹å‰è€…çš„ä¸€ä¸ªå…·ä½“å®ç°ã€‚</p><p>ä»¥åæˆ‘ä»¬è‡ªå·±å†™çš„Serviceå°±å¯ä»¥è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserDao, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä»¥åçš„å¥½å¤„æ˜¯ï¼ŒMPå·²ç»å¸®æˆ‘ä»¬æŠŠä¸šåŠ¡å±‚çš„ä¸€äº›åŸºç¡€çš„å¢åˆ æ”¹æŸ¥éƒ½å·²ç»å®ç°äº†ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä½¿ç”¨ã€‚</p><p>ç¼–å†™æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mybatisplus04GeneratorApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; list = userService.list();</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> mybatisplus_04_generatoré¡¹ç›®ä¸­å¯¹äºMyBatisçš„ç¯å¢ƒæ˜¯æ²¡æœ‰è¿›è¡Œé…ç½®ï¼Œå¦‚æœæƒ³è¦è¿è¡Œï¼Œéœ€è¦æå–å°†é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œå®Œå–„ååœ¨è¿è¡Œã€‚</p><p>è‡³æ­¤ï¼ŒMPä¹Ÿå‘Šä¸€æ®µè½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot</title>
      <link href="/posts/1864766114.html"/>
      <url>/posts/1864766114.html</url>
      
        <content type="html"><![CDATA[<div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=553267404&&page=1&as_wide=1&high_quality=1&danmaku=0"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     high_quality=1    danmaku=1     allowfullscreen="true">     </iframe></div><h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><p><strong>ä»Šæ—¥ç›®æ ‡ï¼š</strong></p><blockquote><ul><li>æŒæ¡åŸºäºSpringBootæ¡†æ¶çš„ç¨‹åºå¼€å‘æ­¥éª¤</li><li>ç†Ÿç»ƒä½¿ç”¨SpringBooté…ç½®ä¿¡æ¯ä¿®æ”¹æœåŠ¡å™¨é…ç½®</li><li>åŸºäºSpringBootçš„å®ŒæˆSSMæ•´åˆé¡¹ç›®å¼€å‘</li></ul></blockquote><h2 id="1ï¼ŒSpringBootç®€ä»‹"><a href="#1ï¼ŒSpringBootç®€ä»‹" class="headerlink" title="1ï¼ŒSpringBootç®€ä»‹"></a>1ï¼ŒSpringBootç®€ä»‹</h2><p><code>SpringBoot</code> æ˜¯ç”± <code>Pivotal</code> å›¢é˜Ÿæä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥==ç®€åŒ–== <code>Spring</code> åº”ç”¨çš„==åˆå§‹æ­å»º==ä»¥åŠ==å¼€å‘è¿‡ç¨‹==ã€‚</p><p>ä½¿ç”¨äº† <code>Spring</code> æ¡†æ¶åå·²ç»ç®€åŒ–äº†æˆ‘ä»¬çš„å¼€å‘ã€‚è€Œ <code>SpringBoot</code> åˆæ˜¯å¯¹ <code>Spring</code> å¼€å‘è¿›è¡Œç®€åŒ–çš„ï¼Œå¯æƒ³è€ŒçŸ¥ <code>SpringBoot</code> ä½¿ç”¨çš„ç®€å•åŠå¹¿æ³›æ€§ã€‚æ—¢ç„¶ <code>SpringBoot</code> æ˜¯ç”¨æ¥ç®€åŒ– <code>Spring</code> å¼€å‘çš„ï¼Œé‚£æˆ‘ä»¬å°±å…ˆå›é¡¾ä¸€ä¸‹ï¼Œä»¥ <code>SpringMVC</code> å¼€å‘ä¸ºä¾‹ï¼š</p><ol><li><strong>åˆ›å»ºå·¥ç¨‹ï¼Œå¹¶åœ¨ <code>pom.xml</code> é…ç½®æ–‡ä»¶ä¸­é…ç½®æ‰€ä¾èµ–çš„åæ ‡</strong></li><li><strong>ç¼–å†™ <code>web3.0</code> çš„é…ç½®ç±»</strong></li><li><strong>ç¼–å†™ <code>SpringMVC</code> çš„é…ç½®ç±»</strong></li><li><strong>ç¼–å†™ <code>Controller</code> ç±»</strong></li></ol><p>å…‰æ˜¯é…ç½®ç±»å°±éœ€è¦é…ç½®è¿™ä¹ˆå¤šé¡¹ï¼Œ <code>SpringMVC</code> ç¨‹åºå¼€å‘å¯ä»¥çœ‹åˆ°ï¼Œå‰ä¸‰æ­¥éƒ½æ˜¯åœ¨æ­å»ºç¯å¢ƒï¼Œè€Œä¸”è¿™ä¸‰æ­¥åŸºæœ¬éƒ½æ˜¯å›ºå®šçš„ã€‚<code>SpringBoot</code> å°±æ˜¯å¯¹è¿™ä¸‰æ­¥è¿›è¡Œç®€åŒ–äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…¥é—¨æ¡ˆä¾‹æ¥ä½“ç° <code>SpingBoot</code> ç®€åŒ– <code>Spring</code> å¼€å‘ã€‚</p><h3 id="1-1-SpringBootå¿«é€Ÿå…¥é—¨"><a href="#1-1-SpringBootå¿«é€Ÿå…¥é—¨" class="headerlink" title="1.1  SpringBootå¿«é€Ÿå…¥é—¨"></a>1.1  SpringBootå¿«é€Ÿå…¥é—¨</h3><h4 id="1-1-1-å¼€å‘æ­¥éª¤"><a href="#1-1-1-å¼€å‘æ­¥éª¤" class="headerlink" title="1.1.1  å¼€å‘æ­¥éª¤"></a>1.1.1  å¼€å‘æ­¥éª¤</h4><p><code>SpringBoot</code> å¼€å‘èµ·æ¥ç‰¹åˆ«ç®€å•ï¼Œåˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p><ul><li>åˆ›å»ºæ–°æ¨¡å—ï¼Œé€‰æ‹©Springåˆå§‹åŒ–ï¼Œå¹¶é…ç½®æ¨¡å—ç›¸å…³åŸºç¡€ä¿¡æ¯</li><li>é€‰æ‹©å½“å‰æ¨¡å—éœ€è¦ä½¿ç”¨çš„æŠ€æœ¯é›†</li><li>å¼€å‘æ§åˆ¶å™¨ç±»</li><li>è¿è¡Œè‡ªåŠ¨ç”Ÿæˆçš„Applicationç±»</li></ul><p>çŸ¥é“äº† <code>SpringBoot</code> çš„å¼€å‘æ­¥éª¤åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œå…·ä½“çš„æ“ä½œ</p><h5 id="1-1-1-1-åˆ›å»ºæ–°æ¨¡å—"><a href="#1-1-1-1-åˆ›å»ºæ–°æ¨¡å—" class="headerlink" title="1.1.1.1  åˆ›å»ºæ–°æ¨¡å—"></a>1.1.1.1  åˆ›å»ºæ–°æ¨¡å—</h5><ul><li><p>ç‚¹å‡» <code>+</code> é€‰æ‹© <code>New Module</code> åˆ›å»ºæ–°æ¨¡å—</p></li><li><p>é€‰æ‹© <code>Spring Initializr</code> ï¼Œç”¨æ¥åˆ›å»º <code>SpringBoot</code> å·¥ç¨‹</p><p>ä»¥å‰æˆ‘ä»¬é€‰æ‹©çš„æ˜¯ <code>Maven</code> ï¼Œä»Šå¤©é€‰æ‹© <code>Spring Initializr</code> æ¥å¿«é€Ÿæ„å»º <code>SpringBoot</code> å·¥ç¨‹ã€‚è€Œåœ¨ <code>Module SDK</code> è¿™ä¸€é¡¹é€‰æ‹©æˆ‘ä»¬å®‰è£…çš„ <code>JDK</code> ç‰ˆæœ¬ã€‚</p></li><li><p>å¯¹ <code>SpringBoot</code> å·¥ç¨‹è¿›è¡Œç›¸å…³çš„è®¾ç½®</p><p>æˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹å¼æ„å»ºçš„ <code>SpringBoot</code> å·¥ç¨‹å…¶å®ä¹Ÿæ˜¯ <code>Maven</code> å·¥ç¨‹ï¼Œè€Œè¯¥æ–¹å¼åªæ˜¯ä¸€ç§å¿«é€Ÿæ„å»ºçš„æ–¹å¼è€Œå·²ã€‚</p><blockquote><p>==æ³¨æ„ï¼šæ‰“åŒ…æ–¹å¼è¿™é‡Œéœ€è¦è®¾ç½®ä¸º <code>Jar</code>==</p></blockquote></li><li><p>é€‰ä¸­ <code>Web</code>ï¼Œç„¶åå‹¾é€‰ <code>Spring Web</code></p><p>ç”±äºæˆ‘ä»¬éœ€è¦å¼€å‘ä¸€ä¸ª <code>web</code> ç¨‹åºï¼Œä½¿ç”¨åˆ°äº† <code>SpringMVC</code> æŠ€æœ¯ï¼Œæ³¨æ„ç›®å‰åªéœ€è¦å‹¾é€‰è¿™ä¸€ä¸ªå³å¯ã€‚</p></li><li><p>æˆ‘ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ideaï¼Œç•Œé¢å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä¹‹åç›´æ¥okå³å¯ï¼Œæ³¨æ„ç‚¹éƒ½åœ¨ä¸Šé¢çš„æ­¥éª¤ã€‚</p></li></ul><p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤åå‡ºç°å‡ ä¸ªæ¨¡å—ï¼Œå®ƒä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª <code>Application</code> ç±»ï¼Œè€Œè¯¥ç±»ä¸€ä¼šå†å¯åŠ¨æœåŠ¡å™¨æ—¶ä¼šç”¨åˆ°</p><blockquote><p>==æ³¨æ„ï¼š==</p><ol><li><p>åœ¨åˆ›å»ºå¥½çš„å·¥ç¨‹ä¸­ä¸éœ€è¦åˆ›å»ºé…ç½®ç±»</p></li><li><p>åˆ›å»ºå¥½çš„é¡¹ç›®ä¼šè‡ªåŠ¨ç”Ÿæˆå…¶ä»–çš„ä¸€äº›æ–‡ä»¶ï¼Œè€Œè¿™äº›æ–‡ä»¶ç›®å‰å¯¹æˆ‘ä»¬æ¥è¯´æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œæ‰€ä»¥å¯ä»¥å°†è¿™äº›æ–‡ä»¶åˆ é™¤ã€‚</p><p>å¯ä»¥åˆ é™¤çš„ç›®å½•å’Œæ–‡ä»¶å¦‚ä¸‹ï¼š</p><ul><li><code>.mvn</code>    </li><li><code>.gitignore</code></li><li><code>HELP.md</code></li><li><code>mvnw</code></li><li><code>mvnw.cmd</code></li></ul></li></ol></blockquote><h5 id="1-1-1-2-åˆ›å»º-Controller"><a href="#1-1-1-2-åˆ›å»º-Controller" class="headerlink" title="1.1.1.2  åˆ›å»º Controller"></a>1.1.1.2  åˆ›å»º <code>Controller</code></h5><p>åœ¨  <code>com.blog.controller</code> åŒ…ä¸‹åˆ›å»º <code>BookController</code> ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id ==&gt; &quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello , spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="1-1-1-3-å¯åŠ¨æœåŠ¡å™¨"><a href="#1-1-1-3-å¯åŠ¨æœåŠ¡å™¨" class="headerlink" title="1.1.1.3  å¯åŠ¨æœåŠ¡å™¨"></a>1.1.1.3  å¯åŠ¨æœåŠ¡å™¨</h5><p>è¿è¡Œ <code>SpringBoot</code> å·¥ç¨‹ä¸éœ€è¦ä½¿ç”¨æœ¬åœ°çš„ <code>Tomcat</code> å’Œ æ’ä»¶ï¼Œç›´æ¥ç¼“è§£äº†æˆ‘æœ¬äººåœ¨å­¦ä¹ springMVCæ—¶å€™è¿è¡Œtomcatç»å¸¸æŠ¥é”™çš„ç—›è‹¦ï¼Œåªè¿è¡Œé¡¹ç›® <code>com.blog</code> åŒ…ä¸‹çš„ <code>Application</code> ç±»ã€‚<br>å‡ºç°å¦‚ä¸‹å°±è¯´æ˜å·²ç»å¯åŠ¨æˆåŠŸäº†ï¼š<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110190921.png" alt=""></p><h5 id="1-1-1-4-è¿›è¡Œæµ‹è¯•"><a href="#1-1-1-4-è¿›è¡Œæµ‹è¯•" class="headerlink" title="1.1.1.4  è¿›è¡Œæµ‹è¯•"></a>1.1.1.4  è¿›è¡Œæµ‹è¯•</h5><p>ä½¿ç”¨ <code>Postman</code> å·¥å…·æ¥æµ‹è¯•æˆ‘ä»¬çš„ç¨‹åºï¼Œå¦‚ä¸‹å›¾<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110191216.png" alt=""></p><p>é€šè¿‡ä¸Šé¢çš„å…¥é—¨æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ <code>SpringBoot</code> è¿›è¡Œå¼€å‘ï¼Œä½¿æ•´ä¸ªå¼€å‘å˜å¾—å¾ˆç®€å•ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</p><p>è¦ç ”ç©¶è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çœ‹çœ‹ <code>Application</code> ç±»å’Œ <code>pom.xml</code> éƒ½ä¹¦å†™äº†ä»€ä¹ˆã€‚å…ˆçœ‹çœ‹ <code>Applicaion</code> ç±»ï¼Œè¯¥ç±»å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»ä¸­çš„ä¸œè¥¿å¾ˆç®€å•ï¼Œå°±åœ¨ç±»ä¸Šæ·»åŠ äº†ä¸€ä¸ª <code>@SpringBootApplication</code> æ³¨è§£ï¼Œè€Œåœ¨ä¸»æ–¹æ³•ä¸­å°±ä¸€è¡Œä»£ç ã€‚æˆ‘ä»¬åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶å°±æ˜¯æ‰§è¡Œçš„è¯¥ç±»ä¸­çš„ä¸»æ–¹æ³•ã€‚</p><p>å†çœ‹çœ‹ <code>pom.xml</code> é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--æŒ‡å®šäº†ä¸€ä¸ªçˆ¶å·¥ç¨‹ï¼Œçˆ¶å·¥ç¨‹ä¸­çš„ä¸œè¥¿åœ¨è¯¥å·¥ç¨‹ä¸­å¯ä»¥ç»§æ‰¿è¿‡æ¥ä½¿ç”¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.blog<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot_01_quickstart<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--JDK çš„ç‰ˆæœ¬--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è¯¥ä¾èµ–å°±æ˜¯æˆ‘ä»¬åœ¨åˆ›å»º SpringBoot å·¥ç¨‹å‹¾é€‰çš„é‚£ä¸ª Spring Web äº§ç”Ÿçš„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--è¿™ä¸ªæ˜¯å•å…ƒæµ‹è¯•çš„ä¾èµ–ï¼Œæˆ‘ä»¬ç°åœ¨æ²¡æœ‰è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥è¿™ä¸ªä¾èµ–ç°åœ¨å¯ä»¥æ²¡æœ‰--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--è¿™ä¸ªæ’ä»¶æ˜¯åœ¨æ‰“åŒ…æ—¶éœ€è¦çš„ï¼Œè€Œè¿™é‡Œæš‚æ—¶è¿˜æ²¡æœ‰ç”¨åˆ°--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»£ç ä¹‹æ‰€ä»¥èƒ½ç®€åŒ–ï¼Œå°±æ˜¯å› ä¸ºæŒ‡å®šçš„çˆ¶å·¥ç¨‹å’Œ <code>Spring Web</code> ä¾èµ–å®ç°çš„ã€‚å…·ä½“çš„æˆ‘ä»¬åé¢åœ¨èŠã€‚</p><h4 id="1-1-2-å¯¹æ¯”"><a href="#1-1-2-å¯¹æ¯”" class="headerlink" title="1.1.2  å¯¹æ¯”"></a>1.1.2  å¯¹æ¯”</h4><p>åšå®Œ <code>SpringBoot</code> çš„å…¥é—¨æ¡ˆä¾‹åï¼Œæ¥ä¸‹æ¥å¯¹æ¯”ä¸€ä¸‹ <code>Spring</code> ç¨‹åºå’Œ <code>SpringBoot</code> ç¨‹åºã€‚å¦‚ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110191643.png" alt=""></p><ul><li><p><strong>åæ ‡</strong></p><p><code>Spring</code> ç¨‹åºä¸­çš„åæ ‡éœ€è¦è‡ªå·±ç¼–å†™ï¼Œè€Œä¸”åæ ‡éå¸¸å¤š</p><p><code>SpringBoot</code> ç¨‹åºä¸­çš„åæ ‡æ˜¯æˆ‘ä»¬åœ¨åˆ›å»ºå·¥ç¨‹æ—¶è¿›è¡Œå‹¾é€‰è‡ªåŠ¨ç”Ÿæˆçš„</p></li><li><p><strong>web3.0é…ç½®ç±»</strong></p><p><code>Spring</code> ç¨‹åºéœ€è¦è‡ªå·±ç¼–å†™è¿™ä¸ªé…ç½®ç±»ã€‚è¿™ä¸ªé…ç½®ç±»å¤§å®¶ä¹‹å‰ç¼–å†™è¿‡ï¼Œè‚¯å®šæ„Ÿè§‰å¾ˆå¤æ‚</p><p><code>SpringBoot</code> ç¨‹åºä¸éœ€è¦æˆ‘ä»¬è‡ªå·±ä¹¦å†™</p></li><li><p><strong>é…ç½®ç±»</strong></p><p><code>Spring/SpringMVC</code> ç¨‹åºçš„é…ç½®ç±»éœ€è¦è‡ªå·±ä¹¦å†™ã€‚è€Œ <code>SpringBoot</code>  ç¨‹åºåˆ™ä¸éœ€è¦ä¹¦å†™ã€‚</p></li></ul><blockquote><p>==æ³¨æ„ï¼šåŸºäºIdeaçš„ <code>Spring Initializr</code> å¿«é€Ÿæ„å»º <code>SpringBoot</code> å·¥ç¨‹æ—¶éœ€è¦è”ç½‘ã€‚== </p></blockquote><h4 id="1-1-3-å®˜ç½‘æ„å»ºå·¥ç¨‹"><a href="#1-1-3-å®˜ç½‘æ„å»ºå·¥ç¨‹" class="headerlink" title="1.1.3  å®˜ç½‘æ„å»ºå·¥ç¨‹"></a>1.1.3  å®˜ç½‘æ„å»ºå·¥ç¨‹</h4><p>åœ¨å…¥é—¨æ¡ˆä¾‹ä¸­ä¹‹æ‰€ä»¥èƒ½å¿«é€Ÿæ„å»º <code>SpringBoot</code> å·¥ç¨‹ï¼Œæ˜¯å› ä¸º <code>Idea</code> ä½¿ç”¨äº†å®˜ç½‘æä¾›äº†å¿«é€Ÿæ„å»º <code>SpringBoot</code> å·¥ç¨‹çš„ç»„ä»¶å®ç°çš„ã€‚é‚£å¦‚ä½•åœ¨å®˜ç½‘è¿›è¡Œå·¥ç¨‹æ„å»ºå‘¢ï¼Ÿé€šè¿‡å¦‚ä¸‹æ­¥éª¤æ„å»º</p><h5 id="1-1-3-1-è¿›å…¥SpringBootå®˜ç½‘"><a href="#1-1-3-1-è¿›å…¥SpringBootå®˜ç½‘" class="headerlink" title="1.1.3.1  è¿›å…¥SpringBootå®˜ç½‘"></a>1.1.3.1  è¿›å…¥SpringBootå®˜ç½‘</h5><p>å®˜ç½‘åœ°å€å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://spring.io/projects/spring-boot</span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ° <code>SpringBoot</code> å®˜ç½‘åæ‹–åˆ°æœ€ä¸‹æ–¹å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110191742.png" alt=""></p><p>ç„¶åç‚¹å‡» <code>Spring Initializr</code> è¶…é“¾æ¥å°±ä¼šè·³è½¬åˆ°å¦‚ä¸‹é¡µé¢<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110191941.png" alt=""></p><p>è¿™ä¸ªé¡µé¢å†…å®¹æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆçœ¼ç†Ÿçš„ï¼Œè¿™å’Œæˆ‘ä»¬ä½¿ç”¨ <code>Idea</code> å¿«é€Ÿæ„å»º <code>SpringBoot</code> å·¥ç¨‹çš„ç•Œé¢åŸºæœ¬ç›¸åŒï¼Œé…ç½®å¦‚ä¸Šå›¾å³å¯ï¼Œè¿™æ˜¯æˆ‘çš„é…ç½®ã€‚<br><em>æ³¨æ„ï¼šè¦åˆ é™¤åŒ…åçš„æ·»åŠ åŒ…ï¼Œä¸ç„¶ä¼šå¾ˆéº»çƒ¦</em></p><h5 id="1-1-3-2-é€‰æ‹©ä¾èµ–"><a href="#1-1-3-2-é€‰æ‹©ä¾èµ–" class="headerlink" title="1.1.3.2  é€‰æ‹©ä¾èµ–"></a>1.1.3.2  é€‰æ‹©ä¾èµ–</h5><p>é€‰æ‹© <code>Spring Web</code> å¯ä»¥ç‚¹å‡»ä¸Šå›¾å³ä¸Šè§’çš„ <code>ADD DEPENDENCIES... CTRL + B</code> æŒ‰é’®ï¼Œå°±ä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110192124.png" alt=""></p><h5 id="1-1-3-3-ç”Ÿæˆå·¥ç¨‹"><a href="#1-1-3-3-ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="1.1.3.3  ç”Ÿæˆå·¥ç¨‹"></a>1.1.3.3  ç”Ÿæˆå·¥ç¨‹</h5><p>ä»¥ä¸Šæ­¥éª¤å®Œæˆåå°±å¯ä»¥ç”Ÿæˆ <code>SpringBoot</code> å·¥ç¨‹äº†ã€‚åœ¨é¡µé¢çš„æœ€ä¸‹æ–¹ç‚¹å‡» <code>GENERATE CTRL + å›è½¦</code> æŒ‰é’®ç”Ÿæˆå·¥ç¨‹å¹¶ä¸‹è½½åˆ°æœ¬åœ°</p><p>æ‰“å¼€ä¸‹è½½å¥½çš„å‹ç¼©åŒ…å¯ä»¥çœ‹åˆ°å·¥ç¨‹ç»“æ„å’Œä½¿ç”¨ <code>Idea</code> ç”Ÿæˆçš„ä¸€æ¨¡ä¸€æ ·</p><p>è€Œæ‰“å¼€ <code>pom.xml</code> æ–‡ä»¶ï¼Œé‡Œé¢ä¹ŸåŒ…å«äº†çˆ¶å·¥ç¨‹å’Œ <code>Spring Web</code> çš„ä¾èµ–ã€‚</p><p>é€šè¿‡ä¸Šé¢å®˜ç½‘çš„æ“ä½œï¼Œæˆ‘ä»¬çŸ¥é“ <code>Idea</code> ä¸­å¿«é€Ÿæ„å»º <code>SpringBoot</code> å·¥ç¨‹å…¶å®å°±æ˜¯ä½¿ç”¨çš„å®˜ç½‘çš„å¿«é€Ÿæ„å»ºç»„ä»¶ï¼Œé‚£ä»¥åå³ä½¿æ²¡æœ‰ <code>Idea</code> ä¹Ÿå¯ä»¥ä½¿ç”¨å®˜ç½‘çš„æ–¹å¼æ„å»º <code>SpringBoot</code> å·¥ç¨‹ã€‚</p><h4 id="1-1-4-SpringBootå·¥ç¨‹å¿«é€Ÿå¯åŠ¨"><a href="#1-1-4-SpringBootå·¥ç¨‹å¿«é€Ÿå¯åŠ¨" class="headerlink" title="1.1.4  SpringBootå·¥ç¨‹å¿«é€Ÿå¯åŠ¨"></a>1.1.4  SpringBootå·¥ç¨‹å¿«é€Ÿå¯åŠ¨</h4><h5 id="1-1-4-1-é—®é¢˜å¯¼å…¥"><a href="#1-1-4-1-é—®é¢˜å¯¼å…¥" class="headerlink" title="1.1.4.1  é—®é¢˜å¯¼å…¥"></a>1.1.4.1  é—®é¢˜å¯¼å…¥</h5><p>è¿™æ ·çœ‹éš¾é“å‰ç«¯ä¹Ÿéœ€è¦ä¸‹è½½ideaä»¥åŠtomcatï¼Ÿ</p><p>ä»¥åæˆ‘ä»¬å’Œå‰ç«¯å¼€å‘äººå‘˜ååŒå¼€å‘ï¼Œè€Œå‰ç«¯å¼€å‘äººå‘˜éœ€è¦æµ‹è¯•å‰ç«¯ç¨‹åºå°±éœ€è¦åç«¯å¼€å¯æœåŠ¡å™¨ï¼Œè¿™å°±å—åˆ¶äºåç«¯å¼€å‘äººå‘˜ã€‚ä¸ºäº†æ‘†è„±è¿™ä¸ªå—åˆ¶ï¼Œå‰ç«¯å¼€å‘äººå‘˜å°è¯•ç€åœ¨è‡ªå·±ç”µè„‘ä¸Šå®‰è£… <code>Tomcat</code> å’Œ <code>Idea</code> ï¼Œåœ¨è‡ªå·±ç”µè„‘ä¸Šå¯åŠ¨åç«¯ç¨‹åºï¼Œè¿™æ˜¾ç„¶ä¸ç°å®ã€‚</p><p>æˆ‘ä»¬åç«¯å¯ä»¥å°† <code>SpringBoot</code> å·¥ç¨‹æ‰“æˆ <code>jar</code> åŒ…ï¼Œè¯¥ <code>jar</code> åŒ…è¿è¡Œä¸ä¾èµ–äº <code>Tomcat</code> å’Œ <code>Idea</code> è¿™äº›å·¥å…·ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯è¿™ä¸ª <code>jar</code> åŒ…åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿æ¥å’Œæˆ‘ä»¬è‡ªå·±ç¨‹åºç›¸åŒçš„ <code>Mysql</code> æ•°æ®åº“å³å¯ã€‚è¿™æ ·å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110192417.png" alt=""></p><p>é‚£ç°åœ¨é—®é¢˜æ˜¯å¦‚ä½•æ‰“åŒ…å‘¢ï¼Ÿ</p><h5 id="1-1-4-2-æ‰“åŒ…"><a href="#1-1-4-2-æ‰“åŒ…" class="headerlink" title="1.1.4.2  æ‰“åŒ…"></a>1.1.4.2  æ‰“åŒ…</h5><p>ç”±äºæˆ‘ä»¬åœ¨æ„å»º <code>SpringBoot</code> å·¥ç¨‹æ—¶å·²ç»åœ¨ <code>pom.xml</code> ä¸­é…ç½®äº†å¦‚ä¸‹æ’ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>Maven</code> çš„ <code>package</code> æŒ‡ä»¤æ‰“åŒ…å°±ä¼šåœ¨ <code>target</code> ç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„ <code>Jar</code> åŒ…ã€‚</p><blockquote><p>==æ³¨æ„ï¼šè¯¥æ’ä»¶å¿…é¡»é…ç½®ï¼Œä¸ç„¶æ‰“å¥½çš„ <code>jar</code> åŒ…ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ã€‚==</p></blockquote><h5 id="1-1-4-3-å¯åŠ¨"><a href="#1-1-4-3-å¯åŠ¨" class="headerlink" title="1.1.4.3  å¯åŠ¨"></a>1.1.4.3  å¯åŠ¨</h5><p>è¿›å…¥ <code>jar</code> åŒ…æ‰€åœ¨ä½ç½®ï¼Œåœ¨ <code>å‘½ä»¤æç¤ºç¬¦</code> ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -jar springboot_01_quickstart-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤å°±å¯ä»¥çœ‹åˆ° <code>SpringBoot</code> è¿è¡Œçš„æ—¥å¿—ä¿¡æ¯ã€‚</p><h3 id="1-2-SpringBootæ¦‚è¿°"><a href="#1-2-SpringBootæ¦‚è¿°" class="headerlink" title="1.2  SpringBootæ¦‚è¿°"></a>1.2  SpringBootæ¦‚è¿°</h3><p><code>SpringBoot</code> æ˜¯ç”±Pivotalå›¢é˜Ÿæä¾›çš„å…¨æ–°æ¡†æ¶ï¼Œå…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥==ç®€åŒ–==Springåº”ç”¨çš„==åˆå§‹æ­å»º==ä»¥åŠ==å¼€å‘è¿‡ç¨‹==ã€‚</p><p>å¤§å®¶å·²ç»æ„Ÿå—äº† <code>SpringBoot</code> ç¨‹åºï¼Œå›è¿‡å¤´çœ‹çœ‹ <code>SpringBoot</code> ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯ç®€åŒ– <code>Spring</code> çš„æ­å»ºè¿‡ç¨‹å’Œå¼€å‘è¿‡ç¨‹ã€‚</p><p>åŸå§‹ <code>Spring</code> ç¯å¢ƒæ­å»ºå’Œå¼€å‘å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>é…ç½®ç¹ç</li><li>ä¾èµ–è®¾ç½®ç¹ç</li></ul><p><code>SpringBoot</code> ç¨‹åºä¼˜ç‚¹æ°å·§å°±æ˜¯é’ˆå¯¹ <code>Spring</code> çš„ç¼ºç‚¹</p><ul><li>è‡ªåŠ¨é…ç½®ã€‚è¿™ä¸ªæ˜¯ç”¨æ¥è§£å†³ <code>Spring</code> ç¨‹åºé…ç½®ç¹ççš„é—®é¢˜</li><li>èµ·æ­¥ä¾èµ–ã€‚è¿™ä¸ªæ˜¯ç”¨æ¥è§£å†³ <code>Spring</code> ç¨‹åºä¾èµ–è®¾ç½®ç¹ççš„é—®é¢˜</li><li>è¾…åŠ©åŠŸèƒ½ï¼ˆå†…ç½®æœåŠ¡å™¨,â€¦ï¼‰ã€‚æˆ‘ä»¬åœ¨å¯åŠ¨ <code>SpringBoot</code> ç¨‹åºæ—¶æ—¢æ²¡æœ‰ä½¿ç”¨æœ¬åœ°çš„ <code>tomcat</code> ä¹Ÿæ²¡æœ‰ä½¿ç”¨ <code>tomcat</code> æ’ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>SpringBoot</code> å†…ç½®çš„æœåŠ¡å™¨ã€‚</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ <code>SpringBoot</code> çš„èµ·æ­¥ä¾èµ–</p><h4 id="1-2-1-èµ·æ­¥ä¾èµ–"><a href="#1-2-1-èµ·æ­¥ä¾èµ–" class="headerlink" title="1.2.1  èµ·æ­¥ä¾èµ–"></a>1.2.1  èµ·æ­¥ä¾èµ–</h4><p>æˆ‘ä»¬ä½¿ç”¨ <code>Spring Initializr</code>  æ–¹å¼åˆ›å»ºçš„ <code>Maven</code> å·¥ç¨‹çš„çš„ <code>pom.xml</code> é…ç½®æ–‡ä»¶ä¸­è‡ªåŠ¨ç”Ÿæˆäº†å¾ˆå¤šåŒ…å« <code>starter</code> çš„ä¾èµ–,ç±»ä¼¼äºè¿™ç§å°±æ˜¯å¯åŠ¨å¿…é¡»çš„ä¾èµ–ã€‚</p><p>è¿™äº›ä¾èµ–å°±æ˜¯==å¯åŠ¨ä¾èµ–==ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¢ç©¶ä¸€ä¸‹ä»–æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h5 id="1-2-1-1-æ¢ç´¢çˆ¶å·¥ç¨‹"><a href="#1-2-1-1-æ¢ç´¢çˆ¶å·¥ç¨‹" class="headerlink" title="1.2.1.1  æ¢ç´¢çˆ¶å·¥ç¨‹"></a>1.2.1.1  æ¢ç´¢çˆ¶å·¥ç¨‹</h5><p>ä»ä¸Šé¢çš„æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°æŒ‡å®šäº†ä¸€ä¸ªçˆ¶å·¥ç¨‹ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°çˆ¶å·¥ç¨‹ï¼Œç„¶å‘ç°çˆ¶å·¥ç¨‹é‡Œåˆæœ‰ä¸€ä¸ªçˆ¶å·¥ç¨‹ã€‚</p><p>å†è¿›å…¥åˆ°è¯¥çˆ¶å·¥ç¨‹ä¸­ï¼Œåœ¨è¯¥å·¥ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é…ç½®å†…å®¹ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221112170045.png" alt=""></p><p>ä¸Šå›¾ä¸­çš„ <code>properties</code> æ ‡ç­¾ä¸­å®šä¹‰äº†å„ä¸ªæŠ€æœ¯è½¯ä»¶ä¾èµ–çš„ç‰ˆæœ¬ï¼Œé¿å…äº†æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸åŒè½¯ä»¶æŠ€æœ¯æ—¶è€ƒè™‘ç‰ˆæœ¬çš„å…¼å®¹é—®é¢˜ã€‚</p><p><code>dependencyManagement</code> æ ‡ç­¾æ˜¯è¿›è¡Œä¾èµ–ç‰ˆæœ¬é”å®šï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¼å…¥å¯¹åº”çš„ä¾èµ–ï¼›å¦‚æœæˆ‘ä»¬å·¥ç¨‹éœ€è¦é‚£ä¸ªä¾èµ–åªéœ€è¦å¼•å…¥ä¾èµ–çš„ <code>groupid</code> å’Œ <code>artifactId</code> ä¸éœ€è¦å®šä¹‰ <code>version</code>ã€‚</p><p>åŒæ ·çš„ <code>build</code> æ ‡ç­¾ä¸­ä¹Ÿå¯¹æ’ä»¶çš„ç‰ˆæœ¬è¿›è¡Œäº†é”å®šã€‚</p><p>çœ‹å®Œäº†çˆ¶å·¥ç¨‹ä¸­ <code>pom.xml</code> çš„é…ç½®åä¸éš¾ç†è§£æˆ‘ä»¬å·¥ç¨‹çš„çš„ä¾èµ–ä¸ºä»€ä¹ˆéƒ½æ²¡æœ‰é…ç½® <code>version</code>ã€‚</p><h5 id="1-2-1-2-æ¢ç´¢ä¾èµ–"><a href="#1-2-1-2-æ¢ç´¢ä¾èµ–" class="headerlink" title="1.2.1.2  æ¢ç´¢ä¾èµ–"></a>1.2.1.2  æ¢ç´¢ä¾èµ–</h5><p>åœ¨æˆ‘ä»¬åˆ›å»ºçš„å·¥ç¨‹ä¸­çš„ <code>pom.xml</code> ä¸­é…ç½®äº†å¦‚ä¸‹ä¾èµ–</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221112170255.png" alt=""></p><p>è¿›å…¥åˆ°è¯¥ä¾èµ–ï¼ŒæŸ¥çœ‹ <code>pom.xml</code> çš„ä¾èµ–ä¼šå‘ç°å®ƒå¼•å…¥äº†å¦‚ä¸‹çš„ä¾èµ–</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221112170317.png" alt=""></p><p>é‡Œé¢çš„å¼•å…¥äº† <code>spring-web</code> å’Œ <code>spring-webmvc</code> çš„ä¾èµ–ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„å·¥ç¨‹ä¸­æ²¡æœ‰ä¾èµ–è¿™ä¸¤ä¸ªåŒ…è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ <code>springMVC</code> ä¸­çš„æ³¨è§£çš„åŸå› ã€‚</p><p>è€Œä¾èµ– <code>spring-boot-starter-tomcat</code> ï¼Œä»åå­—åŸºæœ¬èƒ½ç¡®è®¤å†…éƒ¨ä¾èµ–äº† <code>tomcat</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å·¥ç¨‹æ‰èƒ½æ­£å¸¸å¯åŠ¨ã€‚</p><p>==ç»“è®ºï¼šä»¥åéœ€è¦ä½¿ç”¨æŠ€æœ¯ï¼Œåªéœ€è¦å¼•å…¥è¯¥æŠ€æœ¯å¯¹åº”çš„èµ·æ­¥ä¾èµ–å³å¯==</p><h5 id="1-2-1-3-å°ç»“"><a href="#1-2-1-3-å°ç»“" class="headerlink" title="1.2.1.3  å°ç»“"></a>1.2.1.3  å°ç»“</h5><p><strong>starter</strong></p><ul><li><code>SpringBoot</code> ä¸­å¸¸è§é¡¹ç›®åç§°ï¼Œå®šä¹‰äº†å½“å‰é¡¹ç›®ä½¿ç”¨çš„æ‰€æœ‰é¡¹ç›®åæ ‡ï¼Œä»¥è¾¾åˆ°å‡å°‘ä¾èµ–é…ç½®çš„ç›®çš„</li></ul><p><strong>parent</strong></p><ul><li><p>æ‰€æœ‰ <code>SpringBoot</code> é¡¹ç›®è¦ç»§æ‰¿çš„é¡¹ç›®ï¼Œå®šä¹‰äº†è‹¥å¹²ä¸ªåæ ‡ç‰ˆæœ¬å·ï¼ˆä¾èµ–ç®¡ç†ï¼Œè€Œéä¾èµ–ï¼‰ï¼Œä»¥è¾¾åˆ°å‡å°‘ä¾èµ–å†²çªçš„ç›®çš„</p></li><li><p><code>spring-boot-starter-parent</code>ï¼ˆ2.5.0ï¼‰ä¸ <code>spring-boot-starter-parent</code>ï¼ˆ2.4.6ï¼‰å…±è®¡57å¤„åæ ‡ç‰ˆæœ¬ä¸åŒ</p></li></ul><p><strong>å®é™…å¼€å‘</strong></p><ul><li><p>ä½¿ç”¨ä»»æ„åæ ‡æ—¶ï¼Œä»…ä¹¦å†™GAVä¸­çš„Gå’ŒAï¼ŒVç”±SpringBootæä¾›</p><blockquote><p>Gï¼šgroupid</p><p>Aï¼šartifactId</p><p>Vï¼šversion</p></blockquote></li><li><p>å¦‚å‘ç”Ÿåæ ‡é”™è¯¯ï¼Œå†æŒ‡å®šversionï¼ˆè¦å°å¿ƒç‰ˆæœ¬å†²çªï¼‰</p></li></ul><h4 id="1-2-2-ç¨‹åºå¯åŠ¨"><a href="#1-2-2-ç¨‹åºå¯åŠ¨" class="headerlink" title="1.2.2  ç¨‹åºå¯åŠ¨"></a>1.2.2  ç¨‹åºå¯åŠ¨</h4><p>åˆ›å»ºçš„æ¯ä¸€ä¸ª <code>SpringBoot</code> ç¨‹åºæ—¶éƒ½åŒ…å«ä¸€ä¸ªç±»ä¼¼äºä¸‹é¢çš„ç±»ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç±»ç§°ä½œå¼•å¯¼ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Springboot01QuickstartApplication</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Springboot01QuickstartApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==æ³¨æ„ï¼š==</p><ul><li><p><code>SpringBoot</code> åœ¨åˆ›å»ºé¡¹ç›®æ—¶ï¼Œé‡‡ç”¨jarçš„æ‰“åŒ…æ–¹å¼</p></li><li><p><code>SpringBoot</code> çš„å¼•å¯¼ç±»æ˜¯é¡¹ç›®çš„å…¥å£ï¼Œè¿è¡Œ <code>main</code> æ–¹æ³•å°±å¯ä»¥å¯åŠ¨é¡¹ç›®</p><p>å› ä¸ºæˆ‘ä»¬åœ¨ <code>pom.xml</code> ä¸­é…ç½®äº† <code>spring-boot-starter-web</code> ä¾èµ–ï¼Œè€Œè¯¥ä¾èµ–é€šè¿‡å‰é¢çš„å­¦ä¹ çŸ¥é“å®ƒä¾èµ– <code>tomcat</code> ï¼Œæ‰€ä»¥è¿è¡Œ <code>main</code> æ–¹æ³•å°±å¯ä»¥ä½¿ç”¨ <code>tomcat</code> å¯åŠ¨å’±ä»¬çš„å·¥ç¨‹ã€‚</p></li></ul><h4 id="1-2-3-åˆ‡æ¢webæœåŠ¡å™¨"><a href="#1-2-3-åˆ‡æ¢webæœåŠ¡å™¨" class="headerlink" title="1.2.3  åˆ‡æ¢webæœåŠ¡å™¨"></a>1.2.3  åˆ‡æ¢webæœåŠ¡å™¨</h4><p>ç°åœ¨æˆ‘ä»¬å¯åŠ¨å·¥ç¨‹ä½¿ç”¨çš„æ˜¯ <code>tomcat</code> æœåŠ¡å™¨ï¼Œé‚£èƒ½ä¸èƒ½ä¸ä½¿ç”¨ <code>tomcat</code> è€Œä½¿ç”¨ <code>jetty</code> æœåŠ¡å™¨ï¼Œ<code>jetty</code> åœ¨æˆ‘ä»¬ <code>maven</code> é«˜çº§æ—¶è®² <code>maven</code> ç§æœä½¿ç”¨çš„æœåŠ¡å™¨ã€‚è€Œè¦åˆ‡æ¢ <code>web</code> æœåŠ¡å™¨å°±éœ€è¦å°†é»˜è®¤çš„ <code>tomcat</code> æœåŠ¡å™¨ç»™æ’é™¤æ‰ï¼Œæ€ä¹ˆæ’é™¤å‘¢ï¼Ÿä½¿ç”¨ <code>exclusion</code> æ ‡ç­¾</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿è¡Œè¿˜å¯ä»¥æ­£å¸¸å¯åŠ¨å—ï¼Œå¾ˆæ˜æ˜¾æ˜¯ä¸å¯ä»¥äº†ï¼Œå› ä¸ºæœ¬åœ°ç¼ºå°‘äº†tomcatçš„é…ç½®</p><p>ç¨‹åºç›´æ¥åœæ­¢äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºæ’é™¤äº† <code>tomcat</code> æœåŠ¡å™¨ï¼Œç¨‹åºä¸­å°±æ²¡æœ‰æœåŠ¡å™¨äº†ã€‚æ‰€ä»¥æ­¤æ—¶ä¸å…‰è¦æ’é™¤ <code>tomcat</code> æœåŠ¡å™¨ï¼Œè¿˜è¦å¼•å…¥ <code>jetty</code> æœåŠ¡å™¨ã€‚åœ¨ <code>pom.xml</code> ä¸­å› ä¸º <code>jetty</code> çš„èµ·æ­¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†æ¬¡è¿è¡Œå¼•å¯¼ç±»ï¼Œåœ¨æ—¥å¿—ä¿¡æ¯ä¸­å°±å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„æ˜¯ <code>jetty</code> æœåŠ¡å™¨</p><p>Jettyæ¯”Tomcatæ›´è½»é‡çº§ï¼Œå¯æ‰©å±•æ€§æ›´å¼ºï¼ˆç›¸è¾ƒäºTomcatï¼‰ï¼Œè°·æ­Œåº”ç”¨å¼•æ“ï¼ˆGAEï¼‰å·²ç»å…¨é¢åˆ‡æ¢ä¸ºJetty</p><p><strong>å°ç»“ï¼š</strong></p><p>é€šè¿‡åˆ‡æ¢æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°åœ¨ä½¿ç”¨ <code>SpringBoot</code> æ¢æŠ€æœ¯æ—¶åªéœ€è¦å¯¼å…¥è¯¥æŠ€æœ¯çš„èµ·æ­¥ä¾èµ–å³å¯ã€‚</p><h2 id="2ï¼Œé…ç½®æ–‡ä»¶"><a href="#2ï¼Œé…ç½®æ–‡ä»¶" class="headerlink" title="2ï¼Œé…ç½®æ–‡ä»¶"></a>2ï¼Œé…ç½®æ–‡ä»¶</h2><h3 id="2-1-é…ç½®æ–‡ä»¶æ ¼å¼"><a href="#2-1-é…ç½®æ–‡ä»¶æ ¼å¼" class="headerlink" title="2.1  é…ç½®æ–‡ä»¶æ ¼å¼"></a>2.1  é…ç½®æ–‡ä»¶æ ¼å¼</h3><p>æˆ‘ä»¬ç°åœ¨å¯åŠ¨æœåŠ¡å™¨é»˜è®¤çš„ç«¯å£å·æ˜¯ <code>8080</code>ï¼Œè®¿é—®è·¯å¾„å¯ä»¥ä¹¦å†™ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/books/1</span><br></pre></td></tr></table></figure><p>åœ¨çº¿ä¸Šç¯å¢ƒæˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›å°†ç«¯å£å·æ”¹ä¸º <code>80</code>ï¼Œè¿™æ ·åœ¨è®¿é—®çš„æ—¶å€™å°±å¯ä»¥ä¸å†™ç«¯å£å·äº†ï¼Œå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/books/1</span><br></pre></td></tr></table></figure><p>è€Œ <code>SpringBoot</code> ç¨‹åºå¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ<code>SpringBoot</code> æä¾›äº†å¤šç§å±æ€§é…ç½®æ–¹å¼</p><ul><li><p><code>application.properties</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port=80</span><br></pre></td></tr></table></figure></li><li><p><code>application.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">81</span></span><br></pre></td></tr></table></figure></li><li><p><code>application.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>==æ³¨æ„ï¼š<code>SpringBoot</code> ç¨‹åºçš„é…ç½®æ–‡ä»¶åå¿…é¡»æ˜¯ <code>application</code> ï¼Œåªæ˜¯åç¼€åä¸åŒè€Œå·²ã€‚==</p></blockquote><h4 id="2-1-1-ç¯å¢ƒå‡†å¤‡"><a href="#2-1-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.1.1  ç¯å¢ƒå‡†å¤‡"></a>2.1.1  ç¯å¢ƒå‡†å¤‡</h4><p>åˆ›å»ºä¸€ä¸ªæ–°å·¥ç¨‹ <code>springboot_02_base_config</code> ç”¨æ¥æ¼”ç¤ºä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå·¥ç¨‹ç¯å¢ƒå’Œå…¥é—¨æ¡ˆä¾‹ä¸€æ¨¡ä¸€æ ·</p><p>åœ¨è¯¥å·¥ç¨‹ä¸­çš„ <code>com.blog.controller</code> åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>BookController</code> çš„æ§åˆ¶å™¨ã€‚å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id ==&gt; &quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello , spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-1-2-ä¸åŒé…ç½®æ–‡ä»¶æ¼”ç¤º"><a href="#2-1-2-ä¸åŒé…ç½®æ–‡ä»¶æ¼”ç¤º" class="headerlink" title="2.1.2  ä¸åŒé…ç½®æ–‡ä»¶æ¼”ç¤º"></a>2.1.2  ä¸åŒé…ç½®æ–‡ä»¶æ¼”ç¤º</h4><ul><li><strong>application.propertiesé…ç½®æ–‡ä»¶</strong></li></ul><p>ç°åœ¨éœ€è¦è¿›è¡Œé…ç½®ï¼Œé…åˆæ–‡ä»¶å¿…é¡»æ”¾åœ¨ <code>resources</code> ç›®å½•ä¸‹ï¼Œè€Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º <code>application.properties</code> çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ç«¯å£å·ï¼Œåœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­ä¹¦å†™ <code>port</code> ï¼Œ<code>Idea</code> å°±ä¼šå‡ºç°æç¤ºï¼Œç›´æ¥enterå³å¯ã€‚</p><p><code>application.properties</code> é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼Œä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œä»æ—¥å¿—ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ç»‘å®šçš„ç«¯å£å·å·²ç»ä¿®æ”¹äº†</p><ul><li><strong>application.ymlé…ç½®æ–‡ä»¶</strong></li></ul><p>åˆ é™¤ <code>application.properties</code> é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚åœ¨ <code>resources</code> ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>application.yml</code> çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­ä¹¦å†™ç«¯å£å·çš„é…ç½®é¡¹ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">81</span></span><br></pre></td></tr></table></figure><blockquote><p>==æ³¨æ„ï¼š åœ¨<code>:</code>åï¼Œæ•°æ®å‰ä¸€å®šè¦åŠ ç©ºæ ¼ã€‚==</p></blockquote><p>å¯åŠ¨æœåŠ¡ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ç»‘å®šçš„ç«¯å£å·æ˜¯ <code>81</code></p><ul><li><strong>application.yamlé…ç½®æ–‡ä»¶</strong></li></ul><p>åˆ é™¤ <code>application.yml</code> é…ç½®æ–‡ä»¶å’Œ <code>application.properties</code> é…ç½®æ–‡ä»¶å†…å®¹ï¼Œç„¶ååœ¨ <code>resources</code> ä¸‹åˆ›å»ºåä¸º <code>application.yaml</code> çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®å†…å®¹å’Œåç¼€åä¸º <code>yml</code> çš„é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ç›¸åŒï¼Œåªæ˜¯ä½¿ç”¨äº†ä¸åŒçš„åç¼€åè€Œå·²</p><p><code>application.yaml</code> é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">83</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ç»‘å®šçš„ç«¯å£å·83</p><p>==æ³¨æ„ï¼šåœ¨é…åˆæ–‡ä»¶ä¸­å¦‚æœæ²¡æœ‰æç¤ºï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸‹æ–¹å¼è§£å†³==</p><ul><li>ç‚¹å‡» <code>File</code> é€‰ä¸­ <code>Project Structure</code>ï¼Œå¯è‡ªè¡Œåœ¨Facetsä¸­ç”¨åŠ å·æ·»åŠ æ–‡ä»¶ã€‚</li></ul><h4 id="2-1-3-ä¸‰ç§é…åˆæ–‡ä»¶çš„ä¼˜å…ˆçº§"><a href="#2-1-3-ä¸‰ç§é…åˆæ–‡ä»¶çš„ä¼˜å…ˆçº§" class="headerlink" title="2.1.3  ä¸‰ç§é…åˆæ–‡ä»¶çš„ä¼˜å…ˆçº§"></a>2.1.3  ä¸‰ç§é…åˆæ–‡ä»¶çš„ä¼˜å…ˆçº§</h4><p>åœ¨ä¸‰ç§é…åˆæ–‡ä»¶ä¸­åˆ†åˆ«é…ç½®ä¸åŒçš„ç«¯å£å·ï¼Œå¯åŠ¨æœåŠ¡æŸ¥çœ‹ç»‘å®šçš„ç«¯å£å·ã€‚ç”¨è¿™ç§æ–¹å¼å°±å¯ä»¥çœ‹åˆ°å“ªä¸ªé…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§æ›´é«˜ä¸€äº›</p><p><code>application.properties</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure><p><code>application.yml</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">81</span></span><br></pre></td></tr></table></figure><p><code>application.yaml</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„ç«¯å£å·æ˜¯ <code>80</code>ã€‚è¯´æ˜ <code>application.properties</code> çš„ä¼˜å…ˆçº§æœ€é«˜</p><p>æ³¨é‡Šæ‰ <code>application.properties</code> é…ç½®æ–‡ä»¶å†…å®¹ã€‚å†æ¬¡å¯åŠ¨æœåŠ¡ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°ä½¿ç”¨çš„ç«¯å£å·æ˜¯ <code>81</code>ï¼Œè¯´æ˜ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸ºç¬¬äºŒä¼˜å…ˆçº§ã€‚</p><p>ä»ä¸Šè¿°çš„éªŒè¯ç»“æœå¯ä»¥ç¡®å®šä¸‰ç§é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§æ˜¯ï¼š</p><p>==<code>application.properties</code>  &gt;  <code>application.yml</code>   &gt;  <code>application.yaml</code>==</p><blockquote><p>==æ³¨æ„ï¼š==</p><ul><li><p><code>SpringBoot</code> æ ¸å¿ƒé…ç½®æ–‡ä»¶åä¸º <code>application</code></p></li><li><p><code>SpringBoot</code> å†…ç½®å±æ€§è¿‡å¤šï¼Œä¸”æ‰€æœ‰å±æ€§é›†ä¸­åœ¨ä¸€èµ·ä¿®æ”¹ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œé€šè¿‡æç¤ºé”®+å…³é”®å­—ä¿®æ”¹å±æ€§</p><p>ä¾‹å¦‚è¦è®¾ç½®æ—¥å¿—çš„çº§åˆ«æ—¶ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¹¦å†™ <code>logging</code>ï¼Œå°±ä¼šæç¤ºå‡ºæ¥ã€‚é…ç½®å†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure></li></ul></blockquote><h3 id="2-2-yamlæ ¼å¼"><a href="#2-2-yamlæ ¼å¼" class="headerlink" title="2.2  yamlæ ¼å¼"></a>2.2  yamlæ ¼å¼</h3><p>ä¸Šé¢è®²äº†ä¸‰ç§ä¸åŒç±»å‹çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ <code>properties</code> ç±»å‹çš„é…åˆæ–‡ä»¶ä¹‹å‰æˆ‘ä»¬å­¦ä¹ è¿‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹å­¦ä¹  <code>yaml</code> ç±»å‹çš„é…ç½®æ–‡ä»¶ã€‚</p><p><strong>YAMLï¼ˆYAML Ainâ€™t Markup Languageï¼‰ï¼Œä¸€ç§æ•°æ®åºåˆ—åŒ–æ ¼å¼ã€‚</strong>è¿™ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶åœ¨è¿‘äº›å¹´å·²ç»å æœ‰ä¸»å¯¼åœ°ä½ï¼Œé‚£ä¹ˆè¿™ç§é…ç½®æ–‡ä»¶å’Œå‰æœŸä½¿ç”¨çš„é…ç½®æ–‡ä»¶æ˜¯æœ‰ä¸€äº›ä¼˜åŠ¿çš„ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¹‹å‰ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚</p><p>æœ€å¼€å§‹æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>xml</code> ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">enterprise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>itcast<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>16<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tel</span>&gt;</span>4006184000<span class="tag">&lt;/<span class="name">tel</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">enterprise</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è€Œ <code>properties</code> ç±»å‹çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enterprise.name</span>=<span class="string">itcast</span></span><br><span class="line"><span class="attr">enterprise.age</span>=<span class="string">16</span></span><br><span class="line"><span class="attr">enterprise.tel</span>=<span class="string">4006184000</span></span><br></pre></td></tr></table></figure><p><code>yaml</code> ç±»å‹çš„é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enterprise:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">itcast</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">16</span></span><br><span class="line"><span class="attr">tel:</span> <span class="number">4006184000</span></span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li><p>å®¹æ˜“é˜…è¯»</p><p><code>yaml</code> ç±»å‹çš„é…ç½®æ–‡ä»¶æ¯” <code>xml</code> ç±»å‹çš„é…ç½®æ–‡ä»¶æ›´å®¹æ˜“é˜…è¯»ï¼Œç»“æ„æ›´åŠ æ¸…æ™°</p></li><li><p>å®¹æ˜“ä¸è„šæœ¬è¯­è¨€äº¤äº’</p></li><li><p>ä»¥æ•°æ®ä¸ºæ ¸å¿ƒï¼Œé‡æ•°æ®è½»æ ¼å¼</p><p><code>yaml</code> æ›´æ³¨é‡æ•°æ®ï¼Œè€Œ <code>xml</code> æ›´æ³¨é‡æ ¼å¼</p></li></ul><p><strong>YAML æ–‡ä»¶æ‰©å±•åï¼š</strong></p><ul><li><code>.yml</code> (ä¸»æµ)</li><li><code>.yaml</code></li></ul><p>ä¸Šé¢ä¸¤ç§åç¼€åéƒ½å¯ä»¥ï¼Œä»¥åä½¿ç”¨æ›´å¤šçš„è¿˜æ˜¯ <code>yml</code> çš„ã€‚</p><h4 id="2-2-1-è¯­æ³•è§„åˆ™"><a href="#2-2-1-è¯­æ³•è§„åˆ™" class="headerlink" title="2.2.1  è¯­æ³•è§„åˆ™"></a>2.2.1  è¯­æ³•è§„åˆ™</h4><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221112210948.png" alt=""></p><p>==æ ¸å¿ƒè§„åˆ™ï¼šæ•°æ®å‰é¢è¦åŠ ç©ºæ ¼ä¸å†’å·éš”å¼€==</p><p>æ•°ç»„æ•°æ®åœ¨æ•°æ®ä¹¦å†™ä½ç½®çš„ä¸‹æ–¹ä½¿ç”¨å‡å·ä½œä¸ºæ•°æ®å¼€å§‹ç¬¦å·ï¼Œæ¯è¡Œä¹¦å†™ä¸€ä¸ªæ•°æ®ï¼Œå‡å·ä¸æ•°æ®é—´ç©ºæ ¼åˆ†éš”ï¼Œä¾‹å¦‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enterprise:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">itcast</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">16</span></span><br><span class="line">  <span class="attr">tel:</span> <span class="number">4006184000</span></span><br><span class="line">  <span class="attr">subject:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Java</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">å‰ç«¯</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">å¤§æ•°æ®</span></span><br></pre></td></tr></table></figure><h3 id="2-3-yamlé…ç½®æ–‡ä»¶æ•°æ®è¯»å–"><a href="#2-3-yamlé…ç½®æ–‡ä»¶æ•°æ®è¯»å–" class="headerlink" title="2.3  yamlé…ç½®æ–‡ä»¶æ•°æ®è¯»å–"></a>2.3  yamlé…ç½®æ–‡ä»¶æ•°æ®è¯»å–</h3><h4 id="2-3-1-ç¯å¢ƒå‡†å¤‡"><a href="#2-3-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.3.1  ç¯å¢ƒå‡†å¤‡"></a>2.3.1  ç¯å¢ƒå‡†å¤‡</h4><p>æ–°åˆ›å»ºä¸€ä¸ªåä¸º <code>springboot_03_read_data</code> çš„ <code>SpringBoot</code> å·¥ç¨‹ï¼Œå’Œä¹‹å‰ç±»ä¼¼</p><p>åœ¨ <code>com.blog.controller</code> åŒ…å†™åˆ›å»ºåä¸º <code>BookController</code> çš„æ§åˆ¶å™¨ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id ==&gt; &quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello , spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>com.blog.domain</code> åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>Enterprise</code> çš„å®ä½“ç±»ç­‰ä¼šç”¨æ¥å°è£…æ•°æ®ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Enterprise</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> String[] subject;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setter and getter</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>resources</code> ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>application.yml</code> çš„é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢é…ç½®äº†ä¸åŒçš„æ•°æ®ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">lesson:</span> <span class="string">SpringBoot</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">enterprise:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">itcast</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">16</span></span><br><span class="line">  <span class="attr">tel:</span> <span class="number">4006184000</span></span><br><span class="line">  <span class="attr">subject:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Java</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">å‰ç«¯</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">å¤§æ•°æ®</span></span><br></pre></td></tr></table></figure><h4 id="2-3-2-è¯»å–é…ç½®æ•°æ®"><a href="#2-3-2-è¯»å–é…ç½®æ•°æ®" class="headerlink" title="2.3.2  è¯»å–é…ç½®æ•°æ®"></a>2.3.2  è¯»å–é…ç½®æ•°æ®</h4><h5 id="2-3-2-1-ä½¿ç”¨-Valueæ³¨è§£"><a href="#2-3-2-1-ä½¿ç”¨-Valueæ³¨è§£" class="headerlink" title="2.3.2.1  ä½¿ç”¨ @Valueæ³¨è§£"></a>2.3.2.1  ä½¿ç”¨ @Valueæ³¨è§£</h5><p>ä½¿ç”¨ <code>@Value(&quot;è¡¨è¾¾å¼&quot;)</code> æ³¨è§£å¯ä»¥ä»é…åˆæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæ³¨è§£ä¸­ç”¨äºè¯»å–å±æ€§åå¼•ç”¨æ–¹å¼æ˜¯ï¼š<code>$&#123;ä¸€çº§å±æ€§å.äºŒçº§å±æ€§åâ€¦â€¦&#125;</code></p><p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>BookController</code> ä¸­ä½¿ç”¨ <code>@Value</code>  æ³¨è§£è¯»å–é…åˆæ–‡ä»¶æ•°æ®ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;lesson&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String lesson;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer port;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;enterprise.subject[0]&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subject_00;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(lesson);</span><br><span class="line">        System.out.println(port);</span><br><span class="line">        System.out.println(subject_00);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello , spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-3-2-2-Environmentå¯¹è±¡"><a href="#2-3-2-2-Environmentå¯¹è±¡" class="headerlink" title="2.3.2.2  Environmentå¯¹è±¡"></a>2.3.2.2  Environmentå¯¹è±¡</h5><p>ä¸Šé¢æ–¹å¼è¯»å–åˆ°çš„æ•°æ®ç‰¹åˆ«é›¶æ•£ï¼Œ<code>SpringBoot</code> è¿˜å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æ³¨è§£æ³¨å…¥ <code>Environment</code> å¯¹è±¡çš„æ–¹å¼è¯»å–æ•°æ®ã€‚è¿™ç§æ–¹å¼ <code>SpringBoot</code> ä¼šå°†é…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„æ•°æ®å°è£…åˆ° <code>Environment</code> å¯¹è±¡ä¸­ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å“ªä¸ªæ•°æ®åªéœ€è¦é€šè¿‡è°ƒç”¨ <code>Environment</code> å¯¹è±¡çš„ <code>getProperty(String name)</code> æ–¹æ³•è·å–ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment env;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(env.getProperty(<span class="string">&quot;lesson&quot;</span>));</span><br><span class="line">        System.out.println(env.getProperty(<span class="string">&quot;enterprise.name&quot;</span>));</span><br><span class="line">        System.out.println(env.getProperty(<span class="string">&quot;enterprise.subject[0]&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello , spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>==æ³¨æ„ï¼šè¿™ç§æ–¹å¼ï¼Œæ¡†æ¶å†…å®¹å¤§é‡æ•°æ®ï¼Œè€Œåœ¨å¼€å‘ä¸­æˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨ã€‚==</p></blockquote><h5 id="2-3-2-3-è‡ªå®šä¹‰å¯¹è±¡"><a href="#2-3-2-3-è‡ªå®šä¹‰å¯¹è±¡" class="headerlink" title="2.3.2.3  è‡ªå®šä¹‰å¯¹è±¡"></a>2.3.2.3  è‡ªå®šä¹‰å¯¹è±¡</h5><p><code>SpringBoot</code> è¿˜æä¾›äº†å°†é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®å°è£…åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å®ä½“ç±»å¯¹è±¡ä¸­çš„æ–¹å¼ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><ul><li><p>å°†å®ä½“ç±» <code>bean</code> çš„åˆ›å»ºäº¤ç»™ <code>Spring</code> ç®¡ç†ã€‚</p><p>åœ¨ç±»ä¸Šæ·»åŠ  <code>@Component</code> æ³¨è§£</p></li><li><p>ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£è¡¨ç¤ºåŠ è½½é…ç½®æ–‡ä»¶</p><p>åœ¨è¯¥æ³¨è§£ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>prefix</code> å±æ€§æŒ‡å®šåªåŠ è½½æŒ‡å®šå‰ç¼€çš„æ•°æ®</p></li><li><p>åœ¨ <code>BookController</code> ä¸­è¿›è¡Œæ³¨å…¥</p></li></ul><p><strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><p><code>Enterprise</code> å®ä½“ç±»å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;enterprise&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Enterprise</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> String[] subject;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTel</span><span class="params">(String tel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.tel = tel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getSubject() &#123;</span><br><span class="line">        <span class="keyword">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSubject</span><span class="params">(String[] subject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Enterprise&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, tel=&#x27;&quot;</span> + tel + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, subject=&quot;</span> + Arrays.toString(subject) +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>BookController</code> å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Enterprise enterprise;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(enterprise.getName());</span><br><span class="line">        System.out.println(enterprise.getAge());</span><br><span class="line">        System.out.println(enterprise.getSubject());</span><br><span class="line">        System.out.println(enterprise.getTel());</span><br><span class="line">        System.out.println(enterprise.getSubject()[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello , spring boot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==æ³¨æ„ï¼š==</p><p>ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼ï¼Œåœ¨å®ä½“ç±»ä¸Šæœ‰å¦‚ä¸‹è­¦å‘Šæç¤º</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221113093543.png" alt=""></p><p>è¿™ä¸ªè­¦å‘Šæç¤ºè§£å†³æ˜¯åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-4-å¤šç¯å¢ƒé…ç½®"><a href="#2-4-å¤šç¯å¢ƒé…ç½®" class="headerlink" title="2.4  å¤šç¯å¢ƒé…ç½®"></a>2.4  å¤šç¯å¢ƒé…ç½®</h3><p>ä»¥ååœ¨å·¥ä½œä¸­ï¼Œå¯¹äºå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒçš„é…ç½®è‚¯å®šéƒ½ä¸ç›¸åŒï¼Œæ¯”å¦‚æˆ‘ä»¬å¼€å‘é˜¶æ®µä¼šåœ¨è‡ªå·±çš„ç”µè„‘ä¸Šå®‰è£… <code>mysql</code> ï¼Œè¿æ¥è‡ªå·±ç”µè„‘ä¸Šçš„ <code>mysql</code> å³å¯ï¼Œä½†æ˜¯é¡¹ç›®å¼€å‘å®Œæ¯•åè¦ä¸Šçº¿å°±éœ€è¦è¯¥é…ç½®ï¼Œå°†ç¯å¢ƒçš„é…ç½®æ”¹ä¸ºçº¿ä¸Šç¯å¢ƒçš„ã€‚</p><p>æ¥å›çš„ä¿®æ”¹é…ç½®ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œ <code>SpringBoot</code> ç»™å¼€å‘è€…æä¾›äº†å¤šç¯å¢ƒçš„å¿«æ·é…ç½®ï¼Œéœ€è¦åˆ‡æ¢ç¯å¢ƒæ—¶åªéœ€è¦æ”¹ä¸€ä¸ªé…ç½®å³å¯ã€‚ä¸åŒç±»å‹çš„é…ç½®æ–‡ä»¶å¤šç¯å¢ƒå¼€å‘çš„é…ç½®éƒ½ä¸ç›¸åŒï¼Œæ¥ä¸‹æ¥å¯¹ä¸åŒç±»å‹çš„é…ç½®æ–‡ä»¶è¿›è¡Œè¯´æ˜</p><h4 id="2-4-1-yamlæ–‡ä»¶"><a href="#2-4-1-yamlæ–‡ä»¶" class="headerlink" title="2.4.1  yamlæ–‡ä»¶"></a>2.4.1  yamlæ–‡ä»¶</h4><p>åœ¨ <code>application.yml</code> ä¸­ä½¿ç”¨ <code>---</code> æ¥åˆ†å‰²ä¸åŒçš„é…ç½®ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¼€å‘</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span> <span class="comment">#ç»™å¼€å‘ç¯å¢ƒèµ·çš„åå­—</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#ç”Ÿäº§</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span> <span class="comment">#ç»™ç”Ÿäº§ç¯å¢ƒèµ·çš„åå­—</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span> <span class="comment">#ç»™æµ‹è¯•ç¯å¢ƒèµ·çš„åå­—</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">82</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢é…ç½®ä¸­ <code>spring.profiles</code> æ˜¯ç”¨æ¥ç»™ä¸åŒçš„é…ç½®èµ·åå­—çš„ã€‚è€Œå¦‚ä½•å‘ŠçŸ¥ <code>SpringBoot</code> ä½¿ç”¨å“ªæ®µé…ç½®å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®æ¥å¯ç”¨éƒ½ä¸€æ®µé…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®å¯ç”¨çš„ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span>  <span class="comment">#è¡¨ç¤ºä½¿ç”¨çš„æ˜¯å¼€å‘ç¯å¢ƒçš„é…ç½®</span></span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>application.yml</code> é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç½®å¯ç”¨çš„ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#å¼€å‘</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#ç”Ÿäº§</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">82</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>==æ³¨æ„ï¼š==</p><p>åœ¨ä¸Šé¢é…ç½®ä¸­ç»™ä¸åŒé…ç½®èµ·åå­—çš„ <code>spring.profiles</code> é…ç½®é¡¹å·²ç»è¿‡æ—¶ã€‚æœ€æ–°ç”¨æ¥èµ·åå­—çš„é…ç½®é¡¹æ˜¯ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¼€å‘</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><h4 id="2-4-2-propertiesæ–‡ä»¶"><a href="#2-4-2-propertiesæ–‡ä»¶" class="headerlink" title="2.4.2  propertiesæ–‡ä»¶"></a>2.4.2  propertiesæ–‡ä»¶</h4><p><code>properties</code> ç±»å‹çš„é…ç½®æ–‡ä»¶é…ç½®å¤šç¯å¢ƒéœ€è¦å®šä¹‰ä¸åŒçš„é…ç½®æ–‡ä»¶</p><ul><li><p><code>application-dev.properties</code> æ˜¯å¼€å‘ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶ä¸­é…ç½®ç«¯å£å·ä¸º <code>80</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure></li><li><p><code>application-test.properties</code> æ˜¯æµ‹è¯•ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶ä¸­é…ç½®ç«¯å£å·ä¸º <code>81</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">81</span></span><br></pre></td></tr></table></figure></li><li><p><code>application-pro.properties</code> æ˜¯ç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶ä¸­é…ç½®ç«¯å£å·ä¸º <code>82</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">82</span></span><br></pre></td></tr></table></figure></li></ul><p><code>SpringBoot</code> åªä¼šé»˜è®¤åŠ è½½åä¸º <code>application.properties</code> çš„é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨ <code>application.properties</code> é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¯ç”¨å“ªä¸ªé…ç½®æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">pro</span></span><br></pre></td></tr></table></figure><h4 id="2-4-3-å‘½ä»¤è¡Œå¯åŠ¨å‚æ•°è®¾ç½®"><a href="#2-4-3-å‘½ä»¤è¡Œå¯åŠ¨å‚æ•°è®¾ç½®" class="headerlink" title="2.4.3  å‘½ä»¤è¡Œå¯åŠ¨å‚æ•°è®¾ç½®"></a>2.4.3  å‘½ä»¤è¡Œå¯åŠ¨å‚æ•°è®¾ç½®</h4><p>ä½¿ç”¨ <code>SpringBoot</code> å¼€å‘çš„ç¨‹åºä»¥åéƒ½æ˜¯æ‰“æˆ <code>jar</code> åŒ…ï¼Œé€šè¿‡ <code>java -jar xxx.jar</code> çš„æ–¹å¼å¯åŠ¨æœåŠ¡çš„ã€‚é‚£ä¹ˆå°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•åˆ‡æ¢ç¯å¢ƒå‘¢ï¼Ÿå› ä¸ºé…ç½®æ–‡ä»¶æ‰“åˆ°çš„jaråŒ…ä¸­äº†ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ <code>jar</code> åŒ…å…¶å®å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå¯ä»¥è§£å‹ç¼©ï¼Œç„¶åä¿®æ”¹é…ç½®ï¼Œæœ€åå†æ‰“æˆjaråŒ…å°±å¯ä»¥äº†ã€‚è¿™ç§æ–¹å¼æ˜¾ç„¶æœ‰ç‚¹éº»çƒ¦ï¼Œè€Œ <code>SpringBoot</code> æä¾›äº†åœ¨è¿è¡Œ <code>jar</code> æ—¶è®¾ç½®å¼€å¯æŒ‡å®šçš„ç¯å¢ƒçš„æ–¹å¼ï¼Œå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java â€“jar xxx.jar â€“-spring.profiles.active=test</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ç§æ–¹å¼èƒ½ä¸èƒ½ä¸´æ—¶ä¿®æ”¹ç«¯å£å·å‘¢ï¼Ÿä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java â€“jar xxx.jar â€“-server.port=88</span><br></pre></td></tr></table></figure><p>å½“ç„¶ä¹Ÿå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªé…ç½®ï¼Œæ¯”å¦‚å³æŒ‡å®šå¯ç”¨å“ªä¸ªç¯å¢ƒé…ç½®ï¼Œåˆä¸´æ—¶æŒ‡å®šç«¯å£ï¼Œå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java â€“jar springboot.jar â€“-server.port=88 â€“-spring.profiles.active=test</span><br></pre></td></tr></table></figure><p>å¤§å®¶è¿›è¡Œæµ‹è¯•åå°±ä¼šå‘ç°å‘½ä»¤è¡Œè®¾ç½®çš„ç«¯å£å·ä¼˜å…ˆçº§é«˜ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨çš„æ˜¯å‘½ä»¤è¡Œè®¾ç½®çš„ç«¯å£å·ï¼‰ï¼Œé…ç½®çš„ä¼˜å…ˆçº§å…¶å® <code>SpringBoot</code> å®˜ç½‘å·²ç»è¿›è¡Œäº†è¯´æ˜ï¼Œå‚è§ :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config</span><br></pre></td></tr></table></figure><p>è¿›å…¥ä¸Šé¢ç½‘ç«™åä¼šçœ‹åˆ°å¦‚ä¸‹é¡µé¢</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221113111301.png" alt=""><br><em>ç®­å¤´æ–¹å‘ä¼˜å…ˆçº§é€æ¸å‡é«˜</em></p><p>å¦‚æœä½¿ç”¨äº†å¤šç§æ–¹å¼é…åˆåŒä¸€ä¸ªé…ç½®é¡¹ï¼Œä¼˜å…ˆçº§é«˜çš„ç”Ÿæ•ˆã€‚</p><h3 id="2-5-é…ç½®æ–‡ä»¶åˆ†ç±»"><a href="#2-5-é…ç½®æ–‡ä»¶åˆ†ç±»" class="headerlink" title="2.5  é…ç½®æ–‡ä»¶åˆ†ç±»"></a>2.5  é…ç½®æ–‡ä»¶åˆ†ç±»</h3><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221113111801.png" alt=""><br><em>åœ¨è¿™å¼ å›¾ä¸­åº”è¯¥å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºè°æ˜¯è€å¤§äº†å§[doge</em></p><p>æœ‰è¿™æ ·çš„åœºæ™¯ï¼Œæˆ‘ä»¬å¼€å‘å®Œæ¯•åéœ€è¦æµ‹è¯•äººå‘˜è¿›è¡Œæµ‹è¯•ï¼Œç”±äºæµ‹è¯•ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒçš„å¾ˆå¤šé…ç½®éƒ½ä¸ç›¸åŒï¼Œæ‰€ä»¥æµ‹è¯•äººå‘˜åœ¨è¿è¡Œæˆ‘ä»¬çš„å·¥ç¨‹æ—¶éœ€è¦ä¸´æ—¶ä¿®æ”¹å¾ˆå¤šé…ç½®ï¼Œå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java â€“jar springboot.jar â€“-spring.profiles.active=test --server.port=85 --server.servlet.context-path=/heima --server.tomcat.connection-timeout=-1 â€¦â€¦ â€¦â€¦ â€¦â€¦ â€¦â€¦ â€¦â€¦</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œ<code>SpringBoot</code> å®šä¹‰äº†é…ç½®æ–‡ä»¶ä¸åŒçš„æ”¾ç½®çš„ä½ç½®ï¼›è€Œæ”¾åœ¨ä¸åŒä½ç½®çš„ä¼˜å…ˆçº§æ—¶ä¸åŒçš„ã€‚</p><p><code>SpringBoot</code> ä¸­4çº§é…ç½®æ–‡ä»¶æ”¾ç½®ä½ç½®ï¼š</p><ul><li>1çº§ï¼šclasspathï¼šapplication.yml  </li><li>2çº§ï¼šclasspathï¼šconfig/application.yml</li><li>3çº§ï¼šfile ï¼šapplication.yml</li><li>4çº§ï¼šfile ï¼šconfig/application.yml </li></ul><blockquote><p>==è¯´æ˜ï¼š==çº§åˆ«è¶Šé«˜ä¼˜å…ˆçº§è¶Šé«˜</p></blockquote><h4 id="2-5-1-ä»£ç æ¼”ç¤º"><a href="#2-5-1-ä»£ç æ¼”ç¤º" class="headerlink" title="2.5.1  ä»£ç æ¼”ç¤º"></a>2.5.1  ä»£ç æ¼”ç¤º</h4><p>åœ¨è¿™é‡Œæˆ‘ä»¬åªæ¼”ç¤ºä¸åŒçº§åˆ«é…ç½®æ–‡ä»¶æ”¾ç½®ä½ç½®çš„ä¼˜å…ˆçº§ã€‚</p><h5 id="2-5-1-1-ç¯å¢ƒå‡†å¤‡"><a href="#2-5-1-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.5.1.1  ç¯å¢ƒå‡†å¤‡"></a>2.5.1.1  ç¯å¢ƒå‡†å¤‡</h5><p>åˆ›å»ºä¸€ä¸ªåä¸º <code>springboot_06_config_file</code> çš„ <code>SpringBoot</code> å·¥ç¨‹ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p><p><img src="assets/image-20210917200241282.png" alt="image-20210917200241282" style="zoom:80%;" /></p><p>åœ¨ <code>resources</code> ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>config</code> çš„ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸­åˆ›å»º <code>application.yml</code> é…ç½®æ–‡ä»¶ï¼Œè€Œåœ¨è¯¥é…ç½®æ–‡ä»¶ä¸­å°†ç«¯å£å·è®¾ç½®ä¸º <code>81</code>ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br></pre></td></tr></table></figure><p>è€Œåœ¨ <code>resources</code> ä¸‹åˆ›å»ºçš„ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸­å¹¶å°†ç«¯å£å·è®¾ç½®ä¸º <code>80</code>ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h5 id="2-5-1-2-éªŒè¯1çº§å’Œ2çº§çš„ä¼˜å…ˆçº§"><a href="#2-5-1-2-éªŒè¯1çº§å’Œ2çº§çš„ä¼˜å…ˆçº§" class="headerlink" title="2.5.1.2  éªŒè¯1çº§å’Œ2çº§çš„ä¼˜å…ˆçº§"></a>2.5.1.2  éªŒè¯1çº§å’Œ2çº§çš„ä¼˜å…ˆçº§</h5><p>è¿è¡Œå¯åŠ¨å¼•å¯¼ç±»ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ä¿¡æ¯</p><p><img src="assets/image-20210917200805389.png" alt="image-20210917200805389"></p><p>é€šè¿‡è¿™ä¸ªç»“æœå¯ä»¥å¾—å‡º==ç±»è·¯å¾„ä¸‹çš„ <code>config</code> ä¸‹çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆäºç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚==</p><h5 id="2-5-1-3-éªŒè¯2çº§å’Œ4çº§çš„ä¼˜å…ˆçº§"><a href="#2-5-1-3-éªŒè¯2çº§å’Œ4çº§çš„ä¼˜å…ˆçº§" class="headerlink" title="2.5.1.3  éªŒè¯2çº§å’Œ4çº§çš„ä¼˜å…ˆçº§"></a>2.5.1.3  éªŒè¯2çº§å’Œ4çº§çš„ä¼˜å…ˆçº§</h5><p>è¦éªŒè¯4çº§ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆ</p><ul><li><p>å°†å·¥ç¨‹æ‰“æˆ <code>jar</code> åŒ…</p><p>ç‚¹å‡»å·¥ç¨‹çš„ <code>package</code> æ¥æ‰“ <code>jar</code> åŒ…</p><p><img src="assets/image-20210917201243721.png" alt="image-20210917201243721" style="zoom:80%;" /></p></li><li><p>åœ¨ç¡¬ç›˜ä¸Šæ‰¾åˆ° <code>jar</code> åŒ…æ‰€åœ¨ä½ç½®</p><p><img src="assets/image-20210917201523669.png" alt="image-20210917201523669" style="zoom:70%;" /></p></li><li><p>åœ¨ <code>jar</code> åŒ…æ‰€åœ¨ä½ç½®åˆ›å»º <code>config</code> æ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»º <code>application.yml</code> é…ç½®æ–‡ä»¶ï¼Œè€Œåœ¨è¯¥é…åˆæ–‡ä»¶ä¸­å°†ç«¯å£å·è®¾ç½®ä¸º <code>82</code> </p></li><li><p>åœ¨å‘½ä»¤è¡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œç¨‹åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar springboot_06_config_file-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><p>è¿è¡Œåæ—¥å¿—ä¿¡æ¯å¦‚ä¸‹å¯ä»¥å‘ç°ç«¯å£çš„åˆ‡æ¢</p><p>é€šè¿‡è¿™ä¸ªç»“æœå¯ä»¥å¾—å‡º==fileï¼š <code>config</code> ä¸‹çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆäºç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚==</p></li></ul><blockquote><p>==æ³¨æ„ï¼š==</p><p>SpringBoot 2.5.0ç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªbugï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åœ¨ <code>jar</code> æ‰€åœ¨ä½ç½®çš„ <code>config</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä»»æ„åç§°çš„æ–‡ä»¶å¤¹</p></blockquote><h2 id="3ï¼ŒSpringBootæ•´åˆjunit"><a href="#3ï¼ŒSpringBootæ•´åˆjunit" class="headerlink" title="3ï¼ŒSpringBootæ•´åˆjunit"></a>3ï¼ŒSpringBootæ•´åˆjunit</h2><p>å›é¡¾ <code>Spring</code> æ•´åˆ <code>junit</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>@RunWith</code> æ³¨è§£æŒ‡å®šè¿è¡Œå™¨ï¼Œä½¿ç”¨ <code>@ContextConfiguration</code> æ³¨è§£æ¥æŒ‡å®šé…ç½®ç±»æˆ–è€…é…ç½®æ–‡ä»¶ã€‚è€Œ <code>SpringBoot</code> æ•´åˆ <code>junit</code> ç‰¹åˆ«ç®€å•ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥å®Œæˆ</p><ul><li>åœ¨æµ‹è¯•ç±»ä¸Šæ·»åŠ  <code>SpringBootTest</code> æ³¨è§£</li><li>ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥è¦æµ‹è¯•çš„èµ„æº</li><li>å®šä¹‰æµ‹è¯•æ–¹æ³•è¿›è¡Œæµ‹è¯•</li></ul><h3 id="3-1-ç¯å¢ƒå‡†å¤‡"><a href="#3-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="3.1  ç¯å¢ƒå‡†å¤‡"></a>3.1  ç¯å¢ƒå‡†å¤‡</h3><p>åˆ›å»ºä¸€ä¸ªåä¸º <code>springboot_07_test</code> çš„ <code>SpringBoot</code> å·¥ç¨‹ï¼Œå·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><img src="assets/image-20210917213556673.png" alt="image-20210917213556673" style="zoom:80%;" /></p><p>åœ¨ <code>com.blog.service</code> ä¸‹åˆ›å»º <code>BookService</code> æ¥å£ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>com.blog.service.impl</code> åŒ…å†™åˆ›å»ºä¸€ä¸ª <code>BookServiceImpl</code> ç±»ï¼Œä½¿å…¶å®ç° <code>BookService</code> æ¥å£ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book service is running ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-ç¼–å†™æµ‹è¯•ç±»"><a href="#3-2-ç¼–å†™æµ‹è¯•ç±»" class="headerlink" title="3.2  ç¼–å†™æµ‹è¯•ç±»"></a>3.2  ç¼–å†™æµ‹è¯•ç±»</h3><p>åœ¨ <code>test/java</code> ä¸‹åˆ›å»º <code>com.blog</code> åŒ…ï¼Œåœ¨è¯¥åŒ…ä¸‹åˆ›å»ºæµ‹è¯•ç±»ï¼Œå°† <code>BookService</code> æ³¨å…¥åˆ°è¯¥æµ‹è¯•ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot07TestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>==æ³¨æ„ï¼š==è¿™é‡Œçš„å¼•å¯¼ç±»æ‰€åœ¨åŒ…å¿…é¡»æ˜¯æµ‹è¯•ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ã€‚</p><p>ä¾‹å¦‚ï¼š</p><ul><li>å¼•å¯¼ç±»æ‰€åœ¨åŒ…æ˜¯ <code>com.blog</code></li><li>æµ‹è¯•ç±»æ‰€åœ¨åŒ…æ˜¯ <code>com.blog</code></li></ul><p>å¦‚æœä¸æ»¡è¶³è¿™ä¸ªè¦æ±‚çš„è¯ï¼Œå°±éœ€è¦åœ¨ä½¿ç”¨ <code>@SpringBootTest</code> æ³¨è§£æ—¶ï¼Œä½¿ç”¨ <code>classes</code> å±æ€§æŒ‡å®šå¼•å¯¼ç±»çš„å­—èŠ‚ç å¯¹è±¡ã€‚å¦‚ <code>@SpringBootTest(classes = Springboot07TestApplication.class)</code></p></blockquote><h2 id="4ï¼ŒSpringBootæ•´åˆmybatis"><a href="#4ï¼ŒSpringBootæ•´åˆmybatis" class="headerlink" title="4ï¼ŒSpringBootæ•´åˆmybatis"></a>4ï¼ŒSpringBootæ•´åˆmybatis</h2><h3 id="4-1-å›é¡¾Springæ•´åˆMybatis"><a href="#4-1-å›é¡¾Springæ•´åˆMybatis" class="headerlink" title="4.1  å›é¡¾Springæ•´åˆMybatis"></a>4.1  å›é¡¾Springæ•´åˆMybatis</h3><p><code>Spring</code> æ•´åˆ <code>Mybatis</code> éœ€è¦å®šä¹‰å¾ˆå¤šé…ç½®ç±»</p><ul><li><p><code>SpringConfig</code> é…ç½®ç±»</p><ul><li><p>å¯¼å…¥ <code>JdbcConfig</code> é…ç½®ç±»</p></li><li><p>å¯¼å…¥ <code>MybatisConfig</code> é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.blog&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class,MyBatisConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>JdbcConfig</code> é…ç½®ç±»</p><ul><li><p>å®šä¹‰æ•°æ®æºï¼ˆåŠ è½½propertiesé…ç½®é¡¹ï¼šdriverã€urlã€usernameã€passwordï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">getDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        ds.setDriverClassName(driver);</span><br><span class="line">        ds.setUrl(url);</span><br><span class="line">        ds.setUsername(userName);</span><br><span class="line">        ds.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>MybatisConfig</code> é…ç½®ç±»</p><ul><li><p>å®šä¹‰ <code>SqlSessionFactoryBean</code></p></li><li><p>å®šä¹‰æ˜ å°„é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MapperScannerConfigurer <span class="title function_">getMapperScannerConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MapperScannerConfigurer</span> <span class="variable">msc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line">    msc.setBasePackage(<span class="string">&quot;com.blog.dao&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> msc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">getSqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">    <span class="type">SqlSessionFactoryBean</span> <span class="variable">ssfb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">    ssfb.setTypeAliasesPackage(<span class="string">&quot;com.blog.domain&quot;</span>);</span><br><span class="line">    ssfb.setDataSource(dataSource);</span><br><span class="line">    <span class="keyword">return</span> ssfb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="4-2-SpringBootæ•´åˆmybatis"><a href="#4-2-SpringBootæ•´åˆmybatis" class="headerlink" title="4.2  SpringBootæ•´åˆmybatis"></a>4.2  SpringBootæ•´åˆmybatis</h3><h4 id="4-2-1-åˆ›å»ºæ¨¡å—"><a href="#4-2-1-åˆ›å»ºæ¨¡å—" class="headerlink" title="4.2.1  åˆ›å»ºæ¨¡å—"></a>4.2.1  åˆ›å»ºæ¨¡å—</h4><ul><li><p>åˆ›å»ºæ–°æ¨¡å—ï¼Œé€‰æ‹© <code>Spring Initializr</code>ï¼Œå¹¶é…ç½®æ¨¡å—ç›¸å…³åŸºç¡€ä¿¡æ¯</p></li><li><p>é€‰æ‹©å½“å‰æ¨¡å—éœ€è¦ä½¿ç”¨çš„æŠ€æœ¯é›†ï¼ˆMyBatisã€MySQLï¼‰</p></li></ul><h4 id="4-2-2-å®šä¹‰å®ä½“ç±»"><a href="#4-2-2-å®šä¹‰å®ä½“ç±»" class="headerlink" title="4.2.2  å®šä¹‰å®ä½“ç±»"></a>4.2.2  å®šä¹‰å®ä½“ç±»</h4><p>åœ¨ <code>com.blog.domain</code> åŒ…ä¸‹å®šä¹‰å®ä½“ç±» <code>Book</code>ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//setter and  getter</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-3-å®šä¹‰daoæ¥å£"><a href="#4-2-3-å®šä¹‰daoæ¥å£" class="headerlink" title="4.2.3  å®šä¹‰daoæ¥å£"></a>4.2.3  å®šä¹‰daoæ¥å£</h4><p>åœ¨ <code>com.blog.dao</code> åŒ…ä¸‹å®šä¹‰ <code>BookDao</code> æ¥å£ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-4-å®šä¹‰æµ‹è¯•ç±»"><a href="#4-2-4-å®šä¹‰æµ‹è¯•ç±»" class="headerlink" title="4.2.4  å®šä¹‰æµ‹è¯•ç±»"></a>4.2.4  å®šä¹‰æµ‹è¯•ç±»</h4><p>åœ¨ <code>test/java</code> ä¸‹å®šä¹‰åŒ… <code>com.blog</code> ï¼Œåœ¨è¯¥åŒ…ä¸‹æµ‹è¯•ç±»ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Springboot08MybatisApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookDao.getById(<span class="number">1</span>);</span><br><span class="line">System.out.println(book);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-5-ç¼–å†™é…ç½®"><a href="#4-2-5-ç¼–å†™é…ç½®" class="headerlink" title="4.2.5  ç¼–å†™é…ç½®"></a>4.2.5  ç¼–å†™é…ç½®</h4><p>æˆ‘ä»¬ä»£ç ä¸­å¹¶æ²¡æœ‰æŒ‡å®šè¿æ¥å“ªå„¿ä¸ªæ•°æ®åº“ï¼Œç”¨æˆ·åæ˜¯ä»€ä¹ˆï¼Œå¯†ç æ˜¯ä»€ä¹ˆã€‚æ‰€ä»¥è¿™éƒ¨åˆ†éœ€è¦åœ¨ <code>SpringBoot</code> çš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…åˆã€‚</p><p>åœ¨ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹å†…å®¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ssm_db</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><h4 id="4-2-6-æµ‹è¯•"><a href="#4-2-6-æµ‹è¯•" class="headerlink" title="4.2.6  æµ‹è¯•"></a>4.2.6  æµ‹è¯•</h4><p>è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯</p><p><img src="assets/image-20210917221427930.png" alt="image-20210917221427930" style="zoom:70%;" /></p><p>é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåœ¨ <code>Spring</code> å®¹å™¨ä¸­æ²¡æœ‰ <code>BookDao</code> ç±»å‹çš„ <code>bean</code>ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>åŸå› æ˜¯ <code>Mybatis</code> ä¼šæ‰«ææ¥å£å¹¶åˆ›å»ºæ¥å£çš„ä»£ç å¯¹è±¡äº¤ç»™ <code>Spring</code> ç®¡ç†ï¼Œä½†æ˜¯ç°åœ¨å¹¶æ²¡æœ‰å‘Šè¯‰ <code>Mybatis</code> å“ªä¸ªæ˜¯ <code>dao</code> æ¥å£ã€‚è€Œæˆ‘ä»¬è¦è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦åœ¨<code>BookDao</code> æ¥å£ä¸Šä½¿ç”¨ <code>@Mapper</code> ï¼Œ<code>BookDao</code> æ¥å£æ”¹è¿›ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>==æ³¨æ„ï¼š==</p><p><code>SpringBoot</code> ç‰ˆæœ¬ä½äº2.4.3(ä¸å«)ï¼ŒMysqlé©±åŠ¨ç‰ˆæœ¬å¤§äº8.0æ—¶ï¼Œéœ€è¦åœ¨urlè¿æ¥ä¸²ä¸­é…ç½®æ—¶åŒº <code>jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</code>ï¼Œæˆ–åœ¨MySQLæ•°æ®åº“ç«¯é…ç½®æ—¶åŒºè§£å†³æ­¤é—®é¢˜</p></blockquote><h4 id="4-2-7-ä½¿ç”¨Druidæ•°æ®æº"><a href="#4-2-7-ä½¿ç”¨Druidæ•°æ®æº" class="headerlink" title="4.2.7  ä½¿ç”¨Druidæ•°æ®æº"></a>4.2.7  ä½¿ç”¨Druidæ•°æ®æº</h4><p>ç°åœ¨æˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šæ•°æ®æºï¼Œ<code>SpringBoot</code> æœ‰é»˜è®¤çš„æ•°æ®æºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šä½¿ç”¨ <code>Druid</code> æ•°æ®æºï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®ç°</p><ul><li><p>å¯¼å…¥ <code>Druid</code> ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨ <code>application.yml</code> é…ç½®æ–‡ä»¶é…ç½®</p><p>å¯ä»¥é€šè¿‡ <code>spring.datasource.type</code> æ¥é…ç½®ä½¿ç”¨ä»€ä¹ˆæ•°æ®æºã€‚é…ç½®æ–‡ä»¶å†…å®¹å¯ä»¥æ”¹è¿›ä¸º</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="5-æ•´åˆå°ç»“"><a href="#5-æ•´åˆå°ç»“" class="headerlink" title="5 æ•´åˆå°ç»“"></a>5 æ•´åˆå°ç»“</h2><p>Junitæ•´åˆæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å•çº¯åˆ›å»ºä¸€ä¸ªserviceå±‚çš„æ¥å£ç±»å’Œå®ç°ç±»ï¼Œ æ·»åŠ ä¸€ä¸ªç‹¬ç«‹çš„æ³¨è§£å»è®©æ¥å£è¢«springç®¡ç†ï¼Œåˆ›å»ºæµ‹è¯•ç±»è®©å…¶è‡ªåŠ¨è£…é…å³å¯ã€‚<br>Mybatisæ•´åˆ<br>å­¦å®Œæ•´ä¸ªéƒ¨åˆ†ï¼Œå‰–å»æ‰€æœ‰ç»†èŠ‚å±‚é¢é‡åˆ°çš„é—®é¢˜ æ•´ä¸ªå®ç°æµç¨‹å¦‚ä¸‹ï¼š<br>é¦–å…ˆæ˜¯å†™ymlå¯¹åº”ä¸Šæ•°æ®åº“ï¼Œåˆ›å»ºä¸€ä¸ªdaoå±‚å…¶ä¸­å†™å…¥å®ä½“ç±»ä»¥åŠdaoå±‚æ¥å£ï¼Œæ–¹æ³•ä¸Šæ·»åŠ ä¸Šå¯¹åº”çš„sqlè¯­å¥åŒæ ·éœ€è¦åŠ ä¸Šæ³¨è§£ï¼Œè®©å…¶è¢«springè¯†åˆ«å¹¶ä¸”çŸ¥é“æ˜¯daoæ¥å£ï¼Œä¹‹åè‡ªåŠ¨è£…é…æµ‹è¯•ç±»ã€‚</p><h2 id="6ï¼Œæ¡ˆä¾‹"><a href="#6ï¼Œæ¡ˆä¾‹" class="headerlink" title="6ï¼Œæ¡ˆä¾‹"></a>6ï¼Œæ¡ˆä¾‹</h2><p><code>SpringBoot</code>åŸºç¡€ç»“æŸï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹  <code>SSM</code> æ—¶åšçš„ä¸‰å¤§æ¡†æ¶æ•´åˆçš„æ¡ˆä¾‹ç”¨ <code>SpringBoot</code> æ¥æ•´åˆå®ç°ï¼Œæµç¨‹ï¼š</p><ol><li><p>pom.xml</p><p>é…ç½®èµ·æ­¥ä¾èµ–ï¼Œå¿…è¦çš„èµ„æºåæ ‡(druid) </p></li><li><p>application.yml</p><p>è®¾ç½®æ•°æ®æºã€ç«¯å£ç­‰</p></li><li><p>é…ç½®ç±»</p><p>å…¨éƒ¨åˆ é™¤</p></li><li><p>dao</p><p>è®¾ç½®@Mapper</p></li><li><p>æµ‹è¯•ç±»</p></li><li><p>é¡µé¢</p><p>æ”¾ç½®åœ¨resourcesç›®å½•ä¸‹çš„staticç›®å½•ä¸­</p></li></ol><h3 id="5-1-åˆ›å»ºå·¥ç¨‹"><a href="#5-1-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="5.1  åˆ›å»ºå·¥ç¨‹"></a>5.1  åˆ›å»ºå·¥ç¨‹</h3><p>åˆ›å»º <code>SpringBoot</code> å·¥ç¨‹ï¼Œåœ¨åˆ›å»ºå·¥ç¨‹æ—¶éœ€è¦å‹¾é€‰ <code>web</code>ã€<code>mysql</code>ã€<code>mybatis</code>ï¼Œå·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><img src="assets/image-20210917225019868.png" alt="image-20210917225019868" style="zoom:80%;" /></p><p>ç”±äºæˆ‘ä»¬å·¥ç¨‹ä¸­ä½¿ç”¨åˆ°äº† <code>Druid</code> ï¼Œæ‰€ä»¥éœ€è¦å¯¼å…¥ <code>Druid</code> çš„åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-2-ä»£ç æ‹·è´"><a href="#5-2-ä»£ç æ‹·è´" class="headerlink" title="5.2  ä»£ç æ‹·è´"></a>5.2  ä»£ç æ‹·è´</h3><p>å°† <code>springMVC_ssm</code> å·¥ç¨‹ä¸­çš„ <code>java</code> ä»£ç åŠæµ‹è¯•ä»£ç è¿åŒåŒ…æ‹·è´åˆ° <code>springboot_09_ssm</code> å·¥ç¨‹</p><p>å¯¹åº”çš„åŒ…ç›´æ¥å¤åˆ¶åˆ°æœ¬å·¥ç¨‹ç›®å½•ä¸‹ï¼Œé™¤äº†htmlç­‰webèµ„æº</p><p>éœ€è¦ä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š</p><ul><li><p><code>Springmvc_11_page</code> ä¸­ <code>config</code> åŒ…ä¸‹çš„æ˜¯é…ç½®ç±»ï¼Œè€Œ <code>SpringBoot</code> å·¥ç¨‹ä¸éœ€è¦è¿™äº›é…ç½®ç±»ï¼Œæ‰€ä»¥è¿™äº›å¯ä»¥ç›´æ¥åˆ é™¤</p></li><li><p><code>dao</code> åŒ…ä¸‹çš„æ¥å£ä¸Šåœ¨æ‹·è´åˆ° <code>springboot_09-ssm</code> å·¥ç¨‹ä¸­éœ€è¦åœ¨æ¥å£ä¸­æ·»åŠ  <code>@Mapper</code> æ³¨è§£</p></li><li><p><code>BookServiceTest</code> æµ‹è¯•éœ€è¦æ”¹æˆ <code>SpringBoot</code> æ•´åˆ <code>junit</code> çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getById(<span class="number">2</span>);</span><br><span class="line">        System.out.println(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Book&gt; all = bookService.getAll();</span><br><span class="line">        System.out.println(all);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-3-é…ç½®æ–‡ä»¶"><a href="#5-3-é…ç½®æ–‡ä»¶" class="headerlink" title="5.3  é…ç½®æ–‡ä»¶"></a>5.3  é…ç½®æ–‡ä»¶</h3><p>åœ¨ <code>application.yml</code> é…ç½®æ–‡ä»¶ä¸­éœ€è¦é…ç½®å¦‚ä¸‹å†…å®¹</p><ul><li>æœåŠ¡çš„ç«¯å£å·</li><li>è¿æ¥æ•°æ®åº“çš„ä¿¡æ¯</li><li>æ•°æ®æº</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ssm_db</span> <span class="comment">#?servierTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><h3 id="5-4-é™æ€èµ„æº"><a href="#5-4-é™æ€èµ„æº" class="headerlink" title="5.4  é™æ€èµ„æº"></a>5.4  é™æ€èµ„æº</h3><p>åœ¨ <code>SpringBoot</code> ç¨‹åºä¸­æ˜¯æ²¡æœ‰ <code>webapp</code> ç›®å½•çš„ï¼Œé‚£ä¹ˆåœ¨ <code>SpringBoot</code> ç¨‹åºä¸­é™æ€èµ„æºéœ€è¦æ”¾åœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿ</p><p>é™æ€èµ„æºéœ€è¦æ”¾åœ¨ <code>resources</code> ä¸‹çš„ <code>static</code> ä¸‹ï¼Œä¹‹ååˆ›å»ºwebé™æ€èµ„æºæ—¶ä¹Ÿå¯ç›´æ¥åˆ›å»ºåœ¨ä¹‹ä¸‹ï¼Œä¹‹åæ¥ç€æµ‹è¯•å³å¯ã€‚</p><p>è‡³æ­¤ï¼ŒspringBootå…¥é—¨åœ†æ»¡ç»“æŸ~ å¸Œæœ›ç¬”è®°å¯ä»¥å¯¹ä½ æœ‰å¸®åŠ©<br><em>rugu</em></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®©æˆ‘çœ‹çœ‹ï¼Œé‡è§~</title>
      <link href="/posts/2.html"/>
      <url>/posts/2.html</url>
      
        <content type="html"><![CDATA[<h1 id="é‡è§ï¼Œè®©æˆ‘çœ‹åˆ°æ›´å¥½çš„ä½ "><a href="#é‡è§ï¼Œè®©æˆ‘çœ‹åˆ°æ›´å¥½çš„ä½ " class="headerlink" title="é‡è§ï¼Œè®©æˆ‘çœ‹åˆ°æ›´å¥½çš„ä½ "></a>é‡è§ï¼Œè®©æˆ‘çœ‹åˆ°æ›´å¥½çš„ä½ </h1><p>è¿™æ˜¯ä¸€æ®µè¯~<br><em>è¿™æ˜¯è¿™æ®µè¯çš„æ³¨è§£</em></p>]]></content>
      
      
      <categories>
          
          <category> é‡è§ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSMæ•´åˆ</title>
      <link href="/posts/1.html"/>
      <url>/posts/1.html</url>
      
        <content type="html"><![CDATA[<div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=553267404&&page=1&as_wide=1&high_quality=1&danmaku=0"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     high_quality=1    danmaku=1     allowfullscreen="true">     </iframe></div><h2 id="SSMæ•´åˆ"><a href="#SSMæ•´åˆ" class="headerlink" title="SSMæ•´åˆ"></a>SSMæ•´åˆ</h2><p><em>åœ¨SSMæ•´åˆéƒ¨åˆ†éœ€è¦æŒæ¡çš„çŸ¥è¯†ç‚¹</em></p><blockquote><ul><li>å®ŒæˆSSMçš„æ•´åˆå¼€å‘</li><li>èƒ½å¤Ÿç†è§£å¹¶å®ç°ç»Ÿä¸€ç»“æœå°è£…ä¸ç»Ÿä¸€å¼‚å¸¸å¤„ç†</li><li>èƒ½å¤Ÿå®Œæˆå‰åå°åŠŸèƒ½æ•´åˆå¼€å‘</li><li>æŒæ¡æ‹¦æˆªå™¨çš„ç¼–å†™</li></ul></blockquote><h2 id="1ï¼ŒSSMæ•´åˆ"><a href="#1ï¼ŒSSMæ•´åˆ" class="headerlink" title="1ï¼ŒSSMæ•´åˆ"></a>1ï¼ŒSSMæ•´åˆ</h2><p>å‰ç½®çŸ¥è¯†ï¼š<code>Mybatis</code>ã€<code>Spring</code>å’Œ<code>SpringMVC</code>ä¸‰ä¸ªæ¡†æ¶</p><h3 id="1-1-æµç¨‹åˆ†æ"><a href="#1-1-æµç¨‹åˆ†æ" class="headerlink" title="1.1 æµç¨‹åˆ†æ"></a>1.1 æµç¨‹åˆ†æ</h3><p>(1) åˆ›å»ºå·¥ç¨‹<br><strong>ps.</strong> åˆ›å»ºä¸€ä¸ªwebå·¥ç¨‹éœ€è¦ä½¿ç”¨æ¡†æ¶ï¼Œè€Œä¸”åˆ›å»ºä¹‹åä¼šç¼ºå°‘ç›¸åº”çš„éƒ¨åˆ†ï¼ˆæ¯”å¦‚test,resourcesç­‰ï¼‰éœ€è¦è‡ªå·±æ·»åŠ ï¼Œæ·»åŠ æ–¹å¼åœ¨æ­¤å°±ä¸è¯´äº†ï¼Œå¯è‡ªè¡Œgoogle</p><ol><li>åˆ›å»ºä¸€ä¸ªMavençš„webå·¥ç¨‹</li><li>pom.xmlæ·»åŠ SSMéœ€è¦çš„ä¾èµ–jaråŒ…</li><li>ç¼–å†™Webé¡¹ç›®çš„å…¥å£é…ç½®ç±»ï¼Œå®ç°<code>AbstractAnnotationConfigDispatcherServletInitializer</code>é‡å†™ä»¥ä¸‹æ–¹æ³•<ul><li><code>getRootConfigClasses()</code>    ï¼šè¿”å›Springçš„é…ç½®ç±»-&gt;éœ€è¦==SpringConfig==é…ç½®ç±»</li><li><code>getServletConfigClasses()</code> ï¼šè¿”å›SpringMVCçš„é…ç½®ç±»-&gt;éœ€è¦==SpringMvcConfig==é…ç½®ç±»</li><li><code>getServletMappings()</code>      : è®¾ç½®SpringMVCè¯·æ±‚æ‹¦æˆªè·¯å¾„è§„åˆ™</li><li><code>getServletFilters()</code>       ï¼šè®¾ç½®è¿‡æ»¤å™¨ï¼Œè§£å†³POSTè¯·æ±‚ä¸­æ–‡ä¹±ç é—®é¢˜</li></ul></li></ol><p>(2)SSMæ•´åˆ[==é‡ç‚¹æ˜¯å„ä¸ªé…ç½®çš„ç¼–å†™==]<br>ï¼ˆåœ¨æ•´åˆè¿‡ç¨‹ä¸­å¯ä»¥ä¸å†™æ¨¡å—ï¼‰</p><ol><li><code>SpringConfig</code><ul><li>æ ‡è¯†è¯¥ç±»ä¸ºé…ç½®ç±» <code>@Configuration</code></li><li>æ‰«æServiceæ‰€åœ¨çš„åŒ… <code>@ComponentScan</code></li><li>åœ¨Serviceå±‚è¦ç®¡ç†äº‹åŠ¡ <code>@EnableTransactionManagement</code></li><li>è¯»å–å¤–éƒ¨çš„propertiesé…ç½®æ–‡ä»¶ <code>@PropertySource</code></li><li>æ•´åˆMybatiséœ€è¦å¼•å…¥Mybatisç›¸å…³é…ç½®ç±» <code>@Import</code><ul><li>ç¬¬ä¸‰æ–¹æ•°æ®æºé…ç½®ç±» <code>JdbcConfig</code><ul><li>æ„å»º<code>DataSource</code>æ•°æ®æºï¼Œ<code>DruidDataSouroce</code>,éœ€è¦æ³¨å…¥æ•°æ®åº“è¿æ¥å››è¦ç´ ï¼Œ @Bean @Value</li><li>æ„å»ºå¹³å°äº‹åŠ¡ç®¡ç†å™¨ï¼Œ<code>DataSourceTransactionManager</code>,<code>@Bean</code></li></ul></li><li><code>Mybatis</code>é…ç½®ç±» <code>MybatisConfig</code><ul><li>æ„å»º<code>SqlSessionFactoryBean</code>å¹¶è®¾ç½®åˆ«åæ‰«æä¸æ•°æ®æºï¼Œ<code>@Bean</code></li><li>æ„å»º<code>MapperScannerConfigurer</code>å¹¶è®¾ç½®DAOå±‚çš„åŒ…æ‰«æ</li></ul></li></ul></li></ul></li><li><code>SpringMvcConfig</code><ul><li>æ ‡è¯†è¯¥ç±»ä¸ºé…ç½®ç±» <code>@Configuration</code></li><li>æ‰«æControlleræ‰€åœ¨çš„åŒ… <code>@ComponentScan</code></li><li>å¼€å¯SpringMVCæ³¨è§£æ”¯æŒ <code>@EnableWebMvc</code></li></ul></li></ol><p>(3)åŠŸèƒ½æ¨¡å—[ä¸å…·ä½“çš„ä¸šåŠ¡æ¨¡å—æœ‰å…³]</p><ol><li>åˆ›å»ºæ•°æ®åº“è¡¨</li><li>æ ¹æ®æ•°æ®åº“è¡¨åˆ›å»ºå¯¹åº”çš„æ¨¡å‹ç±»</li><li>é€šè¿‡Daoå±‚å®Œæˆæ•°æ®åº“è¡¨çš„å¢åˆ æ”¹æŸ¥(æ¥å£+è‡ªåŠ¨ä»£ç†)</li><li>ç¼–å†™Serviceå±‚[Serviceæ¥å£+å®ç°ç±»]<ul><li><code>@Service</code></li><li><code>@Transactional</code></li><li>æ•´åˆJunitå¯¹ä¸šåŠ¡å±‚è¿›è¡Œå•å…ƒæµ‹è¯•<ul><li><code>@RunWith</code></li><li><code>@ContextConfiguration</code></li><li><code>@Test</code></li></ul></li></ul></li><li>ç¼–å†™Controllerå±‚<ul><li>æ¥æ”¶è¯·æ±‚ @RequestMapping @GetMapping @PostMapping @PutMapping @DeleteMapping</li><li>æ¥æ”¶æ•°æ® ç®€å•ã€POJOã€åµŒå¥—POJOã€é›†åˆã€æ•°ç»„ã€JSONæ•°æ®ç±»å‹<ul><li><code>@RequestParam</code></li><li><code>@PathVariable</code></li><li><code>@RequestBody</code></li></ul></li><li>è½¬å‘ä¸šåŠ¡å±‚ <ul><li><code>@Autowired</code></li></ul></li><li>å“åº”ç»“æœ<ul><li><code>@ResponseBody</code></li></ul></li></ul></li></ol><h3 id="1-2-æ•´åˆé…ç½®"><a href="#1-2-æ•´åˆé…ç½®" class="headerlink" title="1.2 æ•´åˆé…ç½®"></a>1.2 æ•´åˆé…ç½®</h3><p>æŒæ¡ä¸Šè¿°çš„çŸ¥è¯†ç‚¹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤ä¸€æ­¥æ­¥çš„æ¥å®ŒæˆSSMçš„æ•´åˆã€‚</p><h4 id="æ­¥éª¤1ï¼šåˆ›å»ºMavençš„webé¡¹ç›®"><a href="#æ­¥éª¤1ï¼šåˆ›å»ºMavençš„webé¡¹ç›®" class="headerlink" title="æ­¥éª¤1ï¼šåˆ›å»ºMavençš„webé¡¹ç›®"></a>æ­¥éª¤1ï¼šåˆ›å»ºMavençš„webé¡¹ç›®</h4><p>å¯ä»¥ä½¿ç”¨Mavençš„éª¨æ¶åˆ›å»º</p><h4 id="æ­¥éª¤2-æ·»åŠ ä¾èµ–"><a href="#æ­¥éª¤2-æ·»åŠ ä¾èµ–" class="headerlink" title="æ­¥éª¤2:æ·»åŠ ä¾èµ–"></a>æ­¥éª¤2:æ·»åŠ ä¾èµ–</h4><p>pom.xmlæ·»åŠ SSMæ‰€éœ€è¦çš„ä¾èµ–jaråŒ…<br>ï¼ˆä¸éœ€è¦çš„åœ°æ–¹ç›´æ¥åˆ é™¤å³å¯ï¼ŒåŸå…ˆçš„é…ç½®ä¹Ÿå¯ä»¥ç›´æ¥åˆ é™¤ï¼‰<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h4 id="æ­¥éª¤3-åˆ›å»ºé¡¹ç›®åŒ…ç»“æ„"><a href="#æ­¥éª¤3-åˆ›å»ºé¡¹ç›®åŒ…ç»“æ„" class="headerlink" title="æ­¥éª¤3:åˆ›å»ºé¡¹ç›®åŒ…ç»“æ„"></a>æ­¥éª¤3:åˆ›å»ºé¡¹ç›®åŒ…ç»“æ„</h4><ul><li>configç›®å½•å­˜æ”¾çš„æ˜¯ç›¸å…³çš„é…ç½®ç±»</li><li>controllerç¼–å†™çš„æ˜¯Controllerç±»</li><li>daoå­˜æ”¾çš„æ˜¯Daoæ¥å£ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯Mapperæ¥å£ä»£ç†æ–¹å¼ï¼Œæ‰€ä»¥æ²¡æœ‰å®ç°ç±»åŒ…</li><li>serviceå­˜çš„æ˜¯Serviceæ¥å£ï¼Œimplå­˜æ”¾çš„æ˜¯Serviceå®ç°ç±»</li><li>resources:å­˜å…¥çš„æ˜¯é…ç½®æ–‡ä»¶ï¼Œå¦‚Jdbc.properties</li><li>webapp:ç›®å½•å¯ä»¥å­˜æ”¾é™æ€èµ„æº</li><li>test/java:å­˜æ”¾çš„æ˜¯æµ‹è¯•ç±»</li></ul><h4 id="æ­¥éª¤4-åˆ›å»ºSpringConfigé…ç½®ç±»"><a href="#æ­¥éª¤4-åˆ›å»ºSpringConfigé…ç½®ç±»" class="headerlink" title="æ­¥éª¤4:åˆ›å»ºSpringConfigé…ç½®ç±»"></a>æ­¥éª¤4:åˆ›å»ºSpringConfigé…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.blog.service&quot;&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class,MyBatisConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤5-åˆ›å»ºJdbcConfigé…ç½®ç±»"><a href="#æ­¥éª¤5-åˆ›å»ºJdbcConfigé…ç½®ç±»" class="headerlink" title="æ­¥éª¤5:åˆ›å»ºJdbcConfigé…ç½®ç±»"></a>æ­¥éª¤5:åˆ›å»ºJdbcConfigé…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setDriverClassName(driver);</span><br><span class="line">        dataSource.setUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        ds.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤6-åˆ›å»ºMybatisConfigé…ç½®ç±»"><a href="#æ­¥éª¤6-åˆ›å»ºMybatisConfigé…ç½®ç±»" class="headerlink" title="æ­¥éª¤6:åˆ›å»ºMybatisConfigé…ç½®ç±»"></a>æ­¥éª¤6:åˆ›å»ºMybatisConfigé…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factoryBean.setDataSource(dataSource);</span><br><span class="line">        factoryBean.setTypeAliasesPackage(<span class="string">&quot;com.blog.domain&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperScannerConfigurer <span class="title function_">mapperScannerConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MapperScannerConfigurer</span> <span class="variable">msc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line">        msc.setBasePackage(<span class="string">&quot;com.blog.dao&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> msc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤7-åˆ›å»ºjdbc-properties"><a href="#æ­¥éª¤7-åˆ›å»ºjdbc-properties" class="headerlink" title="æ­¥éª¤7:åˆ›å»ºjdbc.properties"></a>æ­¥éª¤7:åˆ›å»ºjdbc.properties</h4><p>åœ¨resourcesä¸‹æä¾›jdbc.properties,è®¾ç½®æ•°æ®åº“è¿æ¥å››è¦ç´ </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm_db</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤8-åˆ›å»ºSpringMVCé…ç½®ç±»"><a href="#æ­¥éª¤8-åˆ›å»ºSpringMVCé…ç½®ç±»" class="headerlink" title="æ­¥éª¤8:åˆ›å»ºSpringMVCé…ç½®ç±»"></a>æ­¥éª¤8:åˆ›å»ºSpringMVCé…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.blog.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤9-åˆ›å»ºWebé¡¹ç›®å…¥å£é…ç½®ç±»"><a href="#æ­¥éª¤9-åˆ›å»ºWebé¡¹ç›®å…¥å£é…ç½®ç±»" class="headerlink" title="æ­¥éª¤9:åˆ›å»ºWebé¡¹ç›®å…¥å£é…ç½®ç±»"></a>æ­¥éª¤9:åˆ›å»ºWebé¡¹ç›®å…¥å£é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="comment">//åŠ è½½Springé…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŠ è½½SpringMVCé…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringMvcConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®¾ç½®SpringMVCè¯·æ±‚åœ°å€æ‹¦æˆªè§„åˆ™</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®¾ç½®postè¯·æ±‚ä¸­æ–‡ä¹±ç è¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">        filter.setEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;filter&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡³æ­¤SSMæ•´åˆçš„ç¯å¢ƒå°±å·²ç»æ­å»ºå¥½äº†ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸Šï¼Œæˆ‘ä»¬å¦‚ä½•è¿›è¡ŒåŠŸèƒ½æ¨¡å—çš„å¼€å‘å‘¢?<br>æ€»ä½“å°±æ˜¯</p><ol><li>è¡¨å’Œå®ä½“ç±»</li><li>ä¸‰å±‚ï¼ˆdaoï¼Œserviceï¼Œcontrollerï¼‰</li></ol><h3 id="1-3-åŠŸèƒ½æ¨¡å—å¼€å‘"><a href="#1-3-åŠŸèƒ½æ¨¡å—å¼€å‘" class="headerlink" title="1.3 åŠŸèƒ½æ¨¡å—å¼€å‘"></a>1.3 åŠŸèƒ½æ¨¡å—å¼€å‘</h3><blockquote><p>éœ€æ±‚:å¯¹è¡¨tbl_bookè¿›è¡Œæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æ ¹æ®IDæŸ¥è¯¢å’ŒæŸ¥è¯¢æ‰€æœ‰</p></blockquote><h4 id="æ­¥éª¤1-åˆ›å»ºæ•°æ®åº“åŠè¡¨"><a href="#æ­¥éª¤1-åˆ›å»ºæ•°æ®åº“åŠè¡¨" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºæ•°æ®åº“åŠè¡¨"></a>æ­¥éª¤1:åˆ›å»ºæ•°æ®åº“åŠè¡¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database ssm_db <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line">use ssm_db;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_book(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  type <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">  description <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `tbl_book`(`id`,`type`,`name`,`description`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;Springå®æˆ˜ ç¬¬äº”ç‰ˆ&#x27;</span>,<span class="string">&#x27;Springå…¥é—¨ç»å…¸æ•™ç¨‹ï¼Œæ·±å…¥ç†è§£SpringåŸç†æŠ€æœ¯å†…å¹•&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;Spring 5æ ¸å¿ƒåŸç†ä¸30ä¸ªç±»æ‰‹å†™å®è·µ&#x27;</span>,<span class="string">&#x27;åå¹´æ²‰æ·€ä¹‹ä½œï¼Œæ‰‹å†™Springç²¾åæ€æƒ³&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;Spring 5è®¾è®¡æ¨¡å¼&#x27;</span>,<span class="string">&#x27;æ·±å…¥Springæºç åˆ¨æSpringæºç ä¸­è•´å«çš„10å¤§è®¾è®¡æ¨¡å¼&#x27;</span>),(<span class="number">4</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;Spring MVC+Mybatiså¼€å‘ä»å…¥é—¨åˆ°é¡¹ç›®å®æˆ˜&#x27;</span>,<span class="string">&#x27;å…¨æ–¹ä½è§£æé¢å‘Webåº”ç”¨çš„è½»é‡çº§æ¡†æ¶ï¼Œå¸¦ä½ æˆä¸ºSpring MVCå¼€å‘é«˜æ‰‹&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;è½»é‡çº§Java Webä¼ä¸šåº”ç”¨å®æˆ˜&#x27;</span>,<span class="string">&#x27;æºç çº§åˆ¨æSpringæ¡†æ¶ï¼Œé€‚åˆå·²æŒæ¡JavaåŸºç¡€çš„è¯»è€…&#x27;</span>),(<span class="number">6</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;Javaæ ¸å¿ƒæŠ€æœ¯ å·â…  åŸºç¡€çŸ¥è¯†(åŸä¹¦ç¬¬11ç‰ˆ)&#x27;</span>,<span class="string">&#x27;Core Javaç¬¬11ç‰ˆï¼ŒJoltå¤§å¥–è·å¥–ä½œå“ï¼Œé’ˆå¯¹Java SE9ã€10ã€11å…¨é¢æ›´æ–°&#x27;</span>),(<span class="number">7</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº&#x27;</span>,<span class="string">&#x27;5ä¸ªçº¬åº¦å…¨é¢åˆ¨æJVM,å¤§å‚é¢è¯•çŸ¥è¯†ç‚¹å…¨è¦†ç›–&#x27;</span>),(<span class="number">8</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;Javaç¼–ç¨‹æ€æƒ³(ç¬¬4ç‰ˆ)&#x27;</span>,<span class="string">&#x27;Javaå­¦ä¹ å¿…è¯»ç»å…¸ï¼Œæ®¿å ‚çº§è‘—ä½œï¼èµ¢å¾—äº†å…¨çƒç¨‹åºå‘˜çš„å¹¿æ³›èµèª‰&#x27;</span>),(<span class="number">9</span>,<span class="string">&#x27;è®¡ç®—æœºç†è®º&#x27;</span>,<span class="string">&#x27;é›¶åŸºç¡€å­¦Java(å…¨å½©ç‰ˆ)&#x27;</span>,<span class="string">&#x27;é›¶åŸºç¡€è‡ªå­¦ç¼–ç¨‹çš„å…¥é—¨å›¾ä¹¦ï¼Œç”±æµ…å…¥æ·±ï¼Œè¯¦è§£Javaè¯­è¨€çš„ç¼–ç¨‹æ€æƒ³å’Œæ ¸å¿ƒæŠ€æœ¯&#x27;</span>),(<span class="number">10</span>,<span class="string">&#x27;å¸‚åœºè¥é”€&#x27;</span>,<span class="string">&#x27;ç›´æ’­å°±è¿™ä¹ˆåš:ä¸»æ’­é«˜æ•ˆæ²Ÿé€šå®æˆ˜æŒ‡å—&#x27;</span>,<span class="string">&#x27;æå­æŸ’ã€æä½³å¥‡ã€è–‡å¨…æˆé•¿ä¸ºç½‘çº¢çš„ç§˜å¯†éƒ½åœ¨ä¹¦ä¸­&#x27;</span>),(<span class="number">11</span>,<span class="string">&#x27;å¸‚åœºè¥é”€&#x27;</span>,<span class="string">&#x27;ç›´æ’­é”€è®²å®æˆ˜ä¸€æœ¬é€š&#x27;</span>,<span class="string">&#x27;å’Œç§‹å¶ä¸€èµ·å­¦ç³»åˆ—ç½‘ç»œè¥é”€ä¹¦ç±&#x27;</span>),(<span class="number">12</span>,<span class="string">&#x27;å¸‚åœºè¥é”€&#x27;</span>,<span class="string">&#x27;ç›´æ’­å¸¦è´§:æ·˜å®ã€å¤©çŒ«ç›´æ’­ä»æ–°æ‰‹åˆ°é«˜æ‰‹&#x27;</span>,<span class="string">&#x27;ä¸€æœ¬æ•™ä½ å¦‚ä½•ç©è½¬ç›´æ’­çš„ä¹¦ï¼Œ10å ‚è¯¾è½»æ¾å®ç°å¸¦è´§æœˆå…¥3W+&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤2-ç¼–å†™æ¨¡å‹ç±»"><a href="#æ­¥éª¤2-ç¼–å†™æ¨¡å‹ç±»" class="headerlink" title="æ­¥éª¤2:ç¼–å†™æ¨¡å‹ç±»"></a>æ­¥éª¤2:ç¼–å†™æ¨¡å‹ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//getter...setter...toStringçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ps.</strong> æœ‰ä¸ªå°å‘ï¼Œä¸€å®šæ³¨æ„ï¼Œå¦åˆ™å°±ä¼šå¾ˆé”æ™ºï¼Œå°±æ˜¯ä½ åœ¨åˆ©ç”¨Alt+insertå¿«æ·é”®çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„ä½ çš„å…‰æ ‡åœ¨å“ªé‡Œï¼Œåˆ‡è®°ï¼Œè¦æŠŠå…‰æ ‡æ”¾åœ¨ç±»ä¸­ï¼Œå¦åˆ™åªä¼šå‡ºç°Generator-&gt;Copyrightï¼Œä¸€å®šæ”¾åœ¨ç±»ä¸­ã€‚</p><h4 id="æ­¥éª¤3-ç¼–å†™Daoæ¥å£-ä¸‰å±‚é¡ºåºä¸ºï¼ˆdao-gt-service-gt-controllerï¼‰"><a href="#æ­¥éª¤3-ç¼–å†™Daoæ¥å£-ä¸‰å±‚é¡ºåºä¸ºï¼ˆdao-gt-service-gt-controllerï¼‰" class="headerlink" title="æ­¥éª¤3:ç¼–å†™Daoæ¥å£ ä¸‰å±‚é¡ºåºä¸ºï¼ˆdao-&gt;service-&gt;controllerï¼‰"></a>æ­¥éª¤3:ç¼–å†™Daoæ¥å£ ä¸‰å±‚é¡ºåºä¸ºï¼ˆdao-&gt;service-&gt;controllerï¼‰</h4><p><em>å®ç°åŠŸèƒ½â€”-å¢åˆ æ”¹æŸ¥ æ•°æ®å±‚</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Insert(&quot;insert into tbl_book values(null,#&#123;type&#125;,#&#123;name&#125;,#&#123;description&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into tbl_book (type,name,description) values(#&#123;type&#125;,#&#123;name&#125;,#&#123;description&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Book book)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update tbl_book set type = #&#123;type&#125;, name = #&#123;name&#125;, description = #&#123;description&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Book book)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_book&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å…³äºä¸ä¼ å…¥idçš„ï¼Œç›´æ¥éƒ½å†™æˆ–è€…ç½®ä¸ºç©ºå³å¯ï¼Œä½†æ˜¯å¿…é¡»æœ‰åˆ†é…è¿™ä¸ªåŠ¨ä½œã€‚<br>é‚£ä¹ˆæœ‰ä¸ªé—®é¢˜ï¼Œå¯¹äºinsertæ“ä½œï¼Œå“ªä¸ªæ˜¯sqlå­—æ®µï¼Œå“ªä¸ªæ˜¯javaå±æ€§å‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯å‰ååˆ†åˆ«å¯¹åº”ã€‚</p><h4 id="æ­¥éª¤4-ç¼–å†™Serviceæ¥å£å’Œå®ç°ç±»"><a href="#æ­¥éª¤4-ç¼–å†™Serviceæ¥å£å’Œå®ç°ç±»" class="headerlink" title="æ­¥éª¤4:ç¼–å†™Serviceæ¥å£å’Œå®ç°ç±»"></a>æ­¥éª¤4:ç¼–å†™Serviceæ¥å£å’Œå®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Book book)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‰idåˆ é™¤</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‰idæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºserviceæ¥å£å°½é‡è§åçŸ¥æ„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        bookDao.save(book);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        bookDao.update(book);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        bookDao.delete(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>è¯´æ˜:</strong></p><ul><li><p>bookDaoåœ¨Serviceä¸­æ³¨å…¥çš„ä¼šæç¤ºä¸€ä¸ªçº¢çº¿æç¤ºï¼Œä¸ºä»€ä¹ˆå‘¢?</p><ul><li>BookDaoæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ²¡æœ‰å®ç°ç±»ï¼Œæ¥å£æ˜¯ä¸èƒ½åˆ›å»ºå¯¹è±¡çš„ï¼Œæ‰€ä»¥æœ€ç»ˆæ³¨å…¥çš„åº”è¯¥æ˜¯ä»£ç†å¯¹è±¡</li><li>ä»£ç†å¯¹è±¡æ˜¯ç”±Springçš„IOCå®¹å™¨æ¥åˆ›å»ºç®¡ç†çš„</li><li>IOCå®¹å™¨åˆæ˜¯åœ¨WebæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™æ‰ä¼šåˆ›å»º</li><li>IDEAåœ¨æ£€æµ‹ä¾èµ–å…³ç³»çš„æ—¶å€™ï¼Œæ²¡æœ‰æ‰¾åˆ°é€‚åˆçš„ç±»æ³¨å…¥ï¼Œæ‰€ä»¥ä¼šæç¤ºé”™è¯¯æç¤º</li><li>ä½†æ˜¯ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œä»£ç†å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºï¼Œæ¡†æ¶ä¼šä½¿ç”¨DIè¿›è¡Œæ³¨å…¥ï¼Œæ‰€ä»¥ç¨‹åºè¿è¡Œæ— å½±å“ã€‚</li></ul></li><li><p>å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜?</p><ul><li><p>å¯ä»¥ä¸ç”¨ç†ä¼šï¼Œå› ä¸ºè¿è¡Œæ˜¯æ­£å¸¸çš„</p></li><li><p>è®¾ç½®é”™è¯¯æç¤ºçº§åˆ«</p><p><img src="assets/1630600227357.png" alt=""></p></li></ul></li></ul><h4 id="æ­¥éª¤5-ç¼–å†™Contorllerç±»"><a href="#æ­¥éª¤5-ç¼–å†™Contorllerç±»" class="headerlink" title="æ­¥éª¤5:ç¼–å†™Contorllerç±»"></a>æ­¥éª¤5:ç¼–å†™Contorllerç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.save(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.update(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.delete(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.getAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå›¾ä¹¦æ¨¡å—çš„å¢åˆ æ”¹æŸ¥å°±å·²ç»å®Œæˆäº†ç¼–å†™ï¼Œæˆ‘ä»¬å¯ä»¥ä»åå¾€å‰å†™ä¹Ÿå¯ä»¥ä»å‰å¾€åå†™ï¼Œæœ€ç»ˆåªéœ€è¦èƒ½æŠŠåŠŸèƒ½å®ç°å³å¯ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å…ˆæŠŠä¸šåŠ¡å±‚çš„ä»£ç ä½¿ç”¨<code>Springæ•´åˆJunit</code>çš„çŸ¥è¯†ç‚¹è¿›è¡Œå•å…ƒæµ‹è¯•:</p><h3 id="1-4-å•å…ƒæµ‹è¯•"><a href="#1-4-å•å…ƒæµ‹è¯•" class="headerlink" title="1.4 å•å…ƒæµ‹è¯•"></a>1.4 å•å…ƒæµ‹è¯•</h3><h4 id="æ­¥éª¤1-æ–°å»ºæµ‹è¯•ç±»"><a href="#æ­¥éª¤1-æ–°å»ºæµ‹è¯•ç±»" class="headerlink" title="æ­¥éª¤1:æ–°å»ºæµ‹è¯•ç±»"></a>æ­¥éª¤1:æ–°å»ºæµ‹è¯•ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤2-æ³¨å…¥Serviceç±»"><a href="#æ­¥éª¤2-æ³¨å…¥Serviceç±»" class="headerlink" title="æ­¥éª¤2:æ³¨å…¥Serviceç±»"></a>æ­¥éª¤2:æ³¨å…¥Serviceç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤3-ç¼–å†™æµ‹è¯•æ–¹æ³•"><a href="#æ­¥éª¤3-ç¼–å†™æµ‹è¯•æ–¹æ³•" class="headerlink" title="æ­¥éª¤3:ç¼–å†™æµ‹è¯•æ–¹æ³•"></a>æ­¥éª¤3:ç¼–å†™æµ‹è¯•æ–¹æ³•</h4><p>æˆ‘ä»¬å…ˆæ¥å¯¹æŸ¥è¯¢è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAll</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Book&gt; all = bookService.getAll();</span><br><span class="line">        System.out.println(all);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-PostManæµ‹è¯•"><a href="#1-5-PostManæµ‹è¯•" class="headerlink" title="1.5 PostManæµ‹è¯•"></a>1.5 PostManæµ‹è¯•</h3><h4 id="æ–°å¢"><a href="#æ–°å¢" class="headerlink" title="æ–°å¢"></a>æ–°å¢</h4><p><code>http://localhost/books</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;ç±»åˆ«æµ‹è¯•æ•°æ®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;ä¹¦åæµ‹è¯•æ•°æ®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;æè¿°æµ‹è¯•æ•°æ®&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h4><p><code>http://localhost/books</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">13</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;ç±»åˆ«æµ‹è¯•æ•°æ®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;ä¹¦åæµ‹è¯•æ•°æ®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;æè¿°æµ‹è¯•æ•°æ®&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><p><code>http://localhost/books/14</code></p><h4 id="æŸ¥è¯¢å•ä¸ª"><a href="#æŸ¥è¯¢å•ä¸ª" class="headerlink" title="æŸ¥è¯¢å•ä¸ª"></a>æŸ¥è¯¢å•ä¸ª</h4><p><code>http://localhost/books/1</code></p><h4 id="æŸ¥è¯¢æ‰€æœ‰"><a href="#æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰"></a>æŸ¥è¯¢æ‰€æœ‰</h4><p><code>http://localhost/books</code></p><h2 id="2ï¼Œç»Ÿä¸€ç»“æœå°è£…"><a href="#2ï¼Œç»Ÿä¸€ç»“æœå°è£…" class="headerlink" title="2ï¼Œç»Ÿä¸€ç»“æœå°è£…"></a>2ï¼Œç»Ÿä¸€ç»“æœå°è£…</h2><h3 id="2-1-è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®šä¹‰"><a href="#2-1-è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®šä¹‰" class="headerlink" title="2.1 è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®šä¹‰"></a>2.1 è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®šä¹‰</h3><p>SSMæ•´åˆä»¥åŠåŠŸèƒ½æ¨¡å—å¼€å‘å®Œæˆåï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ä¸Šè¿°æ¡ˆä¾‹çš„åŸºç¡€ä¸Šåˆ†æä¸‹æœ‰å“ªäº›é—®é¢˜éœ€è¦æˆ‘ä»¬å»è§£å†³ä¸‹ã€‚é¦–å…ˆç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯:</p><ul><li><p>åœ¨Controllerå±‚å¢åˆ æ”¹è¿”å›ç»™å‰ç«¯çš„æ˜¯booleanç±»å‹æ•°æ®</p></li><li><p>åœ¨Controllerå±‚æŸ¥è¯¢å•ä¸ªè¿”å›ç»™å‰ç«¯çš„æ˜¯å¯¹è±¡</p></li><li><p>åœ¨Controllerå±‚æŸ¥è¯¢æ‰€æœ‰è¿”å›ç»™å‰ç«¯çš„æ˜¯é›†åˆå¯¹è±¡</p></li></ul><p>ç›®å‰æˆ‘ä»¬å°±å·²ç»æœ‰ä¸‰ç§æ•°æ®ç±»å‹è¿”å›ç»™å‰ç«¯ï¼Œå¦‚æœéšç€ä¸šåŠ¡çš„å¢é•¿ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›çš„æ•°æ®ç±»å‹ä¼šè¶Šæ¥è¶Šå¤šã€‚å¯¹äºå‰ç«¯å¼€å‘äººå‘˜åœ¨è§£ææ•°æ®çš„æ—¶å€™å°±æ¯”è¾ƒå‡Œä¹±äº†ï¼Œæ‰€ä»¥å¯¹äºå‰ç«¯æ¥è¯´ï¼Œå¦‚æœåå°èƒ½å¤Ÿè¿”å›ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®ç»“æœï¼Œå‰ç«¯åœ¨è§£æçš„æ—¶å€™å°±å¯ä»¥æŒ‰ç…§ä¸€ç§æ–¹å¼è¿›è¡Œè§£æã€‚å¼€å‘å°±ä¼šå˜å¾—æ›´åŠ ç®€å•ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æƒ³èƒ½ä¸èƒ½å°†è¿”å›ç»“æœçš„æ•°æ®è¿›è¡Œç»Ÿä¸€ï¼Œå…·ä½“å¦‚ä½•æ¥åšï¼Œå¤§ä½“çš„æ€è·¯ä¸º:</p><ul><li>ä¸ºäº†å°è£…è¿”å›çš„ç»“æœæ•°æ®:==åˆ›å»ºç»“æœæ¨¡å‹ç±»ï¼Œå°è£…æ•°æ®åˆ°dataå±æ€§ä¸­==</li><li>ä¸ºäº†å°è£…è¿”å›çš„æ•°æ®æ˜¯ä½•ç§æ“ä½œåŠæ˜¯å¦æ“ä½œæˆåŠŸ:==å°è£…æ“ä½œç»“æœåˆ°codeå±æ€§ä¸­==</li><li>æ“ä½œå¤±è´¥åä¸ºäº†å°è£…è¿”å›çš„é”™è¯¯ä¿¡æ¯:==å°è£…ç‰¹æ®Šæ¶ˆæ¯åˆ°message(msg)å±æ€§ä¸­==<br>å³å‡ºç°è§„å®šå¥½çš„åè®®ï¼Œæ•°æ®è¿”å›æ¨¡å‹</li></ul><p>æ ¹æ®åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ç»Ÿä¸€æ•°æ®è¿”å›ç»“æœç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&#123;</span><br><span class="line"><span class="keyword">private</span> Object data;</span><br><span class="line"><span class="keyword">private</span> Integer code;</span><br><span class="line"><span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> Resultç±»ååŠç±»ä¸­çš„å­—æ®µå¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œå¢å‡æä¾›è‹¥å¹²ä¸ªæ„é€ æ–¹æ³•ï¼Œæ–¹ä¾¿æ“ä½œã€‚</p><h3 id="2-2-è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®ç°"><a href="#2-2-è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®ç°" class="headerlink" title="2.2 è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®ç°"></a>2.2 è¡¨ç°å±‚ä¸å‰ç«¯æ•°æ®ä¼ è¾“åè®®å®ç°</h3><p>å‰é¢æˆ‘ä»¬å·²ç»åˆ†æäº†å¦‚ä½•å°è£…è¿”å›ç»“æœæ•°æ®ï¼Œå…·ä½“åœ¨é¡¹ç›®ä¸­è¯¥å¦‚ä½•å®ç°ï¼Œæˆ‘ä»¬é€šè¿‡ä¸ªä¾‹å­æ¥æ“ä½œä¸€æŠŠ</p><h4 id="2-2-1-ç¯å¢ƒå‡†å¤‡"><a href="#2-2-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.2.1 ç¯å¢ƒå‡†å¤‡"></a>2.2.1 ç¯å¢ƒå‡†å¤‡</h4><ul><li>åˆ›å»ºä¸€ä¸ªWebçš„Mavené¡¹ç›®</li><li>pom.xmlæ·»åŠ SSMæ•´åˆæ‰€éœ€jaråŒ…</li><li>åˆ›å»ºå¯¹åº”çš„é…ç½®ç±»</li><li>ç¼–å†™Controllerã€Serviceæ¥å£ã€Serviceå®ç°ç±»ã€Daoæ¥å£å’Œæ¨¡å‹ç±»</li><li>resourcesä¸‹æä¾›jdbc.propertiesé…ç½®æ–‡ä»¶</li></ul><p>å› ä¸ºè¿™ä¸ªé¡¹ç›®ç¯å¢ƒçš„å†…å®¹å’ŒSSMæ•´åˆçš„å†…å®¹æ˜¯ä¸€è‡´çš„ï¼Œå»ºè®®å¯ä»¥ç›´æ¥copyç¬¬ä¸€ä¸ªæ•´åˆåˆ›å»ºçš„é¡¹ç›®ï¼Œé¡¹ç›®ç»“æ„æ˜¯ä¸€æ ·çš„ã€‚</p><h4 id="2-2-2-ç»“æœå°è£…"><a href="#2-2-2-ç»“æœå°è£…" class="headerlink" title="2.2.2 ç»“æœå°è£…"></a>2.2.2 ç»“æœå°è£…</h4><p>å¯¹äºç»“æœå°è£…ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯åœ¨è¡¨ç°å±‚è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠç»“æœç±»æ”¾åœ¨controlleråŒ…ä¸‹ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ”¾åœ¨domainåŒ…ï¼Œè¿™ä¸ªéƒ½æ˜¯å¯ä»¥çš„ï¼Œå…·ä½“å¦‚ä½•å®ç°ç»“æœå°è£…ï¼Œå…·ä½“çš„æ­¥éª¤ä¸º:</p><h5 id="æ­¥éª¤1-åˆ›å»ºResultç±»"><a href="#æ­¥éª¤1-åˆ›å»ºResultç±»" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºResultç±»"></a>æ­¥éª¤1:åˆ›å»ºResultç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="comment">//æè¿°ç»Ÿä¸€æ ¼å¼ä¸­çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">    <span class="comment">//æè¿°ç»Ÿä¸€æ ¼å¼ä¸­çš„ç¼–ç ï¼Œç”¨äºåŒºåˆ†æ“ä½œï¼Œå¯ä»¥ç®€åŒ–é…ç½®0æˆ–1è¡¨ç¤ºæˆåŠŸå¤±è´¥</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="comment">//æè¿°ç»Ÿä¸€æ ¼å¼ä¸­çš„æ¶ˆæ¯ï¼Œå¯é€‰å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//æ„é€ æ–¹æ³•æ˜¯æ–¹ä¾¿å¯¹è±¡çš„åˆ›å»º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(Integer code,Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//æ„é€ æ–¹æ³•æ˜¯æ–¹ä¾¿å¯¹è±¡çš„åˆ›å»º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(Integer code, Object data, String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//setter...getter...çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤2-å®šä¹‰è¿”å›ç Codeç±»"><a href="#æ­¥éª¤2-å®šä¹‰è¿”å›ç Codeç±»" class="headerlink" title="æ­¥éª¤2:å®šä¹‰è¿”å›ç Codeç±»"></a>æ­¥éª¤2:å®šä¹‰è¿”å›ç Codeç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çŠ¶æ€ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Code</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SAVE_OK</span> <span class="operator">=</span> <span class="number">20011</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELETE_OK</span> <span class="operator">=</span> <span class="number">20021</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">UPDATE_OK</span> <span class="operator">=</span> <span class="number">20031</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">GET_OK</span> <span class="operator">=</span> <span class="number">20041</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SAVE_ERR</span> <span class="operator">=</span> <span class="number">20010</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELETE_ERR</span> <span class="operator">=</span> <span class="number">20020</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">UPDATE_ERR</span> <span class="operator">=</span> <span class="number">20030</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">GET_ERR</span> <span class="operator">=</span> <span class="number">20040</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong>codeç±»ä¸­çš„å¸¸é‡è®¾è®¡ä¹Ÿä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œå¢å‡ï¼Œä¾‹å¦‚å°†æŸ¥è¯¢å†è¿›è¡Œç»†åˆ†ä¸ºGET_OK,GET_ALL_OK,GET_PAGE_OKç­‰ã€‚</p><h5 id="æ­¥éª¤3-ä¿®æ”¹Controllerç±»çš„è¿”å›å€¼"><a href="#æ­¥éª¤3-ä¿®æ”¹Controllerç±»çš„è¿”å›å€¼" class="headerlink" title="æ­¥éª¤3:ä¿®æ”¹Controllerç±»çš„è¿”å›å€¼"></a>æ­¥éª¤3:ä¿®æ”¹Controllerç±»çš„è¿”å›å€¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»Ÿä¸€æ¯ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•è¿”å›å€¼</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> bookService.save(book);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(flag ? Code.SAVE_OK:Code.SAVE_ERR,flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> bookService.update(book);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(flag ? Code.UPDATE_OK:Code.UPDATE_ERR,flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> bookService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(flag ? Code.DELETE_OK:Code.DELETE_ERR,flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getById(id);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> book != <span class="literal">null</span> ? Code.GET_OK : Code.GET_ERR;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> book != <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;æ•°æ®æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•ï¼&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,book,msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Book&gt; bookList = bookService.getAll();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> bookList != <span class="literal">null</span> ? Code.GET_OK : Code.GET_ERR;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> bookList != <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;æ•°æ®æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•ï¼&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,bookList,msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤4-å¯åŠ¨æœåŠ¡æµ‹è¯•"><a href="#æ­¥éª¤4-å¯åŠ¨æœåŠ¡æµ‹è¯•" class="headerlink" title="æ­¥éª¤4:å¯åŠ¨æœåŠ¡æµ‹è¯•"></a>æ­¥éª¤4:å¯åŠ¨æœåŠ¡æµ‹è¯•</h5><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/%E5%9B%BE%E7%89%87-7.webp" alt=""></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„è¿”å›ç»“æœå°±å·²ç»èƒ½ä»¥ä¸€ç§ç»Ÿä¸€çš„æ ¼å¼è¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯æ ¹æ®è¿”å›çš„ç»“æœï¼Œå…ˆä»ä¸­è·å–<code>code</code>,æ ¹æ®<code>code</code>åˆ¤æ–­ï¼Œå¦‚æœæˆåŠŸåˆ™å–<code>data</code>å±æ€§çš„å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™å–<code>msg</code>ä¸­çš„å€¼åšæç¤ºã€‚</p><h2 id="3ï¼Œç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#3ï¼Œç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="3ï¼Œç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>3ï¼Œç»Ÿä¸€å¼‚å¸¸å¤„ç†</h2><h3 id="3-1-é—®é¢˜æè¿°"><a href="#3-1-é—®é¢˜æè¿°" class="headerlink" title="3.1 é—®é¢˜æè¿°"></a>3.1 é—®é¢˜æè¿°</h3><p>åœ¨è®²è§£è¿™ä¸€éƒ¨åˆ†çŸ¥è¯†ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ¼”ç¤ºä¸ªæ•ˆæœï¼Œä¿®æ”¹BookControllerç±»çš„<code>getById</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="comment">//æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span>(id==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getById(id);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> book != <span class="literal">null</span> ? Code.GET_OK : Code.GET_ERR;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> book != <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;æ•°æ®æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,book,msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨è¿è¡Œé¡¹ç›®ï¼Œä½¿ç”¨PostManå‘é€è¯·æ±‚ï¼Œå½“ä¼ å…¥çš„idä¸º1ï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹æ•ˆæœï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221119113556.png" alt=""></p><p>å‰ç«¯æ¥æ”¶åˆ°è¿™ä¸ªä¿¡æ¯åå’Œä¹‹å‰æˆ‘ä»¬çº¦å®šçš„æ ¼å¼ä¸ä¸€è‡´ï¼Œè¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³?</p><p>åœ¨è§£å†³é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å¼‚å¸¸çš„ç§ç±»åŠå‡ºç°å¼‚å¸¸çš„åŸå› :</p><ul><li>æ¡†æ¶å†…éƒ¨æŠ›å‡ºçš„å¼‚å¸¸ï¼šå› ä½¿ç”¨ä¸åˆè§„å¯¼è‡´</li><li>æ•°æ®å±‚æŠ›å‡ºçš„å¼‚å¸¸ï¼šå› å¤–éƒ¨æœåŠ¡å™¨æ•…éšœå¯¼è‡´ï¼ˆä¾‹å¦‚ï¼šæœåŠ¡å™¨è®¿é—®è¶…æ—¶ï¼‰</li><li>ä¸šåŠ¡å±‚æŠ›å‡ºçš„å¼‚å¸¸ï¼šå› ä¸šåŠ¡é€»è¾‘ä¹¦å†™é”™è¯¯å¯¼è‡´ï¼ˆä¾‹å¦‚ï¼šéå†ä¸šåŠ¡ä¹¦å†™æ“ä½œï¼Œå¯¼è‡´ç´¢å¼•å¼‚å¸¸ç­‰ï¼‰</li><li>è¡¨ç°å±‚æŠ›å‡ºçš„å¼‚å¸¸ï¼šå› æ•°æ®æ”¶é›†ã€æ ¡éªŒç­‰è§„åˆ™å¯¼è‡´ï¼ˆä¾‹å¦‚ï¼šä¸åŒ¹é…çš„æ•°æ®ç±»å‹é—´å¯¼è‡´å¼‚å¸¸ï¼‰</li><li>å·¥å…·ç±»æŠ›å‡ºçš„å¼‚å¸¸ï¼šå› å·¥å…·ç±»ä¹¦å†™ä¸ä¸¥è°¨ä¸å¤Ÿå¥å£®å¯¼è‡´ï¼ˆä¾‹å¦‚ï¼šå¿…è¦é‡Šæ”¾çš„è¿æ¥é•¿æœŸæœªé‡Šæ”¾ç­‰ï¼‰</li></ul><p>çœ‹å®Œä¸Šé¢è¿™äº›å‡ºç°å¼‚å¸¸çš„ä½ç½®ï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨æˆ‘ä»¬å¼€å‘çš„ä»»ä½•ä¸€ä¸ªä½ç½®éƒ½æœ‰å¯èƒ½å‡ºç°å¼‚å¸¸ï¼Œè€Œä¸”è¿™äº›å¼‚å¸¸æ˜¯ä¸èƒ½é¿å…çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¾—å°†å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚</p><p><strong>æ€è€ƒ</strong></p><ol><li><p>å„ä¸ªå±‚çº§å‡å‡ºç°å¼‚å¸¸ï¼Œå¼‚å¸¸å¤„ç†ä»£ç ä¹¦å†™åœ¨å“ªä¸€å±‚?</p><p>==æ‰€æœ‰çš„å¼‚å¸¸å‡æŠ›å‡ºåˆ°è¡¨ç°å±‚è¿›è¡Œå¤„ç†==<br><em>æ‰€æœ‰çš„å¼‚å¸¸éƒ½åº”è¯¥ä»åº•éƒ¨å‘ä¸ŠæŠ›å‡ºï¼Œæ•°æ®å±‚â€”ä¸šåŠ¡å±‚â€”è¡¨ç°å±‚</em></p></li><li><p>å¼‚å¸¸çš„ç§ç±»å¾ˆå¤šï¼Œè¡¨ç°å±‚å¦‚ä½•å°†æ‰€æœ‰çš„å¼‚å¸¸éƒ½å¤„ç†åˆ°å‘¢?</p><p>==å¼‚å¸¸åˆ†ç±»==</p></li><li><p>è¡¨ç°å±‚å¤„ç†å¼‚å¸¸ï¼Œæ¯ä¸ªæ–¹æ³•ä¸­å•ç‹¬ä¹¦å†™ï¼Œä»£ç ä¹¦å†™é‡å·¨å¤§ä¸”æ„ä¹‰ä¸å¼ºï¼Œå¦‚ä½•è§£å†³?</p><p>==AOP==</p></li></ol><p>å¯¹äºä¸Šé¢è¿™äº›é—®é¢˜åŠè§£å†³æ–¹æ¡ˆï¼ŒSpringMVCå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—è§£å†³æ–¹æ¡ˆ:</p><ul><li><p>å¼‚å¸¸å¤„ç†å™¨:</p><ul><li>é›†ä¸­çš„ã€ç»Ÿä¸€çš„å¤„ç†é¡¹ç›®ä¸­å‡ºç°çš„å¼‚å¸¸ã€‚</li></ul></li></ul><h3 id="3-2-å¼‚å¸¸å¤„ç†å™¨çš„ä½¿ç”¨"><a href="#3-2-å¼‚å¸¸å¤„ç†å™¨çš„ä½¿ç”¨" class="headerlink" title="3.2 å¼‚å¸¸å¤„ç†å™¨çš„ä½¿ç”¨"></a>3.2 å¼‚å¸¸å¤„ç†å™¨çš„ä½¿ç”¨</h3><h5 id="æ­¥éª¤1-åˆ›å»ºå¼‚å¸¸å¤„ç†å™¨ç±»"><a href="#æ­¥éª¤1-åˆ›å»ºå¼‚å¸¸å¤„ç†å™¨ç±»" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºå¼‚å¸¸å¤„ç†å™¨ç±»"></a>æ­¥éª¤1:åˆ›å»ºå¼‚å¸¸å¤„ç†å™¨ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@RestControllerAdviceç”¨äºæ ‡è¯†å½“å‰ç±»ä¸ºRESTé£æ ¼å¯¹åº”çš„å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line">    <span class="comment">//é™¤äº†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œä¿ç•™å¯¹Exceptionç±»å‹çš„å¼‚å¸¸å¤„ç†ï¼Œç”¨äºå¤„ç†éé¢„æœŸçš„å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doException</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;å¼‚å¸¸ç»™çˆ·çˆ¬&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==ç¡®ä¿SpringMvcConfigèƒ½å¤Ÿæ‰«æåˆ°å¼‚å¸¸å¤„ç†å™¨ç±»==</p><h5 id="æ­¥éª¤2-è®©ç¨‹åºæŠ›å‡ºå¼‚å¸¸"><a href="#æ­¥éª¤2-è®©ç¨‹åºæŠ›å‡ºå¼‚å¸¸" class="headerlink" title="æ­¥éª¤2:è®©ç¨‹åºæŠ›å‡ºå¼‚å¸¸"></a>æ­¥éª¤2:è®©ç¨‹åºæŠ›å‡ºå¼‚å¸¸</h5><p>ä¿®æ”¹<code>BookController</code>çš„getByIdæ–¹æ³•ï¼Œæ·»åŠ <code>int i = 1/0</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getById(id);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> book != <span class="literal">null</span> ? Code.GET_OK : Code.GET_ERR;</span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> book != <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;æ•°æ®æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(code,book,msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3-ä½¿ç”¨PostManå‘é€GETè¯·æ±‚è®¿é—®localhost-8080-books-1"><a href="#æ­¥éª¤3-ä½¿ç”¨PostManå‘é€GETè¯·æ±‚è®¿é—®localhost-8080-books-1" class="headerlink" title="æ­¥éª¤3:ä½¿ç”¨PostManå‘é€GETè¯·æ±‚è®¿é—®localhost:8080/books/1"></a>æ­¥éª¤3:ä½¿ç”¨PostManå‘é€GETè¯·æ±‚è®¿é—®localhost:8080/books/1</h5><p>åœ¨æœ¬åœ°æ§åˆ¶å°è¾“å‡ºè¿™å¥è¯ï¼Œè¯´æ˜å¼‚å¸¸å·²ç»è¢«æ‹¦æˆªï¼Œä¸”æ‰§è¡Œäº†<code>doException()</code>æ–¹æ³•</p><ul><li>å¼‚å¸¸ç»™çˆ·çˆ¬</li></ul><h5 id="ä½†æ˜¯å‰ç«¯æ˜¯æ²¡æœ‰ä»»ä½•æç¤ºçš„ï¼Œç°åœ¨å°†å¼‚å¸¸å¤„ç†å™¨ç±»è¿”å›ç»“æœç»™å‰ç«¯"><a href="#ä½†æ˜¯å‰ç«¯æ˜¯æ²¡æœ‰ä»»ä½•æç¤ºçš„ï¼Œç°åœ¨å°†å¼‚å¸¸å¤„ç†å™¨ç±»è¿”å›ç»“æœç»™å‰ç«¯" class="headerlink" title="ä½†æ˜¯å‰ç«¯æ˜¯æ²¡æœ‰ä»»ä½•æç¤ºçš„ï¼Œç°åœ¨å°†å¼‚å¸¸å¤„ç†å™¨ç±»è¿”å›ç»“æœç»™å‰ç«¯"></a>ä½†æ˜¯å‰ç«¯æ˜¯æ²¡æœ‰ä»»ä½•æç¤ºçš„ï¼Œç°åœ¨å°†å¼‚å¸¸å¤„ç†å™¨ç±»è¿”å›ç»“æœç»™å‰ç«¯</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doException</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;å˜¿å˜¿,å¼‚å¸¸ä½ å“ªé‡Œè·‘ï¼&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">666</span>,<span class="literal">null</span>,<span class="string">&quot;å˜¿å˜¿,å¼‚å¸¸ä½ å“ªé‡Œè·‘ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡å™¨ï¼Œä½¿ç”¨PostManå‘é€è¯·æ±‚ï¼Œæ­¤æ—¶å°±èƒ½æ¥æ”¶åˆ°ç»“æœäº†<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">666</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å˜¿å˜¿ï¼Œé€®åˆ°ä¸€ä¸ªå¼‚å¸¸~&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h4 id="çŸ¥è¯†ç‚¹1ï¼š-RestControllerAdvice"><a href="#çŸ¥è¯†ç‚¹1ï¼š-RestControllerAdvice" class="headerlink" title="çŸ¥è¯†ç‚¹1ï¼š@RestControllerAdvice"></a>çŸ¥è¯†ç‚¹1ï¼š@RestControllerAdvice</h4><div class="table-container"><table><thead><tr><th>åç§°</th><th>@RestControllerAdvice</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>==ç±»æ³¨è§£==</td></tr><tr><td>ä½ç½®</td><td>Resté£æ ¼å¼€å‘çš„æ§åˆ¶å™¨å¢å¼ºç±»å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>ä¸ºResté£æ ¼å¼€å‘çš„æ§åˆ¶å™¨ç±»åšå¢å¼º</td></tr></tbody></table></div><p><strong>è¯´æ˜:</strong> æ­¤æ³¨è§£è‡ªå¸¦@ResponseBodyæ³¨è§£ä¸@Componentæ³¨è§£ï¼Œå…·å¤‡å¯¹åº”çš„åŠŸèƒ½</p><h4 id="çŸ¥è¯†ç‚¹2ï¼š-ExceptionHandler"><a href="#çŸ¥è¯†ç‚¹2ï¼š-ExceptionHandler" class="headerlink" title="çŸ¥è¯†ç‚¹2ï¼š@ExceptionHandler"></a>çŸ¥è¯†ç‚¹2ï¼š@ExceptionHandler</h4><div class="table-container"><table><thead><tr><th>åç§°</th><th>@ExceptionHandler</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>==æ–¹æ³•æ³¨è§£==</td></tr><tr><td>ä½ç½®</td><td>ä¸“ç”¨äºå¼‚å¸¸å¤„ç†çš„æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®æŒ‡å®šå¼‚å¸¸çš„å¤„ç†æ–¹æ¡ˆï¼ŒåŠŸèƒ½ç­‰åŒäºæ§åˆ¶å™¨æ–¹æ³•ï¼Œ<br/>å‡ºç°å¼‚å¸¸åç»ˆæ­¢åŸå§‹æ§åˆ¶å™¨æ‰§è¡Œ,å¹¶è½¬å…¥å½“å‰æ–¹æ³•æ‰§è¡Œ</td></tr></tbody></table></div><p><strong>è¯´æ˜ï¼š</strong>æ­¤ç±»æ–¹æ³•å¯ä»¥æ ¹æ®å¤„ç†çš„å¼‚å¸¸ä¸åŒï¼Œåˆ¶ä½œå¤šä¸ªæ–¹æ³•åˆ†åˆ«å¤„ç†å¯¹åº”çš„å¼‚å¸¸</p><h3 id="3-3-é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ"><a href="#3-3-é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="3.3 é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ"></a>3.3 é¡¹ç›®å¼‚å¸¸å¤„ç†æ–¹æ¡ˆ</h3><h4 id="3-3-1-å¼‚å¸¸åˆ†ç±»"><a href="#3-3-1-å¼‚å¸¸åˆ†ç±»" class="headerlink" title="3.3.1 å¼‚å¸¸åˆ†ç±»"></a>3.3.1 å¼‚å¸¸åˆ†ç±»</h4><p>å¼‚å¸¸å¤„ç†å™¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿä½¿ç”¨äº†ï¼Œé‚£ä¹ˆåœ¨å’±ä»¬çš„é¡¹ç›®ä¸­è¯¥å¦‚ä½•æ¥å¤„ç†å¼‚å¸¸å‘¢?</p><p>å› ä¸ºå¼‚å¸¸çš„ç§ç±»æœ‰å¾ˆå¤šï¼Œå¦‚æœæ¯ä¸€ä¸ªå¼‚å¸¸éƒ½å¯¹åº”ä¸€ä¸ª@ExceptionHandlerï¼Œé‚£å¾—å†™å¤šå°‘ä¸ªæ–¹æ³•æ¥å¤„ç†å„è‡ªçš„å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å¤„ç†å¼‚å¸¸ä¹‹å‰ï¼Œéœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œä¸€ä¸ªåˆ†ç±»:</p><ul><li><p>ä¸šåŠ¡å¼‚å¸¸ï¼ˆBusinessExceptionï¼‰</p><ul><li><p>è§„èŒƒçš„ç”¨æˆ·è¡Œä¸ºäº§ç”Ÿçš„å¼‚å¸¸</p><ul><li>ç”¨æˆ·åœ¨é¡µé¢è¾“å…¥å†…å®¹çš„æ—¶å€™æœªæŒ‰ç…§æŒ‡å®šæ ¼å¼è¿›è¡Œæ•°æ®å¡«å†™ï¼Œå¦‚åœ¨å¹´é¾„æ¡†è¾“å…¥çš„æ˜¯å­—ç¬¦ä¸²</li></ul></li><li><p>ä¸è§„èŒƒçš„ç”¨æˆ·è¡Œä¸ºæ“ä½œäº§ç”Ÿçš„å¼‚å¸¸</p><ul><li>å¦‚ç”¨æˆ·æ•…æ„ä¼ é€’é”™è¯¯æ•°æ®,urlæœ¬èº«å­˜åœ¨é”™è¯¯ï¼šlocalhost:8080/books/å¤å¤</li></ul></li></ul></li><li><p>ç³»ç»Ÿå¼‚å¸¸ï¼ˆSystemExceptionï¼‰</p><ul><li>é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­å¯é¢„è®¡ä½†æ— æ³•é¿å…çš„å¼‚å¸¸<ul><li>æ¯”å¦‚æ•°æ®åº“æˆ–æœåŠ¡å™¨å®•æœº</li></ul></li></ul></li><li><p>å…¶ä»–å¼‚å¸¸ï¼ˆExceptionï¼‰</p><ul><li>ç¼–ç¨‹äººå‘˜æœªé¢„æœŸåˆ°çš„å¼‚å¸¸ï¼Œå¦‚:ç”¨åˆ°çš„æ–‡ä»¶ä¸å­˜åœ¨</li></ul></li></ul><p>å°†å¼‚å¸¸åˆ†ç±»ä»¥åï¼Œé’ˆå¯¹ä¸åŒç±»å‹çš„å¼‚å¸¸ï¼Œè¦æä¾›å…·ä½“çš„è§£å†³æ–¹æ¡ˆ  </p><h4 id="3-3-2-å¼‚å¸¸è§£å†³æ–¹æ¡ˆ"><a href="#3-3-2-å¼‚å¸¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.3.2 å¼‚å¸¸è§£å†³æ–¹æ¡ˆ"></a>3.3.2 å¼‚å¸¸è§£å†³æ–¹æ¡ˆ</h4><ul><li>ä¸šåŠ¡å¼‚å¸¸ï¼ˆBusinessExceptionï¼‰<ul><li>å‘é€å¯¹åº”æ¶ˆæ¯ä¼ é€’ç»™ç”¨æˆ·ï¼Œæé†’è§„èŒƒæ“ä½œ<ul><li>å¤§å®¶å¸¸è§çš„å°±æ˜¯æç¤ºç”¨æˆ·åå·²å­˜åœ¨æˆ–å¯†ç æ ¼å¼ä¸æ­£ç¡®ç­‰</li></ul></li></ul></li><li>ç³»ç»Ÿå¼‚å¸¸ï¼ˆSystemExceptionï¼‰<ul><li>å‘é€å›ºå®šæ¶ˆæ¯ä¼ é€’ç»™ç”¨æˆ·ï¼Œå®‰æŠšç”¨æˆ·<ul><li>ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•</li><li>ç³»ç»Ÿæ­£åœ¨ç»´æŠ¤å‡çº§ï¼Œè¯·ç¨åå†è¯•</li><li>ç³»ç»Ÿå‡ºé—®é¢˜ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ç­‰</li></ul></li><li>å‘é€ç‰¹å®šæ¶ˆæ¯ç»™è¿ç»´äººå‘˜ï¼Œæé†’ç»´æŠ¤<ul><li>å¯ä»¥å‘é€çŸ­ä¿¡ã€é‚®ç®±æˆ–è€…æ˜¯å…¬å¸å†…éƒ¨é€šä¿¡è½¯ä»¶</li></ul></li><li>è®°å½•æ—¥å¿—<ul><li>å‘æ¶ˆæ¯å’Œè®°å½•æ—¥å¿—å¯¹ç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œå±äºåå°ç¨‹åº</li></ul></li></ul></li><li>å…¶ä»–å¼‚å¸¸ï¼ˆExceptionï¼‰<ul><li>å‘é€å›ºå®šæ¶ˆæ¯ä¼ é€’ç»™ç”¨æˆ·ï¼Œå®‰æŠšç”¨æˆ·</li><li>å‘é€ç‰¹å®šæ¶ˆæ¯ç»™ç¼–ç¨‹äººå‘˜ï¼Œæé†’ç»´æŠ¤ï¼ˆçº³å…¥é¢„æœŸèŒƒå›´å†…ï¼‰<ul><li>ä¸€èˆ¬æ˜¯ç¨‹åºæ²¡æœ‰è€ƒè™‘å…¨ï¼Œæ¯”å¦‚æœªåšéç©ºæ ¡éªŒç­‰</li></ul></li><li>è®°å½•æ—¥å¿—</li></ul></li></ul><h4 id="3-3-3-å¼‚å¸¸è§£å†³æ–¹æ¡ˆçš„å…·ä½“å®ç°"><a href="#3-3-3-å¼‚å¸¸è§£å†³æ–¹æ¡ˆçš„å…·ä½“å®ç°" class="headerlink" title="3.3.3 å¼‚å¸¸è§£å†³æ–¹æ¡ˆçš„å…·ä½“å®ç°"></a>3.3.3 å¼‚å¸¸è§£å†³æ–¹æ¡ˆçš„å…·ä½“å®ç°</h4><blockquote><p>æ€è·¯:</p><p>1.å…ˆé€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå®ŒæˆBusinessExceptionå’ŒSystemExceptionçš„å®šä¹‰</p><p>2.å°†å…¶ä»–å¼‚å¸¸åŒ…è£…æˆè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹</p><p>3.åœ¨å¼‚å¸¸å¤„ç†å™¨ç±»ä¸­å¯¹ä¸åŒçš„å¼‚å¸¸è¿›è¡Œå¤„ç†</p></blockquote><h5 id="æ­¥éª¤1-è‡ªå®šä¹‰å¼‚å¸¸ç±»"><a href="#æ­¥éª¤1-è‡ªå®šä¹‰å¼‚å¸¸ç±»" class="headerlink" title="æ­¥éª¤1:è‡ªå®šä¹‰å¼‚å¸¸ç±»"></a>æ­¥éª¤1:è‡ªå®šä¹‰å¼‚å¸¸ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨ï¼Œç”¨äºå°è£…å¼‚å¸¸ä¿¡æ¯ï¼Œå¯¹å¼‚å¸¸è¿›è¡Œåˆ†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(Integer code, String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†å™¨ï¼Œç”¨äºå°è£…å¼‚å¸¸ä¿¡æ¯ï¼Œå¯¹å¼‚å¸¸è¿›è¡Œåˆ†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(Integer code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(Integer code, String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ul><li>è®©è‡ªå®šä¹‰å¼‚å¸¸ç±»ç»§æ‰¿<code>RuntimeException</code>çš„å¥½å¤„æ˜¯ï¼ŒåæœŸåœ¨æŠ›å‡ºè¿™ä¸¤ä¸ªå¼‚å¸¸çš„æ—¶å€™ï¼Œå°±ä¸ç”¨åœ¨tryâ€¦catchâ€¦æˆ–throwsäº†</li><li>è‡ªå®šä¹‰å¼‚å¸¸ç±»ä¸­æ·»åŠ <code>code</code>å±æ€§çš„åŸå› æ˜¯ä¸ºäº†æ›´å¥½çš„åŒºåˆ†å¼‚å¸¸æ˜¯æ¥è‡ªå“ªä¸ªä¸šåŠ¡çš„</li></ul><h5 id="æ­¥éª¤2-å°†å…¶ä»–å¼‚å¸¸åŒ…æˆè‡ªå®šä¹‰å¼‚å¸¸"><a href="#æ­¥éª¤2-å°†å…¶ä»–å¼‚å¸¸åŒ…æˆè‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="æ­¥éª¤2:å°†å…¶ä»–å¼‚å¸¸åŒ…æˆè‡ªå®šä¹‰å¼‚å¸¸"></a>æ­¥éª¤2:å°†å…¶ä»–å¼‚å¸¸åŒ…æˆè‡ªå®šä¹‰å¼‚å¸¸</h5><p>å‡å¦‚åœ¨BookServiceImplçš„getByIdæ–¹æ³•æŠ›å¼‚å¸¸äº†ï¼Œè¯¥å¦‚ä½•æ¥åŒ…è£…å‘¢?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿä¸šåŠ¡å¼‚å¸¸ï¼ŒåŒ…è£…æˆè‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span>(id == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(Code.BUSINESS_ERR,<span class="string">&quot;è¯·ä¸è¦ä½¿ç”¨ä½ çš„æŠ€æœ¯æŒ‘æˆ˜æˆ‘çš„è€æ€§!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿç³»ç»Ÿå¼‚å¸¸ï¼Œå°†å¯èƒ½å‡ºç°çš„å¼‚å¸¸è¿›è¡ŒåŒ…è£…ï¼Œè½¬æ¢æˆè‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(Code.SYSTEM_TIMEOUT_ERR,<span class="string">&quot;æœåŠ¡å™¨è®¿é—®è¶…æ—¶ï¼Œè¯·é‡è¯•!&quot;</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bookDao.getById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„åŒ…è£…æ–¹å¼æœ‰ï¼š</p><ul><li>æ–¹å¼ä¸€:<code>try&#123;&#125;catch()&#123;&#125;</code>åœ¨catchä¸­é‡æ–°throwæˆ‘ä»¬è‡ªå®šä¹‰å¼‚å¸¸å³å¯ã€‚</li><li>æ–¹å¼äºŒ:ç›´æ¥throwè‡ªå®šä¹‰å¼‚å¸¸å³å¯</li></ul><p>ä¸Šé¢ä¸ºäº†ä½¿<code>code</code>çœ‹ç€æ›´ä¸“ä¸šäº›ï¼Œæˆ‘ä»¬åœ¨Codeç±»ä¸­å†æ–°å¢éœ€è¦çš„å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çŠ¶æ€ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Code</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SAVE_OK</span> <span class="operator">=</span> <span class="number">20011</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELETE_OK</span> <span class="operator">=</span> <span class="number">20021</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">UPDATE_OK</span> <span class="operator">=</span> <span class="number">20031</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">GET_OK</span> <span class="operator">=</span> <span class="number">20041</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SAVE_ERR</span> <span class="operator">=</span> <span class="number">20010</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DELETE_ERR</span> <span class="operator">=</span> <span class="number">20020</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">UPDATE_ERR</span> <span class="operator">=</span> <span class="number">20030</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">GET_ERR</span> <span class="operator">=</span> <span class="number">20040</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SYSTEM_ERR</span> <span class="operator">=</span> <span class="number">50001</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SYSTEM_TIMEOUT_ERR</span> <span class="operator">=</span> <span class="number">50002</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">SYSTEM_UNKNOW_ERR</span> <span class="operator">=</span> <span class="number">59999</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">BUSINESS_ERR</span> <span class="operator">=</span> <span class="number">60002</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3-å¤„ç†å™¨ç±»ä¸­å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸"><a href="#æ­¥éª¤3-å¤„ç†å™¨ç±»ä¸­å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="æ­¥éª¤3:å¤„ç†å™¨ç±»ä¸­å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸"></a>æ­¥éª¤3:å¤„ç†å™¨ç±»ä¸­å¤„ç†è‡ªå®šä¹‰å¼‚å¸¸</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@RestControllerAdviceç”¨äºæ ‡è¯†å½“å‰ç±»ä¸ºRESTé£æ ¼å¯¹åº”çš„å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line">    <span class="comment">//@ExceptionHandlerç”¨äºè®¾ç½®å½“å‰å¤„ç†å™¨ç±»å¯¹åº”çš„å¼‚å¸¸ç±»å‹</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SystemException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doSystemException</span><span class="params">(SystemException ex)</span>&#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ—¥å¿—</span></span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯ç»™è¿ç»´</span></span><br><span class="line">        <span class="comment">//å‘é€é‚®ä»¶ç»™å¼€å‘äººå‘˜,exå¯¹è±¡å‘é€ç»™å¼€å‘äººå‘˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ex.getCode(),<span class="literal">null</span>,ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doBusinessException</span><span class="params">(BusinessException ex)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(ex.getCode(),<span class="literal">null</span>,ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™¤äº†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œä¿ç•™å¯¹Exceptionç±»å‹çš„å¼‚å¸¸å¤„ç†ï¼Œç”¨äºå¤„ç†éé¢„æœŸçš„å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doOtherException</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">        <span class="comment">//è®°å½•æ—¥å¿—</span></span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯ç»™è¿ç»´</span></span><br><span class="line">        <span class="comment">//å‘é€é‚®ä»¶ç»™å¼€å‘äººå‘˜,exå¯¹è±¡å‘é€ç»™å¼€å‘äººå‘˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(Code.SYSTEM_UNKNOW_ERR,<span class="literal">null</span>,<span class="string">&quot;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤4-è¿è¡Œç¨‹åº"><a href="#æ­¥éª¤4-è¿è¡Œç¨‹åº" class="headerlink" title="æ­¥éª¤4:è¿è¡Œç¨‹åº"></a>æ­¥éª¤4:è¿è¡Œç¨‹åº</h5><p>æ ¹æ®IDæŸ¥è¯¢</p><p>å¦‚æœä¼ å…¥çš„å‚æ•°ä¸º1ï¼Œä¼šæŠ¥<code>BusinessException</code>ï¼Œä¼ å‡ºæˆ‘ä»¬è®¾å®šçš„å¼‚å¸¸è¿”å›</p><p>å¦‚æœä¼ å…¥çš„æ˜¯å…¶ä»–å‚æ•°ï¼Œä¼šæŠ¥<code>SystemException</code></p><p>å¯¹äºå¼‚å¸¸æˆ‘ä»¬å°±å·²ç»å¤„ç†å®Œæˆäº†ï¼Œä¸ç®¡åå°å“ªä¸€å±‚æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šä»¥æˆ‘ä»¬ä¸å‰ç«¯çº¦å®šå¥½çš„æ–¹å¼è¿›è¡Œè¿”å›ï¼Œå‰ç«¯åªéœ€è¦æŠŠä¿¡æ¯è·å–åˆ°ï¼Œæ ¹æ®è¿”å›çš„æ­£ç¡®ä¸å¦æ¥å±•ç¤ºä¸åŒçš„å†…å®¹å³å¯ã€‚</p><p><strong>å°ç»“</strong></p><p>å¼‚å¸¸çš„æ€»å¤„ç†æ–¹å¼ä¸ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/631d597316f2c2beb1d20ccd.jpg" alt=""></p><h2 id="4ï¼Œå‰åå°åè®®è”è°ƒ"><a href="#4ï¼Œå‰åå°åè®®è”è°ƒ" class="headerlink" title="4ï¼Œå‰åå°åè®®è”è°ƒ"></a>4ï¼Œå‰åå°åè®®è”è°ƒ</h2><h3 id="4-1-é¡¹ç›®å‰ç½®"><a href="#4-1-é¡¹ç›®å‰ç½®" class="headerlink" title="4.1 é¡¹ç›®å‰ç½®"></a>4.1 é¡¹ç›®å‰ç½®</h3><ol><li><p>å°†<code>èµ„æ–™\SSMåŠŸèƒ½é¡µé¢</code>ä¸‹é¢çš„é™æ€èµ„æºæ‹·è´åˆ°webappä¸‹ã€‚</p></li><li><p>å› ä¸ºæ·»åŠ äº†é™æ€èµ„æºï¼ŒSpringMVCä¼šæ‹¦æˆªï¼Œæ‰€æœ‰éœ€è¦åœ¨SpringConfigçš„é…ç½®ç±»ä¸­å°†é™æ€èµ„æºè¿›è¡Œæ”¾è¡Œã€‚</p></li></ol><ul><li><p>æ–°å»ºSpringMvcSupport</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/css/**&quot;</span>).addResourceLocations(<span class="string">&quot;/css/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/js/**&quot;</span>).addResourceLocations(<span class="string">&quot;/js/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/plugins/**&quot;</span>).addResourceLocations(<span class="string">&quot;/plugins/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨SpringMvcConfigä¸­æ‰«æSpringMvcSupport</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.blog.controller&quot;,&quot;com.blog.config&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦å°†æ‰€æœ‰çš„åˆ—è¡¨æŸ¥è¯¢ã€æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ç­‰åŠŸèƒ½ä¸€ä¸ªä¸ªæ¥å®ç°ä¸‹ã€‚</p><h3 id="4-2-åˆ—è¡¨åŠŸèƒ½"><a href="#4-2-åˆ—è¡¨åŠŸèƒ½" class="headerlink" title="4.2 åˆ—è¡¨åŠŸèƒ½"></a>4.2 åˆ—è¡¨åŠŸèƒ½</h3><blockquote><p>éœ€æ±‚:é¡µé¢åŠ è½½å®Œåå‘é€å¼‚æ­¥è¯·æ±‚åˆ°åå°è·å–åˆ—è¡¨æ•°æ®è¿›è¡Œå±•ç¤ºã€‚</p><p>1.æ‰¾åˆ°é¡µé¢çš„é’©å­å‡½æ•°ï¼Œ<code>created()</code></p><p>2.<code>created()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>this.getAll()</code>æ–¹æ³•</p><p>3.åœ¨getAll()æ–¹æ³•ä¸­ä½¿ç”¨axioså‘é€å¼‚æ­¥è¯·æ±‚ä»åå°è·å–æ•°æ®</p><p>4.è®¿é—®çš„è·¯å¾„ä¸º<code>http://localhost/books</code></p><p>5.è¿”å›æ•°æ®</p></blockquote><p>è¿”å›æ•°æ®res.dataçš„å†…å®¹å¦‚ä¸‹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¡ç®—æœºç†è®º&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Springå®æˆ˜ ç¬¬äº”ç‰ˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Springå…¥é—¨ç»å…¸æ•™ç¨‹ï¼Œæ·±å…¥ç†è§£SpringåŸç†æŠ€æœ¯å†…å¹•&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¡ç®—æœºç†è®º&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Spring 5æ ¸å¿ƒåŸç†ä¸30ä¸ªç±»æ‰‹å†™å®è·µ&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åå¹´æ²‰æ·€ä¹‹ä½œï¼Œæ‰‹å†™Springç²¾åæ€æƒ³&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">20041</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‘é€æ–¹å¼:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//å‘é€ajaxè¯·æ±‚ï¼Œè·å–æ˜¯getè¯·æ±‚ï¼Œå’ŒResulté£æ ¼å¯¹åº”</span></span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&quot;/books&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dataList</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-æ·»åŠ åŠŸèƒ½"><a href="#4-3-æ·»åŠ åŠŸèƒ½" class="headerlink" title="4.3 æ·»åŠ åŠŸèƒ½"></a>4.3 æ·»åŠ åŠŸèƒ½</h3><blockquote><p>éœ€æ±‚:å®Œæˆå›¾ç‰‡çš„æ–°å¢åŠŸèƒ½æ¨¡å—</p><p>1.æ‰¾åˆ°é¡µé¢ä¸Šçš„<code>æ–°å»º</code>æŒ‰é’®ï¼ŒæŒ‰é’®ä¸Šç»‘å®šäº†<code>@click=&quot;handleCreate()&quot;</code>æ–¹æ³•</p><p>2.åœ¨methodä¸­æ‰¾åˆ°<code>handleCreate</code>æ–¹æ³•ï¼Œæ–¹æ³•ä¸­æ‰“å¼€æ–°å¢é¢æ¿</p><p>3.æ–°å¢é¢æ¿ä¸­æ‰¾åˆ°<code>ç¡®å®š</code>æŒ‰é’®,æŒ‰é’®ä¸Šç»‘å®šäº†<code>@click=&quot;handleAdd()&quot;</code>æ–¹æ³•</p><p>4.åœ¨methodä¸­æ‰¾åˆ°<code>handleAdd</code>æ–¹æ³•</p><p>5.åœ¨æ–¹æ³•ä¸­å‘é€è¯·æ±‚å’Œæ•°æ®ï¼Œå“åº”æˆåŠŸåå°†æ–°å¢é¢æ¿å…³é—­å¹¶é‡æ–°æŸ¥è¯¢æ•°æ®</p></blockquote><p><code>handleCreate</code>æ‰“å¼€æ–°å¢é¢æ¿</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><code>handleAdd</code>æ–¹æ³•å‘é€å¼‚æ­¥è¯·æ±‚å¹¶æºå¸¦æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">handleAdd () &#123;</span><br><span class="line">    <span class="comment">//å‘é€ajaxè¯·æ±‚</span></span><br><span class="line">    <span class="comment">//this.formDataæ˜¯è¡¨å•ä¸­çš„æ•°æ®ï¼Œæœ€åæ˜¯ä¸€ä¸ªjsonæ•°æ®</span></span><br><span class="line">    axios.<span class="title function_">post</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-æ·»åŠ åŠŸèƒ½çŠ¶æ€å¤„ç†"><a href="#4-4-æ·»åŠ åŠŸèƒ½çŠ¶æ€å¤„ç†" class="headerlink" title="4.4 æ·»åŠ åŠŸèƒ½çŠ¶æ€å¤„ç†"></a>4.4 æ·»åŠ åŠŸèƒ½çŠ¶æ€å¤„ç†</h3><p>åŸºç¡€çš„æ–°å¢åŠŸèƒ½å·²ç»å®Œæˆï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›é—®é¢˜éœ€è¦è§£å†³ä¸‹:</p><blockquote><p>éœ€æ±‚:æ–°å¢æˆåŠŸæ˜¯å…³é—­é¢æ¿ï¼Œé‡æ–°æŸ¥è¯¢æ•°æ®ï¼Œé‚£ä¹ˆæ–°å¢å¤±è´¥ä»¥åè¯¥å¦‚ä½•å¤„ç†?</p><p>1.åœ¨handlerAddæ–¹æ³•ä¸­æ ¹æ®åå°è¿”å›çš„æ•°æ®æ¥è¿›è¡Œä¸åŒçš„å¤„ç†</p><p>2.å¦‚æœåå°è¿”å›çš„æ˜¯æˆåŠŸï¼Œåˆ™æç¤ºæˆåŠŸä¿¡æ¯ï¼Œå¹¶å…³é—­é¢æ¿</p><p>3.å¦‚æœåå°è¿”å›çš„æ˜¯å¤±è´¥ï¼Œåˆ™æç¤ºé”™è¯¯ä¿¡æ¯</p></blockquote><p>(1)ä¿®æ”¹å‰ç«¯é¡µé¢</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">handleAdd () &#123;</span><br><span class="line">    <span class="comment">//å‘é€ajaxè¯·æ±‚</span></span><br><span class="line">    axios.<span class="title function_">post</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ“ä½œæˆåŠŸï¼Œå…³é—­å¼¹å±‚ï¼Œæ˜¾ç¤ºæ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20011</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;æ·»åŠ æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20010</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;æ·»åŠ å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ— è®ºå¦‚ä½•éƒ½ä¼šè¢«æ‰§è¡Œçš„æ•°æ®æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨finallyï¼Œè¿™é‡Œæ˜¯ç®­å¤´å‡½æ•°ï¼Œå­¦è¿‡jsçš„åº”è¯¥çŸ¥é“</p><p>(2)åå°è¿”å›æ“ä½œç»“æœï¼Œå°†Daoå±‚çš„å¢åˆ æ”¹æ–¹æ³•è¿”å›å€¼ä»<code>void</code>æ”¹æˆ<code>int</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Insert(&quot;insert into tbl_book values(null,#&#123;type&#125;,#&#123;name&#125;,#&#123;description&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into tbl_book (type,name,description) values(#&#123;type&#125;,#&#123;name&#125;,#&#123;description&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">save</span><span class="params">(Book book)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update tbl_book set type = #&#123;type&#125;, name = #&#123;name&#125;, description = #&#123;description&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(Book book)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_book where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tbl_book&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(3)åœ¨BookServiceImplä¸­ï¼Œå¢åˆ æ”¹æ–¹æ³•æ ¹æ®DAOçš„è¿”å›å€¼æ¥å†³å®šè¿”å›true/false</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.save(book) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.update(book) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.delete(id) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(Code.BUSINESS_ERR,<span class="string">&quot;è¯·ä¸è¦ä½¿ç”¨ä½ çš„æŠ€æœ¯æŒ‘æˆ˜æˆ‘çš„è€æ€§!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        //å°†å¯èƒ½å‡ºç°çš„å¼‚å¸¸è¿›è¡ŒåŒ…è£…ï¼Œè½¬æ¢æˆè‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line"><span class="comment">//        try&#123;</span></span><br><span class="line"><span class="comment">//            int i = 1/0;</span></span><br><span class="line"><span class="comment">//        &#125;catch (Exception e)&#123;</span></span><br><span class="line"><span class="comment">//            throw new SystemException(Code.SYSTEM_TIMEOUT_ERR,&quot;æœåŠ¡å™¨è®¿é—®è¶…æ—¶ï¼Œè¯·é‡è¯•!&quot;,e);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">return</span> bookDao.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bookDao.getAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(4)æµ‹è¯•é”™è¯¯æƒ…å†µï¼Œå°†å›¾ä¹¦ç±»åˆ«é•¿åº¦è®¾ç½®è¶…å‡ºèŒƒå›´å³å¯</p><p>å¤„ç†å®Œæ–°å¢åï¼Œä¼šå‘ç°æ–°å¢è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ</p><p>æ–°å¢æˆåŠŸåï¼Œå†æ¬¡ç‚¹å‡»<code>æ–°å¢</code>æŒ‰é’®ä¼šå‘ç°ä¹‹å‰çš„æ•°æ®è¿˜å­˜åœ¨ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨æ–°å¢çš„æ—¶å€™å°†è¡¨å•å†…å®¹æ¸…ç©ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resetForm</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">formData</span> = &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">handleCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetForm</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5-ä¿®æ”¹åŠŸèƒ½"><a href="#4-5-ä¿®æ”¹åŠŸèƒ½" class="headerlink" title="4.5 ä¿®æ”¹åŠŸèƒ½"></a>4.5 ä¿®æ”¹åŠŸèƒ½</h3><blockquote><p>éœ€æ±‚:å®Œæˆå›¾ä¹¦ä¿¡æ¯çš„ä¿®æ”¹åŠŸèƒ½</p><p>1.æ‰¾åˆ°é¡µé¢ä¸­çš„<code>ç¼–è¾‘</code>æŒ‰é’®ï¼Œè¯¥æŒ‰é’®ç»‘å®šäº†<code>@click=&quot;handleUpdate(scope.row)&quot;</code></p><p>2.åœ¨methodçš„<code>handleUpdate</code>æ–¹æ³•ä¸­å‘é€å¼‚æ­¥è¯·æ±‚æ ¹æ®IDæŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯</p><p>3.æ ¹æ®åå°è¿”å›çš„ç»“æœï¼Œåˆ¤æ–­æ˜¯å¦æŸ¥è¯¢æˆåŠŸ</p><p>â€‹    å¦‚æœæŸ¥è¯¢æˆåŠŸæ‰“å¼€ä¿®æ”¹é¢æ¿å›æ˜¾æ•°æ®ï¼Œå¦‚æœå¤±è´¥æç¤ºé”™è¯¯ä¿¡æ¯</p><p>4.ä¿®æ”¹å®Œæˆåæ‰¾åˆ°ä¿®æ”¹é¢æ¿çš„<code>ç¡®å®š</code>æŒ‰é’®ï¼Œè¯¥æŒ‰é’®ç»‘å®šäº†<code>@click=&quot;handleEdit()&quot;</code></p><p>5.åœ¨methodçš„<code>handleEdit</code>æ–¹æ³•ä¸­å‘é€å¼‚æ­¥è¯·æ±‚æäº¤ä¿®æ”¹æ•°æ®</p><p>6.æ ¹æ®åå°è¿”å›çš„ç»“æœï¼Œåˆ¤æ–­æ˜¯å¦ä¿®æ”¹æˆåŠŸ</p><p>â€‹    å¦‚æœæˆåŠŸæç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå…³é—­ä¿®æ”¹é¢æ¿ï¼Œé‡æ–°æŸ¥è¯¢æ•°æ®ï¼Œå¦‚æœå¤±è´¥æç¤ºé”™è¯¯ä¿¡æ¯</p></blockquote><p>scope.rowä»£è¡¨çš„æ˜¯å½“å‰è¡Œçš„è¡Œæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´,scope.rowå°±æ˜¯é€‰ä¸­è¡Œå¯¹åº”çš„jsonæ•°æ®ï¼Œå¦‚ä¸‹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¡ç®—æœºç†è®º&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Springå®æˆ˜ ç¬¬äº”ç‰ˆ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Springå…¥é—¨ç»å…¸æ•™ç¨‹ï¼Œæ·±å…¥ç†è§£SpringåŸç†æŠ€æœ¯å†…å¹•&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>handleUpdate</code>æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼¹å‡ºç¼–è¾‘çª—å£</span></span><br><span class="line"><span class="title function_">handleUpdate</span>(<span class="params">row</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(row);   //row.id æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢æ•°æ®ï¼Œæ ¹æ®idæŸ¥è¯¢</span></span><br><span class="line">    axios.<span class="title function_">get</span>(<span class="string">&quot;/books/&quot;</span>+row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20041</span>)&#123;</span><br><span class="line">            <span class="comment">//å±•ç¤ºå¼¹å±‚ï¼ŒåŠ è½½æ•°æ®</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">formData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>handleEdit</code>æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleEdit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//å‘é€ajaxè¯·æ±‚</span></span><br><span class="line">    axios.<span class="title function_">put</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ“ä½œæˆåŠŸï¼Œå…³é—­å¼¹å±‚ï¼Œæ˜¾ç¤ºæ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20031</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20030</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ä¿®æ”¹åŠŸèƒ½å°±å·²ç»å®Œæˆã€‚</p><h3 id="4-6-åˆ é™¤åŠŸèƒ½"><a href="#4-6-åˆ é™¤åŠŸèƒ½" class="headerlink" title="4.6 åˆ é™¤åŠŸèƒ½"></a>4.6 åˆ é™¤åŠŸèƒ½</h3><blockquote><p>éœ€æ±‚:å®Œæˆé¡µé¢çš„åˆ é™¤åŠŸèƒ½ã€‚</p><p>1.æ‰¾åˆ°é¡µé¢çš„åˆ é™¤æŒ‰é’®ï¼ŒæŒ‰é’®ä¸Šç»‘å®šäº†<code>@click=&quot;handleDelete(scope.row)&quot;</code></p><p>2.methodçš„<code>handleDelete</code>æ–¹æ³•å¼¹å‡ºæç¤ºæ¡†</p><p>3.ç”¨æˆ·ç‚¹å‡»å–æ¶ˆ,æç¤ºæ“ä½œå·²ç»è¢«å–æ¶ˆã€‚</p><p>4.ç”¨æˆ·ç‚¹å‡»ç¡®å®šï¼Œå‘é€å¼‚æ­¥è¯·æ±‚å¹¶æºå¸¦éœ€è¦åˆ é™¤æ•°æ®çš„ä¸»é”®ID</p><p>5.æ ¹æ®åå°è¿”å›ç»“æœåšä¸åŒçš„æ“ä½œ</p><p>â€‹    å¦‚æœè¿”å›æˆåŠŸï¼Œæç¤ºæˆåŠŸä¿¡æ¯ï¼Œå¹¶é‡æ–°æŸ¥è¯¢æ•°æ®</p><p>â€‹    å¦‚æœè¿”å›å¤±è´¥ï¼Œæç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶é‡æ–°æŸ¥è¯¢æ•°æ®</p></blockquote><p>ä¿®æ”¹<code>handleDelete</code>æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span><br><span class="line">    <span class="comment">//1.å¼¹å‡ºæç¤ºæ¡†</span></span><br><span class="line">    <span class="variable language_">this</span>.$confirm(<span class="string">&quot;æ­¤æ“ä½œæ°¸ä¹…åˆ é™¤å½“å‰æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ&quot;</span>,<span class="string">&quot;æç¤º&quot;</span>,&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&#x27;info&#x27;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//2.åšåˆ é™¤ä¸šåŠ¡</span></span><br><span class="line">        axios.<span class="title function_">delete</span>(<span class="string">&quot;/books/&quot;</span>+row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20021</span>)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;åˆ é™¤å¤±è´¥&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//3.å–æ¶ˆåˆ é™¤</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">info</span>(<span class="string">&quot;å–æ¶ˆåˆ é™¤æ“ä½œ&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´é¡µé¢</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- é¡µé¢meta --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>SpringMVCæ¡ˆä¾‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no&quot;</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥æ ·å¼ --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../plugins/elementui/index.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../plugins/font-awesome/css/font-awesome.min.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/style.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;hold-transition&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content-header&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>å›¾ä¹¦ç®¡ç†<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;filter-container&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">placeholder</span>=<span class="string">&quot;å›¾ä¹¦åç§°&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;pagination.queryString&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;filter-item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;getAll()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dalfBut&quot;</span>&gt;</span>æŸ¥è¯¢<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">class</span>=<span class="string">&quot;butT&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleCreate()&quot;</span>&gt;</span>æ–°å»º<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">current-row-key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">:data</span>=<span class="string">&quot;dataList&quot;</span> <span class="attr">stripe</span> <span class="attr">highlight-current-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;index&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;åºå·&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;type&quot;</span> <span class="attr">label</span>=<span class="string">&quot;å›¾ä¹¦ç±»åˆ«&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> <span class="attr">label</span>=<span class="string">&quot;å›¾ä¹¦åç§°&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span> <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;æ“ä½œ&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpdate(scope.row)&quot;</span>&gt;</span>ç¼–è¾‘<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDelete(scope.row)&quot;</span>&gt;</span>åˆ é™¤<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- æ–°å¢æ ‡ç­¾å¼¹å±‚ --&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;add-form&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;æ–°å¢å›¾ä¹¦&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;dialogFormVisible&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;dataAddForm&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;formData&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">label-position</span>=<span class="string">&quot;right&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å›¾ä¹¦ç±»åˆ«&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.type&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å›¾ä¹¦åç§°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.description&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;dialogFormVisible = false&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleAdd()&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- ç¼–è¾‘æ ‡ç­¾å¼¹å±‚ --&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;add-form&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;ç¼–è¾‘æ£€æŸ¥é¡¹&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;dialogFormVisible4Edit&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;dataEditForm&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;formData&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">label-position</span>=<span class="string">&quot;right&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å›¾ä¹¦ç±»åˆ«&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;type&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.type&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;12&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;å›¾ä¹¦åç§°&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;æè¿°&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.description&quot;</span> <span class="attr">type</span>=<span class="string">&quot;textarea&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;dialogFormVisible4Edit = false&quot;</span>&gt;</span>å–æ¶ˆ<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit()&quot;</span>&gt;</span>ç¡®å®š<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥ç»„ä»¶åº“ --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../plugins/elementui/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../js/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/axios-0.18.0.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">pagination</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">dataList</span>: [],<span class="comment">//å½“å‰é¡µè¦å±•ç¤ºçš„åˆ—è¡¨æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">formData</span>: &#123;&#125;,<span class="comment">//è¡¨å•æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">dialogFormVisible</span>: <span class="literal">false</span>,<span class="comment">//æ§åˆ¶è¡¨å•æ˜¯å¦å¯è§</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">dialogFormVisible4Edit</span>:<span class="literal">false</span>,<span class="comment">//ç¼–è¾‘è¡¨å•æ˜¯å¦å¯è§</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">rules</span>: &#123;<span class="comment">//æ ¡éªŒè§„åˆ™</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">type</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;å›¾ä¹¦ç±»åˆ«ä¸ºå¿…å¡«é¡¹&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&#x27;å›¾ä¹¦åç§°ä¸ºå¿…å¡«é¡¹&#x27;</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span> &#125;]</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//é’©å­å‡½æ•°ï¼ŒVUEå¯¹è±¡åˆå§‹åŒ–å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//åˆ—è¡¨</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">getAll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//å‘é€ajaxè¯·æ±‚</span></span></span><br><span class="line"><span class="language-javascript">                    axios.<span class="title function_">get</span>(<span class="string">&quot;/books&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">dataList</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//å¼¹å‡ºæ·»åŠ çª—å£</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">handleCreate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="title function_">resetForm</span>();</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//é‡ç½®è¡¨å•</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">resetForm</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">formData</span> = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//æ·»åŠ </span></span></span><br><span class="line"><span class="language-javascript">                handleAdd () &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//å‘é€ajaxè¯·æ±‚</span></span></span><br><span class="line"><span class="language-javascript">                    axios.<span class="title function_">post</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">//å¦‚æœæ“ä½œæˆåŠŸï¼Œå…³é—­å¼¹å±‚ï¼Œæ˜¾ç¤ºæ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20011</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">dialogFormVisible</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;æ·»åŠ æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20010</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;æ·»åŠ å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//å¼¹å‡ºç¼–è¾‘çª—å£</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">handleUpdate</span>(<span class="params">row</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// console.log(row);   //row.id æŸ¥è¯¢æ¡ä»¶</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//æŸ¥è¯¢æ•°æ®ï¼Œæ ¹æ®idæŸ¥è¯¢</span></span></span><br><span class="line"><span class="language-javascript">                    axios.<span class="title function_">get</span>(<span class="string">&quot;/books/&quot;</span>+row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">// console.log(res.data.data);</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20041</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="comment">//å±•ç¤ºå¼¹å±‚ï¼ŒåŠ è½½æ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">formData</span> = res.<span class="property">data</span>.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//ç¼–è¾‘</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">handleEdit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//å‘é€ajaxè¯·æ±‚</span></span></span><br><span class="line"><span class="language-javascript">                    axios.<span class="title function_">put</span>(<span class="string">&quot;/books&quot;</span>,<span class="variable language_">this</span>.<span class="property">formData</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">//å¦‚æœæ“ä½œæˆåŠŸï¼Œå…³é—­å¼¹å±‚ï¼Œæ˜¾ç¤ºæ•°æ®</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20031</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">dialogFormVisible4Edit</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;ä¿®æ”¹æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20030</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;ä¿®æ”¹å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(res.<span class="property">data</span>.<span class="property">msg</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// åˆ é™¤</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">handleDelete</span>(<span class="params">row</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//1.å¼¹å‡ºæç¤ºæ¡†</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.$confirm(<span class="string">&quot;æ­¤æ“ä½œæ°¸ä¹…åˆ é™¤å½“å‰æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ&quot;</span>,<span class="string">&quot;æç¤º&quot;</span>,&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>:<span class="string">&#x27;info&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">//2.åšåˆ é™¤ä¸šåŠ¡</span></span></span><br><span class="line"><span class="language-javascript">                        axios.<span class="title function_">delete</span>(<span class="string">&quot;/books/&quot;</span>+row.<span class="property">id</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">20021</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                            &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;åˆ é™¤å¤±è´¥&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                            &#125;</span></span><br><span class="line"><span class="language-javascript">                        &#125;).<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="variable language_">this</span>.<span class="title function_">getAll</span>();</span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                    &#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="comment">//3.å–æ¶ˆåˆ é™¤</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">info</span>(<span class="string">&quot;å–æ¶ˆåˆ é™¤æ“ä½œ&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221106184637.png" alt=""><br>æˆ‘ä»¬å¤„ç†å®Œä¼šå‘ç°ï¼Œæˆ‘ä»¬å®é™…éœ€è¦çš„å°±åªæ˜¯è¿™äº›ä¸œè¥¿ï¼Œå°±æ˜¯å¯¹åº”çš„å¢åˆ æ”¹æŸ¥çš„æ“ä½œ</p><ol><li>å¯¹äºæŸ¥å•ä¸ªå’Œåˆ é™¤ï¼Œéœ€è¦æºå¸¦å‚æ•°</li><li>å¯¹äºæ–°å¢å’Œä¿®æ”¹ï¼Œéœ€è¦æºå¸¦çš„æ˜¯å¯¹åº”jsonå‚æ•°</li><li>å¯¹äºæŸ¥å…¨éƒ¨æ— éœ€æºå¸¦<br>è‡³äºè¿™äº›è¯·æ±‚æäº¤ä¹‹åçš„æ“ä½œå®é™…ä¸Šéƒ½æ˜¯vueå’ŒUIçš„æ“ä½œï¼Œå’Œspringå…³ç³»ä¸å¤§ï¼Œä¸ä¼šçš„è¯ä¸éœ€è¦æ‹…å¿ƒï¼Œéœ€è¦è¡¥å…¨çš„æ˜¯å¯¹åº”å‰ç«¯çŸ¥è¯†ã€‚</li></ol><h2 id="5ï¼Œæ‹¦æˆªå™¨"><a href="#5ï¼Œæ‹¦æˆªå™¨" class="headerlink" title="5ï¼Œæ‹¦æˆªå™¨"></a>5ï¼Œæ‹¦æˆªå™¨</h2><p>å¯¹äºæ‹¦æˆªå™¨è¿™èŠ‚çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¹ å¦‚ä¸‹å†…å®¹:</p><ul><li>æ‹¦æˆªå™¨æ¦‚å¿µ</li><li>å…¥é—¨æ¡ˆä¾‹</li><li>æ‹¦æˆªå™¨å‚æ•°</li><li>æ‹¦æˆªå™¨å·¥ä½œæµç¨‹åˆ†æ</li></ul><h3 id="5-1-æ‹¦æˆªå™¨æ¦‚å¿µ"><a href="#5-1-æ‹¦æˆªå™¨æ¦‚å¿µ" class="headerlink" title="5.1 æ‹¦æˆªå™¨æ¦‚å¿µ"></a>5.1 æ‹¦æˆªå™¨æ¦‚å¿µ</h3><p>è®²è§£æ‹¦æˆªå™¨çš„æ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€å¼ å›¾:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221106190645.png" alt=""></p><p>(1)æµè§ˆå™¨å‘é€ä¸€ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°Tomcatçš„webæœåŠ¡å™¨</p><p>(2)TomcatæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œä¼šå»åˆ¤æ–­è¯·æ±‚çš„æ˜¯é™æ€èµ„æºè¿˜æ˜¯åŠ¨æ€èµ„æº</p><p>(3)å¦‚æœæ˜¯é™æ€èµ„æºï¼Œä¼šç›´æ¥åˆ°Tomcatçš„é¡¹ç›®éƒ¨ç½²ç›®å½•ä¸‹å»ç›´æ¥è®¿é—®</p><p>(4)å¦‚æœæ˜¯åŠ¨æ€èµ„æºï¼Œå°±éœ€è¦äº¤ç»™é¡¹ç›®çš„åå°ä»£ç è¿›è¡Œå¤„ç†</p><p>(5)åœ¨æ‰¾åˆ°å…·ä½“çš„æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å»é…ç½®è¿‡æ»¤å™¨(å¯ä»¥é…ç½®å¤šä¸ª)ï¼ŒæŒ‰ç…§é¡ºåºè¿›è¡Œæ‰§è¡Œ</p><p>(6)ç„¶åè¿›å…¥åˆ°åˆ°ä¸­å¤®å¤„ç†å™¨(SpringMVCä¸­çš„å†…å®¹)ï¼ŒSpringMVCä¼šæ ¹æ®é…ç½®çš„è§„åˆ™è¿›è¡Œæ‹¦æˆª</p><p>(7)å¦‚æœæ»¡è¶³è§„åˆ™ï¼Œåˆ™è¿›è¡Œå¤„ç†ï¼Œæ‰¾åˆ°å…¶å¯¹åº”çš„controllerç±»ä¸­çš„æ–¹æ³•è¿›è¡Œæ‰§è¡Œ,å®Œæˆåè¿”å›ç»“æœ</p><p>(8)å¦‚æœä¸æ»¡è¶³è§„åˆ™ï¼Œåˆ™ä¸è¿›è¡Œå¤„ç†</p><p>(9)è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªControlleræ–¹æ³•æ‰§è¡Œçš„å‰åæ·»åŠ ä¸šåŠ¡ï¼Œå…·ä½“è¯¥å¦‚ä½•æ¥å®ç°?</p><p>è¿™ä¸ªå°±æ˜¯æ‹¦æˆªå™¨è¦åšçš„äº‹ã€‚</p><ul><li>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œåœ¨SpringMVCä¸­åŠ¨æ€æ‹¦æˆªæ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œ</li><li>ä½œç”¨:<ul><li>åœ¨æŒ‡å®šçš„æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç </li><li>é˜»æ­¢åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ</li><li>æ€»ç»“ï¼šæ‹¦æˆªå™¨å°±æ˜¯ç”¨æ¥åšå¢å¼º</li></ul></li></ul><p>çœ‹å®Œä»¥åï¼Œå¤§å®¶ä¼šå‘ç°</p><ul><li>æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨åœ¨ä½œç”¨å’Œæ‰§è¡Œé¡ºåºä¸Šä¹Ÿå¾ˆç›¸ä¼¼</li></ul><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°ä¸€ä¸ªç–‘é—®ï¼Œæ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>å½’å±ä¸åŒï¼šFilterå±äºServletæŠ€æœ¯ï¼ŒInterceptorå±äºSpringMVCæŠ€æœ¯</li><li>æ‹¦æˆªå†…å®¹ä¸åŒï¼šFilterå¯¹æ‰€æœ‰è®¿é—®è¿›è¡Œå¢å¼ºï¼ŒInterceptorä»…é’ˆå¯¹SpringMVCçš„è®¿é—®è¿›è¡Œå¢å¼º</li></ul><h3 id="5-2-æ‹¦æˆªå™¨å…¥é—¨æ¡ˆä¾‹"><a href="#5-2-æ‹¦æˆªå™¨å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="5.2 æ‹¦æˆªå™¨å…¥é—¨æ¡ˆä¾‹"></a>5.2 æ‹¦æˆªå™¨å…¥é—¨æ¡ˆä¾‹</h3><h4 id="5-2-1-ç¯å¢ƒå‡†å¤‡"><a href="#5-2-1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="5.2.1 ç¯å¢ƒå‡†å¤‡"></a>5.2.1 ç¯å¢ƒå‡†å¤‡</h4><ul><li><p>åˆ›å»ºä¸€ä¸ªWebçš„Mavené¡¹ç›®</p></li><li><p>pom.xmlæ·»åŠ SSMæ•´åˆæ‰€éœ€jaråŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.blog<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springmvc_12_interceptor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>80<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå¯¹åº”çš„é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainersInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringMvcConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¹±ç å¤„ç†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">        filter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;filter&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.blog.controller&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæ¨¡å‹ç±»Book</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Book&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;ä¹¦å=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, ä»·æ ¼=&quot;</span> + price +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book save...&quot;</span> + book);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book save&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book delete...&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book delete&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Book book)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book update...&quot;</span>+book);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book update&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book getById...&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book getById&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book getAll...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;:&#x27;book getAll&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>æœ€ç»ˆåˆ›å»ºå¥½çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹:</p><p><img src="assets/1630677370998.png" alt="1630677370998"></p><h4 id="5-2-2-æ‹¦æˆªå™¨å¼€å‘"><a href="#5-2-2-æ‹¦æˆªå™¨å¼€å‘" class="headerlink" title="5.2.2 æ‹¦æˆªå™¨å¼€å‘"></a>5.2.2 æ‹¦æˆªå™¨å¼€å‘</h4><h5 id="æ­¥éª¤1-åˆ›å»ºæ‹¦æˆªå™¨ç±»"><a href="#æ­¥éª¤1-åˆ›å»ºæ‹¦æˆªå™¨ç±»" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºæ‹¦æˆªå™¨ç±»"></a>æ­¥éª¤1:åˆ›å»ºæ‹¦æˆªå™¨ç±»</h5><p>è®©ç±»å®ç°HandlerInterceptoræ¥å£ï¼Œé‡å†™æ¥å£ä¸­çš„ä¸‰ä¸ªæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//å®šä¹‰æ‹¦æˆªå™¨ç±»ï¼Œå®ç°HandlerInterceptoræ¥å£</span></span><br><span class="line"><span class="comment">//æ³¨æ„å½“å‰ç±»å¿…é¡»å—Springå®¹å™¨æ§åˆ¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//åŸå§‹æ–¹æ³•è°ƒç”¨å‰æ‰§è¡Œçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//åŸå§‹æ–¹æ³•è°ƒç”¨åæ‰§è¡Œçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//åŸå§‹æ–¹æ³•è°ƒç”¨å®Œæˆåæ‰§è¡Œçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong> æ‹¦æˆªå™¨ç±»è¦è¢«SpringMVCå®¹å™¨æ‰«æåˆ°ã€‚</p><h5 id="æ­¥éª¤2-é…ç½®æ‹¦æˆªå™¨ç±»"><a href="#æ­¥éª¤2-é…ç½®æ‹¦æˆªå™¨ç±»" class="headerlink" title="æ­¥éª¤2:é…ç½®æ‹¦æˆªå™¨ç±»"></a>æ­¥éª¤2:é…ç½®æ‹¦æˆªå™¨ç±»</h5><p>è¿™ä¸ªç±»çš„é…ç½®å’Œä¹‹å‰çš„è¿‡å‰ç«¯æ–¹æ³•ç±»ä¼¼ï¼Œè¿™é‡Œç”¨ä½œå¯¹ç…§</p><ul><li>æ‹¦æˆªå™¨å¦‚ä½•è¿›å…¥åˆ°é¡¹ç›®ä¸­å‘¢ï¼Œæ‹¦æˆªå™¨å­˜åœ¨äºå®¹å™¨ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ³¨å…¥ï¼Œæ³¨å…¥æ€ä¹ˆæ³¨å…¥å‘¢ï¼ŸåŒæ ·çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨è£…é…å³å¯ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor projectInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//é…ç½®æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(projectInterceptor).addPathPatterns(<span class="string">&quot;/books&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤3-SpringMVCæ·»åŠ SpringMvcSupportåŒ…æ‰«æ"><a href="#æ­¥éª¤3-SpringMVCæ·»åŠ SpringMvcSupportåŒ…æ‰«æ" class="headerlink" title="æ­¥éª¤3:SpringMVCæ·»åŠ SpringMvcSupportåŒ…æ‰«æ"></a>æ­¥éª¤3:SpringMVCæ·»åŠ SpringMvcSupportåŒ…æ‰«æ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.blog.controller&quot;,&quot;com.blog.config&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span>&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤4-è¿è¡Œç¨‹åºæµ‹è¯•"><a href="#æ­¥éª¤4-è¿è¡Œç¨‹åºæµ‹è¯•" class="headerlink" title="æ­¥éª¤4:è¿è¡Œç¨‹åºæµ‹è¯•"></a>æ­¥éª¤4:è¿è¡Œç¨‹åºæµ‹è¯•</h5><p>ä½¿ç”¨PostManå‘é€<code>http://localhost/books</code> å‘ç°ä¼šè¢«æˆåŠŸæ‹¦æˆª</p><p>å¦‚æœå‘é€<code>http://localhost/books/100</code>ä¼šå‘ç°æ‹¦æˆªå™¨æ²¡æœ‰è¢«æ‰§è¡Œï¼ŒåŸå› æ˜¯æ‹¦æˆªå™¨çš„<code>addPathPatterns</code>æ–¹æ³•é…ç½®çš„æ‹¦æˆªè·¯å¾„æ˜¯<code>/books</code>,æˆ‘ä»¬ç°åœ¨å‘é€çš„æ˜¯<code>/books/100</code>ï¼Œæ‰€ä»¥æ²¡æœ‰åŒ¹é…ä¸Šï¼Œå› æ­¤æ²¡æœ‰æ‹¦æˆªï¼Œæ‹¦æˆªå™¨å°±ä¸ä¼šæ‰§è¡Œã€‚</p><h5 id="æ­¥éª¤5-ä¿®æ”¹æ‹¦æˆªå™¨æ‹¦æˆªè§„åˆ™"><a href="#æ­¥éª¤5-ä¿®æ”¹æ‹¦æˆªå™¨æ‹¦æˆªè§„åˆ™" class="headerlink" title="æ­¥éª¤5:ä¿®æ”¹æ‹¦æˆªå™¨æ‹¦æˆªè§„åˆ™"></a>æ­¥éª¤5:ä¿®æ”¹æ‹¦æˆªå™¨æ‹¦æˆªè§„åˆ™</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor projectInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/pages/**&quot;</span>).addResourceLocations(<span class="string">&quot;/pages/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//é…ç½®æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(projectInterceptor).addPathPatterns(<span class="string">&quot;/books&quot;</span>,<span class="string">&quot;/books/*&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœå†æ¬¡è®¿é—®<code>http://localhost/books/100</code>ï¼Œæ‹¦æˆªå™¨å°±ä¼šè¢«æ‰§è¡Œã€‚</p><p>æœ€åè¯´ä¸€ä»¶äº‹ï¼Œå°±æ˜¯æ‹¦æˆªå™¨ä¸­çš„<code>preHandler</code>æ–¹æ³•ï¼Œå¦‚æœè¿”å›true,åˆ™ä»£è¡¨æ”¾è¡Œï¼Œä¼šæ‰§è¡ŒåŸå§‹Controllerç±»ä¸­è¦è¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚æœè¿”å›falseï¼Œåˆ™ä»£è¡¨æ‹¦æˆªï¼Œåé¢çš„å°±ä¸ä¼šå†æ‰§è¡Œäº†ã€‚</p><h5 id="æ­¥éª¤6-ç®€åŒ–SpringMvcSupportçš„ç¼–å†™"><a href="#æ­¥éª¤6-ç®€åŒ–SpringMvcSupportçš„ç¼–å†™" class="headerlink" title="æ­¥éª¤6:ç®€åŒ–SpringMvcSupportçš„ç¼–å†™"></a>æ­¥éª¤6:ç®€åŒ–SpringMvcSupportçš„ç¼–å†™</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.blog.controller&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="comment">//å®ç°WebMvcConfigureræ¥å£å¯ä»¥ç®€åŒ–å¼€å‘ï¼Œä½†å…·æœ‰ä¸€å®šçš„ä¾µå…¥æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor projectInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//é…ç½®å¤šæ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(projectInterceptor).addPathPatterns(<span class="string">&quot;/books&quot;</span>,<span class="string">&quot;/books/*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤åå’±ä»¬å°±ä¸ç”¨å†å†™<code>SpringMvcSupport</code>ç±»äº†ã€‚</p><p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹:</p><p><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/20221110113231.png" alt=""></p><p>å½“æœ‰æ‹¦æˆªå™¨åï¼Œè¯·æ±‚ä¼šå…ˆè¿›å…¥preHandleæ–¹æ³•ï¼Œ</p><p>â€‹    å¦‚æœæ–¹æ³•è¿”å›trueï¼Œåˆ™æ”¾è¡Œç»§ç»­æ‰§è¡Œåé¢çš„handle[controllerçš„æ–¹æ³•]å’Œåé¢çš„æ–¹æ³•</p><p>â€‹    å¦‚æœè¿”å›falseï¼Œåˆ™ç›´æ¥è·³è¿‡åé¢æ–¹æ³•çš„æ‰§è¡Œã€‚</p><h3 id="5-3-æ‹¦æˆªå™¨å‚æ•°"><a href="#5-3-æ‹¦æˆªå™¨å‚æ•°" class="headerlink" title="5.3 æ‹¦æˆªå™¨å‚æ•°"></a>5.3 æ‹¦æˆªå™¨å‚æ•°</h3><h4 id="5-3-1-å‰ç½®å¤„ç†æ–¹æ³•"><a href="#5-3-1-å‰ç½®å¤„ç†æ–¹æ³•" class="headerlink" title="5.3.1 å‰ç½®å¤„ç†æ–¹æ³•"></a>5.3.1 å‰ç½®å¤„ç†æ–¹æ³•</h4><p>åŸå§‹æ–¹æ³•ä¹‹å‰è¿è¡ŒpreHandle</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                         HttpServletResponse response,</span></span><br><span class="line"><span class="params">                         Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>request:è¯·æ±‚å¯¹è±¡</li><li>response:å“åº”å¯¹è±¡</li><li>handler:è¢«è°ƒç”¨çš„å¤„ç†å™¨å¯¹è±¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–¹æ³•å¯¹è±¡ï¼Œå¯¹åå°„ä¸­çš„Methodå¯¹è±¡è¿›è¡Œäº†å†åŒ…è£…</li></ul><p>ä½¿ç”¨requestå¯¹è±¡å¯ä»¥è·å–è¯·æ±‚æ•°æ®ä¸­çš„å†…å®¹ï¼Œå¦‚è·å–è¯·æ±‚å¤´çš„<code>Content-Type</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Content-Type&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;preHandle...&quot;</span>+contentType);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨handlerå‚æ•°ï¼Œå¯ä»¥è·å–æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HandlerMethod</span> <span class="variable">hm</span> <span class="operator">=</span> (HandlerMethod)handler;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> hm.getMethod().getName();<span class="comment">//å¯ä»¥è·å–æ–¹æ³•çš„åç§°</span></span><br><span class="line">    System.out.println(<span class="string">&quot;preHandle...&quot;</span>+methodName);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-3-2-åç½®å¤„ç†æ–¹æ³•"><a href="#5-3-2-åç½®å¤„ç†æ–¹æ³•" class="headerlink" title="5.3.2 åç½®å¤„ç†æ–¹æ³•"></a>5.3.2 åç½®å¤„ç†æ–¹æ³•</h4><p>åŸå§‹æ–¹æ³•è¿è¡Œåè¿è¡Œï¼Œå¦‚æœåŸå§‹æ–¹æ³•è¢«æ‹¦æˆªï¼Œåˆ™ä¸æ‰§è¡Œ  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                       HttpServletResponse response,</span></span><br><span class="line"><span class="params">                       Object handler,</span></span><br><span class="line"><span class="params">                       ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;postHandle&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ä¸‰ä¸ªå‚æ•°å’Œä¸Šé¢çš„æ˜¯ä¸€è‡´çš„ã€‚</p><p>modelAndView:å¦‚æœå¤„ç†å™¨æ‰§è¡Œå®Œæˆå…·æœ‰è¿”å›ç»“æœï¼Œå¯ä»¥è¯»å–åˆ°å¯¹åº”æ•°æ®ä¸é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œè°ƒæ•´</p><p>å› ä¸ºå’±ä»¬ç°åœ¨éƒ½æ˜¯è¿”å›jsonæ•°æ®ï¼Œæ‰€ä»¥è¯¥å‚æ•°çš„ä½¿ç”¨ç‡ä¸é«˜ã€‚</p><h4 id="5-3-3-å®Œæˆå¤„ç†æ–¹æ³•"><a href="#5-3-3-å®Œæˆå¤„ç†æ–¹æ³•" class="headerlink" title="5.3.3 å®Œæˆå¤„ç†æ–¹æ³•"></a>5.3.3 å®Œæˆå¤„ç†æ–¹æ³•</h4><p>æ‹¦æˆªå™¨æœ€åæ‰§è¡Œçš„æ–¹æ³•ï¼Œæ— è®ºåŸå§‹æ–¹æ³•æ˜¯å¦æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                            HttpServletResponse response,</span></span><br><span class="line"><span class="params">                            Object handler,</span></span><br><span class="line"><span class="params">                            Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;afterCompletion&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰ä¸‰ä¸ªå‚æ•°ä¸ä¸Šé¢çš„æ˜¯ä¸€è‡´çš„ã€‚</p><p>ex:å¦‚æœå¤„ç†å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸å¯¹è±¡ï¼Œå¯ä»¥é’ˆå¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå•ç‹¬å¤„ç†  </p><p>å› ä¸ºæˆ‘ä»¬ç°åœ¨å·²ç»æœ‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç±»ï¼Œæ‰€ä»¥è¯¥å‚æ•°çš„ä½¿ç”¨ç‡ä¹Ÿä¸é«˜ã€‚</p><p>è¿™ä¸‰ä¸ªæ–¹æ³•ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯==preHandle==,åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¯ä»¥é€šè¿‡è¿”å›å€¼æ¥å†³å®šæ˜¯å¦è¦è¿›è¡Œæ”¾è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸šåŠ¡é€»è¾‘æ”¾åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¦‚æœæ»¡è¶³ä¸šåŠ¡åˆ™è¿”å›trueæ”¾è¡Œï¼Œä¸æ»¡è¶³åˆ™è¿”å›falseæ‹¦æˆªã€‚</p><h3 id="5-4-æ‹¦æˆªå™¨é“¾é…ç½®"><a href="#5-4-æ‹¦æˆªå™¨é“¾é…ç½®" class="headerlink" title="5.4 æ‹¦æˆªå™¨é“¾é…ç½®"></a>5.4 æ‹¦æˆªå™¨é“¾é…ç½®</h3><p>ç›®å‰ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªæ·»åŠ äº†ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œè¯¥å¦‚ä½•é…ç½®?é…ç½®å¤šä¸ªåï¼Œæ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆ?</p><h4 id="5-4-1-é…ç½®å¤šä¸ªæ‹¦æˆªå™¨"><a href="#5-4-1-é…ç½®å¤šä¸ªæ‹¦æˆªå™¨" class="headerlink" title="5.4.1 é…ç½®å¤šä¸ªæ‹¦æˆªå™¨"></a>5.4.1 é…ç½®å¤šä¸ªæ‹¦æˆªå™¨</h4><h5 id="æ­¥éª¤1-åˆ›å»ºæ‹¦æˆªå™¨ç±»-1"><a href="#æ­¥éª¤1-åˆ›å»ºæ‹¦æˆªå™¨ç±»-1" class="headerlink" title="æ­¥éª¤1:åˆ›å»ºæ‹¦æˆªå™¨ç±»"></a>æ­¥éª¤1:åˆ›å»ºæ‹¦æˆªå™¨ç±»</h5><p>å®ç°æ¥å£ï¼Œå¹¶é‡å†™æ¥å£ä¸­çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor2</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle...222&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle...222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion...222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ­¥éª¤2-é…ç½®æ‹¦æˆªå™¨ç±»-1"><a href="#æ­¥éª¤2-é…ç½®æ‹¦æˆªå™¨ç±»-1" class="headerlink" title="æ­¥éª¤2:é…ç½®æ‹¦æˆªå™¨ç±»"></a>æ­¥éª¤2:é…ç½®æ‹¦æˆªå™¨ç±»</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.blog.controller&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="comment">//å®ç°WebMvcConfigureræ¥å£å¯ä»¥ç®€åŒ–å¼€å‘ï¼Œä½†å…·æœ‰ä¸€å®šçš„ä¾µå…¥æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor projectInterceptor;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor2 projectInterceptor2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//é…ç½®å¤šæ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(projectInterceptor).addPathPatterns(<span class="string">&quot;/books&quot;</span>,<span class="string">&quot;/books/*&quot;</span>);</span><br><span class="line">        registry.addInterceptor(projectInterceptor2).addPathPatterns(<span class="string">&quot;/books&quot;</span>,<span class="string">&quot;/books/*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¥éª¤3:è¿è¡Œç¨‹åºï¼Œè§‚å¯Ÿé¡ºåº</p><p>æ‹¦æˆªå™¨æ‰§è¡Œçš„é¡ºåºæ˜¯å’Œé…ç½®é¡ºåºæœ‰å…³ã€‚å°±å’Œå‰é¢æ‰€æåˆ°çš„è¿ç»´äººå‘˜è¿›å…¥æœºæˆ¿çš„æ¡ˆä¾‹ï¼Œå…ˆè¿›åå‡ºã€‚</p><ul><li>å½“é…ç½®å¤šä¸ªæ‹¦æˆªå™¨æ—¶ï¼Œå½¢æˆæ‹¦æˆªå™¨é“¾</li><li>æ‹¦æˆªå™¨é“¾çš„è¿è¡Œé¡ºåºå‚ç…§æ‹¦æˆªå™¨æ·»åŠ é¡ºåºä¸ºå‡†</li><li>å½“æ‹¦æˆªå™¨ä¸­å‡ºç°å¯¹åŸå§‹å¤„ç†å™¨çš„æ‹¦æˆªï¼Œåé¢çš„æ‹¦æˆªå™¨å‡ç»ˆæ­¢è¿è¡Œ</li><li>å½“æ‹¦æˆªå™¨è¿è¡Œä¸­æ–­ï¼Œä»…è¿è¡Œé…ç½®åœ¨å‰é¢çš„æ‹¦æˆªå™¨çš„afterCompletionæ“ä½œ</li><li>preHandleï¼šä¸é…ç½®é¡ºåºç›¸åŒï¼Œå¿…å®šè¿è¡Œ</li></ul><p>postHandle:ä¸é…ç½®é¡ºåºç›¸åï¼Œå¯èƒ½ä¸è¿è¡Œ</p><p>afterCompletion:ä¸é…ç½®é¡ºåºç›¸åï¼Œå¯èƒ½ä¸è¿è¡Œã€‚</p><p>è¿™ä¸ªé¡ºåºä¸å¤ªå¥½è®°ï¼Œæœ€ç»ˆåªéœ€è¦æŠŠæ¡ä½ä¸€ä¸ªåŸåˆ™å³å¯:==ä»¥æœ€ç»ˆçš„è¿è¡Œç»“æœä¸ºå‡†==</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€ç¯‡æ–‡ç« </title>
      <link href="/posts/1546629063.html"/>
      <url>/posts/1546629063.html</url>
      
        <content type="html"><![CDATA[<h2 id="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« "><a href="#è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« " class="headerlink" title="è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« "></a>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« </h2><p>è¿™ä¹‹å‰æˆ‘éƒ½æ˜¯è®°å½•äºæœ‰é“äº‘ï¼Œä½†æ˜¯å¹¶éä½¿ç”¨markdownè¯­æ³•ï¼Œå§‹ç»ˆæ„Ÿè§‰å·®äº†äº›ä»€ä¹ˆï¼Œæœ‰é“äº‘çš„markdownä¸å¤Ÿå¥½ç”¨ï¼ŒåŠæ—¶æ¸²æŸ“å¤Ÿç›´è§‚ä½†ä¸å¤Ÿç¾è§‚ï¼Œæ‰€ä»¥è½¬äº†ä½¿ç”¨vscodeï¼Œæœ‰äººé—®ä¸ºä»€ä¹ˆä¸ä½¿ç”¨typoraï¼Œè¿™é‡Œå•çº¯ä¸ªäººå–œå¥½å§ï¼Œè€Œä¸”è¿™é‡Œä¹¦å†™mdå¯ä»¥è®©æˆ‘éƒ¨ç½²åˆ°hexoæ›´å¿«æ·ï¼Œçœå»å¤šæ¬¡ç§»åŠ¨æ–‡ä»¶æ“ä½œçš„æ—¶é—´ï¼Œæ›´æ–¹ä¾¿ã€‚<br><em>ä¹Ÿæ²¡æƒ³ç€å†™å•¥ï¼Œå°±å•çº¯çš„è®°å½•ä¸€ä¸‹è¿™ä¸ªå…·æœ‰æ„ä¹‰çš„ç½‘ç«™å»ºç«‹æ—¶æœŸ â€”-rugu.space</em><br><em>æœ€ä¸Šé¢çš„å¤´æ–‡ä»¶å¯¹ hexo æ¥è¯´å¾ˆé‡è¦æ¯ç¯‡æ–‡ç« éƒ½éœ€è¦ï¼Œåªæœ‰æ·»åŠ äº† title å±æ€§æ‰å¯ä»¥è¢«åˆ¤æ–­æˆæ–‡ç« å“¦</em><br>Front-matter æ˜¯ markdown æ–‡ä»¶æœ€ä¸Šæ–¹ä»¥ â€”- åˆ†éš”çš„åŒºåŸŸï¼Œç”¨äºæŒ‡å®šä¸ªåˆ«æ¡£æ¡ˆçš„å˜æ•°ã€‚</p><h4 id="Front-matter"><a href="#Front-matter" class="headerlink" title="Front-matter"></a>Front-matter</h4><ol><li>Page Front-matter ç”¨äºé¡µé¢é…ç½®</li><li>Post Front-matter ç”¨äºæ–‡ç« é¡µé…ç½®</li></ol><h5 id="Page-Front-matter"><a href="#Page-Front-matter" class="headerlink" title="Page Front-matter"></a>Page Front-matter</h5><div class="table-container"><table><thead><tr><th style="text-align:center">å†™æ³•</th><th style="text-align:center">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:center">title</td><td style="text-align:center">ã€å¿…éœ€ã€‘é¡µé¢æ ‡é¢˜</td></tr><tr><td style="text-align:center">date</td><td style="text-align:center">ã€å¿…éœ€ã€‘é¡µé¢åˆ›å»ºæ—¥æœŸ</td></tr><tr><td style="text-align:center">type</td><td style="text-align:center">ã€å¿…éœ€ã€‘æ ‡ç±¤ã€åˆ†ç±»å’Œå‹æƒ…é“¾æ¥ä¸‰ä¸ªé¡µé¢éœ€è¦é…ç½®</td></tr><tr><td style="text-align:center">updated</td><td style="text-align:center">ã€å¯é€‰ã€‘é¡µé¢æ›´æ–°æ—¥æœŸ</td></tr><tr><td style="text-align:center">description</td><td style="text-align:center">ã€å¯é€‰ã€‘é¡µé¢æè¿°</td></tr><tr><td style="text-align:center">keywords</td><td style="text-align:center">ã€å¯é€‰ã€‘é¡µé¢å…³é”®å­—</td></tr><tr><td style="text-align:center">comments</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤ºé¡µé¢è¯„è®ºæ¨¡å— (é»˜è®¤ true)</td></tr><tr><td style="text-align:center">top_img</td><td style="text-align:center">ã€å¯é€‰ã€‘é¡µé¢é¡¶éƒ¨å›¾ç‰‡</td></tr><tr><td style="text-align:center">mathjax</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤º mathjax (å½“è®¾ç½® mathjax çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false)</td></tr><tr><td style="text-align:center">kates</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤º katex (å½“è®¾ç½® katex çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false)</td></tr><tr><td style="text-align:center">aside</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤ºä¾§è¾¹æ  (é»˜è®¤ true)</td></tr><tr><td style="text-align:center">aplayer</td><td style="text-align:center">ã€å¯é€‰ã€‘åœ¨éœ€è¦çš„é¡µé¢åŠ è½½ aplayer çš„ js å’Œ css, å‚è€ƒéŸ³ä¹é…ç½®</td></tr><tr><td style="text-align:center">highlight_shrink</td><td style="text-align:center">ã€å¯é€‰ã€‘é…ç½®ä»£ç æ¡†æ˜¯å¦å±•å¼€ (true/false)(é»˜è®¤ä¸ºè®¾ç½®ä¸­ highlight_shrink çš„é…ç½®)</td></tr></tbody></table></div><h5 id="Post-Front-matter"><a href="#Post-Front-matter" class="headerlink" title="Post Front-matter"></a>Post Front-matter</h5><div class="table-container"><table><thead><tr><th style="text-align:center">å†™æ³•</th><th style="text-align:center">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:center">title</td><td style="text-align:center">ã€å¿…éœ€ã€‘æ–‡ç« æ ‡é¢˜</td></tr><tr><td style="text-align:center">date</td><td style="text-align:center">ã€å¿…éœ€ã€‘æ–‡ç« åˆ›å»ºæ—¥æœŸ</td></tr><tr><td style="text-align:center">updated</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« æ›´æ–°æ—¥æœŸ</td></tr><tr><td style="text-align:center">tags</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« æ ‡ç±¤</td></tr><tr><td style="text-align:center">categories</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« åˆ†ç±»</td></tr><tr><td style="text-align:center">keywords</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« å…³é”®å­—</td></tr><tr><td style="text-align:center">description</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« æè¿°</td></tr><tr><td style="text-align:center">top_img</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« é¡¶éƒ¨å›¾ç‰‡</td></tr><tr><td style="text-align:center">cover</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« ç¼©ç•¥å›¾ (å¦‚æœæ²¡æœ‰è®¾ç½® top_img, æ–‡ç« é¡µé¡¶éƒ¨å°†æ˜¾ç¤ºç¼©ç•¥å›¾ï¼Œå¯è®¾ä¸º false / å›¾ç‰‡åœ°å€ / ç•™ç©º)</td></tr><tr><td style="text-align:center">comments</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« è¯„è®ºæ¨¡å— (é»˜è®¤ true)</td></tr><tr><td style="text-align:center">toc</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç«  TOC (é»˜è®¤ä¸ºè®¾ç½®ä¸­ toc çš„ enable é…ç½®)</td></tr><tr><td style="text-align:center">toc_number</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤º toc_number (é»˜è®¤ä¸ºè®¾ç½®ä¸­ toc çš„ number é…ç½®)</td></tr><tr><td style="text-align:center">toc_style_simple</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤º toc ç®€æ´æ¨¡å¼</td></tr><tr><td style="text-align:center">copyright</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤ºæ–‡ç« ç‰ˆæƒæ¨¡å— (é»˜è®¤ä¸ºè®¾ç½®ä¸­ post_copyright çš„ enable é…ç½®)</td></tr><tr><td style="text-align:center">copyright_author</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« ä½œè€…</td></tr><tr><td style="text-align:center">copyright_author_href</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« ä½œè€…é“¾æ¥</td></tr><tr><td style="text-align:center">copyright_url</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„æ–‡ç« è¿ç»“é“¾æ¥</td></tr><tr><td style="text-align:center">copyright_info</td><td style="text-align:center">ã€å¯é€‰ã€‘æ–‡ç« ç‰ˆæƒæ¨¡å—çš„ç‰ˆæƒå£°æ˜æ–‡å­—</td></tr><tr><td style="text-align:center">mathjax</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤º mathjax (å½“è®¾ç½® mathjax çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false)</td></tr><tr><td style="text-align:center">katex</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤º katex (å½“è®¾ç½® katex çš„ per_page: false æ—¶ï¼Œæ‰éœ€è¦é…ç½®ï¼Œé»˜è®¤ false)</td></tr><tr><td style="text-align:center">aplayer</td><td style="text-align:center">ã€å¯é€‰ã€‘åœ¨éœ€è¦çš„é¡µé¢åŠ è½½ aplayer çš„ js å’Œ css, è¯·å‚è€ƒæ–‡ç« ä¸‹é¢çš„éŸ³ä¹ é…ç½®</td></tr><tr><td style="text-align:center">highlight_shrink</td><td style="text-align:center">ã€å¯é€‰ã€‘é…ç½®ä»£ç æ¡†æ˜¯å¦å±•å¼€ (true/false)(é»˜è®¤ä¸ºè®¾ç½®ä¸­ highlight_shrink çš„é…ç½®)</td></tr><tr><td style="text-align:center">aside</td><td style="text-align:center">ã€å¯é€‰ã€‘æ˜¾ç¤ºä¾§è¾¹æ  (é»˜è®¤ true)</td></tr><tr><td style="text-align:center">sticky</td><td style="text-align:center">ã€æ–‡ç« ç½®é¡¶åŠŸèƒ½è®¾ç½® æŒ‰æ•°å­—åˆ¤å®šè¶Šå¤§è¶Šé å‰ã€‘</td></tr><tr><td style="text-align:center">copyright</td><td style="text-align:center">ã€å¯é€‰ã€‘è¡¨ç¤ºè¿™æ˜¯å¦å¯ä»¥è¢«è½¬è½½ï¼ˆfalse or trueï¼‰</td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> first </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ªäººä½¿ç”¨markdownæŒ‡å—</title>
      <link href="/posts/1577303690.html"/>
      <url>/posts/1577303690.html</url>
      
        <content type="html"><![CDATA[<h1 id="è¿™æ˜¯å¦ä¸€é‡æ„ä¹‰ä¸Šçš„-Myfirst-Article-å‡ ä¸ª-å°±ä»£è¡¨æ˜¯å‡ çº§æ ‡é¢˜"><a href="#è¿™æ˜¯å¦ä¸€é‡æ„ä¹‰ä¸Šçš„-Myfirst-Article-å‡ ä¸ª-å°±ä»£è¡¨æ˜¯å‡ çº§æ ‡é¢˜" class="headerlink" title="è¿™æ˜¯å¦ä¸€é‡æ„ä¹‰ä¸Šçš„ Myfirst-Article å‡ ä¸ª#å°±ä»£è¡¨æ˜¯å‡ çº§æ ‡é¢˜"></a>è¿™æ˜¯å¦ä¸€é‡æ„ä¹‰ä¸Šçš„ Myfirst-Article å‡ ä¸ª#å°±ä»£è¡¨æ˜¯å‡ çº§æ ‡é¢˜</h1><h2 id="è¿™æ˜¯å°ä¸€ç‚¹çš„"><a href="#è¿™æ˜¯å°ä¸€ç‚¹çš„" class="headerlink" title="è¿™æ˜¯å°ä¸€ç‚¹çš„"></a>è¿™æ˜¯å°ä¸€ç‚¹çš„</h2><p>æ­£æ–‡åœ¨è¿™ï¼Œæ¢è¡Œä½†æ˜¯ä¸æ–°èµ·ä¸€æ®µï¼Ÿ ä¸¤ä¸ªç©ºæ ¼åœ¨è¿™ä¸ªæœ«å°¾<br> æ¢è¡Œäº†<br>è¿™æ˜¯æ¢æ®µäº†<br>å¦‚ä½•å¼ºè°ƒ <strong>ä½ å¥½</strong> <em>å˜æ–œ</em><br>æœ‰åºåˆ—è¡¨</p><ol><li>æ•°å­—åŠ ç‚¹å’Œä¸€ä¸ªç©ºæ ¼</li><li>å¯ä»¥è‡ªåŠ¨ç»­å†™<ol><li>æŒ‰ tab å¯ä»¥è‡ªåŠ¨å˜æˆå­çº§</li><li>hh</li></ol></li><li>æ˜æ˜¾ç»­å†™<br>æ— åºåˆ—è¡¨</li></ol><h3 id="è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜"><a href="#è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜" class="headerlink" title="è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜"></a>è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜</h3><p>å¦‚ä½•å¿«é€Ÿæ·»åŠ imageï¼ˆéœ€è¦æ·»åŠ æ’ä»¶â€”-paste imageï¼‰</p><ol><li>ç›´æ¥ç²˜è´´ such as (ç²˜è´´ä½¿ç”¨çš„è¦æ¯”æ™®é€šçš„ç²˜è´´å¤šä¸€ä¸ª Alt å³ Ctrl+Alt+V)<br> ps.è¿™ç‚¹ä¸èƒ½å¿½ç•¥ï¼Œå¦åˆ™åƒæˆ‘ä¸€ä¸ªæœ‹å‹å°±ä»¥ä¸ºæ˜¯æ’ä»¶å‡ºç°äº†é—®é¢˜<br><img src="https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/2022-11-01-21-03-15.png" alt=""><br><em>windows çš„æˆªå›¾ä¹Ÿå¯</em></li><li>å°†å›¾ç‰‡æ”¾å…¥åŒçº§åˆ«ç›®å½•ä¸‹å³å¯</li></ol><script type="math/tex; mode=display">å°±æ˜¯åœ¨ä¸€æ®µæ–‡å­—ä¸­ä¹Ÿå¯ä»¥è¿›è¡Œ\lambdaæ’å…¥\lim_{sin(x)}(t)=1</script><h2 id="è¡¨æ ¼çš„å†™æ³•"><a href="#è¡¨æ ¼çš„å†™æ³•" class="headerlink" title="è¡¨æ ¼çš„å†™æ³•"></a>è¡¨æ ¼çš„å†™æ³•</h2><p>ç¬¬äºŒè¡Œçš„æ˜¯æ ‡å¿—æˆä¸ºä¸€ä¸ªè¡¨æ ¼ï¼ˆä½¿ç”¨ï¼šå¯ä»¥ä½¿å…¶å±…ä¸­ï¼‰<br><em>è¿™ä¸ªæ ¼å¼åªéœ€è¦å†™ä¸€æ¬¡ï¼Œæ˜¯ä¸ºäº†æ ‡æ³¨æ˜¯æŒ‰ç…§ä»€ä¹ˆæ–¹å¼æ¥è¿›è¡Œå¯¹é½çš„</em><br>| åºå· | å§“å | å¹´é¾„ |<br>| :â€”â€”: |:-: | :â€”â€”: |<br>| 1 | å°æ˜ | 12 |</p><p>åœ¨è¿™é‡Œå¯èƒ½è‡ªå·±ç‹¬ç«‹ç¼–å†™çš„æ—¶å€™å°±ä¼šçœ‹ç€æœ‰ç‚¹ä¸èˆ’æœäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚ä½•æ ¼å¼åŒ–ï¼Ÿ<br>æŒ‰ä½ Alt+Shift+F å³å¯å¿«é€Ÿå®ç°æ ¼å¼åŒ–</p><h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><p>è¿™æ˜¯ä¸€ä¸ªé“¾æ¥ï¼ˆç›´æ¥ç²˜è´´å³å¯ï¼‰éœ€è¦é€‰ä¸­<a href="https://www.bilibili.com/">æ–‡å­—</a>è‡ªåŠ¨è¯†åˆ«</p><h2 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h2><p><em>ä½¿ç”¨çš„è¯­è¨€è¦ä½¿ç”¨```æ¥è¡¨ç¤º</em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&quot;æ¸²æŸ“é«˜äº®éœ€è¦æŒ‡å®šè¯­è¨€&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³è¦æ›´åŠ ä¸“æ³¨çš„é£æ ¼å¯ä»¥æ•™ä½ ä¸€ä¸ªå° tips æŒ‰ä½ Ctrl+K æ¾å¼€ç„¶åæŒ‰ä¸‹ Z å³å¯è¿›å…¥ zen mode<br>ï¼ˆæ³¨æ„æ˜¯è‹±æ–‡è¾“å…¥æ³•çš„çŠ¶æ€ä¸‹ï¼‰é€€å‡ºæ—¶æŒ‰ä¸¤ä¸‹ Esc</p><h5 id="è¿™ç¬¬ä¸€ç¯‡æ–‡ç« å°±è¿™ä¹ˆç»“æŸå•¦ï¼Œè¿™æ˜¯æˆ‘çš„ä¸€ç¯‡è®°å½•ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¯ä»¥å­¦åˆ°æœ‰ç”¨çš„ä¸œè¥¿"><a href="#è¿™ç¬¬ä¸€ç¯‡æ–‡ç« å°±è¿™ä¹ˆç»“æŸå•¦ï¼Œè¿™æ˜¯æˆ‘çš„ä¸€ç¯‡è®°å½•ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¯ä»¥å­¦åˆ°æœ‰ç”¨çš„ä¸œè¥¿" class="headerlink" title="è¿™ç¬¬ä¸€ç¯‡æ–‡ç« å°±è¿™ä¹ˆç»“æŸå•¦ï¼Œè¿™æ˜¯æˆ‘çš„ä¸€ç¯‡è®°å½•ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¯ä»¥å­¦åˆ°æœ‰ç”¨çš„ä¸œè¥¿~~"></a>è¿™ç¬¬ä¸€ç¯‡æ–‡ç« å°±è¿™ä¹ˆç»“æŸå•¦ï¼Œè¿™æ˜¯æˆ‘çš„ä¸€ç¯‡è®°å½•ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¯ä»¥å­¦åˆ°æœ‰ç”¨çš„ä¸œè¥¿~~</h5><p><em>ï¼ˆè®°ä½ç¬”è®°çš„ç›®çš„æ˜¯è¦ä¸“æ³¨äºè‡ªå·±çš„å†…å®¹ï¼Œè€Œä¸æ˜¯è‡ªå·±çš„æ ¼å¼ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨ markdown çš„åŸå› ä¸æ˜¯å—ï¼‰</em></p>]]></content>
      
      
      <categories>
          
          <category> mdæŒ‡å— </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>åˆ†ç±»</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<!-- GitCalendarå®¹å™¨ --><div id="gitZone"></div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/fit.css"/>
      <url>/css/fit.css</url>
      
        <content type="html"><![CDATA[/* é¡µè„šä¸å¤´å›¾é€æ˜ */#footer {    background: transparent !important;  }  #page-header {    background: transparent !important;  }    /* ç™½å¤©æ¨¡å¼é®ç½©é€æ˜ */  #footer::before {    background: transparent !important;  }  #page-header::before {    background: transparent !important;  }    /* å¤œé—´æ¨¡å¼é®ç½©é€æ˜ */  [data-theme="dark"] #footer::before {    background: transparent !important;  }  [data-theme="dark"] #page-header::before {    background: transparent !important;  }  body {    cursor: url(https://bu.dusays.com/2022/05/17/6283c365d20dd.png), auto;}.hide-block>.hide-button.open,.hide-inline>.hide-button.open {    display: block}a,button,img {    cursor: url(https://bu.dusays.com/2022/05/17/6283c376afcfc.png), auto}/* ä¾§è¾¹æ ä¸ªäººä¿¡æ¯å¡ç‰‡åŠ¨æ€æ¸å˜è‰² */#aside-content > .card-widget.card-info {  background: linear-gradient(    -45deg,    #e8d8b9,    #eccec5,    #a3e9eb,    #bdbdf0,    #eec1ea  );  box-shadow: 0 0 5px rgb(66, 68, 68);  position: relative;  background-size: 400% 400%;  -webkit-animation: Gradient 10s ease infinite;  -moz-animation: Gradient 10s ease infinite;  animation: Gradient 10s ease infinite !important;}@-webkit-keyframes Gradient {  0% {    background-position: 0% 50%;  }  50% {    background-position: 100% 50%;  }  100% {    background-position: 0% 50%;  }}@-moz-keyframes Gradient {  0% {    background-position: 0% 50%;  }  50% {    background-position: 100% 50%;  }  100% {    background-position: 0% 50%;  }}@keyframes Gradient {  0% {    background-position: 0% 50%;  }  50% {    background-position: 100% 50%;  }  100% {    background-position: 0% 50%;  }}/* è®¾ç½®å¯¹åº”å¤œæ™šåˆ‡æ¢ */[data-theme="dark"] #aside-content .card-widget {  background: rgba(25, 25, 25, 0.88);}/* ä¸ªäººä¿¡æ¯Follow meæŒ‰é’® */#aside-content > .card-widget.card-info > #card-info-btn {  background-color: #3eb8be;  border-radius: 8px;}/*å“”å“©å“”å“©è§†é¢‘é€‚é…*/.aspect-ratio {  position: relative;  width: 90%;  height: auto;  padding-bottom: 75%;  margin: 3% auto;  text-align: center;}.aspect-ratio iframe {  position: absolute;  width: 100%;  height: 86%;  left: 0;  top: 0;}/* æ–‡ç« é¡µH1-H6å›¾æ ‡æ ·å¼æ•ˆæœ *//* æ§åˆ¶é£è½¦è½¬åŠ¨é€Ÿåº¦ 4sé‚£é‡Œå¯ä»¥è‡ªå·±è°ƒèŠ‚å¿«æ…¢ */h1::before,h2::before,h3::before,h4::before,h5::before,h6::before {  -webkit-animation: ccc 4s linear infinite;  animation: ccc 4s linear infinite;}/* æ§åˆ¶é£è½¦è½¬åŠ¨æ–¹å‘ -1turn ä¸ºé€†æ—¶é’ˆè½¬åŠ¨ï¼Œ1turn ä¸ºé¡ºæ—¶é’ˆè½¬åŠ¨ï¼Œç›¸åŒæ•°å­—éƒ¨åˆ†è®°å¾—ç»Ÿä¸€ä¿®æ”¹ */@-webkit-keyframes ccc {  0% {    -webkit-transform: rotate(0deg);    transform: rotate(0deg);  }  to {    -webkit-transform: rotate(-1turn);    transform: rotate(-1turn);  }}@keyframes ccc {  0% {    -webkit-transform: rotate(0deg);    transform: rotate(0deg);  }  to {    -webkit-transform: rotate(-1turn);    transform: rotate(-1turn);  }}/* è®¾ç½®é£è½¦é¢œè‰² */#content-inner.layout h1::before {  color: #ef50a8;  margin-left: -1.55rem;  font-size: 1.3rem;  margin-top: -0.23rem;}#content-inner.layout h2::before {  color: #fb7061;  margin-left: -1.35rem;  font-size: 1.1rem;  margin-top: -0.12rem;}#content-inner.layout h3::before {  color: #ffbf00;  margin-left: -1.22rem;  font-size: 0.95rem;  margin-top: -0.09rem;}#content-inner.layout h4::before {  color: #a9e000;  margin-left: -1.05rem;  font-size: 0.8rem;  margin-top: -0.09rem;}#content-inner.layout h5::before {  color: #57c850;  margin-left: -0.9rem;  font-size: 0.7rem;  margin-top: 0rem;}#content-inner.layout h6::before {  color: #5ec1e0;  margin-left: -0.9rem;  font-size: 0.66rem;  margin-top: 0rem;}/* sè®¾ç½®é£è½¦hoveråŠ¨æ•ˆ 6sé‚£é‡Œå¯ä»¥è‡ªå·±è°ƒèŠ‚å¿«æ…¢*/#content-inner.layout h1:hover,#content-inner.layout h2:hover,#content-inner.layout h3:hover,#content-inner.layout h4:hover,#content-inner.layout h5:hover,#content-inner.layout h6:hover {  color: var(--theme-color);}#content-inner.layout h1:hover::before,#content-inner.layout h2:hover::before,#content-inner.layout h3:hover::before,#content-inner.layout h4:hover::before,#content-inner.layout h5:hover::before,#content-inner.layout h6:hover::before {  color: var(--theme-color);  -webkit-animation: ccc 6s linear infinite;  animation: ccc 6s linear infinite;}.foo {  --theme-color: rgb(118,215,234);}/* æ·»åŠ é¡¶éƒ¨æ¡ æºç  https://xlenco.eu.org/posts/769f.html */.pace {  pointer-events: none;  user-select: none;  z-index: 2;  position: fixed;  margin: auto;  top: 4px;  left: 0;  right: 0;  height: 8px;  border-radius: 8px;  width: 6rem;  background: #eaecf2;  overflow: hidden;}.pace-inactive .pace-progress {  opacity: 0;  transition: 0.3s ease-in;}.pace.pace-inactive {  opacity: 0;  transition: 0.3s;  top: -8px;}.pace .pace-progress {  box-sizing: border-box;  transform: translate3d(0, 0, 0);  position: fixed;  z-index: 2;  display: block;  position: absolute;  top: 0;  right: 100%;  height: 100%;  width: 100%;  background: #49b1f5;  background: linear-gradient(    to right,    rgb(18, 194, 233),    rgb(196, 113, 237),    rgb(246, 79, 89)  );  animation: gradient 2s ease infinite;  background-size: 200%;}/* å›¾ç‰‡æ¨¡ç³Šæ¸å˜æ¸…æ™° *//*4sä¸ºåŠ è½½åŠ¨ç”»çš„æ—¶é—´ï¼Œ1ä¸ºåŠ è½½åŠ¨ç”»çš„æ¬¡æ•°ï¼Œease-in-outä¸ºåŠ¨ç”»æ•ˆæœ*/#page-header,#web_bg {  -webkit-animation: imgblur 4s 1 ease-in-out;  animation: imgblur 4s 1 ease-in-out;}@keyframes imgblur {  0% {    filter: blur(5px);  }  100% {    filter: blur(0px);  }}/*é€‚é…ä½¿ç”¨-webkitå†…æ ¸çš„æµè§ˆå™¨ */@-webkit-keyframes imgblur {  0% {    -webkit-filter: blur(5px);  }  100% {    -webkit-filter: blur(0px);  }}/* å­—ä½“è®¾ç½® */@font-face {  /* ä¸ºè½½å…¥çš„å­—ä½“å–åå­—(éšæ„) */  font-family: 'YSHST';  /* å­—ä½“æ–‡ä»¶åœ°å€(ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„éƒ½å¯ä»¥) */  src: url(/font/ä¼˜è®¾å¥½èº«ä½“.woff2);  /* å®šä¹‰åŠ ç²—æ ·å¼(åŠ ç²—å¤šå°‘) */  font-weight: normal;  /* å®šä¹‰å­—ä½“æ ·å¼(æ–œä½“/éæ–œä½“) */  font-style: normal;  /* å®šä¹‰æ˜¾ç¤ºæ ·å¼ */  font-display: block;}@font-face {  /* ä¸ºè½½å…¥çš„å­—ä½“å–åå­—(éšæ„) */  font-family: 'gzAw';  /* å­—ä½“æ–‡ä»¶åœ°å€(ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„éƒ½å¯ä»¥) */  src: url(/font/ç­‘ç´«Aä¸¸byå®é™ä¹‹é›¨.woff2);  /* å®šä¹‰åŠ ç²—æ ·å¼(åŠ ç²—å¤šå°‘) */  font-weight: normal;  /* å®šä¹‰å­—ä½“æ ·å¼(æ–œä½“/éæ–œä½“) */  font-style: normal;  /* å®šä¹‰æ˜¾ç¤ºæ ·å¼ */  font-display: block;}/* ç¿»é¡µæŒ‰é’®å±…ä¸­ */#pagination {  width: 100%;  margin: auto;}/* ä¸€çº§èœå•å±…ä¸­ */#nav .menus_items {  position: absolute !important;  width: fit-content !important;  left: 50% !important;  transform: translateX(-50%) !important;}/* å­èœå•æ¨ªå‘å±•ç¤º */#nav .menus_items .menus_item:hover .menus_item_child {  display: flex !important;}/* è¿™é‡Œçš„2æ˜¯ä»£è¡¨å¯¼èˆªæ çš„ç¬¬2ä¸ªå…ƒç´ ï¼Œå³æœ‰å­èœå•çš„å…ƒç´ ï¼Œå¯ä»¥æŒ‰è‡ªå·±éœ€æ±‚ä¿®æ”¹ */.menus_items .menus_item:nth-child(5) .menus_item_child {  left: -38px;}.menus_items .menus_item:nth-child(8) .menus_item_child {  left: -38px;}/* å¤œé—´æ¨¡å¼èœå•æ å‘å…‰å­— */[data-theme="dark"] #nav .site-page,[data-theme="dark"] #nav .menus_items .menus_item .menus_item_child li a {  text-shadow: 0 0 2px rgb(135,206,250) !important;}/* æ‰‹æœºç«¯é€‚é… */[data-theme="dark"] #sidebar #sidebar-menus .menus_items .site-page {  text-shadow: 0 0 2px rgb(179, 71, 241) !important;}/* æ–‡ç« å¡ç‰‡ */#recent-posts > .recent-post-item .post_cover {  height: 240px !important;}/* è‡ªå®šä¹‰è¡¨æƒ…ä¼˜åŒ– */#twikoo .OwO-body {  max-width: 100% !important;}#twikoo .OwO .OwO-body .OwO-items:nth-child(3),#twikoo .OwO .OwO-body .OwO-items:nth-child(4) {  max-height: 270px !important;}.OwO .OwO-body .OwO-items-image .OwO-item {  max-width: calc(12% - 8px);}#twikoo .OwO-items li[title|="Menhera"] img,#twikoo .OwO-items li[title|="Snow"] img {  width: 100% !important;}.tk-comment .vemoji[alt|="Menhera"],.tk-comment .tk-owo-emotion[alt*="Menhera"],.tk-comment .vemoji[alt|="Snow"],.tk-comment .tk-owo-emotion[alt*="Snow"] {  max-width: 150px !important;  max-height: 150px !important;  width: 150px;  margin: 8px 1px;  display: block !important;}@media screen and (max-width: 768px) {  .tk-comment .vemoji[alt|="Menhera"],  .tk-comment .tk-owo-emotion[alt*="Menhera"],  .tk-comment .vemoji[alt|="Snow"],  .tk-comment .tk-owo-emotion[alt*="Snow"] {    max-width: calc(100% - 30px) !important;    max-height: calc(100% - 30px) !important;  }  .OwO .OwO-body .OwO-items-image .OwO-item[title*="Menhera"],  .OwO .OwO-body .OwO-items-image .OwO-item[title*="Snow"] {    max-width: calc(50% - 10px);    box-sizing: border-box;  }}/* ç”±äºå…¨å±ä¼šå‡ºbugï¼Œæ‰€ä»¥ç›´æ¥ç»™ä»–éšè— */.winbox {  border-radius: 12px;  overflow: hidden;}.wb-full {  display: none;}.wb-min {  background-position: center;}[data-theme='dark'] .wb-body,[data-theme='dark'] #changeBgBox {  background: #333 !important;}.bgbox {  display: flex;  flex-wrap: wrap;  justify-content: space-between;}.pimgbox,.imgbox,.box {  width: 166px;  margin: 10px;  background-size: cover}.pimgbox,.imgbox {  border-radius: 10px;  overflow: hidden;}.pimgbox {  height: 240px;}.imgbox {  height: 95px;}.box {  height: 100px;}/* è€ç”¨æˆ·å¦‚æœä¸å†ä½¿ç”¨é¡µé¢ç‰ˆå¯åˆ é™¤ä¸‹é¢ä»£ç  *//* #color {  border: none;  background: transparent;  width: 166px;  height: 110px;  margin: 5px 10px;  position: relative;  cursor: pointer;}#color::before {  position: absolute;  color: rgb(255, 255, 255);  left: 38px;  top: 44px;  content: 'è‡ªå®šä¹‰é¢œè‰²';} */@media screen and (max-width: 768px) {  /* èƒŒæ™¯ */  .pimgbox,  .imgbox,  .box {      height: 73px;      width: 135px;  }  .pimgbox {      height: 205px;  }  /* è€ç”¨æˆ·å¦‚æœä¸å†ä½¿ç”¨é¡µé¢ç‰ˆå¯åˆ é™¤ä¸‹é¢ä»£ç  */  /* #color {      width: 141px;      height: 83px;      margin: 7px;  }  #color::before {      left: 33px;      top: 33px;  }     */  /* 2.0æ–°å¢å†…å®¹ */      .wb-min {      display: none;  }  #changeBgBox .wb-body::-webkit-scrollbar {      display: none;  }}/* å‹é“¾é€‚é… *//* å¤´åƒå¾®è°ƒ */.flink-item-icon {  margin-right: 0 !important;  transition: .5s !important;}.flink-item-name,.flink-item-desc {  padding-left: 10px !important;}/* å»æ‰åŸæ¥è‡ªå¸¦çš„before */#article-container .flink .flink-list>.flink-list-item::before {  content: none;}/* é¼ æ ‡ç»è¿‡æ”¹å˜èƒŒæ™¯ */#article-container .flink .flink-list>.flink-list-item:hover {  background-color: #61bcf2cc;  box-shadow: 0 0 20px rgba(0, 0, 0, .3);}/* é¼ æ ‡ç»è¿‡æ”¹å˜æ–‡å­—é¢œè‰² */#article-container .flink .flink-list>.flink-list-item:hover a {  color: white !important;}/* é¼ æ ‡ç»è¿‡å¤´åƒæ»šåŠ¨ */#article-container .flink .flink-list>.flink-list-item:hover .flink-item-icon {  width: 60px;  margin-left: -70px;  -webkit-transform: rotate(-180deg);  -moz-transform: rotate(-180deg);  -o-transform: rotate(-180deg);  -ms-transform: rotate(-180deg);  transform: rotate(-180deg);}/* å¡ç‰‡èƒŒæ™¯æ·»åŠ å›¾ç‰‡ *//* #aside-content > .card-widget.card-info {  background-image: url(https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/pp2.png) !important;  background-repeat: no-repeat !important;  background-attachment: inherit !important;  background-size: 100% !important;} *//* åŠ è½½å›¾ç‰‡è®¾ç½® */.loading-img {  background: url(https://cdn.jsdelivr.net/gh/m2qian/owndraw/img/12.webp) no-repeat center center;  background-size: cover;}/* æ–‡ç« é¡µåŠé€æ˜ */div#post {  background: #ffffffee}[data-theme="dark"] div#post {  background: #191919ee}/* æœ‰åºåˆ—è¡¨æ·»åŠ æ—‹è½¬æ•ˆæœ */#article-container ol li:hover:before{-webkit-transform: rotate(360deg);-moz-transform: rotate(360deg);-o-transform: rotate(360deg);-ms-transform: rotate(360deg);transform: rotate(360deg)}/* loadingæ ·å¼ */.loading-img {  background: url(https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301221930003.webp) no-repeat center center;  background-size: cover;}/* æ—¥é—´æ¨¡å¼ä¸ç”Ÿæ•ˆ */[data-theme="light"] #site-name,[data-theme="light"] #site-title,[data-theme="light"] #site-subtitle,[data-theme="light"] #post-info {  animation: none;}/* å¤œé—´æ¨¡å¼ç”Ÿæ•ˆ */[data-theme="dark"] #site-name,[data-theme="dark"] #site-title {  animation: light_15px 10s linear infinite;}[data-theme="dark"] #site-subtitle {  animation: light_10px 10s linear infinite;}[data-theme="dark"] #post-info {  animation: light_5px 10s linear infinite;}/* å…³é”®å¸§æè¿° */@keyframes light_15px {  0% {    text-shadow: #5636ed 0 0 15px;  }  12.5% {    text-shadow: #11ee5e 0 0 15px;  }  25% {    text-shadow: #f14747 0 0 15px;  }  37.5% {    text-shadow: #f1a247 0 0 15px;  }  50% {    text-shadow: #f1ee47 0 0 15px;  }  50% {    text-shadow: #b347f1 0 0 15px;  }  62.5% {    text-shadow: #002afa 0 0 15px;  }  75% {    text-shadow: #ed709b 0 0 15px;  }  87.5% {    text-shadow: #39c5bb 0 0 15px;  }  100% {    text-shadow: #5636ed 0 0 15px;  }}@keyframes light_10px {  0% {    text-shadow: #5636ed 0 0 10px;  }  12.5% {    text-shadow: #11ee5e 0 0 10px;  }  25% {    text-shadow: #f14747 0 0 10px;  }  37.5% {    text-shadow: #f1a247 0 0 10px;  }  50% {    text-shadow: #f1ee47 0 0 10px;  }  50% {    text-shadow: #b347f1 0 0 10px;  }  62.5% {    text-shadow: #002afa 0 0 10px;  }  75% {    text-shadow: #ed709b 0 0 10px;  }  87.5% {    text-shadow: #39c5bb 0 0 10px;  }  100% {    text-shadow: #5636ed 0 0 10px;  }}@keyframes light_5px {  0% {    text-shadow: #5636ed 0 0 5px;  }  12.5% {    text-shadow: #11ee5e 0 0 5px;  }  25% {    text-shadow: #f14747 0 0 5px;  }  37.5% {    text-shadow: #f1a247 0 0 15px;  }  50% {    text-shadow: #f1ee47 0 0 5px;  }  50% {    text-shadow: #b347f1 0 0 5px;  }  62.5% {    text-shadow: #002afa 0 0 5px;  }  75% {    text-shadow: #ed709b 0 0 5px;  }  87.5% {    text-shadow: #39c5bb 0 0 5px;  }  100% {    text-shadow: #5636ed 0 0 5px;  }}/* æ³¢æµªcss */.main-hero-waves-area {  width: 100%;  position: absolute;  left: 0;  bottom: -11px;  z-index: 5;}.waves-area .waves-svg {  width: 100%;  height: 5rem;}/* Animation */.parallax > use {  animation: move-forever 25s cubic-bezier(0.55, 0.5, 0.45, 0.5) infinite;}.parallax > use:nth-child(1) {  animation-delay: -2s;  animation-duration: 7s;  fill: #f7f9febd;}.parallax > use:nth-child(2) {  animation-delay: -3s;  animation-duration: 10s;  fill: #f7f9fe82;}.parallax > use:nth-child(3) {  animation-delay: -4s;  animation-duration: 13s;  fill: #f7f9fe36;}.parallax > use:nth-child(4) {  animation-delay: -5s;  animation-duration: 20s;  fill: #f7f9fe;}/* é»‘è‰²æ¨¡å¼èƒŒæ™¯ */[data-theme="dark"] .parallax > use:nth-child(1) {  animation-delay: -2s;  animation-duration: 7s;  fill: #18171dc8;}[data-theme="dark"] .parallax > use:nth-child(2) {  animation-delay: -3s;  animation-duration: 10s;  fill: #18171d80;}[data-theme="dark"] .parallax > use:nth-child(3) {  animation-delay: -4s;  animation-duration: 13s;  fill: #18171d3e;}[data-theme="dark"] .parallax > use:nth-child(4) {  animation-delay: -5s;  animation-duration: 20s;  fill: #18171d;}@keyframes move-forever {  0% {    transform: translate3d(-90px, 0, 0);  }  100% {    transform: translate3d(85px, 0, 0);  }}/*Shrinking for mobile*/@media (max-width: 768px) {  .waves-area .waves-svg {    height: 40px;    min-height: 40px;  }}/* æ ‡é¢˜å¢å¼º */#site-name::before {  opacity: 0;  background-color: var(--theme-color) !important;  border-radius: 8px;  -webkit-border-radius: 8px;  -moz-border-radius: 8px;  -ms-border-radius: 8px;  -o-border-radius: 8px;  transition: 0.3s;  -webkit-transition: 0.3s;  -moz-transition: 0.3s;  -ms-transition: 0.3s;  -o-transition: 0.3s;  position: absolute;  top: 0 !important;  right: 0 !important;  width: 100%;  height: 100%;  content: "\f015";  box-shadow: 0 0 5px var(--theme-color);  font-family: "Font Awesome 6 Free";  text-align: center;  color: white;  line-height: 34px; /*å¦‚æœæœ‰æº¢å‡ºæˆ–è€…å‚ç›´ä¸å±…ä¸­çš„ç°è±¡å¾®è°ƒä¸€ä¸‹è¿™ä¸ªå‚æ•°*/  font-size: 18px; /*æ ¹æ®ä¸ªäººå–œå¥½*/}#site-name:hover::before {  opacity: 1;  scale: 1.03;}#site-name {  position: relative;  font-size: 24px; /*ä¸€å®šè¦æŠŠå­—ä½“è°ƒå¤§ç‚¹ï¼Œå¦åˆ™æ•ˆæœæƒ¨ä¸å¿ç¹ï¼*/}.nav-fixed #nav{  transform: translateY(58px)!important;  -webkit-transform: translateY(58px)!important;  -moz-transform: translateY(58px)!important;  -ms-transform: translateY(58px)!important;  -o-transform: translateY(58px)!important;}#nav{  transition: none!important;  -webkit-transition: none!important;  -moz-transition: none!important;  -ms-transition: none!important;  -o-transition: none!important;}/* å¯¼èˆªæ æ˜¾ç¤ºæ ‡é¢˜ */#page-name::before {  font-size: 18px;  position: absolute;  width: 100%;  height: 100%;  border-radius: 8px;  color: white !important;  top: 0;  left: 0;  content: "å›åˆ°é¡¶éƒ¨";  background-color: var(rgb(118,215,234));  transition: all 0.3s;  -webkit-transition: all 0.3s;  -moz-transition: all 0.3s;  -ms-transition: all 0.3s;  -o-transition: all 0.3s;  opacity: 0;  box-shadow: 0 0 3px var(rgb(118,215,234));  line-height: 45px; /*å¦‚æœå‚ç›´ä½ç½®ä¸å±…ä¸­å¯ä»¥å¾®è°ƒæ­¤å€¼ï¼Œä¹Ÿå¯ä»¥åˆ äº†*/}#page-name:hover:before {  opacity: 1;}#name-container {  transition: all 0.3s;  -webkit-transition: all 0.3s;  -moz-transition: all 0.3s;  -ms-transition: all 0.3s;  -o-transition: all 0.3s;}#name-container:hover {  scale: 1.03;}#page-name {  position: relative;  padding: 10px 30px; /*å¦‚æœæ–‡å­—é—´éš”ä¸åˆç†å¯ä»¥å¾®è°ƒä¿®æ”¹ï¼Œç¬¬äºŒä¸ªæ˜¯æ°´å¹³æ–¹å‘çš„paddingï¼Œç¬¬ä¸€ä¸ªæ˜¯å‚ç›´çš„*/}#nav{    padding: 0 20px;}/* ä¿®å¤æ»šåŠ¨æ˜¾ç¤ºæ ‡é¢˜å±…ä¸­ */center#name-container {  position: absolute !important;  width: fit-content !important;  left: 42% !important;}@media screen and (max-width: 768px) {  center#name-container {    display: none;  }}/* æ¶ˆæ¯å¼¹çª— */.snackbar-container {  background: var(purple) !important;  color: var(rgb(255,223,0)) !important;  border-radius: 0 !important;  display: flex;  justify-content: center !important;  max-width: none !important;  min-width: 100% !important;  margin: 0px !important;  left: 0px !important;  height: 60px !important;  transform: none !important;}.snackbar-container p {  font-weight: bold !important;  text-align: center !important;  font-size: 0.8rem !important;  display: flex !important;  justify-content: center !important;}.snackbar-container .action {  color: var(rgb(255,223,0)) !important;  padding: 4px 6px !important;  font-weight: bold;  border-radius: 8px !important;  transition: 0.3s;  border: var(--style-border) !important;}.snackbar-container .action:hover {  color: var(rgb(255,223,0)) !important;  background: var(purple) !important;}.snackbar-container::after {  position: absolute;  width: 0;  height: 100%;  left: 0;  top: 0;  background: var(purple);  opacity: 0.1;  content: "";  animation: snackbar-progress 2s linear forwards;  pointer-events: none;}@keyframes snackbar-progress {  from {    width: 0;  }  to {    width: 100%;  }}:root {  --trans-light: rgba(255, 255, 255, 0.88);  --trans-dark: rgba(25, 25, 25, 0.88);  --border-style: 1px solid rgb(169, 169, 169);  --backdrop-filter: blur(5px) saturate(150%);}/* é¦–é¡µæ–‡ç« å¡ç‰‡ */#recent-posts > .recent-post-item {  background: var(--trans-light);  backdrop-filter: var(--backdrop-filter);  border-radius: 25px;  border: var(--border-style);}/* é¦–é¡µä¾§æ å¡ç‰‡ */#aside-content .card-widget {  background: var(--trans-light);  backdrop-filter: var(--backdrop-filter);  border-radius: 18px;  border: var(--border-style);}/* æ–‡ç« é¡µã€å½’æ¡£é¡µã€æ™®é€šé¡µé¢ */div#post,div#page,div#archive {  background: var(--trans-light);  backdrop-filter: var(--backdrop-filter);  border: var(--border-style);  border-radius: 20px;}/* å¯¼èˆªæ  */#page-header.nav-fixed #nav {  background: rgba(255, 255, 255, 0.75);  backdrop-filter: var(--backdrop-filter);}[data-theme="dark"] #page-header.nav-fixed #nav {  background: rgba(0, 0, 0, 0.7) !important;}/* å¤œé—´æ¨¡å¼é®ç½© */[data-theme="dark"] #recent-posts > .recent-post-item,[data-theme="dark"] #aside-content .card-widget,[data-theme="dark"] div#post,[data-theme="dark"] div#archive,[data-theme="dark"] div#page {  background: var(--trans-dark);}/* å¤œé—´æ¨¡å¼é¡µè„šé¡µå¤´é®ç½©é€æ˜ */[data-theme="dark"] #footer::before {  background: transparent !important;}[data-theme="dark"] #page-header::before {  background: transparent !important;}/* é˜…è¯»æ¨¡å¼ */.read-mode #aside-content .card-widget {  background: rgba(158, 204, 171, 0.5) !important;}.read-mode div#post {  background: rgba(158, 204, 171, 0.5) !important;}/* å¤œé—´æ¨¡å¼ä¸‹çš„é˜…è¯»æ¨¡å¼ */[data-theme="dark"] .read-mode #aside-content .card-widget {  background: rgba(25, 25, 25, 0.9) !important;  color: #ffffff;}[data-theme="dark"] .read-mode div#post {  background: rgba(25, 25, 25, 0.9) !important;  color: #ffffff;}/* æ¬¢è¿ä¿¡æ¯ */#welcome-info {  background: linear-gradient(45deg, #b9f4f3, #e3fbf9);  border-radius: 198px;  padding: 8px;}[data-theme="dark"] #welcome-info {  background: #212121;}/* ä¿¡æ¯å¡ç‰‡å¤´åƒçŠ¶æ€ */.card-info-avatar .author-status-box {  position: absolute;  bottom: 0;  left: calc(100% - 28px);  width: 28px;  height: 28px;  border: 1px solid #d0d7de;  border-radius: 2em;  background-color: #f8f8f8f8;  transition: 0.4s;  overflow: hidden;}[data-theme="dark"] .card-info-avatar .author-status-box {  background-color: #222222f2;  border: 1px solid #5c6060;}.card-info-avatar .author-status-box .author-status {  display: flex;  align-items: center;  justify-content: center;  height: 28px;  padding: 0 5px;}.card-info-avatar .author-status-box:hover {  width: 105px;}.card-info-avatar .author-status-box:hover .author-status span {  width: 105px;  margin-left: 4px;}.card-info-avatar .author-status-box .author-status span {  width: 0;  font-size: 12px;  height: 100%;  overflow: hidden;  text-overflow: ellipsis;  white-space: nowrap;  transition: 0.4s;}.card-widget .card-info-avatar {  display: inline-block;  position: relative;}/* ä¸ªäººä¿¡æ¯å¡ç‰‡èƒŒæ™¯å›¾ */[data-theme="light"] #aside-content > .card-widget.card-info {  background-image: url(https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301241905629.webp);  background-repeat: no-repeat;  background-attachment: inherit;  background-size: 200%;}[data-theme="dark"] #aside-content > .card-widget.card-info {  background-image: url(https://cdn.staticaly.com/gh/m2qian/owndraw@main/img/202301241905216.webp);  background-repeat: no-repeat;  background-attachment: inherit;  background-size: 200%;}/* å¸§ç‡æ£€æµ‹ */#fps {  position: fixed;  /* æŒ‡å®šä½ç½® */  left: 10px;  bottom: 10px;  z-index: 1919810;}[data-theme="light"] #fps {  background-color: rgba(255, 255, 255, 0.85);  backdrop-filter: var(--backdrop-filter);  padding: 4px;  border-radius: 4px;}[data-theme="dark"] #fps {  background-color: rgba(0, 0, 0, 0.72);  backdrop-filter: var(--backdrop-filter);  padding: 4px;  border-radius: 4px;}/* å¼•å…¥Unicodeå’ŒFont-classçš„çº¿ä¸Šèµ„æº */@import "//at.alicdn.com/t/font_2264842_b004iy0kk2b.css";.iconfont {  font-family: "iconfont" !important;  /* è¿™é‡Œå¯ä»¥è‡ªå®šä¹‰å›¾æ ‡å¤§å° */  font-size: 3em;  font-style: normal;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;}svg.icon {  width: 1.58em; height: 1.58em;  /* widthå’Œheightå®šä¹‰å›¾æ ‡çš„é»˜è®¤å®½åº¦å’Œé«˜åº¦*/  vertical-align: -0.35em;  fill: currentColor;  overflow: hidden;}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/cat.css"/>
      <url>/css/cat.css</url>
      
        <content type="html"><![CDATA[body::-webkit-scrollbar {    width: 0;}.neko {    width: 64px;    height: 64px;    background-image: url("https://bu.dusays.com/2022/07/20/62d812db74be9.png");    position: absolute;    right: 32px;    background-repeat: no-repeat;    background-size: contain;    transform: translateX(50%);    cursor: pointer;    font-family: tzy;    font-weight: 600;    font-size: 16px;    color: #6f42c1;    display: none;}.neko::after {    display: none;    width: 100px;    height: 100px;    background-image: url("https://bu.dusays.com/2022/07/20/62d812d95e6f5.png");    background-size: contain;    z-index: 9999;    position: absolute;    right: 50%;    text-align: center;    line-height: 100px;    top: -115%;}.neko.showMsg::after {    content: attr(data-msg);    display: block;    overflow: hidden;    text-overflow: ellipsis;}.neko:hover::after {    content: attr(data-msg);    display: block;    overflow: hidden;    text-overflow: ellipsis;}.neko.fontColor::after {    color: #333;}/** * @description: æ»šåŠ¨æ¡æ ·å¼  è·ŸçŒ«äºŒé€‰ä¸€ */@media screen and (max-width:992px) {    ::-webkit-scrollbar {        width: 8px !important;        height: 8px !important    }    ::-webkit-scrollbar-track {        border-radius: 2em;    }    ::-webkit-scrollbar-thumb {        background-color: rgb(255 255 255 / .3);        background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent);        border-radius: 2em    }    ::-webkit-scrollbar-corner {        background-color: transparent    }}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/progress_bar.css"/>
      <url>/css/progress_bar.css</url>
      
        <content type="html"><![CDATA[.pace {    -webkit-pointer-events: none;    pointer-events: none;    -webkit-user-select: none;    -moz-user-select: none;    user-select: none;    z-index: 2000;    position: fixed;    margin: auto;    top: 10px;    left: 0;    right: 0;    height: 8px;    border-radius: 8px;    width: 4rem;    background: #eaecf2;    border: 1px #e3e8f7;    overflow: hidden;  }    .pace-inactive .pace-progress {    opacity: 0;    transition: 0.3s ease-in;  }    .pace .pace-progress {    -webkit-box-sizing: border-box;    -moz-box-sizing: border-box;    -ms-box-sizing: border-box;    -o-box-sizing: border-box;    box-sizing: border-box;    -webkit-transform: translate3d(0, 0, 0);    -moz-transform: translate3d(0, 0, 0);    -ms-transform: translate3d(0, 0, 0);    -o-transform: translate3d(0, 0, 0);    transform: translate3d(0, 0, 0);    max-width: 200px;    position: absolute;    z-index: 2000;    display: block;    top: 0;    right: 100%;    height: 100%;    width: 100%;    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);    animation: gradient 1.5s ease infinite;    background-size: 200%;  }    .pace.pace-inactive {    opacity: 0;    transition: 0.3s;    top: -8px;  }  @keyframes gradient {    0% {      background-position: 0% 50%;    }    50% {      background-position: 100% 50%;    }    100% {      background-position: 0% 50%;    }  }  ]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/lantern.css"/>
      <url>/css/lantern.css</url>
      
        <content type="html"><![CDATA[/* ç¯ç¬¼ Start */* {    box-sizing: border-box;}/* ç§»åŠ¨ç«¯æ˜¾ç¤º/éšè— /none/blockï¼Œå¯è‡ªå®šä¹‰æ˜¾ç¤ºä¸€ä¸ª */@media screen and (max-width: 970px) {    .d-box1 {        display: none;    }    .dengl .d-box {        right: 0px;        top: -40px;        /* è‡ªå®šä¹‰ç¯ç¬¼å¤§å° */        transform: scale(0.4);    }}.dengl {    position: fixed;    z-index: 9;}/* .d-box,.d-box1{    z-index: 9;  } */.d-box {    position: fixed;    /* è‡ªå®šä¹‰ç¯ç¬¼çš„ä½ç½® */    right: 85px;    top: 0;    /* è‡ªå®šä¹‰ç¯ç¬¼å¤§å° */    transform: scale(0.8);}.d-box1 {    position: fixed;    /* è‡ªå®šä¹‰ç¯ç¬¼çš„ä½ç½® */    left: 0;    top: 0;    /* è‡ªå®šä¹‰ç¯ç¬¼å¤§å° */    transform: scale(0.8);}/* ä¿®æ”¹ç¯ç¬¼çš„å­—ä½“ */.d-box .d1::after {    content: 'è™å¹´å¤§å‰';}.d-box1 .d1::after {    content: 'ä¸‡äº‹é¡ºé‚';}.d-box1 .d1,.d-box1 .d2,.d-box1 .d1::after,.d-box1 .d1::before,.d-box1 .d2::after,.d-box1 .d2::before,.d-box1 .d2 ul li span,.d-box1 .d1 ul li span {    background-color: #f01f1a;    border: 5px solid #5c1713;    /* è‡ªå®šä¹‰ç¯ç¬¼çš„é˜´å½± */    /* box-shadow: 0 5px 61px rgba(255, 240, 29, 0.88); */}.d1,.d2,.d1::after,.d1::before,.d2::after,.d2::before,.d2 ul li span,.d1 ul li span {    background-color: #f01f1a;    border: 5px solid #5c1713;    /* è‡ªå®šä¹‰ç¯ç¬¼çš„é˜´å½± */    box-shadow: 0 5px 61px #ff1d1d;}.d1::after,.d1::before {    height: 82px;    position: absolute;    top: 0;    content: '';    font-size: 17px;}.d1,.d2 {    position: relative;    animation: swing 4s linear infinite;    transform-origin: top center;}.d1 {    width: 160px;    top: 100px;    height: 90px;    right: 0;    border-radius: 80px/49px;}.d1::before {    top: -5px;    right: 7px;    width: 123px;    border-radius: 62px/52px;}.d1::after {    text-align: center;    line-height: 90px;    color: #ffe31d;    font-weight: 600;    top: -5px;    right: 35px;    width: 69px;    border-radius: 41px/49px;}.d1 span {    position: absolute;    top: 84px;    left: 49px;    width: 50px;    height: 16px;    z-index: 2;    border-radius: 0 0 10px 10px;    background-color: #ffe31d;    border: 5px solid #5c1713;}.d1 span:nth-child(2) {    top: -17px;    border-radius: 10px 10px 0 0;}.d1 p {    position: absolute;    top: -31px;    left: 13px;    width: 16px;    height: 13px;    border-radius: 25px;    border: 5px solid #5c1713;    border-bottom: 0;}.d1 ul {    position: relative;    top: 80px;    left: 13px;    width: 54px;    display: flex;}.d1 li {    flex: 1;    list-style: none;    height: 24px;    margin: 0px 2.5px;    width: 5px;    border-radius: 5px;    border-right: 3.5px solid #5c1713;}.d1 ul li:nth-child(3) {    content: '';    height: 50px;}.d1 ul li:nth-child(3)::before {    content: '';    position: absolute;    top: 47px;    left: 54px;    width: 5px;    height: 5px;    border-radius: 5px 5px 10px 10px;    background-color: #ffe31d;    border: 5px solid #5c1713;}.d1 ul li span {    position: absolute;    top: 20px;    left: 55px;    width: 13px;    height: 19px;    border-radius: 14px;}.d2::after,.d2::before {    position: absolute;    height: 128px;    top: -3px;    content: '';}.d2 {    width: 199px;    height: 128px;    top: -61px;    right: -122px;    border-radius: 98px/70px;}.d2::before {    top: -8px;    right: 18px;    width: 143px;    border-radius: 69px/67px;}/* è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡ */.d2::after {    top: -8px;    right: 51px;    width: 75px;    border-radius: 57px/89px;    background: url(https://bu.dusays.com/2021/02/03/7e1a77cf800cf.png) no-repeat;    background-position: center;    background-size: 92px auto;}.d2 span {    position: absolute;    top: 123px;    left: 68px;    width: 55px;    height: 14px;    z-index: 2;    border-radius: 0 0 10px 10px;    background-color: #ffe31d;    border: 5px solid #5c1713;}.d2 span:nth-child(2) {    top: -16px;    border-radius: 10px 10px 0 0;}.d2 p {    position: absolute;    top: -32px;    left: 13px;    width: 19px;    height: 13px;    border-radius: 25px;    border: 5px solid #5c1713;    border-bottom: 0;}.d2 ul {    position: relative;    top: 121px;    left: 32px;    width: 53px;    display: flex;}.d2 li {    flex: 1;    list-style: none;    height: 24px;    margin: 0px 3px;    width: 4px;    border-radius: 7px;    border-right: 3px solid #5c1713;}.d2 ul li:nth-child(3) {    content: '';    height: 60px;}.d2 ul li:nth-child(3)::before {    content: '';    position: absolute;    top: 59px;    left: 53px;    width: 9px;    height: 6px;    border-radius: 5px 5px 10px 10px;    background-color: #ffe31d;    border: 5px solid #5c1713;}.d2 ul li span {    position: absolute;    top: 21px;    left: 54px;    width: 18px;    height: 17px;    border-radius: 20px;}@keyframes swing {    0% {        transform: rotate(0);    }    25% {        transform: rotate(-13deg);    }    50% {        transform: rotate(0);    }    75% {        transform: rotate(13deg);    }    100% {        transform: rotate(0);    }}/* ç¯ç¬¼ END */]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/readPercent.css"/>
      <url>/css/readPercent.css</url>
      
        <content type="html"><![CDATA[/* è¿”å›é¡¶éƒ¨ */button#go-up #percent {    display: none;    font-weight: bold;    font-size: 15px !important;}button#go-up span {    font-size: 12px!important;    margin-right: -1px;}/* é¼ æ ‡æ»‘åŠ¨åˆ°æŒ‰é’®ä¸Šæ—¶æ˜¾ç¤ºè¿”å›é¡¶éƒ¨å›¾æ ‡ */button#go-up:hover i {    display: block !important;}button#go-up:hover #percent {    display: none !important;}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/rightMenu.css"/>
      <url>/css/rightMenu.css</url>
      
        <content type="html"><![CDATA[#rightMenu {    display: none;    position: fixed;    padding: 0 .25rem;    width: 9rem;    height: fit-content;    top: 10%;    left: 10%;    background-color: rgba(238, 255, 255, .85);    -webkit-backdrop-filter: blur(20px);    backdrop-filter: blur(20px);    color: #363636;    border-radius: 12px;    z-index: 99994;    border: #e3e8f7;    user-select: none;    box-shadow: rgba(0, 0, 0, .05);}#rightMenu a {    color: #363636;}#rightMenu .rightMenu-group {    padding: .35rem .3rem;    transition: .3s}#rightMenu .rightMenu-line {    border-top: 1px dashed #4259ef23}#rightMenu .rightMenu-group.rightMenu-small {    display: flex;    justify-content: space-between}#rightMenu .rightMenu-group .rightMenu-item {    border-radius: 8px;    transition: .3s;    cursor: pointer}#rightMenu .rightMenu-line .rightMenu-item {    margin: .25rem 0;    padding: .25rem 0}#rightMenu .rightMenu-group.rightMenu-line .rightMenu-item {    display: flex}#rightMenu .rightMenu-group .rightMenu-item:hover {    background-color: #6f42c1;    color: #fff;}#rightMenu .rightMenu-group .rightMenu-item:active {    transform: scale(.97)}#rightMenu .rightMenu-group .rightMenu-item i {    display: inline-block;    text-align: center;    line-height: 1.5rem;    width: 1.5rem;    padding: 0 .25rem}#rightMenu .rightMenu-line .rightMenu-item i {    margin: 0 .25rem}#rightMenu .rightMenu-group .rightMenu-item span {    line-height: 1.5rem}.rightMenu-small .rightMenu-item {    width: 30px;    height: 30px;    line-height: 30px}#rightmenu-mask {    position: fixed;    width: 100vw;    height: 100vh;    background: 0 0;    top: 0;    left: 0;    display: none;    z-index: 101;    margin: 0 !important;    z-index: 99993}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/runtime.min.css"/>
      <url>/css/runtime.min.css</url>
      
        <content type="html"><![CDATA[div#runtime {  width: 180px;  margin: auto;  color: #fff;  padding-inline: 5px;  border-radius: 10px;  background-color: rgba(0, 0, 0, 0.7);}#workboard {  font-size: 12px;}[data-theme="dark"] div#runtime {  color: #28b4c8;  box-shadow: 0 0 5px rgba(28, 69, 218, 0.71);  animation: flashlight 1s linear infinite alternate;}@-moz-keyframes flashlight {  from {    box-shadow: 0 0 5px #1478d2;  }  to {    box-shadow: 0 0 2px #1478d2;  }}@-webkit-keyframes flashlight {  from {    box-shadow: 0 0 5px #1478d2;  }  to {    box-shadow: 0 0 2px #1478d2;  }}@-o-keyframes flashlight {  from {    box-shadow: 0 0 5px #1478d2;  }  to {    box-shadow: 0 0 2px #1478d2;  }}@keyframes flashlight {  from {    box-shadow: 0 0 5px #1478d2;  }  to {    box-shadow: 0 0 2px #1478d2;  }}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/music.css"/>
      <url>/css/music.css</url>
      
        <content type="html"><![CDATA[/* æ’­æ”¾å™¨å¤§å° */.music-player {    width: 570px;    height: 500px;  }  .music-player h3{    margin: 0px 0 1px!important;  }  @font-face {font-family: "iconfont";    src: url('iconfont.eot?t=1537976418058'); /* IE9*/    src: url('iconfont.eot?t=1537976418058#iefix') format('embedded-opentype'), /* IE6-IE8 */    url('data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAmcAAsAAAAADgwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFY8lGHxY21hcAAAAYAAAACUAAACBGvSDaxnbHlmAAACFAAABUMAAAbwatoOAWhlYWQAAAdYAAAALwAAADYSwtboaGhlYQAAB4gAAAAcAAAAJAfeA4tobXR4AAAHpAAAAA8AAAAoKAAAAGxvY2EAAAe0AAAAFgAAABYIpgZ4bWF4cAAAB8wAAAAdAAAAIAEYAGNuYW1lAAAH7AAAAUUAAAJtPlT+fXBvc3QAAAk0AAAAZQAAAJSspZ5ZeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkYWCcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGByeyf3/z9zwv4EhhrmBoQEozAiSAwD0fA0ZeJztkcENwjAQBMdxCAQhQgU88qYeesBKGoh48aLSS7oIa1+QKIKzxtKedWdpF9gBUdxEDeFNINdL3VD6kWPp19ylzxyoaOxqvSUb57RM6wqbHr76p4Jm/Fx0oNGfUVtabdzrueFfp3I/N9VmPx25hfVOzsqSkzOzwZGX2Ojk2Tk5Oc9lcuR0x6OQE+lIBag+4Pgp1HicbVVrjBNVFJ5z796Zvu482plOH0tLZ9rp7hba0m5bZLuUhwZNQEB2F7airBDlERd5/IX4b+MPE3/wUhMTEkLEQAwkhpAIgcCaGI3xpyQqwb/orgsmGs129Ex3UWJoJufec+43PfN955wZgQjC37/SL6giGEKvIESgHjWNHBpNhnzOQAPOILCaH2psI9xP9BNQ4gNACqb7kBRi7lKVbnEvuU2YhhG4ADuUUOn0bUUpdl4e0JU7J9HAuFYEZ3bWveNOz8wI+PtfTj+ITr7G0GirwWQ1NBDVIWf4wcjRz9ylsQJxH5oFAgNxUEh/Au6r85cx3bTbdC/BdvdjRR84eQcNOV9UlNunSyHFvRAuut/PzEAThmdnMWcP5nxA99F9giZkhKIwJAhmEbyMjYoJKdBFCUQqg6mJUbPegLqDxCOWU29BPQWiAqL0pHO3UAGoFJZaRE2l0+nOo2w6IQPICS1K5CxYnTmj45Noj48FRMKknq8854Ou835PFJoVcrbSBN29rJXqpbB7RacbSJ/cmVD6CIRgs1HWYWuw82UwSBmlgQBl5DjuJyj1oyWLGn5Na7QhKEJaEMCWwdD0qFlFQqh3Dn1JS8Fjn/zeStp2spWwAWy3vDrprcmFhTZw2wl3jxJkduHoSd+rGcV8f9Cb1C/khPXCGGbEBHjZljNYb3hZ8Krm0amksXooER60wHQsUU+DjVI7MkTNFAyBJOrRCio5mIcqPmHUrKDYCMBH1qPkkfPuuolPnx+KxGKRofJHG9sfDq9s8oQtT4VCU7KV5E0i2wneXNn70nLZjgNf/3oJAUnLA8x/PmTvHOBqJA5y662a9yekxI6v3fUejediwN7ZOP42XcUzidAUz/KpUCLLV//EE1l5GNYUOCSzvPXsKm4lOB6HYC9dlw9Bb5YPbQCI5eKLOqDZT34RkqjEWk95SxIlz3j6D0Eam6mKa72hOdQpga1VReynRn3QsRRUoavHogRmtIIqEE44v+HfG+FKIrK/NhGLAeckLkmWOvrasWNkxyFg45KsSuNtSeViuy1yVWqPS6oskZ/95wIhVXUfRBKlrRHD39NLTvd2dskvjEAv2bzbnW6LGpfGxyWueTf+u+/Ow4/0IrVxHvqFljCKTLCeBSzrEvB4VKJpwKoUACuDI4mBegPfC0hSzDfEIvLDghc9CM5rCgxdNBejtf+iJs5E5x5HDcLxeLiq2fzenz7DX82VcXrsqt/wAZUjEfmKTwtSKdsH0JeTIKhJy1as0LuxTaMwuqkbGnkV4BVy91owBHHtejjGg9feZz4oZ6/bFZ/4XdAfnp8L+4M/MKJobMnW4rIXU6ImEzG7q/7M7m9wtjWxeXH3zvMtjAJ77uobb95YnKNb9BZdIzjCJkHIZbAfZawpVq4ILWRR7XJTIIN0a9jd0SUoEWTyDopS9URKgYIR7HA8bUEGZwLxljOM95KrLi8rQAzFp7LJAAlNMtWn6D7WD3NjB4mW0ugp14K5sroI8ZPggccQV912eAEysDwQUTQfmwj0BvYwBroicZanh0bGFE1TxiZPkE+eimBHxtpyOCxvP3qmO783uzzzwubu/Fqix0TKeBUbdPKW91rr0qlipZH+AmGHVeoelUYGu8PQvWHF0e2qY1uihL28wDjKNFsyGxo9q2jk4Jir9jOf3uUUhECXtoFfjjL8duQU1eavIOjwNph7DDoQJP5FkFp2VQ8D35a3qMNwDgmOHKJ5xiVFB8b2IMMJ5tOUSGA5PTGJCmwJy+2xI+ypCHLm6HY5fBTWrOrvd//Ccv8D5gQugwB4nGNgZGBgAOJ0oeli8fw2Xxm4WRhA4PrFk0kI+v9+FgbmDCCXg4EJJAoAItUKtAB4nGNgZGBgbvjfwBDDwgACQJKRARVwAQBHEAJzeJxjYWBgYCECAwADmAApAAAAAAAAOgB0ANwBFAGYAfwCgAL0A3gAAHicY2BkYGDgYghnYGEAASYwjwtI/gfzGQASMwF8AAAAeJxlj01OwzAQhV/6B6QSqqhgh+QFYgEo/RGrblhUavdddN+mTpsqiSPHrdQDcB6OwAk4AtyAO/BIJ5s2lsffvHljTwDc4Acejt8t95E9XDI7cg0XuBeuU38QbpBfhJto41W4Rf1N2MczpsJtdGF5g9e4YvaEd2EPHXwI13CNT+E69S/hBvlbuIk7/Aq30PHqwj7mXle4jUcv9sdWL5xeqeVBxaHJIpM5v4KZXu+Sha3S6pxrW8QmU4OgX0lTnWlb3VPs10PnIhVZk6oJqzpJjMqt2erQBRvn8lGvF4kehCblWGP+tsYCjnEFhSUOjDFCGGSIyujoO1Vm9K+xQ8Jee1Y9zed0WxTU/3OFAQL0z1xTurLSeTpPgT1fG1J1dCtuy56UNJFezUkSskJe1rZUQuoBNmVXjhF6XNGJPyhnSP8ACVpuyAAAAHicbcrBCoNADATQjLau3dWPjBTdaInINqD9+gb06MBc3gxVdCbSfSIq1HjgiQYBLV6ISJRKZp0OKXm1sBjLLNoM6+gYfqxf0SkVc73MZ39r6/2IQ7+bZmM95+7NutlFRH+UdSMxAAAA') format('woff'),    url('iconfont.ttf?t=1537976418058') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/    url('iconfont.svg?t=1537976418058#iconfont') format('svg'); /* iOS 4.1- */  }    .icon-prev:before { content: "\f0069"; }    .icon-next:before { content: "\f006a"; }    .icon-play:before { content: "\e66a"; }    .icon-pause:before { content: "\e76a"; }    .icon-random:before { content: "\e622"; }    .icon-muted:before { content: "\e61e"; }    .icon-volume:before { content: "\e87a"; }    .icon-loop:before { content: "\e66c"; }    .icon-single:before { content: "\e66d"; }      /* æ’­æ”¾å™¨ä½ç½® */  .music-player {    position: relative;    margin: 0px auto;  }    /* æ­Œæ›²åˆ—è¡¨ */    .music-player__list {    width: 100%;    padding: 10px;    margin-top: 30px;    background: rgba(0, 0, 0, 0.5);    border-radius: 5px;    -webkit-box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);  }    .music__list__item {    padding-left: 25px;    color: #ccc;    position: relative;    margin-bottom: 10px;    font-size: 14px;    cursor: pointer;  }    .music__list__item:last-of-type {    margin: 0;  }    .music__list__item.play {    color: #fff;  }    .music__list__item.play:before {    font-family: 'iconfont';    content: "\e87a";    position: absolute;    left: 0px;    top: 4px;  }  /* æ’­æ”¾å™¨ä¸»ä½“ */  .music-player__main {    height: 180px;    padding: 25px;    box-shadow: 0 0 10px rgb(0 0 0 / 20%);    border-radius: 10px;    position: relative;    overflow: hidden;  }    /* æ’­æ”¾å™¨ä¸»ä½“æ¨¡ç³ŠèƒŒæ™¯ */  .music-player__blur {    width: 100%;    height: 100%;    position: absolute;    background-size: 100%;    left: 0;    top: 0;    z-index: -1;    -webkit-filter: blur(20px);    filter: blur(20px);  }  /* æ’­æ”¾å™¨å”±ç‰‡æ•ˆæœ */  .music-player__disc {    float: left;    width: 130px;    height: 130px;    background: url(/img/cd.png) no-repeat center;    background-size: 100%;    position: relative;  }    /* å”±ç‰‡æŒ‡é’ˆ */  .music-player__pointer {    width: 25px;    position: absolute;    right: -10px;    top: 0;    -webkit-transform-origin: right top;    -ms-transform-origin: right top;    transform-origin: right top;    -webkit-transform: rotate(-15deg);    -ms-transform: rotate(-15deg);    transform: rotate(-15deg);    -webkit-transition: all 0.3s;    -o-transition: all 0.3s;    transition: all 0.3s;  }    /* å”±ç‰‡æŒ‡é’ˆæ’­æ”¾çŠ¶æ€ åŠ playç±»å */  .music-player__pointer.play {    -webkit-transform: rotate(0deg);    -ms-transform: rotate(0deg);    transform: rotate(0deg);  }    /* å”±ç‰‡æ­Œæ›²å›¾ç‰‡ */  .music-player__image {    width: 80px;    height: 80px;    border-radius: 50%;    position: absolute;    overflow: hidden;    left: 0;    right: 0;    top: 0;    bottom: 0;    margin: auto;  }  /* æ’­æ”¾å™¨æ§ä»¶ */  .music-player__controls {    width: 330px;    height: 130px;    float: right;  }    /* æ­Œæ›²ä¿¡æ¯ */  .music__info {    width: 100%;    height: 50px;    margin-bottom: 15px;  }    .music__info .music__info--title {    color: #fff;  }    .music__info .music__info--title {    font-size: 16px;  }  /* æ§ä»¶ */    .player-control {    width: 100%;  }    .player-control__content {    overflow: hidden;  }    /* æ’­æ”¾æš‚åœæŒ‰é’® */  .player-control__btns {    float: left;    overflow: hidden;  }    .player-control__btn {    float: left;    margin: 0 5px;    font-weight: bolder;    color: #fff;    cursor: pointer;  }    .player-control__volume {    float: right;    overflow: hidden;  }    .control__volume--progress {    float: left;    width: 100px;    position: relative;    top: 8px;  }    .player__song--timeProgess{    font-size: 12px;    color: #fff;    padding: 0px 3px;    background: rgba(0, 0, 0, 0.3);    border-radius: 5px;  }    .player-control__content .nowTime{    float: left;  }  .player-control__content .totalTime{    float: right;  }    .music-player .progress {    background: rgba(0, 0, 0, 0.3);    height: 5px;    -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) inset;    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) inset;    overflow: hidden;    margin: 0.5rem 0!important;    border-radius: 2px;    position: relative;    cursor: pointer;  }    .music-player .progress .back {    width: 0px;    height: 100%;    border-radius: 2px;    background: rgb(12, 182, 212);  }    .music-player .progress .pointer {    width: 7px;    height: 7px;    background: #fff;    border-radius: 50%;    opacity: 0;    -webkit-transition: opacity 0.3s;    -o-transition: opacity 0.3s;    transition: opacity 0.3s;    position: absolute;    top: -1px;    left: 0;  }    .music-player .progress:hover .pointer {    opacity: 1;  }      /* æ’­æ”¾ ç”»ç‰‡ åŠ¨ç”» */    @-webkit-keyframes disc {    from {        -webkit-transform: rotate(0deg);        transform: rotate(0deg);    }      to {        -webkit-transform: rotate(360deg);        transform: rotate(360deg);    }  }    @keyframes disc {    from {        -webkit-transform: rotate(0deg);        transform: rotate(0deg);    }    to {        -webkit-transform: rotate(360deg);        transform: rotate(360deg);    }  }  .music-player__image.play {    -webkit-animation: disc 5s linear 0s infinite;    animation: disc 5s linear 0s infinite;  }  /*  æ’­æ”¾è¿›åº¦  */  .player__song--progress {    width: 100%;    margin-top: 15px;  }  .music-player h1, .music-player h2, .music-player h3,.music-player h4, .music-player h5, .music-player h6, .music-player p {    margin: 0; padding: 0;  }  .music-player li { list-style: none; }]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/css/widening.css"/>
      <url>/css/widening.css</url>
      
        <content type="html"><![CDATA[.layout{    max-width:1400px;}.aside-content{    max-width:312px;    min-width:300px;}/* å¹³æ¿å°ºå¯¸è‡ªé€‚åº”(ä¸å¯ç”¨ä¾§è¾¹æ å®½åº¦é™åˆ¶) */@media screen and (max-width: 900px) {    .aside-content {      max-width: none !important;    }  }  ]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>bi~</title>
      <link href="/dayrecord/index.html"/>
      <url>/dayrecord/index.html</url>
      
        <content type="html"><![CDATA[<div class="timeline red"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>ä¸ªäººç¢ç¢å¿µ</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-25 15:00</p></div></div><div class='timeline-item-content'><p>äººä¸èƒ½ç›´æ¥çŸ¥é“è‡ªå·±ä¸çŸ¥é“çš„ä¸œè¥¿ã€‚</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-25 åˆå››åœ¨å®¶æ‘†çƒ‚å‘¢</p></div></div><div class='timeline-item-content'><p>é¦–æ¬¡æ¨ä¸Š</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-24 å¤§å¹´åˆä¸‰å•¦</p></div></div><div class='timeline-item-content'><p>é¦–æ¬¡ä½¿ç”¨</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2023-01-22 æ–°å¹´å¥½~</p></div></div><div class='timeline-item-content'><p>é¦–æ¬¡è®¤è¯†åˆ°timeLine<br>è¿‡å¤§å¹´å•¦~</p></div></div></div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>å‹é“¾</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/FunnyTitle.js"/>
      <url>/js/FunnyTitle.js</url>
      
        <content type="html"><![CDATA[// <!--æµè§ˆå™¨æ¶ææ ‡é¢˜--> var OriginTitle = document.title; var titleTime; document.addEventListener('visibilitychange', function () {     if (document.hidden) {         $('[rel="icon"]').attr('href', "/img/trhx2.png");         document.title = 'â”­â”®ï¹â”­â”®_ç½‘é¡µå´©æºƒäº†ï¼';         clearTimeout(titleTime);     }     else {         $('[rel="icon"]').attr('href', "/img/trhx2.png");         document.title = 'ğŸ˜å˜¿ï¼Œæ˜¯ä¸æ˜¯éª—åˆ°ä½ å°å­äº†' +  OriginTitle;         titleTime = setTimeout(function () {             document.title = OriginTitle;         }, 2000);     } });]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/bb.js"/>
      <url>/js/bb.js</url>
      
        <content type="html"><![CDATA[let svg = '<svg  viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" class="is-badge"><path  d="m512 268c0 17.9-4.3 34.5-12.9 49.7s-20.1 27.1-34.6 35.4c.4 2.7.6 6.9.6 12.6 0 27.1-9.1 50.1-27.1 69.1-18.1 19.1-39.9 28.6-65.4 28.6-11.4 0-22.3-2.1-32.6-6.3-8 16.4-19.5 29.6-34.6 39.7-15 10.2-31.5 15.2-49.4 15.2-18.3 0-34.9-4.9-49.7-14.9-14.9-9.9-26.3-23.2-34.3-40-10.3 4.2-21.1 6.3-32.6 6.3-25.5 0-47.4-9.5-65.7-28.6-18.3-19-27.4-42.1-27.4-69.1 0-3 .4-7.2 1.1-12.6-14.5-8.4-26-20.2-34.6-35.4-8.5-15.2-12.8-31.8-12.8-49.7 0-19 4.8-36.5 14.3-52.3s22.3-27.5 38.3-35.1c-4.2-11.4-6.3-22.9-6.3-34.3 0-27 9.1-50.1 27.4-69.1s40.2-28.6 65.7-28.6c11.4 0 22.3 2.1 32.6 6.3 8-16.4 19.5-29.6 34.6-39.7 15-10.1 31.5-15.2 49.4-15.2s34.4 5.1 49.4 15.1c15 10.1 26.6 23.3 34.6 39.7 10.3-4.2 21.1-6.3 32.6-6.3 25.5 0 47.3 9.5 65.4 28.6s27.1 42.1 27.1 69.1c0 12.6-1.9 24-5.7 34.3 16 7.6 28.8 19.3 38.3 35.1 9.5 15.9 14.3 33.4 14.3 52.4zm-266.9 77.1 105.7-158.3c2.7-4.2 3.5-8.8 2.6-13.7-1-4.9-3.5-8.8-7.7-11.4-4.2-2.7-8.8-3.6-13.7-2.9-5 .8-9 3.2-12 7.4l-93.1 140-42.9-42.8c-3.8-3.8-8.2-5.6-13.1-5.4-5 .2-9.3 2-13.1 5.4-3.4 3.4-5.1 7.7-5.1 12.9 0 5.1 1.7 9.4 5.1 12.9l58.9 58.9 2.9 2.3c3.4 2.3 6.9 3.4 10.3 3.4 6.7-.1 11.8-2.9 15.2-8.7z" fill="#1da1f2"></path></svg>'let total = 0let nowNum = 0let items = []let page = 1let Url = '' // ä¿®æ”¹apiï¼Œè®°å¾—å¸¦å‚æ•°pagewindow.addEventListener('DOMContentLoaded', () => {    getNew();});// è·å–æ•°æ®function getNew() {    let bibi = document.getElementById('bibi');    try {        bibi.removeChild(document.getElementById('more'))    } catch (error) { }    bibi.innerHTML += '<div id="bb_loading"><img src="/assets/loading3.gif" alt="bb_loading"></div>' // bb_loadingå›¾ç‰‡å¯ä»¥f12åœ¨æˆ‘ç½‘ç«™æºç ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å›¾ç‰‡ã€‚    fetch(Url + page).then(res => res.json()).then((res) => {        total = res.data.total        items = res.data.items        nowNum += items.length        if (page == 1) {            document.querySelector('.bb-info').innerHTML = '<svg style="width:1.20em;height:1.20em;top:5px;fill:currentColor;overflow:hidden;position:relative"><use xlink:href="#icon-chat"></svg> ç«™é•¿çš„å” å¨(' + total + ')'        }        page += 1    }).then(() => {        bb();        if (nowNum < total) {            document.getElementById('bibi').innerHTML += '<button id="more" onclick="getNew()">å†ç¿»ç¿»</button>'        }        document.getElementById('bibi').removeChild(document.getElementById('bb_loading'))    })}// æ¸²æŸ“æ•°æ®function bb() {    let bb = document.getElementById('bb-main')    items.forEach((item) => {        let time = item.createdAt.substring(0, 10);        let div = document.createElement('div')        item.content = contentFormat(item.content)        div.className = 'bb-card'        div.innerHTML = '<div class="card-header"><div class="avatar"><img class="nofancybox"src="' + item.author.avatar + '"></div><div class="name">' + item.author.nickName + '</div>' + svg + '<div class="card-time">' + time + '</div></div><div class="card-content">' + item.content + '</div><div class="card-footer"><div data-v-185689ea=""class="card-label"style="background: ' + item.tag.bgColor + '; color: white;">' + item.tag.name + '</div></div>'        bb.appendChild(div)    })}// contentæ ¼å¼åŒ–function contentFormat(s) {    let br = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;    let re_forimg = /<img(.*?)src=[\"|\']?(.*?)[\"|\']?(.*?)>|!\[(.*?)\]\((.*?)\)/g;    let getImgUrl = /(http(.*).[jpg|png|gif])/g;    let ls = s.match(getImgUrl)    s = s.replace(re_forimg, '')    s = s.replace(br, '')    let html = '<br>'    if (ls) {        ls.forEach((e) => {            html += '<a href="' + e + '" target="_blank" data-fancybox="group" class="fancybox"><img src="' + e + '"></a>'        })    }    s += html    return s}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/cat.js"/>
      <url>/js/cat.js</url>
      
        <content type="html"><![CDATA[if (document.body.clientWidth > 992) {    function getBasicInfo() {        /* çª—å£é«˜åº¦ */        var ViewH = $(window).height();        /* documenté«˜åº¦ */        var DocH = $("body")[0].scrollHeight;        /* æ»šåŠ¨çš„é«˜åº¦ */        var ScrollTop = $(window).scrollTop();        /* å¯æ»šåŠ¨çš„é«˜åº¦ */        var S_V = DocH - ViewH;        var Band_H = ScrollTop / (DocH - ViewH) * 100;        return {            ViewH: ViewH,            DocH: DocH,            ScrollTop: ScrollTop,            Band_H: Band_H,            S_V: S_V        }    };    function show(basicInfo) {        if (basicInfo.ScrollTop > 0.001) {            $(".neko").css('display', 'block');        } else {            $(".neko").css('display', 'none');        }    }    (function ($) {        $.fn.nekoScroll = function (option) {            var defaultSetting = {                top: '0',                scroWidth: 6 + 'px',                z_index: 9999,                zoom: 0.9,                borderRadius: 5 + 'px',                right: 60 + 'px',                nekoImg: "https://s1.ax1x.com/2022/11/07/xv7lO1.png",                hoverMsg: "å–µå–µå–µ~",                color: "#6f42c1",                during: 500,                blog_body: "body",            };            var setting = $.extend(defaultSetting, option);            var getThis = this.prop("className") !== "" ? "." + this.prop("className") : this.prop("id") !== "" ? "#" +                this.prop("id") : this.prop("nodeName");            if ($(".neko").length == 0) {                this.after("<div class=\"neko\" id=" + setting.nekoname + " data-msg=\"" + setting.hoverMsg + "\"></div>");            }            let basicInfo = getBasicInfo();            $(getThis)                .css({                    'position': 'fixed',                    'width': setting.scroWidth,                    'top': setting.top,                    'height': basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 + 'px',                    'z-index': setting.z_index,                    'background-color': setting.bgcolor,                    "border-radius": setting.borderRadius,                    'right': setting.right,                    'background-image': 'url(' + setting.scImg + ')',                    'background-image': '-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent)', 'border-radius': '2em',                    'background-size': 'contain'                });            $("#" + setting.nekoname)                .css({                    'position': 'fixed',                    'top': basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 - 50 + 'px',                    'z-index': setting.z_index * 10,                    'right': setting.right,                    'background-image': 'url(' + setting.nekoImg + ')',                });            show(getBasicInfo());            $(window)                .scroll(function () {                    let basicInfo = getBasicInfo();                    show(basicInfo);                    $(getThis)                        .css({                            'position': 'fixed',                            'width': setting.scroWidth,                            'top': setting.top,                            'height': basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 + 'px',                            'z-index': setting.z_index,                            'background-color': setting.bgcolor,                            "border-radius": setting.borderRadius,                            'right': setting.right,                            'background-image': 'url(' + setting.scImg + ')',                            'background-image': '-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.1) 75%, transparent 75%, transparent)', 'border-radius': '2em',                            'background-size': 'contain'                        });                    $("#" + setting.nekoname)                        .css({                            'position': 'fixed',                            'top': basicInfo.Band_H * setting.zoom * basicInfo.ViewH * 0.01 - 50 + 'px',                            'z-index': setting.z_index * 10,                            'right': setting.right,                            'background-image': 'url(' + setting.nekoImg + ')',                        });                    if (basicInfo.ScrollTop == basicInfo.S_V) {                        $("#" + setting.nekoname)                            .addClass("showMsg")                    } else {                        $("#" + setting.nekoname)                            .removeClass("showMsg");                        $("#" + setting.nekoname)                            .attr("data-msg", setting.hoverMsg);                    }                });            this.click(function (e) {                btf.scrollToDest(0, 500)            });            $("#" + setting.nekoname)                .click(function () {                    btf.scrollToDest(0, 500)                });            return this;        }    })(jQuery);    $(document).ready(function () {        //éƒ¨åˆ†è‡ªå®šä¹‰        $("#myscoll").nekoScroll({            bgcolor: 'rgb(0 0 0 / .5)', //èƒŒæ™¯é¢œè‰²ï¼Œæ²¡æœ‰ç»³å­èƒŒæ™¯å›¾ç‰‡æ—¶æœ‰æ•ˆ            borderRadius: '2em',            zoom: 0.9        }        );        //è‡ªå®šä¹‰ï¼ˆå»æ‰ä»¥ä¸‹æ³¨é‡Šï¼Œå¹¶æ³¨é‡Šæ‰å…¶ä»–çš„æŸ¥çœ‹æ•ˆæœï¼‰        /*        $("#myscoll").nekoScroll({            nekoname:'neko1', //nekonameï¼Œç›¸å½“äºid            nekoImg:'img/çŒ«å’ª.png', //nekoçš„èƒŒæ™¯å›¾ç‰‡            scImg:"img/ç»³1.png", //ç»³å­çš„èƒŒæ™¯å›¾ç‰‡            bgcolor:'#1e90ff', //èƒŒæ™¯é¢œè‰²ï¼Œæ²¡æœ‰ç»³å­èƒŒæ™¯å›¾ç‰‡æ—¶æœ‰æ•ˆ            zoom:0.9, //ç»³å­é•¿åº¦çš„ç¼©æ”¾å€¼            hoverMsg:'ä½ å¥½~å–µ', //é¼ æ ‡æµ®åŠ¨åˆ°nekoä¸Šæ–¹çš„å¯¹è¯æ¡†ä¿¡æ¯            right:'100px', //è·ç¦»é¡µé¢å³è¾¹çš„è·ç¦»            fontFamily:'æ¥·ä½“', //å¯¹è¯æ¡†å­—ä½“            fontSize:'14px', //å¯¹è¯æ¡†å­—ä½“çš„å¤§å°            color:'#1e90ff', //å¯¹è¯æ¡†å­—ä½“é¢œè‰²            scroWidth:'8px', //ç»³å­çš„å®½åº¦            z_index:100, //ä¸ç”¨è§£é‡Šäº†å§            during:1200, //ä»é¡¶éƒ¨åˆ°åº•éƒ¨æ»‘åŠ¨çš„æ—¶é•¿        });        */    })}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/chocolate.js"/>
      <url>/js/chocolate.js</url>
      
        <content type="html"><![CDATA[$(function() {    // æ°”æ³¡    function bubble() {        $('#page-header').circleMagic({            radius: 10,            density: .2,            color: 'rgba(255,255,255,.4)',            clearOffset: 0.99        });    }! function(p) {        p.fn.circleMagic = function(t) {            var o, a, n, r, e = !0,                i = [],                d = p.extend({ color: "rgba(255,0,0,.5)", radius: 10, density: .3, clearOffset: .2 }, t),                l = this[0];            function c() { e = !(document.body.scrollTop > a) }            function s() { o = l.clientWidth, a = l.clientHeight, l.height = a ;"px", n.width = o, n.height = a }            function h() {                if (e)                    for (var t in r.clearRect(0, 0, o, a), i) i[t].draw();                requestAnimationFrame(h)            }            function f() {                var t = this;                function e() { t.pos.x = Math.random() * o, t.pos.y = a ;100 * Math.random(), t.alpha = .1 ;Math.random() * d.clearOffset, t.scale = .1 ;.3 * Math.random(), t.speed = Math.random(), "random" === d.color ? t.color = "rgba(" :Math.floor(255 * Math.random()) ;", " ;Math.floor(0 * Math.random()) ;", " ;Math.floor(0 * Math.random()) ;", " ;Math.random().toPrecision(2) ;")" ; t.color = d.color }                t.pos = {}, e(), this.draw = function() { t.alpha <= 0 && e(), t.pos.y -= t.speed, t.alpha -= 5e-4, r.beginPath(), r.arc(t.pos.x, t.pos.y, t.scale * d.radius, 0, 2 * Math.PI, !1), r.fillStyle = t.color, r.fill(), r.closePath() }            }! function() {                o = l.offsetWidth, a = l.offsetHeight,                    function() {                        var t = document.createElement("canvas");                        t.id = "canvas", t.style.top = 0, t.style.zIndex = 0, t.style.position = "absolute", l.appendChild(t), t.parentElement.style.overflow = "hidden"                    }(), (n = document.getElementById("canvas")).width = o, n.height = a, r = n.getContext("2d");                for (var t = 0; t < o * d.density; t++) {                    var e = new f;                    i.push(e)                }                h()            }(), window.addEventListener("scroll", c, !1), window.addEventListener("resize", s, !1)        }    }(jQuery);    // è°ƒç”¨æ°”æ³¡æ–¹æ³•    bubble();})]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/fit.js"/>
      <url>/js/fit.js</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/fps.js"/>
      <url>/js/fps.js</url>
      
        <content type="html"><![CDATA[if (window.localStorage.getItem("fpson") == undefined || window.localStorage.getItem("fpson") == "1") {    var rAF = function () {        return (            window.requestAnimationFrame ||            window.webkitRequestAnimationFrame ||            function (callback) {                window.setTimeout(callback, 1000 / 60);            }        );    }();    var frame = 0;    var allFrameCount = 0;    var lastTime = Date.now();    var lastFameTime = Date.now();    var loop = function () {        var now = Date.now();        var fs = (now - lastFameTime);        var fps = Math.round(1000 / fs);        lastFameTime = now;        // ä¸ç½® 0ï¼Œåœ¨åŠ¨ç”»çš„å¼€å¤´åŠç»“å°¾è®°å½•æ­¤å€¼çš„å·®å€¼ç®—å‡º FPS        allFrameCount++;        frame++;        if (now > 1000 + lastTime) {            var fps = Math.round((frame * 1000) / (now - lastTime));            if (fps <= 5) {                var kd = `<span style="color:#bd0000">å¡æˆpptğŸ¤¢</span>`            } else if (fps <= 15) {                var kd = `<span style="color:red">ç”µç«çº§å¸§ç‡ğŸ˜–</span>`            } else if (fps <= 25) {                var kd = `<span style="color:orange">æœ‰ç‚¹éš¾å—ğŸ˜¨</span>`            } else if (fps < 35) {                var kd = `<span style="color:#9338e6">ä¸å¤ªæµç•…ğŸ™„</span>`            } else if (fps <= 45) {                var kd = `<span style="color:#08b7e4">è¿˜ä¸é”™å“¦ğŸ˜</span>`            } else {                var kd = `<span style="color:#39c5bb">ååˆ†æµç•…ğŸ˜‹</span>`            }            document.getElementById("fps").innerHTML = `FPS:${fps} ${kd}`;            frame = 0;            lastTime = now;        };        rAF(loop);    }    loop();} else {    document.getElementById("fps").style = "display:none!important"}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/fuzhi.js"/>
      <url>/js/fuzhi.js</url>
      
        <content type="html"><![CDATA[/** ç›‘å¬copyäº‹ä»¶ */document.addEventListener("copy",function(e){    //å¤åˆ¶çš„å†…å®¹    btf.snackbarShow('å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªGPLåè®®', false, 3000)  })  ]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/day.js"/>
      <url>/js/day.js</url>
      
        <content type="html"><![CDATA[var d = new Date();m = d.getMonth() + 1;dd = d.getDate();y = d.getFullYear();// å…¬ç¥­æ—¥if (m == 9 && dd == 18) {    document.getElementsByTagName("html")[0].setAttribute("style", "filter: grayscale(60%);");    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä»Šå¤©æ˜¯ä¹ä¸€å…«äº‹å˜" + (y - 1931).toString() + "å‘¨å¹´çºªå¿µæ—¥\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 7 && dd == 7) {    document.getElementsByTagName("html")[0].setAttribute("style", "filter: grayscale(60%);");    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä»Šå¤©æ˜¯å¢æ²Ÿæ¡¥äº‹å˜" + (y - 1937).toString() + "å‘¨å¹´çºªå¿µæ—¥\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 12 && dd == 13) {    document.getElementsByTagName("html")[0].setAttribute("style", "filter: grayscale(60%);");    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä»Šå¤©æ˜¯å—äº¬å¤§å± æ€" + (y - 1937).toString() + "å‘¨å¹´çºªå¿µæ—¥\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 8 && dd == 14) {    document.getElementsByTagName("html")[0].setAttribute("style", "filter: grayscale(60%);");    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä»Šå¤©æ˜¯ä¸–ç•Œæ…°å®‰å¦‡çºªå¿µæ—¥\nğŸª”å‹¿å¿˜å›½è€»ï¼ŒæŒ¯å…´ä¸­åğŸª”");        sessionStorage.setItem("isPopupWindow", "1");    }}// èŠ‚å‡æ—¥if (m == 10 && dd <= 3) {//å›½åº†èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ç¥ç¥–å›½" + (y - 1949).toString() + "å²ç”Ÿæ—¥å¿«ä¹ï¼");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 8 && dd == 15) {//ææ¥ç©çš„ï¼Œå°æ—¥å­æŠ•é™    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("å°æ—¥å­å·²ç»æŠ•é™" + (y - 1945).toString() + "å¹´äº†ğŸ˜ƒ");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 1 && dd == 1) {//å…ƒæ—¦èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire(y.toString() + "å¹´å…ƒæ—¦å¿«ä¹ï¼ğŸ‰");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 3 && dd == 8) {//å¦‡å¥³èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("å„ä½å¥³ç¥ä»¬ï¼Œå¦‡å¥³èŠ‚å¿«ä¹ï¼ğŸ‘©");        sessionStorage.setItem("isPopupWindow", "1");    }}l = ["éå¸¸æŠ±æ­‰ï¼Œå› ä¸ºä¸å¯æ§åŸå› ï¼Œåšå®¢å°†äºæ˜å¤©åœæ­¢è¿è¥ï¼", "å¥½æ¶ˆæ¯ï¼Œæ—¥æœ¬æ²¡äº†ï¼", "ç¾å›½å®äº†ï¼ŒåŸå› ç«Ÿç„¶æ˜¯å·æ™®ï¼", "å¾®è½¯å®äº†ï¼", "ä½ çš„ç”µè„‘å·²ç»è¿‡è½½ï¼Œå»ºè®®ç«‹å³å…³æœºï¼", "ä½ çŸ¥é“å—ï¼Ÿç«™é•¿å¾ˆå–œæ¬¢ä½ å“¦ï¼", "ä¸€åˆ†é’Ÿæœ‰61ç§’å“¦", "ä½ å–œæ¬¢çš„äººè·Ÿåˆ«äººè·‘äº†ï¼"]if (m == 4 && dd == 1) {//æ„šäººèŠ‚ï¼Œéšæœºè°è¯    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire(l[Math.floor(Math.random() * l.length)]);        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 5 && dd == 1) {//åŠ³åŠ¨èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("åŠ³åŠ¨èŠ‚å¿«ä¹\nä¸ºå„è¡Œå„ä¸šè¾›å‹¤å·¥ä½œçš„äººä»¬è‡´æ•¬ï¼");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 5 && dd == 4) {//é’å¹´èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("é’å¹´èŠ‚å¿«ä¹\né’æ˜¥ä¸æ˜¯å›å¿†é€å»,è€Œæ˜¯æŠŠæ¡ç°åœ¨ï¼");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 5 && dd == 20) {//520    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä»Šå¹´æ˜¯520æƒ…äººèŠ‚\nå¿«å’Œä½ å–œæ¬¢çš„äººä¸€èµ·è¿‡å§ï¼ğŸ’‘");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 7 && dd == 1) {//å»ºå…šèŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ç¥ä¸­å›½å…±äº§å…š" + (y - 1921).toString() + "å²ç”Ÿæ—¥å¿«ä¹ï¼");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 9 && dd == 10) {//æ•™å¸ˆèŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("å„ä½è€å¸ˆä»¬æ•™å¸ˆèŠ‚å¿«ä¹ï¼ğŸ‘©â€ğŸ«");        sessionStorage.setItem("isPopupWindow", "1");    }}if (m == 12 && dd == 25) {//åœ£è¯èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("åœ£è¯èŠ‚å¿«ä¹ï¼ğŸ„");        sessionStorage.setItem("isPopupWindow", "1");    }}//ä¼ ç»ŸèŠ‚æ—¥éƒ¨åˆ†if ((y == 2023 && m == 4 && dd == 5) || (y == 2024 && m == 4 && dd == 4) || (y == 2025 && m == 4 && dd == 4)) {//æ¸…æ˜èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·,ä¸€æŸé²œèŠ±ç¥­æ•…äººğŸ’");        sessionStorage.setItem("isPopupWindow", "1");    }}if ((y == 2023 && m == 12 && dd == 22) || (y == 2024 && m == 12 && dd == 21) || (y == 2025 && m == 12 && dd == 21)) {//å†¬è‡³    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("å†¬è‡³å¿«ä¹\nå¿«åƒä¸Šä¸€ç¢—çƒ­çƒ­çš„æ±¤åœ†å’Œé¥ºå­å§ğŸ§†");        sessionStorage.setItem("isPopupWindow", "1");    }}var lunar = calendarFormatter.solar2lunar();//å†œå†é‡‡ç”¨æ±‰å­—è®¡ç®—ï¼Œé˜²æ­¢å‡ºç°é—°æœˆå¯¼è‡´é—®é¢˜if ((lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åˆå…­") || (lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åˆäº”") || (lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åˆå››") || (lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åˆä¸‰") || (lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åˆäºŒ") || (lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åˆä¸€") || (lunar["IMonthCn"] == "è…Šæœˆ" && lunar["IDayCn"] == "ä¸‰å") || (lunar["IMonthCn"] == "è…Šæœˆ" && lunar["IDayCn"] == "å»¿ä¹")) {    //æ˜¥èŠ‚ï¼Œæœ¬æ¥åªæœ‰å¤§å¹´ä¸‰ååˆ°åˆå…­ï¼Œä½†æ˜¯æœ‰æ—¶å€™é™¤å¤•æ˜¯å¤§å¹´äºŒåä¹ï¼Œæ‰€ä»¥ä¹ŸåŠ ä¸Šäº†    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire(y.toString() + "å¹´æ–°å¹´å¿«ä¹\nğŸŠç¥ä½ å¿ƒæƒ³äº‹æˆï¼Œè¯¸äº‹é¡ºåˆ©ğŸŠ");        sessionStorage.setItem("isPopupWindow", "1");    }}if ((lunar["IMonthCn"] == "æ­£æœˆ" && lunar["IDayCn"] == "åäº”")) {    //å…ƒå®µèŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("å…ƒå®µèŠ‚å¿«ä¹\né€ä½ ä¸€ä¸ªå¤§å¤§çš„ç¯ç¬¼ğŸ§…");        sessionStorage.setItem("isPopupWindow", "1");    }}if ((lunar["IMonthCn"] == "äº”æœˆ" && lunar["IDayCn"] == "åˆäº”")) {    //ç«¯åˆèŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ç«¯åˆèŠ‚å¿«ä¹\nè¯·ä½ åƒä¸€æ¡ç²½å­ğŸ™");        sessionStorage.setItem("isPopupWindow", "1");    }}if ((lunar["IMonthCn"] == "ä¸ƒæœˆ" && lunar["IDayCn"] == "åˆä¸ƒ")) {    //ä¸ƒå¤•èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä¸ƒå¤•èŠ‚å¿«ä¹\né»„æ˜å,æŸ³æ¢¢å¤´,ç‰›éƒç»‡å¥³æ¥ç¢°å¤´");        sessionStorage.setItem("isPopupWindow", "1");    }}if ((lunar["IMonthCn"] == "å…«æœˆ" && lunar["IDayCn"] == "åäº”")) {    //ä¸­ç§‹èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("ä¸­ç§‹èŠ‚å¿«ä¹\nè¯·ä½ åƒä¸€å—æœˆé¥¼ğŸª");        sessionStorage.setItem("isPopupWindow", "1");    }}if ((lunar["IMonthCn"] == "ä¹æœˆ" && lunar["IDayCn"] == "åˆä¹")) {    //é‡é˜³èŠ‚    if (sessionStorage.getItem("isPopupWindow") != "1") {        Swal.fire("é‡é˜³èŠ‚å¿«ä¹\nç‹¬åœ¨å¼‚ä¹¡ä¸ºå¼‚å®¢ï¼Œæ¯é€¢ä½³èŠ‚å€æ€äº²");        sessionStorage.setItem("isPopupWindow", "1");    }}// åˆ‡æ¢ä¸»é¢˜æé†’// if (y == 2022 && m == 12 && (dd >= 18 && dd <= 20)) {//     if (sessionStorage.getItem("isPopupWindow") != "1") {//         Swal.fire("ç½‘ç«™æ¢æˆå†¬æ—¥é™å®šä¸»é¢˜å•¦â›„");//         sessionStorage.setItem("isPopupWindow", "1");//     }// }]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/lunar.js"/>
      <url>/js/lunar.js</url>
      
        <content type="html"><![CDATA[var lunarInfo=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42416,83315,21168,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448,84835,37744,18936,18800,25776,92326,59984,27424,108228,43744,41696,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,84821,19296,42352,21732,53600,59752,54560,55968,92838,22224,19168,43476,41680,53584,62034,54560],solarMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Gan=["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"],Zhi=["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"],Animals=["é¼ ","ç‰›","è™","å…”","é¾™","è›‡","é©¬","ç¾Š","çŒ´","é¸¡","ç‹—","çŒª"],solarTerm=["å°å¯’","å¤§å¯’","ç«‹æ˜¥","é›¨æ°´","æƒŠè›°","æ˜¥åˆ†","æ¸…æ˜","è°·é›¨","ç«‹å¤","å°æ»¡","èŠ’ç§","å¤è‡³","å°æš‘","å¤§æš‘","ç«‹ç§‹","å¤„æš‘","ç™½éœ²","ç§‹åˆ†","å¯’éœ²","éœœé™","ç«‹å†¬","å°é›ª","å¤§é›ª","å†¬è‡³"],sTermInfo=["9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","9778397bd19801ec9210c965cc920e","97b6b97bd19801ec95f8c965cc920f","97bd09801d98082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd197c36c9210c9274c91aa","97b6b97bd19801ec95f8c965cc920e","97bd09801d98082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec95f8c965cc920e","97bcf97c3598082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd07f595b0b6fc920fb0722","9778397bd097c36b0b6fc9210c8dc2","9778397bd19801ec9210c9274c920e","97b6b97bd19801ec95f8c965cc920f","97bd07f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c920e","97b6b97bd19801ec95f8c965cc920f","97bd07f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec9210c965cc920e","97bd07f1487f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c9274c920e","97bcf7f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c91aa","97b6b97bd197c36c9210c9274c920e","97bcf7f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c920e","97b6b7f0e47f531b0723b0b6fb0722","7f0e37f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36b0b70c9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e37f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc9210c8dc2","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0787b0721","7f0e27f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c91aa","97b6b7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c8dc2","977837f0e37f149b0723b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f5307f595b0b0bc920fb0722","7f0e397bd097c35b0b6fc9210c8dc2","977837f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0721","7f0e37f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc9210c8dc2","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0723b06bd","7f07e7f0e37f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f1487f595b0b0bb0b6fb0722","7f0e37f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e37f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0723b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0723b06bd","7f07e7f0e37f14998083b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14898082b0723b02d5","7f07e7f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e36665b66aa89801e9808297c35","665f67f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e36665b66a449801e9808297c35","665f67f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e36665b66a449801e9808297c35","665f67f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e26665b66a449801e9808297c35","665f67f0e37f1489801eb072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722"],nStr1=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹","å"],nStr2=["åˆ","å","å»¿","å…"],nStr3=["æ­£","äºŒ","ä¸‰","å››","äº”","å…­","ä¸ƒ","å…«","ä¹","å","å†¬","è…Š"];function lYearDays(b){var f,c=348;for(f=32768;f>8;f>>=1)c+=lunarInfo[b-1900]&f?1:0;return c+leapDays(b)}function leapMonth(b){return 15&lunarInfo[b-1900]}function leapDays(b){return leapMonth(b)?65536&lunarInfo[b-1900]?30:29:0}function monthDays(b,f){return f>12||f<1?-1:lunarInfo[b-1900]&65536>>f?30:29}function solarDays(b,f){if(f>12||f<1)return-1;var c=f-1;return 1===c?b%4==0&&b%100!=0||b%400==0?29:28:solarMonth[c]}function toGanZhiYear(b){var f=(b-3)%10,c=(b-3)%12;return 0===f&&(f=10),0===c&&(c=12),Gan[f-1]+Zhi[c-1]}function toAstro(b,f){return"é­”ç¾¯æ°´ç“¶åŒé±¼ç™½ç¾Šé‡‘ç‰›åŒå­å·¨èŸ¹ç‹®å­å¤„å¥³å¤©ç§¤å¤©èå°„æ‰‹é­”ç¾¯".substr(2*b-(f<[20,19,21,21,21,22,23,23,23,23,22,22][b-1]?2:0),2)+"åº§"}function toGanZhi(b){return Gan[b%10]+Zhi[b%12]}function getTerm(b,f){if(b<1900||b>2100)return-1;if(f<1||f>24)return-1;var c=sTermInfo[b-1900],e=[parseInt("0x"+c.substr(0,5)).toString(),parseInt("0x"+c.substr(5,5)).toString(),parseInt("0x"+c.substr(10,5)).toString(),parseInt("0x"+c.substr(15,5)).toString(),parseInt("0x"+c.substr(20,5)).toString(),parseInt("0x"+c.substr(25,5)).toString()],a=[e[0].substr(0,1),e[0].substr(1,2),e[0].substr(3,1),e[0].substr(4,2),e[1].substr(0,1),e[1].substr(1,2),e[1].substr(3,1),e[1].substr(4,2),e[2].substr(0,1),e[2].substr(1,2),e[2].substr(3,1),e[2].substr(4,2),e[3].substr(0,1),e[3].substr(1,2),e[3].substr(3,1),e[3].substr(4,2),e[4].substr(0,1),e[4].substr(1,2),e[4].substr(3,1),e[4].substr(4,2),e[5].substr(0,1),e[5].substr(1,2),e[5].substr(3,1),e[5].substr(4,2)];return parseInt(a[f-1])}function toChinaMonth(b){if(b>12||b<1)return-1;var f=nStr3[b-1];return f+="æœˆ"}function toChinaDay(b){var f;switch(b){case 10:f="åˆå";break;case 20:f="äºŒå";break;case 30:f="ä¸‰å";break;default:f=nStr2[Math.floor(b/10)],f+=nStr1[b%10]}return f}function getAnimal(b){return Animals[(b-4)%12]}function solar2lunar(b,f,c){if(b<1900||b>2100)return-1;if(1900===b&&1===f&&c<31)return-1;var e,a,r=null,t=0;b=(r=b?new Date(b,parseInt(f)-1,c):new Date).getFullYear(),f=r.getMonth()+1,c=r.getDate();var d=(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())-Date.UTC(1900,0,31))/864e5;for(e=1900;e<2101&&d>0;e++)d-=t=lYearDays(e);d<0&&(d+=t,e--);var n=new Date,s=!1;n.getFullYear()===b&&n.getMonth()+1===f&&n.getDate()===c&&(s=!0);var u=r.getDay(),o=nStr1[u];0===u&&(u=7);var l=e;a=leapMonth(e);var i=!1;for(e=1;e<13&&d>0;e++)a>0&&e===a+1&&!1===i?(--e,i=!0,t=leapDays(l)):t=monthDays(l,e),!0===i&&e===a+1&&(i=!1),d-=t;0===d&&a>0&&e===a+1&&(i?i=!1:(i=!0,--e)),d<0&&(d+=t,--e);var h=e,D=d+1,g=f-1,v=toGanZhiYear(l),y=getTerm(b,2*f-1),m=getTerm(b,2*f),p=toGanZhi(12*(b-1900)+f+11);c>=y&&(p=toGanZhi(12*(b-1900)+f+12));var M=!1,T=null;y===c&&(M=!0,T=solarTerm[2*f-2]),m===c&&(M=!0,T=solarTerm[2*f-1]);var I=toGanZhi(Date.UTC(b,g,1,0,0,0,0)/864e5+25567+10+c-1),C=toAstro(f,c);return{lYear:l,lMonth:h,lDay:D,Animal:getAnimal(l),IMonthCn:(i?"é—°":"")+toChinaMonth(h),IDayCn:toChinaDay(D),cYear:b,cMonth:f,cDay:c,gzYear:v,gzMonth:p,gzDay:I,isToday:s,isLeap:i,nWeek:u,ncWeek:"æ˜ŸæœŸ"+o,isTerm:M,Term:T,astro:C}}var calendarFormatter={solar2lunar:function(b,f,c){return solar2lunar(b,f,c)},lunar2solar:function(b,f,c,e){if((e=!!e)&&leapMonth!==f)return-1;if(2100===b&&12===f&&c>1||1900===b&&1===f&&c<31)return-1;var a=monthDays(b,f),r=a;if(e&&(r=leapDays(b,f)),b<1900||b>2100||c>r)return-1;for(var t=0,d=1900;d<b;d++)t+=lYearDays(d);var n=0,s=!1;for(d=1;d<f;d++)n=leapMonth(b),s||n<=d&&n>0&&(t+=leapDays(b),s=!0),t+=monthDays(b,d);e&&(t+=a);var u=Date.UTC(1900,1,30,0,0,0),o=new Date(864e5*(t+c-31)+u);return solar2lunar(o.getUTCFullYear(),o.getUTCMonth()+1,o.getUTCDate())}};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/light.js"/>
      <url>/js/light.js</url>
      
        <content type="html"><![CDATA[// éœ“è™¹ç¯æ•ˆæœ// é¢œè‰²æ•°ç»„var arr = ["#39c5bb", "#f14747", "#f1a247", "#f1ee47", "#b347f1", "#1edbff", "#ed709b", "#5636ed"];// é¢œè‰²ç´¢å¼•var idx = 0;// åˆ‡æ¢é¢œè‰²function changeColor() {    // ä»…å¤œé—´æ¨¡å¼æ‰å¯ç”¨    if (document.getElementsByTagName('html')[0].getAttribute('data-theme') == 'dark') {        if (document.getElementById("site-name"))            document.getElementById("site-name").style.textShadow = arr[idx] + " 0 0 15px";        if (document.getElementById("site-title"))            document.getElementById("site-title").style.textShadow = arr[idx] + " 0 0 15px";        if (document.getElementById("site-subtitle"))            document.getElementById("site-subtitle").style.textShadow = arr[idx] + " 0 0 10px";        if (document.getElementById("post-info"))            document.getElementById("post-info").style.textShadow = arr[idx] + " 0 0 5px";        try {            document.getElementsByClassName("author-info__name")[0].style.textShadow = arr[idx] + " 0 0 12px";            document.getElementsByClassName("author-info__description")[0].style.textShadow = arr[idx] + " 0 0 12px";        } catch {                    }        idx++;        if (idx == 8) {            idx = 0;        }    } else {        // ç™½å¤©æ¨¡å¼æ¢å¤é»˜è®¤        if (document.getElementById("site-name"))            document.getElementById("site-name").style.textShadow = "#1e1e1ee0 1px 1px 1px";        if (document.getElementById("site-title"))            document.getElementById("site-title").style.textShadow = "#1e1e1ee0 1px 1px 1px";        if (document.getElementById("site-subtitle"))            document.getElementById("site-subtitle").style.textShadow = "#1e1e1ee0 1px 1px 1px";        if (document.getElementById("post-info"))            document.getElementById("post-info").style.textShadow = "#1e1e1ee0 1px 1px 1px";        try {            document.getElementsByClassName("author-info__name")[0].style.textShadow = "";            document.getElementsByClassName("author-info__description")[0].style.textShadow = "";        } catch {                    }    }}// å¼€å¯è®¡æ—¶å™¨window.onload = setInterval(changeColor, 1200);// å­˜æ•°æ®// nameï¼šå‘½å dataï¼šæ•°æ®function saveData(name, data) {    localStorage.setItem(name, JSON.stringify({ 'time': Date.now(), 'data': data }))}// å–æ•°æ®// nameï¼šå‘½å timeï¼šè¿‡æœŸæ—¶é•¿,å•ä½åˆ†é’Ÿ,å¦‚ä¼ å…¥30,å³åŠ è½½æ•°æ®æ—¶å¦‚æœè¶…å‡º30åˆ†é’Ÿè¿”å›0,å¦åˆ™è¿”å›æ•°æ®function loadData(name, time) {    let d = JSON.parse(localStorage.getItem(name));    // è¿‡æœŸæˆ–æœ‰é”™è¯¯è¿”å› 0 å¦åˆ™è¿”å›æ•°æ®    if (d) {        let t = Date.now() - d.time        if (t < (time * 60 * 1000) && t > -1) return d.data;    }    return 0;}// ä¸Šé¢ä¸¤ä¸ªå‡½æ•°å¦‚æœä½ æœ‰å…¶ä»–éœ€è¦å­˜å–æ•°æ®çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨// è¯»å–èƒŒæ™¯try {    let data = loadData('blogbg', 1440)    if (data) changeBg(data, 1)    else localStorage.removeItem('blogbg');} catch (error) { localStorage.removeItem('blogbg'); }// åˆ‡æ¢èƒŒæ™¯å‡½æ•°// æ­¤å¤„çš„flagæ˜¯ä¸ºäº†æ¯æ¬¡è¯»å–æ—¶éƒ½é‡æ–°å­˜å‚¨ä¸€æ¬¡,å¯¼è‡´è¿‡æœŸæ—¶é—´ä¸ç¨³å®š// å¦‚æœflagä¸º0åˆ™å­˜å‚¨,å³è®¾ç½®èƒŒæ™¯. ä¸º1åˆ™ä¸å­˜å‚¨,å³æ¯æ¬¡åŠ è½½è‡ªåŠ¨è¯»å–èƒŒæ™¯.function changeBg(s, flag) {    let bg = document.getElementById('web_bg')    if (s.charAt(0) == '#') {        bg.style.backgroundColor = s        bg.style.backgroundImage = 'none'    } else bg.style.backgroundImage = s    if (!flag) { saveData('blogbg', s) }}// ä»¥ä¸‹ä¸º2.0æ–°å¢å†…å®¹// åˆ›å»ºçª—å£var winbox = ''function createWinbox() {    let div = document.createElement('div')    document.body.appendChild(div)    winbox = WinBox({        id: 'changeBgBox',        index: 999,        title: "åˆ‡æ¢èƒŒæ™¯",        x: "center",        y: "center",        minwidth: '300px',        height: "60%",        background: 'var(--leonus-blue)',        onmaximize: () => { div.innerHTML = `<style>body::-webkit-scrollbar {display: none;}div#changeBgBox {width: 100% !important;}</style>` },        onrestore: () => { div.innerHTML = '' }    });    winResize();    window.addEventListener('resize', winResize)    // æ¯ä¸€ç±»æˆ‘æ”¾äº†ä¸€ä¸ªæ¼”ç¤ºï¼Œç›´æ¥å¾€ä¸‹å¤åˆ¶ç²˜è´´ aæ ‡ç­¾ å°±å¯ä»¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ å‡½æ•°é‡Œé¢çš„é“¾æ¥ å†’å·å‰é¢éœ€è¦æ·»åŠ åæ–œæ \è¿›è¡Œè½¬ä¹‰    winbox.body.innerHTML = `    <div id="article-container" style="padding:10px;">        <p><button onclick="localStorage.removeItem('blogbg');location.reload();" style="background:#5fcdff;display:block;width:100%;padding: 15px 0;border-radius:6px;color:white;"><i class="fa-solid fa-arrows-rotate"></i> ç‚¹æˆ‘æ¢å¤é»˜è®¤èƒŒæ™¯</button></p>    <h2 id="å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰"><a href="#å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰" class="headerlink" title="å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰"></a>å›¾ç‰‡ï¼ˆæ‰‹æœºï¼‰</h2>    <div class="bgbox">    <a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://img.vm.laomishuo.com/image/2021/12/2021122715170589.jpeg)" class="pimgbox" onclick="changeBg('url(https\://img.vm.laomishuo.com/image/2021/12/2021122715170589.jpeg)')"></a>    </div>        <h2 id="å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰"><a href="#å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰" class="headerlink" title="å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰"></a>å›¾ç‰‡ï¼ˆç”µè„‘ï¼‰</h2>    <div class="bgbox">    <a href="javascript:;" rel="noopener external nofollow" style="background-image:url(https://cn.bing.com/th?id=OHR.GBRTurtle_ZH-CN6069093254_1920x1080.jpg)" class="imgbox" onclick="changeBg('url(https\://cn.bing.com/th?id=OHR.GBRTurtle_ZH-CN6069093254_1920x1080.jpg)')"></a>    </div>                <h2 id="æ¸å˜è‰²"><a href="#æ¸å˜è‰²" class="headerlink" title="æ¸å˜è‰²"></a>æ¸å˜è‰²</h2>    <div class="bgbox">    <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: linear-gradient(to right, #eecda3, #ef629f)" onclick="changeBg('linear-gradient(to right, #eecda3, #ef629f)')"></a>    </div>        <h2 id="çº¯è‰²"><a href="#çº¯è‰²" class="headerlink" title="çº¯è‰²"></a>çº¯è‰²</h2>    <div class="bgbox">    <a href="javascript:;" rel="noopener external nofollow" class="box" style="background: #7D9D9C" onclick="changeBg('#7D9D9C')"></a>     </div>`;}// é€‚åº”çª—å£å¤§å°function winResize() {    var offsetWid = document.documentElement.clientWidth;    if (offsetWid <= 768) {        winbox.resize(offsetWid * 0.95 + "px", "90%").move("center", "center");    } else {        winbox.resize(offsetWid * 0.6 + "px", "70%").move("center", "center");    }}// åˆ‡æ¢çŠ¶æ€ï¼Œçª—å£å·²åˆ›å»ºåˆ™æ§åˆ¶çª—å£æ˜¾ç¤ºå’Œéšè—ï¼Œæ²¡çª—å£åˆ™åˆ›å»ºçª—å£function toggleWinbox() {    if (document.querySelector('#changeBgBox')) winbox.toggleClass('hide');    else createWinbox();}function whenDOMReady() {    // èƒŒæ™¯localstorage    try {        let data = loadData('blogbg', 1440)        if (data) changeBg(data, 1)        else localStorage.removeItem('blogbg');    } catch (error) { localStorage.removeItem('blogbg'); }}whenDOMReady()document.addEventListener("pjax:success", whenDOMReady)// é˜²æŠ–å…¨å±€è®¡æ—¶å™¨let TT = null;    //timeç”¨æ¥æ§åˆ¶äº‹ä»¶çš„è§¦å‘// é˜²æŠ–å‡½æ•°:fn->é€»è¾‘ time->é˜²æŠ–æ—¶é—´function debounce(fn, time) {    if (TT !== null) clearTimeout(TT);    TT = setTimeout(fn, time);}// å¤åˆ¶æé†’document.addEventListener("copy", function () {    debounce(function () {        new Vue({            data: function () {                this.$notify({                    title: "å“å˜¿ï¼å¤åˆ¶æˆåŠŸğŸ¬",                    message: "è‹¥è¦è½¬è½½æœ€å¥½ä¿ç•™åŸæ–‡é“¾æ¥å“¦ï¼Œç»™ä½ ä¸€ä¸ªå¤§å¤§çš„èµï¼",                    position: 'top-left',                    offset: 50,                    showClose: true,                    type: "success",                    duration: 5000                });            }        })    }, 300);})if (GLOBAL_CONFIG.Snackbar) {    btf.snackbarShow('æ¬¢è¿å…‰ä¸´')}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/player.js"/>
      <url>/js/player.js</url>
      
        <content type="html"><![CDATA[//åˆ›å»ºä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨çš„ç±» å•ä¾‹æ¨¡å¼class Player {    constructor() { //ç±»çš„æ„é€ å‡½æ•°        //å¦‚æœæ²¡æœ‰å®ä¾‹åŒ–ï¼Œå°±å»æ„é€ ä¸€ä¸ªå®ä¾‹        return this.getInstance(...arguments);    }    //æ„å»ºå®ä¾‹    getInstance() {        let instance = new PlayerCreator(...arguments);        //è®©å®ä¾‹å¯ä»¥ä½¿ç”¨åˆ°Playerçš„åŸå‹çš„å±æ€§æ–¹æ³•        // instance.__proto__=Player.prototype;        // instance.constructor=Player;        //æŠŠæ„å»ºå¥½çš„å®ä¾‹æŒ‚åœ¨Playerç±»ä¸Š        Player.instance = instance;        return instance;    }}//æ­Œæ›²ä¿¡æ¯class Musics {    //æ­Œæ›²    constructor() {        this.songs = [{                id: 1,                title: 'è¶Šæƒè®¿é—®-å´©åï¼šæ˜Ÿç©¹é“é“ - Hanser',                singer: 'è¶Šæƒè®¿é—®-å´©åï¼šæ˜Ÿç©¹é“é“ - Hanser',                songUrl: './songs/1.mp3',                imageUrl: './images/songs/1.webp'            },            {                id: 2,                title: 'å¦„æƒ³Realityï¼ˆç¿»è‡ª æ´›å¤©ä¾ï¼‰ - ç‚ç¥¾',                singer: 'å¦„æƒ³Realityï¼ˆç¿»è‡ª æ´›å¤©ä¾ï¼‰ - ç‚ç¥¾',                songUrl: './songs/2.mp3',                imageUrl: './images/songs/2.webp'            },{                id: 3,                title: 'äººé—´å¤±å®  - æ˜”è¯º',                singer: 'äººé—´å¤±å®  - æ˜”è¯º',                songUrl: './songs/3.mp3',                imageUrl: './images/songs/3.webp'            },            {                id: 4,                title: 'å´©åä¸–ç•Œçš„æ­Œå§¬ (Movie Ver.) - å°æ—æœªéƒ',                singer: 'å´©åä¸–ç•Œçš„æ­Œå§¬ (Movie Ver.) - å°æ—æœªéƒ',                songUrl: './songs/4.mp3',                imageUrl: './images/songs/4.webp'            },{                id: 5,                title: 'ç›å¾·ç³å¨œç”µå¡” - èŠ±ç²',                singer: 'ç›å¾·ç³å¨œç”µå¡” - èŠ±ç²',                songUrl: './songs/5.mp3',                imageUrl: './images/songs/5.webp'            },        ]    }    //æ ¹æ®ç´¢å¼•è·å–æ­Œæ›²çš„æ–¹æ³•    getSongByNum(index) {        return this.songs[index];    }}//çœŸæ­£çš„æ„å»ºæ’­æ”¾å™¨çš„ç±»class PlayerCreator {    constructor() {        this.audio = document.querySelector('.music-player__audio') // Audio domå…ƒç´ , å› ä¸ºå¾ˆå¤šapiéƒ½æ˜¯éœ€è¦åŸç”Ÿaudioè°ƒç”¨çš„ï¼Œæ‰€ä»¥ä¸ç”¨jqè·å–        // this.audio.muted = true; // æ§åˆ¶é™éŸ³        this.audio.volume = 0.2;        //å·¥å…·        this.util = new Util();        this.musics = new Musics(); //æ­Œæ›²ä¿¡æ¯        this.song_index = 0; // å½“å‰æ’­æ”¾çš„æ­Œæ›²ç´¢å¼•        this.loop_mode = 1; // 1 2        // ä¸‹æ–¹æ­Œæ›²åˆ—è¡¨å®¹å™¨        this.song_list = $('.music__list_content');        this.render_doms = { //åˆ‡æ¢æ­Œæ›²æ—¶éœ€è¦æ¸²æŸ“çš„domç»„            title: $('.music__info--title'),            singer: $('.music__info--singer'),            image: $('.music-player__image img'),            blur: $('.music-player__blur')        }        this.ban_dom = { //ç¦éŸ³æ—¶éœ€è¦æ¸²æŸ“çš„domç»„            control__btn: $('.control__volume--icon')        }        // æ—¶é—´æ˜¾ç¤ºå®¹å™¨        this.render_time = {            now: $('.nowTime'),            total: $('.totalTime')        }        // å”±ç‰‡        this.disc = {            image: $('.music-player__image'),            pointer: $('.music-player__pointer')        };        //æ’­æ”¾å™¨åˆå§‹åŒ–        this.init();    }    //åˆå§‹åŒ–å‡½æ•°    init() {        this.renderSongList();        this.renderSongStyle();        this.bindEventListener();    }    //ç”Ÿæˆæ’­æ”¾åˆ—è¡¨    renderSongList() {        let _str = '';        this.musics.songs.forEach((song, i) => {            _str += `<li class="music__list__item">${song.title}</li>`        });        this.song_list.html(_str);    }    //æ ¹æ®æ­Œæ›²å»æ¸²æŸ“è§†å›¾    renderSongStyle() {        let {            title,            singer,            songUrl,            imageUrl        } = this.musics.getSongByNum(this.song_index);        this.audio.src = songUrl;        this.render_doms.title.html(title);        this.render_doms.singer.html(singer);        this.render_doms.image.prop('src', imageUrl);        this.render_doms.blur.css('background-image', 'url("' + imageUrl + '")');        //åˆ‡æ¢åˆ—è¡¨ä¸­çš„itemçš„ç±»å play        this.song_list.find('.music__list__item').eq(this.song_index).addClass('play').siblings().removeClass('play');    }    //ç»‘å®šå„ç§äº‹ä»¶    bindEventListener() {        //æ’­æ”¾æŒ‰é’®        this.$play = new Btns('.player-control__btn--play', {            click: this.handlePlayAndPause.bind(this)        });        //ä¸Šä¸€é¦–        this.$prev = new Btns('.player-control__btn--prev', {            click: this.changeSong.bind(this, 'prev')        });        //ä¸‹ä¸€é¦–        this.$next = new Btns('.player-control__btn--next', {            click: this.changeSong.bind(this, 'next')        });        //å¾ªç¯æ¨¡å¼        this.$mode = new Btns('.player-control__btn--mode', {            click: this.changePlayMode.bind(this)        });        //ç¦éŸ³        this.$ban = new Btns('.control__volume--icon', {            click: this.banNotes.bind(this)        })        //åˆ—è¡¨ç‚¹å‡»        this.song_list.on('click', 'li', (e) => {            let index = $(e.target).index();            this.changeSong(index);        })        //éŸ³é‡æ§åˆ¶ audioæ ‡ç­¾éŸ³é‡ vlouem å±æ€§æ§åˆ¶0-1        new Progress('.control__volume--progress', {            min: 0,            max: 1,            value: this.audio.volume,            handler: (value) => { //æ›´æ”¹è¿›åº¦æ—¶                this.audio.volume = value;            }        })        //æ­Œæ›²è¿›åº¦ this.audio.duration        //å¯ä»¥æ’­æ”¾çš„æ—¶å€™è§¦å‘ï¼ˆæ­Œæ›²çš„åŸºæœ¬ä¿¡æ¯éƒ½å·²ç»è·å–åˆ°äº†ï¼‰        this.audio.oncanplay = () => {            //é¿å…é‡å¤å®ä¾‹åŒ–            if (this.progress) {                this.progress.max = this.audio.duration; //åˆ‡æ¢æ­Œæ›²åæ›´æ–°æ—¶é•¿                this.render_time.total.html(this.util.formatTime(this.audio.duration));                return false;            };            this.progress = new Progress('.player__song--progress', {                min: 0,                max: this.audio.duration,                value: 0,                handler: (value) => {                    this.audio.currentTime = value;                }            })            //è°ƒæ•´æ€»æ—¶é•¿            this.render_time.total.html(this.util.formatTime(this.audio.duration));        }        //ä¼šåœ¨æ’­æ”¾çš„æ—¶å€™æŒç»­è§¦å‘        this.audio.ontimeupdate = () => {            this.progress.setValue(this.audio.currentTime);            //è°ƒæ•´å½“å‰æ—¶é•¿            this.render_time.now.html(this.util.formatTime(this.audio.currentTime));        }        //å½“æ­Œæ›²æ’­æ”¾å®Œæˆçš„æ—¶å€™        this.audio.onended = () => {            this.changeSong('next');            //æ’­æ”¾å®Œï¼Œæ¢æ­Œåï¼Œé‡æ–°æ’­æ”¾            this.audio.play();        }    }    //æ’­æ”¾æš‚åœæ§åˆ¶    handlePlayAndPause() {        let _o_i = this.$play.$el.find('i');        //this.audio.pauseedå€¼ä¸ºtrue è¯´æ˜ç›®å‰æ˜¯ä¸æ’­æ”¾        if (this.audio.paused) { //ç°åœ¨æ˜¯æš‚åœçš„ è¦æ’­æ”¾            this.audio.play();            _o_i.removeClass('icon-play').addClass('icon-pause');            this.disc.image.addClass('play');            this.disc.pointer.addClass('play')        } else {            this.audio.pause();            _o_i.addClass('icon-play').removeClass('icon-pause');            this.disc.image.removeClass('play');            this.disc.pointer.removeClass('play');        }    }    //æ›´æ”¹å¾ªç¯æ¨¡å¼    changePlayMode() {        this.loop_mode++;        if (this.loop_mode > 2) this.loop_mode = 0;        this.renderPlayMode();    }    //æ›´æ”¹æŒ‰é’®æ ·å¼    renderPlayMode() {        let _classess = ['loop', 'random', 'single'];        let _o_i = this.$mode.$el.find('i');        //prop æ”¹ä¸€äº›æ ‡ç­¾çš„è‡ªæœ‰å±æ€§ attræ”¹ä¸€äº›æ ‡ç­¾çš„è‡ªå®šä¹‰å±æ€§        _o_i.prop('class', 'iconfont icon-' + _classess[this.loop_mode])    }    //æ›´æ”¹æ­Œæ›²ç´¢å¼•    changeSongIndex(type) {        if (typeof type === 'number') {            this.song_index = type;        } else {            if (this.loop_mode === 0) {                //åˆ—è¡¨å¾ªç¯                this.song_index += type === 'next' ? 1 : -1;                if (this.song_index > this.musics.songs.length - 1) this.song_index = 0;                if (this.song_index < 0) this.song_index = this.musics.songs.length - 1;            } else if (this.loop_mode === 1) {                //éšæœºæ’­æ”¾                let _length = this.musics.songs.length;                let _random = Math.floor(Math.random() * _length);                for (let i = 0; i < 10000; i++) { //éšæœºçš„æ•°ä¸ºæœ¬èº«åˆ™ç»§ç»­éšæœº                    if (this.song_index == _random) {                        _random = Math.floor(Math.random() * _length);                    } else {                        this.song_index = _random;                        break;                    }                }            } else if (this.loop_mode === 2) {                this.song_index = this.song_index;            }        }    }    //æ­Œæ›²æ—¶é•¿    songTime() {        let totalMinute = parseInt(this.audio.duration / 60) < 10 ? "0" + parseInt(this.audio.duration / 60) : parseInt(this.audio.duration / 60);        let totalSecond = parseInt(this.audio.duration % 60) < 10 ? "0" + parseInt(this.audio.duration % 60) : parseInt(this.audio.duration % 60);        $('.totalTime').text(totalMinute + ':' + totalSecond);    }    //åˆ‡æ¢æ­Œæ›²    changeSong(type) {        //æ›´æ”¹ç´¢å¼•        this.changeSongIndex(type);        //è®°å½•åˆ‡æ­Œå‰çš„çŠ¶æ€        let _is_pause = this.audio.paused;        //åˆ‡æ­Œåæ›´æ”¹è§†å›¾æ˜¾ç¤º        this.renderSongStyle();        //å¦‚æœåˆ‡æ­Œå‰æ˜¯åœ¨æ’­æ”¾ï¼Œå°±ç»§ç»­æ’­æ”¾        if (!_is_pause) this.audio.play();    }    //ç¦éŸ³    banNotes() {        let _o_i = this.$ban.$el.find("i");        if (this.audio.muted == true) { //å¦‚æœç¦éŸ³åˆ™å¼€å¯            this.audio.muted = false;            _o_i.removeClass('icon-muted').addClass('icon-volume');        } else {            this.audio.muted = true;            _o_i.removeClass('icon-volume').addClass('icon-muted');        }    }}//è¿›åº¦æ¡class Progress {    constructor(selector, options) {        $.extend(this, options);        ///ç»™thisæŒ‚è½½ä¼ å…¥çš„å‚æ•°        this.$el = $(selector);        this.width = this.$el.width();        this.init();    }    //è¿›åº¦æ¡åˆå§‹åŒ–    init() {        this.renderBackAndPointer();        this.bindEvents();        this.drag();        this.value;        this.changeDOMStyle(this.width * this.value);    }    //ä¸ºè¿›åº¦æ¡æ¸²æŸ“backå’Œpointer    renderBackAndPointer() {        this.$back = $('<div class="back">');        this.$pointer = $('<div class="pointer">');        this.$el.append(this.$back);        this.$el.append(this.$pointer);    }    setValue(value) { //ä¸»åŠ¨è°ƒç”¨ï¼Œä¼ å…¥valueå€¼ï¼Œè®¾ç½®è¿›åº¦æ¡æ ·å¼        let _distance = this.width * value / (this.max - this.min);        this.changeDOMStyle(_distance);    }    drag() {        let ele = this.$pointer;        let father = this.$el;        let flag = false; //é¼ æ ‡æ˜¯å¦ç‚¹å‡»        ele.mousedown((e) => {            flag = true;            let mousePos = {                x: e.offsetX            }            $(document).mousemove((e) => {                if (flag === true) {                    let _left = e.clientX - father.offset().left - mousePos.x;                    let _distance = Math.max(0, Math.min(_left, father.outerWidth(false) - ele.outerWidth(false)))                    let _ratio = _distance / father.outerWidth(false);                    let _value = _ratio * (this.max - this.min); //å½“å‰çš„éŸ³é‡å€¼                    this.changeDOMStyle(_distance);                    this.handler(_value); //æ›´æ”¹è¿›åº¦ä¹‹åï¼Œæ‰§è¡Œå›è°ƒ                }            })        })        $(document).mouseup(() => {            flag = false;        })    }    bindEvents() { //é¼ æ ‡ç‚¹å‡»æ—¶æ›´æ”¹        this.$el.click((e) => {            let _x = e.offsetX; //é¼ æ ‡è·ç¦»å…ƒç´ å·¦è¾¹çš„è·ç¦»            let _ratio = _x / this.width;            let _value = _ratio * (this.max - this.min); //å½“å‰çš„éŸ³é‡å€¼            this.changeDOMStyle(_x);            this.handler(_value); //æ›´æ”¹è¿›åº¦ä¹‹åï¼Œæ‰§è¡Œå›è°ƒ        })    }    //æ›´æ”¹pointerå’Œback    changeDOMStyle(distance) {        this.$back.width(distance + 7 == 7 ? 0 : distance + 7);//è¿›åº¦ä¸º0æ—¶å°†è¿›åº¦æ¡èƒŒæ™¯æ”¹ä¸º0å¦åˆ™åŠ ä¸Šè¿›åº¦æŒ‰é’®çš„é•¿åº¦        this.$pointer.css('left', distance + 'px');    }}//æŒ‰é’®ç±» class Btns {    constructor(selector, handlers) {        this.$el = $(selector); //å…ƒç´         this.bindEvents(handlers);    }    bindEvents(handlers) { //ç»‘å®šäº‹ä»¶        for (const event in handlers) {            //ä½¿ç”¨å€¼çš„æ—¶å€™ä¿è¯é”®å€¼å¯¹åœ¨å¯¹è±¡ä¸­æ˜¯å­˜åœ¨çš„            if (handlers.hasOwnProperty(event)) {                this.$el.on(event, handlers[event]);            }        }    }}new Player();document.addEventListener('pjax:complete', (e) => {    new Player();})]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/nav.js"/>
      <url>/js/nav.js</url>
      
        <content type="html"><![CDATA[document.addEventListener('pjax:complete', tonav);document.addEventListener('DOMContentLoaded', tonav);//å“åº”pjaxfunction tonav() {    document.getElementById("name-container").setAttribute("style", "display:none");    var position = $(window).scrollTop();    $(window).scroll(function () {        var scroll = $(window).scrollTop();        if (scroll > position) {            document.getElementById("name-container").setAttribute("style", "");            document.getElementsByClassName("menus_items")[1].setAttribute("style", "display:none!important");        } else {            document.getElementsByClassName("menus_items")[1].setAttribute("style", "");            document.getElementById("name-container").setAttribute("style", "display:none");        }        position = scroll;    });    //ä¿®å¤æ²¡æœ‰å¼„å³é”®èœå•çš„ç«¥é‹æ— æ³•å›é¡¶éƒ¨çš„é—®é¢˜    document.getElementById("page-name").innerText = document.title.split(" | RuguğŸ±â€ğŸ")[0];}function scrollToTop() {    document.getElementsByClassName("menus_items")[1].setAttribute("style", "");    document.getElementById("name-container").setAttribute("style", "display:none");    btf.scrollToDest(0, 500);}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/random.js"/>
      <url>/js/random.js</url>
      
        <content type="html"><![CDATA[hexo.extend.generator.register('random', function (locals) {    const config = hexo.config.random || {}    const posts = []    for (const post of locals.posts.data) {        if (post.random !== false) posts.push(post.path)    }    return {        path: config.path || 'zhheo/random.js',        data: `var posts=${JSON.stringify(posts)};function toRandomPost(){pjax.loadUrl('/'+posts[Math.floor(Math.random() * posts.length)]);};`    }})]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/readPercent.js"/>
      <url>/js/readPercent.js</url>
      
        <content type="html"><![CDATA[window.onscroll = percent;// æ‰§è¡Œå‡½æ•°// é¡µé¢ç™¾åˆ†æ¯”function percent() {    let a = document.documentElement.scrollTop || window.pageYOffset, // å·å»é«˜åº¦        b = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight, document.body.clientHeight, document.documentElement.clientHeight) - document.documentElement.clientHeight, // æ•´ä¸ªç½‘é¡µé«˜åº¦        result = Math.round(a / b * 100), // è®¡ç®—ç™¾åˆ†æ¯”        up = document.querySelector("#go-up") // è·å–æŒ‰é’®    if (result <= 95) {        up.childNodes[0].style.display = 'none'        up.childNodes[1].style.display = 'block'        up.childNodes[1].innerHTML = result;    } else {        up.childNodes[1].style.display = 'none'        up.childNodes[0].style.display = 'block'    }}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/share.js"/>
      <url>/js/share.js</url>
      
        <content type="html"><![CDATA[// åˆ†äº«æœ¬é¡µfunction share_() {    let url = window.location.origin + window.location.pathname    try {        // æˆªå–æ ‡é¢˜        var title = document.title;        var subTitle = title.endsWith("| Ruguâ˜•") ? title.substring(0, title.length - 14) : title;        navigator.clipboard.writeText('Ruguâ˜•çš„ç«™å†…åˆ†äº«\næ ‡é¢˜ï¼š' + subTitle + '\né“¾æ¥ï¼š' + url + '\næ¬¢è¿æ¥è®¿ï¼ğŸ­ğŸ­ğŸ­');        new Vue({            data: function () {                this.$notify({                    title: "æˆåŠŸå¤åˆ¶åˆ†äº«ä¿¡æ¯ğŸ‰",                    message: "æ‚¨ç°åœ¨å¯ä»¥é€šè¿‡ç²˜è´´ç›´æ¥è·Ÿå°ä¼™ä¼´åˆ†äº«äº†ï¼",                    position: 'top-left',                    offset: 50,                    showClose: true,                    type: "success",                     duration: 5000                });                // return { visible: false }            }        })    } catch (err) {        console.error('å¤åˆ¶å¤±è´¥ï¼', err);    }}// é˜²æŠ–function share() {    debounce(share_, 300);}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/rightMenu.js"/>
      <url>/js/rightMenu.js</url>
      
        <content type="html"><![CDATA[var rm = {};rm.showRightMenu = function (isTrue, x = 0, y = 0) {  let $rightMenu = $("#rightMenu");  $rightMenu.css("top", x + "px").css("left", y + "px");  if (isTrue) {    stopMaskScroll();    $rightMenu.show();  } else {    $rightMenu.hide();  }};let rmWidth = $("#rightMenu").width();let rmHeight = $("#rightMenu").height();rm.reloadrmSize = function () {  rmWidth = $("#rightMenu").width();  rmHeight = $("#rightMenu").height();};window.oncontextmenu = function (event) {  if (document.body.clientWidth > 768) {    let pageX = event.clientX + 10;    let pageY = event.clientY;    let $rightMenuNormal = $(".rightMenuNormal");    let $rightMenuOther = $(".rightMenuOther");    let $rightMenuReadmode = $("#menu-readmode");    $rightMenuNormal.show();    $rightMenuOther.show();    rm.reloadrmSize();    if (pageX + rmWidth > window.innerWidth) {      pageX -= rmWidth;    }    if (pageY + rmHeight > window.innerHeight) {      pageY -= rmHeight;    }    rm.showRightMenu(true, pageY, pageX);    $("#rightmenu-mask").attr("style", "display: flex");    return false;  }};function removeRightMenu() {  rm.showRightMenu(false);  $("#rightmenu-mask").attr("style", "display: none");}function stopMaskScroll() {  if (document.getElementById("rightmenu-mask")) {    let xscroll = document.getElementById("rightmenu-mask");    xscroll.addEventListener(      "mousewheel",      function (e) {        removeRightMenu();      },      false    );  }  if (document.getElementById("rightMenu")) {    let xscroll = document.getElementById("rightMenu");    xscroll.addEventListener(      "mousewheel",      function (e) {        removeRightMenu();      },      false    );  }}/** * @name:  åˆ‡æ›æ¨¡å¼ */function switchDarkMode() {  removeRightMenu();  const nowMode =    document.documentElement.getAttribute("data-theme") === "dark"      ? "dark"      : "light";  if (nowMode === "light") {    activateDarkMode();    saveToLocal.set("theme", "dark", 2);    GLOBAL_CONFIG.Snackbar !== undefined &&      btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night);  } else {    activateLightMode();    saveToLocal.set("theme", "light", 2);    GLOBAL_CONFIG.Snackbar !== undefined &&      btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day);  }  typeof utterancesTheme === "function" && utterancesTheme();  typeof FB === "object" && window.loadFBComment();  window.DISQUS &&    document.getElementById("disqus_thread").children.length &&    setTimeout(() => window.disqusReset(), 200);}/* eslint-disable no-undef */document.addEventListener("DOMContentLoaded", function () {  translateInitialization();  document.addEventListener("pjax:complete", translateInitialization);});const translate = GLOBAL_CONFIG.translate;const snackbarData = GLOBAL_CONFIG.Snackbar;const defaultEncoding =  translate.defaultEncoding; /* ç¶²ç«™é»˜èªèªè¨€ï¼Œ1: ç¹é«”ä¸­æ–‡, 2: ç°¡é«”ä¸­æ–‡ */const translateDelay =  translate.translateDelay; /* å»¶é²æ™‚é–“,è‹¥ä¸åœ¨å‰, è¦è¨­å®šå»¶é²ç¿»è­¯æ™‚é–“, å¦‚100è¡¨ç¤º100ms,é»˜èªç‚º0 */const msgToTraditionalChinese =  translate.msgToTraditionalChinese; /* æ­¤è™•å¯ä»¥æ›´æ”¹ç‚ºä½ æƒ³è¦é¡¯ç¤ºçš„æ–‡å­— */const msgToSimplifiedChinese =  translate.msgToSimplifiedChinese; /* åŒä¸Šï¼Œä½†å…©è™•å‡ä¸å»ºè­°æ›´æ”¹ */let currentEncoding = defaultEncoding;const targetEncodingCookie = "translate-chn-cht";let targetEncoding =  saveToLocal.get(targetEncodingCookie) === undefined    ? defaultEncoding    : Number(saveToLocal.get("translate-chn-cht"));let translateButtonObject;const isSnackbar = GLOBAL_CONFIG.Snackbar !== undefined;function translateText(txt) {  if (txt === "" || txt == null) return "";  if (currentEncoding === 1 && targetEncoding === 2) return Simplized(txt);  else if (currentEncoding === 2 && targetEncoding === 1) {    return Traditionalized(txt);  } else return txt;}function translateBody(fobj) {  let objs;  if (typeof fobj === "object") objs = fobj.childNodes;  else objs = document.body.childNodes;  for (let i = 0; i < objs.length; i++) {    const obj = objs.item(i);    if (      "||BR|HR|".indexOf("|" + obj.tagName + "|") > 0 ||      obj === translateButtonObject    ) {      continue;    }    if (obj.title !== "" && obj.title != null) {      obj.title = translateText(obj.title);    }    if (obj.alt !== "" && obj.alt != null) obj.alt = translateText(obj.alt);    if (obj.placeholder !== "" && obj.placeholder != null)      obj.placeholder = translateText(obj.placeholder);    if (      obj.tagName === "INPUT" &&      obj.value !== "" &&      obj.type !== "text" &&      obj.type !== "hidden"    ) {      obj.value = translateText(obj.value);    }    if (obj.nodeType === 3) obj.data = translateText(obj.data);    else translateBody(obj);  }}function translatePage() {  if (targetEncoding === 1) {    currentEncoding = 1;    targetEncoding = 2;    saveToLocal.set(targetEncodingCookie, targetEncoding, 2);    translateBody();    if (isSnackbar) btf.snackbarShow(snackbarData.cht_to_chs);  } else if (targetEncoding === 2) {    currentEncoding = 2;    targetEncoding = 1;    saveToLocal.set(targetEncodingCookie, targetEncoding, 2);    translateBody();    if (isSnackbar) btf.snackbarShow(snackbarData.chs_to_cht);  }}function JTPYStr() {  return "ä¸‡ä¸ä¸‘ä¸“ä¸šä¸›ä¸œä¸ä¸¢ä¸¤ä¸¥ä¸§ä¸ªä¸¬ä¸°ä¸´ä¸ºä¸½ä¸¾ä¹ˆä¹‰ä¹Œä¹ä¹”ä¹ ä¹¡ä¹¦ä¹°ä¹±äº‰äºäºäº‘äº˜äºšäº§äº©äº²äºµäº¸äº¿ä»…ä»ä»‘ä»“ä»ªä»¬ä»·ä¼—ä¼˜ä¼™ä¼šä¼›ä¼ä¼Ÿä¼ ä¼¤ä¼¥ä¼¦ä¼§ä¼ªä¼«ä½“ä½™ä½£ä½¥ä¾ ä¾£ä¾¥ä¾¦ä¾§ä¾¨ä¾©ä¾ªä¾¬ä¿£ä¿¦ä¿¨ä¿©ä¿ªä¿­å€ºå€¾å¬å»å¾å¿å‚¥å‚§å‚¨å‚©å„¿å…‘å…–å…šå…°å…³å…´å…¹å…»å…½å†å†…å†ˆå†Œå†™å†›å†œå†¢å†¯å†²å†³å†µå†»å‡€å‡„å‡‰å‡Œå‡å‡‘å‡›å‡ å‡¤å‡«å‡­å‡¯å‡»å‡¼å‡¿åˆåˆ’åˆ˜åˆ™åˆšåˆ›åˆ åˆ«åˆ¬åˆ­åˆ½åˆ¿å‰€å‰‚å‰å‰‘å‰¥å‰§åŠåŠåŠ¡åŠ¢åŠ¨åŠ±åŠ²åŠ³åŠ¿å‹‹å‹å‹šåŒ€åŒ¦åŒ®åŒºåŒ»ååå•å–å¢å¤å§å«å´åºå‚å…å†å‰å‹åŒåå•å¢å£å¦å¨å©å®å¿å‚å†å‡åŒå‘å˜å™å å¶å·å¹å½ååå“å•å—å£å¨å¬å¯å´å‘’å‘“å‘•å‘–å‘—å‘˜å‘™å‘›å‘œå’å’”å’™å’›å’å’¤å’´å’¸å“Œå“å“‘å“’å““å“”å“•å“—å“™å“œå“å“Ÿå”›å”å” å”¡å”¢å”£å”¤å”¿å•§å•¬å•­å•®å•°å•´å•¸å–·å–½å–¾å—«å‘µå—³å˜˜å˜¤å˜±å™œå™¼åš£åš¯å›¢å›­å›±å›´å›µå›½å›¾åœ†åœ£åœ¹åœºå‚åå—åšå›åœåååŸå å„å…å†å’å¦å§å©å«å­å¯å±å²å´åŸ˜åŸ™åŸšåŸåŸ¯å ‘å •å¡†å¢™å£®å£°å£³å£¶å£¸å¤„å¤‡å¤å¤Ÿå¤´å¤¸å¤¹å¤ºå¥å¥‚å¥‹å¥–å¥¥å¦†å¦‡å¦ˆå¦©å¦ªå¦«å§—å§œå¨„å¨…å¨†å¨‡å¨ˆå¨±å¨²å¨´å©³å©´å©µå©¶åªªå«’å«”å«±å¬·å­™å­¦å­ªå®å®å®å® å®¡å®ªå®«å®½å®¾å¯å¯¹å¯»å¯¼å¯¿å°†å°”å°˜å°§å°´å°¸å°½å±‚å±ƒå±‰å±Šå±å±¡å±¦å±¿å²å²‚å²–å²—å²˜å²™å²šå²›å²­å²³å²½å²¿å³ƒå³„å³¡å³£å³¤å³¥å³¦å´‚å´ƒå´„å´­åµ˜åµšåµ›åµåµ´å·…å·©å·¯å¸å¸…å¸ˆå¸å¸å¸˜å¸œå¸¦å¸§å¸®å¸±å¸»å¸¼å¹‚å¹å¹²å¹¶å¹¿åº„åº†åºåº‘åº“åº”åº™åºåºŸåº¼å»ªå¼€å¼‚å¼ƒå¼ å¼¥å¼ªå¼¯å¼¹å¼ºå½’å½“å½•å½Ÿå½¦å½»å¾„å¾•å¾¡å¿†å¿å¿§å¿¾æ€€æ€æ€‚æ€ƒæ€„æ€…æ€†æ€œæ€»æ€¼æ€¿æ‹æ³æ¶æ¸æ¹æºæ»æ¼æ½æ‚¦æ‚«æ‚¬æ‚­æ‚¯æƒŠæƒ§æƒ¨æƒ©æƒ«æƒ¬æƒ­æƒ®æƒ¯æ„æ„ æ„¤æ„¦æ„¿æ…‘æ…­æ†·æ‡‘æ‡’æ‡”æˆ†æˆ‹æˆæˆ—æˆ˜æˆ¬æˆ·æ‰æ‰‘æ‰¦æ‰§æ‰©æ‰ªæ‰«æ‰¬æ‰°æŠšæŠ›æŠŸæŠ æŠ¡æŠ¢æŠ¤æŠ¥æ‹…æ‹Ÿæ‹¢æ‹£æ‹¥æ‹¦æ‹§æ‹¨æ‹©æŒ‚æŒšæŒ›æŒœæŒæŒæŒŸæŒ æŒ¡æŒ¢æŒ£æŒ¤æŒ¥æŒ¦ææŸæ¡æ¢æ£æ®æ»æ³æ´æ·æ¸æºæ¼æ¸æ½æ¿æ€ææ‚æ…æºæ‘„æ‘…æ‘†æ‘‡æ‘ˆæ‘Šæ’„æ’‘æ’µæ’·æ’¸æ’ºæ“æ”’æ•Œæ•›æ•°æ–‹æ–“æ–—æ–©æ–­æ— æ—§æ—¶æ—·æ—¸æ˜™æ˜¼æ˜½æ˜¾æ™‹æ™’æ™“æ™”æ™•æ™–æš‚æš§æœ­æœ¯æœ´æœºæ€æ‚æƒæ¡æ¥æ¨æ©æ°ææ„ææ¢æ£æ¥æ§æ¨æªæ«æ­æŸœæŸ æŸ½æ €æ …æ ‡æ ˆæ ‰æ Šæ ‹æ Œæ æ æ ‘æ –æ ·æ ¾æ¡Šæ¡ æ¡¡æ¡¢æ¡£æ¡¤æ¡¥æ¡¦æ¡§æ¡¨æ¡©æ¢¦æ¢¼æ¢¾æ£€æ£‚æ¤æ¤Ÿæ¤ æ¤¤æ¤­æ¥¼æ¦„æ¦‡æ¦ˆæ¦‰æ§šæ§›æ§Ÿæ§ æ¨ªæ¨¯æ¨±æ©¥æ©±æ©¹æ©¼æªæª©æ¬¢æ¬¤æ¬§æ­¼æ®æ®‡æ®‹æ®’æ®“æ®šæ®¡æ®´æ¯æ¯‚æ¯•æ¯™æ¯¡æ¯µæ°‡æ°”æ°¢æ°©æ°²æ±‡æ±‰æ±¡æ±¤æ±¹æ²“æ²Ÿæ²¡æ²£æ²¤æ²¥æ²¦æ²§æ²¨æ²©æ²ªæ²µæ³æ³ªæ³¶æ³·æ³¸æ³ºæ³»æ³¼æ³½æ³¾æ´æ´’æ´¼æµƒæµ…æµ†æµ‡æµˆæµ‰æµŠæµ‹æµæµæµæµæµ‘æµ’æµ“æµ”æµ•æ¶‚æ¶Œæ¶›æ¶æ¶æ¶Ÿæ¶ æ¶¡æ¶¢æ¶£æ¶¤æ¶¦æ¶§æ¶¨æ¶©æ·€æ¸Šæ¸Œæ¸æ¸æ¸æ¸‘æ¸”æ¸–æ¸—æ¸©æ¸¸æ¹¾æ¹¿æºƒæº…æº†æº‡æ»—æ»šæ»æ»Ÿæ» æ»¡æ»¢æ»¤æ»¥æ»¦æ»¨æ»©æ»ªæ¼¤æ½†æ½‡æ½‹æ½æ½œæ½´æ¾œæ¿‘æ¿’çç­ç¯çµç¾ç¿ç‚€ç‚‰ç‚–ç‚œç‚ç‚¹ç‚¼ç‚½çƒçƒ‚çƒƒçƒ›çƒŸçƒ¦çƒ§çƒ¨çƒ©çƒ«çƒ¬çƒ­ç„•ç„–ç„˜ç……ç…³ç†˜çˆ±çˆ·ç‰ç‰¦ç‰µç‰ºçŠŠçŠŸçŠ¶çŠ·çŠ¸çŠ¹ç‹ˆç‹ç‹ç‹ç‹¬ç‹­ç‹®ç‹¯ç‹°ç‹±ç‹²çŒƒçŒçŒ•çŒ¡çŒªçŒ«çŒ¬çŒ®ç­ç‘ç™çšç›ç®ç¯ç°ç±çºç‰ççç‘ç°ç²çççç¼ç‘¶ç‘·ç’‡ç’ç“’ç“®ç“¯ç”µç”»ç•…ç•²ç•´ç––ç–—ç–Ÿç– ç–¡ç–¬ç–®ç–¯ç–±ç–´ç—ˆç—‰ç—’ç—–ç—¨ç—ªç—«ç—´ç˜…ç˜†ç˜—ç˜˜ç˜ªç˜«ç˜¾ç˜¿ç™ç™£ç™«ç™¯çš‘çš±çš²ç›ç›ç›‘ç›–ç›—ç›˜çœçœ¦çœ¬ç€ççç‘ç’ç©çŸ«çŸ¶çŸ¾çŸ¿ç €ç ç –ç —ç šç œç ºç »ç ¾ç¡€ç¡ç¡…ç¡•ç¡–ç¡—ç¡™ç¡šç¡®ç¡·ç¢ç¢›ç¢œç¢±ç¢¹ç£™ç¤¼ç¥ç¥¢ç¥¯ç¥·ç¥¸ç¦€ç¦„ç¦…ç¦»ç§ƒç§†ç§ç§¯ç§°ç§½ç§¾ç¨†ç¨ç¨£ç¨³ç©‘ç©·çªƒçªçª‘çªœçªçª¥çª¦çª­ç«–ç«ç¬ƒç¬‹ç¬”ç¬•ç¬ºç¬¼ç¬¾ç­‘ç­šç­›ç­œç­ç­¹ç­¾ç®€ç®“ç®¦ç®§ç®¨ç®©ç®ªç®«ç¯‘ç¯“ç¯®ç¯±ç°–ç±ç±´ç±»ç±¼ç²œç²ç²¤ç²ªç²®ç³ç³‡ç´§çµ·çºŸçº çº¡çº¢çº£çº¤çº¥çº¦çº§çº¨çº©çºªçº«çº¬çº­çº®çº¯çº°çº±çº²çº³çº´çºµçº¶çº·çº¸çº¹çººçº»çº¼çº½çº¾çº¿ç»€ç»ç»‚ç»ƒç»„ç»…ç»†ç»‡ç»ˆç»‰ç»Šç»‹ç»Œç»ç»ç»ç»ç»‘ç»’ç»“ç»”ç»•ç»–ç»—ç»˜ç»™ç»šç»›ç»œç»ç»ç»Ÿç» ç»¡ç»¢ç»£ç»¤ç»¥ç»¦ç»§ç»¨ç»©ç»ªç»«ç»¬ç»­ç»®ç»¯ç»°ç»±ç»²ç»³ç»´ç»µç»¶ç»·ç»¸ç»¹ç»ºç»»ç»¼ç»½ç»¾ç»¿ç¼€ç¼ç¼‚ç¼ƒç¼„ç¼…ç¼†ç¼‡ç¼ˆç¼‰ç¼Šç¼‹ç¼Œç¼ç¼ç¼ç¼ç¼‘ç¼’ç¼“ç¼”ç¼•ç¼–ç¼—ç¼˜ç¼™ç¼šç¼›ç¼œç¼ç¼ç¼Ÿç¼ ç¼¡ç¼¢ç¼£ç¼¤ç¼¥ç¼¦ç¼§ç¼¨ç¼©ç¼ªç¼«ç¼¬ç¼­ç¼®ç¼¯ç¼°ç¼±ç¼²ç¼³ç¼´ç¼µç½‚ç½‘ç½—ç½šç½¢ç½´ç¾ç¾Ÿç¾¡ç¿˜ç¿™ç¿šè€¢è€§è€¸è€»è‚è‹èŒèè”è©èªè‚ƒè‚ è‚¤è‚·è‚¾è‚¿èƒ€èƒèƒ†èƒœèƒ§èƒ¨èƒªèƒ«èƒ¶è„‰è„è„è„è„‘è„“è„”è„šè„±è„¶è„¸è…Šè…Œè…˜è…­è…»è…¼è…½è…¾è†‘è‡œèˆ†èˆ£èˆ°èˆ±èˆ»è‰°è‰³è‰¹è‰ºèŠ‚èŠˆèŠ—èŠœèŠ¦è‹è‹‡è‹ˆè‹‹è‹Œè‹è‹è‹è‹˜è‹¹èŒèŒèŒ‘èŒ”èŒ•èŒ§è†èè™èšè›èœèèŸè è¡è£è¤è¥è¦è§è¨è©èªè«è¬è­è®è¯è…èœè±è²è³è´è¶è·è¸è¹èºè¼èšèè¤è¥è¦è§è¨è‘±è’‡è’‰è’‹è’Œè“è“Ÿè“ è“£è“¥è“¦è”·è”¹è”ºè”¼è•²è•´è–®è—è—“è™è™‘è™šè™«è™¬è™®è™½è™¾è™¿èš€èšèš‚èš•èšèš¬è›Šè›è›è›®è›°è›±è›²è›³è›´èœ•èœ—èœ¡è‡èˆè‰èè¼è¾è€è¨èŸè¡…è¡”è¡¥è¡¬è¡®è¢„è¢…è¢†è¢œè¢­è¢¯è£…è£†è£ˆè£¢è££è£¤è£¥è¤›è¤´è¥è¥•è§è§‚è§ƒè§„è§…è§†è§‡è§ˆè§‰è§Šè§‹è§Œè§è§è§è§è§‘è§è§¦è§¯è©Ÿèª‰èªŠè® è®¡è®¢è®£è®¤è®¥è®¦è®§è®¨è®©è®ªè®«è®­è®®è®¯è®°è®±è®²è®³è®´è®µè®¶è®·è®¸è®¹è®ºè®»è®¼è®½è®¾è®¿è¯€è¯è¯‚è¯ƒè¯„è¯…è¯†è¯‡è¯ˆè¯‰è¯Šè¯‹è¯Œè¯è¯è¯è¯è¯‘è¯’è¯“è¯”è¯•è¯–è¯—è¯˜è¯™è¯šè¯›è¯œè¯è¯è¯Ÿè¯ è¯¡è¯¢è¯£è¯¤è¯¥è¯¦è¯§è¯¨è¯©è¯ªè¯«è¯¬è¯­è¯®è¯¯è¯°è¯±è¯²è¯³è¯´è¯µè¯¶è¯·è¯¸è¯¹è¯ºè¯»è¯¼è¯½è¯¾è¯¿è°€è°è°‚è°ƒè°„è°…è°†è°‡è°ˆè°Šè°‹è°Œè°è°è°è°è°‘è°’è°“è°”è°•è°–è°—è°˜è°™è°šè°›è°œè°è°è°Ÿè° è°¡è°¢è°£è°¤è°¥è°¦è°§è°¨è°©è°ªè°«è°¬è°­è°®è°¯è°°è°±è°²è°³è°´è°µè°¶è°·è±®è´è´è´Ÿè´ è´¡è´¢è´£è´¤è´¥è´¦è´§è´¨è´©è´ªè´«è´¬è´­è´®è´¯è´°è´±è´²è´³è´´è´µè´¶è´·è´¸è´¹è´ºè´»è´¼è´½è´¾è´¿èµ€èµèµ‚èµƒèµ„èµ…èµ†èµ‡èµˆèµ‰èµŠèµ‹èµŒèµèµèµèµèµ‘èµ’èµ“èµ”èµ•èµ–èµ—èµ˜èµ™èµšèµ›èµœèµèµèµŸèµ èµ¡èµ¢èµ£èµªèµµèµ¶è¶‹è¶±è¶¸è·ƒè·„è·–è·è·µè·¶è··è·¸è·¹è·»è¸Šè¸Œè¸ªè¸¬è¸¯è¹‘è¹’è¹°è¹¿èºèºœèº¯è½¦è½§è½¨è½©è½ªè½«è½¬è½­è½®è½¯è½°è½±è½²è½³è½´è½µè½¶è½·è½¸è½¹è½ºè½»è½¼è½½è½¾è½¿è¾€è¾è¾‚è¾ƒè¾„è¾…è¾†è¾‡è¾ˆè¾‰è¾Šè¾‹è¾Œè¾è¾è¾è¾è¾‘è¾’è¾“è¾”è¾•è¾–è¾—è¾˜è¾™è¾šè¾è¾©è¾«è¾¹è¾½è¾¾è¿è¿‡è¿ˆè¿è¿˜è¿™è¿›è¿œè¿è¿è¿Ÿè¿©è¿³è¿¹é€‚é€‰é€Šé€’é€¦é€»é—é¥é‚“é‚é‚¬é‚®é‚¹é‚ºé‚»éƒéƒ„éƒéƒéƒ‘éƒ“éƒ¦éƒ§éƒ¸é…é…¦é…±é…½é…¾é…¿é‡Šé‡Œé‰…é‰´éŠ®éŒ¾é’†é’‡é’ˆé’‰é’Šé’‹é’Œé’é’é’é’é’‘é’’é’“é’”é’•é’–é’—é’˜é’™é’šé’›é’é’é’Ÿé’ é’¡é’¢é’£é’¤é’¥é’¦é’§é’¨é’©é’ªé’«é’¬é’­é’®é’¯é’°é’±é’²é’³é’´é’µé’¶é’·é’¸é’¹é’ºé’»é’¼é’½é’¾é’¿é“€é“é“‚é“ƒé“„é“…é“†é“ˆé“‰é“Šé“‹é“é“é“é“é“‘é“’é“•é“—é“˜é“™é“šé“›é“œé“é“é“Ÿé“ é“¡é“¢é“£é“¤é“¥é“¦é“§é“¨é“ªé“«é“¬é“­é“®é“¯é“°é“±é“²é“³é“´é“µé“¶é“·é“¸é“¹é“ºé“»é“¼é“½é“¾é“¿é”€é”é”‚é”ƒé”„é”…é”†é”‡é”ˆé”‰é”Šé”‹é”Œé”é”é”é”é”‘é”’é”“é””é”•é”–é”—é”™é”šé”œé”é”Ÿé” é”¡é”¢é”£é”¤é”¥é”¦é”¨é”©é”«é”¬é”­é”®é”¯é”°é”±é”²é”³é”´é”µé”¶é”·é”¸é”¹é”ºé”»é”¼é”½é”¾é”¿é•€é•é•‚é•ƒé•†é•‡é•ˆé•‰é•Šé•Œé•é•é•é•é•‘é•’é••é•–é•—é•™é•šé•›é•œé•é•é•Ÿé• é•¡é•¢é•£é•¤é•¥é•¦é•§é•¨é•©é•ªé•«é•¬é•­é•®é•¯é•°é•±é•²é•³é•´é•¶é•¿é—¨é—©é—ªé—«é—¬é—­é—®é—¯é—°é—±é—²é—³é—´é—µé—¶é—·é—¸é—¹é—ºé—»é—¼é—½é—¾é—¿é˜€é˜é˜‚é˜ƒé˜„é˜…é˜†é˜‡é˜ˆé˜‰é˜Šé˜‹é˜Œé˜é˜é˜é˜é˜‘é˜’é˜“é˜”é˜•é˜–é˜—é˜˜é˜™é˜šé˜›é˜Ÿé˜³é˜´é˜µé˜¶é™…é™†é™‡é™ˆé™‰é™•é™§é™¨é™©éšéšéš¶éš½éš¾é›é› é›³é›¾éœéœ‰éœ­é“é™é¥é‘é’é¯é´éŸ¦éŸ§éŸ¨éŸ©éŸªéŸ«éŸ¬éŸµé¡µé¡¶é¡·é¡¸é¡¹é¡ºé¡»é¡¼é¡½é¡¾é¡¿é¢€é¢é¢‚é¢ƒé¢„é¢…é¢†é¢‡é¢ˆé¢‰é¢Šé¢‹é¢Œé¢é¢é¢é¢é¢‘é¢’é¢“é¢”é¢•é¢–é¢—é¢˜é¢™é¢šé¢›é¢œé¢é¢é¢Ÿé¢ é¢¡é¢¢é¢£é¢¤é¢¥é¢¦é¢§é£é£é£é£‘é£’é£“é£”é£•é£–é£—é£˜é£™é£šé£é£¨é¤é¥¤é¥¥é¥¦é¥§é¥¨é¥©é¥ªé¥«é¥¬é¥­é¥®é¥¯é¥°é¥±é¥²é¥³é¥´é¥µé¥¶é¥·é¥¸é¥¹é¥ºé¥»é¥¼é¥½é¥¾é¥¿é¦€é¦é¦‚é¦ƒé¦„é¦…é¦†é¦‡é¦ˆé¦‰é¦Šé¦‹é¦Œé¦é¦é¦é¦é¦‘é¦’é¦“é¦”é¦•é©¬é©­é©®é©¯é©°é©±é©²é©³é©´é©µé©¶é©·é©¸é©¹é©ºé©»é©¼é©½é©¾é©¿éª€éªéª‚éªƒéª„éª…éª†éª‡éªˆéª‰éªŠéª‹éªŒéªéªéªéªéª‘éª’éª“éª”éª•éª–éª—éª˜éª™éªšéª›éªœéªéªéªŸéª éª¡éª¢éª£éª¤éª¥éª¦éª§é«…é«‹é«Œé¬“é­‡é­‰é±¼é±½é±¾é±¿é²€é²é²‚é²„é²…é²†é²‡é²ˆé²‰é²Šé²‹é²Œé²é²é²é²é²‘é²’é²“é²”é²•é²–é²—é²˜é²™é²šé²›é²œé²é²é²Ÿé² é²¡é²¢é²£é²¤é²¥é²¦é²§é²¨é²©é²ªé²«é²¬é²­é²®é²¯é²°é²±é²²é²³é²´é²µé²¶é²·é²¸é²¹é²ºé²»é²¼é²½é²¾é²¿é³€é³é³‚é³ƒé³„é³…é³†é³‡é³ˆé³‰é³Šé³‹é³Œé³é³é³é³é³‘é³’é³“é³”é³•é³–é³—é³˜é³™é³›é³œé³é³é³Ÿé³ é³¡é³¢é³£é¸Ÿé¸ é¸¡é¸¢é¸£é¸¤é¸¥é¸¦é¸§é¸¨é¸©é¸ªé¸«é¸¬é¸­é¸®é¸¯é¸°é¸±é¸²é¸³é¸´é¸µé¸¶é¸·é¸¸é¸¹é¸ºé¸»é¸¼é¸½é¸¾é¸¿é¹€é¹é¹‚é¹ƒé¹„é¹…é¹†é¹‡é¹ˆé¹‰é¹Šé¹‹é¹Œé¹é¹é¹é¹é¹‘é¹’é¹“é¹”é¹•é¹–é¹—é¹˜é¹šé¹›é¹œé¹é¹é¹Ÿé¹ é¹¡é¹¢é¹£é¹¤é¹¥é¹¦é¹§é¹¨é¹©é¹ªé¹«é¹¬é¹­é¹¯é¹°é¹±é¹²é¹³é¹´é¹¾éº¦éº¸é»„é»‰é»¡é»©é»ªé»¾";}function FTPYStr() {  return "è¬èˆ‡é†œå°ˆæ¥­å¢æ±çµ²ä¸Ÿå…©åš´å–ªå€‹çˆ¿è±è‡¨ç‚ºéº—èˆ‰éº¼ç¾©çƒæ¨‚å–¬ç¿’é„‰æ›¸è²·äº‚çˆ­æ–¼è™§é›²äº™äºç”¢ç•è¦ªè¤»åš²å„„åƒ…å¾ä¾–å€‰å„€å€‘åƒ¹çœ¾å„ªå¤¥æœƒå‚´å‚˜å‰å‚³å‚·å€€å€«å‚–å½ä½‡é«”é¤˜å‚­åƒ‰ä¿ ä¾¶åƒ¥åµå´åƒ‘å„ˆå„•å„‚ä¿å„”å„¼å€†å„·å„‰å‚µå‚¾å‚¯åƒ‚åƒ¨å„Ÿå„»å„å„²å„ºå…’å…Œå…—é»¨è˜­é—œèˆˆèŒ²é¤Šç¸å›…å…§å²¡å†Šå¯«è»è¾²å¡šé¦®è¡æ±ºæ³å‡æ·¨æ·’æ¶¼æ·©æ¸›æ¹Šå‡œå¹¾é³³é³§æ†‘å‡±æ“Šæ°¹é‘¿èŠ»åŠƒåŠ‰å‰‡å‰›å‰µåˆªåˆ¥å‰—å‰„åŠŠåŠŒå‰´åŠ‘å‰®åŠå‰åŠ‡å‹¸è¾¦å‹™å‹±å‹•å‹µå‹å‹å‹¢å‹³çŒ›å‹©å‹»åŒ­åŒ±å€é†«è¯å”å–®è³£ç›§é¹µè‡¥è¡›å»å·¹å» å»³æ›†å²å£“å­å™å»å»‚å´å»ˆå»šå»„å»ç¸£åƒé‰é†é›™ç™¼è®Šæ•˜ç–Šè‘‰è™Ÿæ­å˜°ç±²å¾Œåš‡å‘‚å—å”šå™¸è½å•Ÿå³å˜¸å›ˆå˜”åš¦å”„å“¡å’¼å—†å—šè© å“¢åš¨åš€å™å’å™…é¹¹å‘±éŸ¿å•å™ å˜µå—¶å™¦å˜©å™²åšŒå™¥å–²å˜œå—Šå˜®å•¢å—©å”•å–šå‘¼å˜–å—‡å›€é½§å›‰å˜½å˜¯å™´å˜åš³å›å—¬å™¯å™“åš¶å›‘åš•åŠˆå›‚è¬”åœ˜åœ’å›ªåœåœ‡åœ‹åœ–åœ“è–å£™å ´é˜ªå£å¡Šå …å£‡å£¢å£©å¡¢å¢³å¢œå£Ÿå£Ÿå£šå£˜å¢¾å°å Šå¢ŠåŸ¡å¢¶å£‹å¡å –å¡’å¡¤å å¢Šåµå¡¹å¢®å£ªç‰†å£¯è²æ®¼å£ºå£¼è™•å‚™è¤‡å¤ é ­èª‡å¤¾å¥ªå¥©å¥å¥®çå¥§å¦å©¦åª½å«µå«—åª¯å§è–‘å©å©­å¬ˆå¬Œå­Œå¨›åª§å«»å«¿å¬°å¬‹å¬¸åª¼å¬¡å¬ªå¬™å¬¤å­«å­¸å­¿å¯§å¯¶å¯¦å¯µå¯©æ†²å®®å¯¬è³“å¯¢å°å°‹å°å£½å°‡çˆ¾å¡µå ¯å°·å±ç›¡å±¤å±­å±œå±†å±¬å±¢å±¨å¶¼æ­²è±ˆå¶‡å´—å³´å¶´åµå³¶å¶ºå¶½å´ å·‹å¶¨å¶§å³½å¶¢å¶ å´¢å·’å¶—å´å¶®å¶„å¶¸å¶”å´³å¶è„Šå·”éå·°å¹£å¸¥å¸«å¹ƒå¸³ç°¾å¹Ÿå¸¶å¹€å¹«å¹¬å¹˜å¹—å†ªè¥†å¹¹ä¸¦å»£èŠæ…¶å»¬å»¡åº«æ‡‰å»Ÿé¾å»¢å»å»©é–‹ç•°æ£„å¼µå½Œå¼³å½å½ˆå¼·æ­¸ç•¶éŒ„å½ å½¥å¾¹å¾‘å¾ ç¦¦æ†¶æ‡ºæ†‚æ„¾æ‡·æ…‹æ…«æ†®æ…ªæ‚µæ„´æ†ç¸½æ‡Ÿæ‡Œæˆ€æ‡‡æƒ¡æ…Ÿæ‡¨æ„·æƒ»æƒ±æƒ²æ‚…æ„¨æ‡¸æ…³æ†«é©šæ‡¼æ…˜æ‡²æ†Šæ„œæ…šæ†šæ…£æ¹£æ…æ†¤æ†’é¡˜æ‡¾æ†–æ€µæ‡£æ‡¶æ‡æˆ‡æˆ”æˆ²æˆ§æˆ°æˆ©æˆ¶ç´®æ’²æ‰¡åŸ·æ“´æ«æƒæšæ“¾æ’«æ‹‹æ‘¶æ‘³æ„æ¶è­·å ±æ“”æ“¬æ”æ€æ“æ””æ“°æ’¥æ“‡æ›æ‘¯æ”£æ—æ’¾æ’»æŒ¾æ’“æ“‹æ’Ÿæ™æ“ æ®æ’æ’ˆææ’¿æ›æ—æ“šæ’šæ“„æ‘‘æ“²æ’£æ‘»æ‘œæ‘£æ”¬æ’³æ”™æ“±æ‘Ÿæ”ªæ”œæ”æ”„æ“ºæ–æ“¯æ”¤æ”–æ’æ”†æ“·æ“¼æ”›æ“»æ”¢æ•µæ–‚æ•¸é½‹æ–•é¬¥æ–¬æ–·ç„¡èˆŠæ™‚æ› æš˜æ›‡æ™æ›¨é¡¯æ™‰æ›¬æ›‰æ›„æšˆæš‰æš«æ›–åŠ„è¡“æ¨¸æ©Ÿæ®ºé›œæ¬Šæ¢ä¾†æ¥Šæ¦ªå‚‘æ¥µæ§‹æ¨…æ¨æ£—æ«ªæ¢˜æ£–æ§æ¥“æ¢Ÿæ«ƒæª¸æª‰æ¢”æŸµæ¨™æ£§æ«›æ«³æ£Ÿæ«¨æ«Ÿæ¬„æ¨¹æ£²æ¨£æ¬’æ£¬æ¤æ©ˆæ¥¨æª”æ¦¿æ©‹æ¨ºæªœæ§³æ¨å¤¢æª®æ£¶æª¢æ¬æ§¨æ«æ§§æ¬æ©¢æ¨“æ¬–æ«¬æ«šæ«¸æªŸæª»æª³æ«§æ©«æª£æ«»æ««æ«¥æ«“æ«ç°·æªæ­¡æ­Ÿæ­æ®²æ­¿æ®¤æ®˜æ®æ®®æ®«æ®¯æ¯†æ¯€è½‚ç•¢æ–ƒæ°ˆæ¯¿æ°Œæ°£æ°«æ°¬æ°³å½™æ¼¢æ±™æ¹¯æ´¶éæºæ²’çƒæ¼šç€æ·ªæ»„æ¸¢æºˆæ»¬æ¿”æ¿˜æ·šæ¾©ç€§ç€˜æ¿¼ç€‰æ½‘æ¾¤æ¶‡æ½”ç‘çªªæµ¹æ·ºæ¼¿æ¾†æ¹æº®æ¿æ¸¬æ¾®æ¿Ÿç€æ»»æ¸¾æ»¸æ¿ƒæ½¯æ¿œå¡—æ¹§æ¿¤æ¾‡æ·¶æ¼£æ½¿æ¸¦æº³æ¸™æ»Œæ½¤æ¾—æ¼²æ¾€æ¾±æ·µæ·¥æ¼¬ç€†æ¼¸æ¾ æ¼ç€‹æ»²æº«éŠç£æ¿•æ½°æ¿ºæ¼µæ¼Šæ½·æ»¾æ»¯ç©ç„æ»¿ç€…æ¿¾æ¿«ç¤æ¿±ç˜æ¾¦æ¿«ç€ ç€Ÿç€²æ¿°æ½›ç€¦ç€¾ç€¨ç€•çæ»…ç‡ˆéˆç½ç‡¦ç…¬çˆç‡‰ç…’ç†—é»ç…‰ç†¾çˆçˆ›çƒ´ç‡­ç…™ç…©ç‡’ç‡ç‡´ç‡™ç‡¼ç†±ç…¥ç‡œç‡¾ç…†ç³Šæºœæ„›çˆºç‰˜çŠ›ç‰½çŠ§çŠ¢å¼·ç‹€ç·ççŒ¶ç‹½éº…ç®ç°ç¨ç‹¹ç…çªçŒ™ç„çŒ»ç«çµç¼ç€è±¬è²“èŸç»çºç’£ç’µç‘’ç‘ªç‘‹ç’°ç¾ç‘²ç’½ç‘‰ç¨çºç“ç’«ç¿ç’¡ç’‰ç‘£ç“Šç‘¤ç’¦ç’¿ç“”ç“šç”•ç”Œé›»ç•«æš¢ä½˜ç–‡ç™¤ç™‚ç˜§ç™˜ç˜é¬ç˜¡ç˜‹çš°å±™ç™°ç—™ç™¢ç˜‚ç™†ç˜“ç™‡ç™¡ç™‰ç˜®ç˜ç˜ºç™Ÿç™±ç™®ç™­ç™©ç™¬ç™²è‡’çššçšºçš¸ç›é¹½ç›£è“‹ç›œç›¤ç˜çœ¥çŸ“è‘—çœçç¼ççŸšçŸ¯ç£¯ç¤¬ç¤¦ç¢­ç¢¼ç£šç¡¨ç¡¯ç¢¸ç¤ªç¤±ç¤«ç¤ç¡œçŸ½ç¢©ç¡¤ç£½ç£‘ç¤„ç¢ºé¹¼ç¤™ç£§ç££å ¿é•Ÿæ»¾ç¦®ç¦•ç¦°ç¦ç¦±ç¦ç¨Ÿç¥¿ç¦ªé›¢ç¦¿ç¨ˆç¨®ç©ç¨±ç©¢ç© ç©­ç¨…ç©Œç©©ç©¡çª®ç«Šç«…çª¯ç«„çª©çªºç«‡çª¶è±ç«¶ç¯¤ç­ç­†ç­§ç®‹ç± ç±©ç¯‰ç¯³ç¯©ç°¹ç®ç±Œç°½ç°¡ç±™ç°€ç¯‹ç±œç±®ç°ç°«ç°£ç°ç±ƒç±¬ç±ªç±Ÿç³´é¡ç§ˆç³¶ç³²ç²µç³ç³§ç³é¤±ç·Šç¸¶ç³¸ç³¾ç´†ç´…ç´‚çº–ç´‡ç´„ç´šç´ˆçºŠç´€ç´‰ç·¯ç´œç´˜ç´”ç´•ç´—ç¶±ç´ç´ç¸±ç¶¸ç´›ç´™ç´‹ç´¡ç´µç´–ç´ç´“ç·šç´ºçµç´±ç·´çµ„ç´³ç´°ç¹”çµ‚ç¸çµ†ç´¼çµ€ç´¹ç¹¹ç¶“ç´¿ç¶çµ¨çµçµç¹çµ°çµç¹ªçµ¦çµ¢çµ³çµ¡çµ•çµçµ±ç¶†ç¶ƒçµ¹ç¹¡ç¶Œç¶çµ›ç¹¼ç¶ˆç¸¾ç·’ç¶¾ç·“çºŒç¶ºç·‹ç¶½ç·”ç·„ç¹©ç¶­ç¶¿ç¶¬ç¹ƒç¶¢ç¶¯ç¶¹ç¶£ç¶œç¶»ç¶°ç¶ ç¶´ç·‡ç·™ç·—ç·˜ç·¬çºœç·¹ç·²ç·ç¸•ç¹¢ç·¦ç¶ç·ç·¶ç·šç·±ç¸‹ç·©ç· ç¸·ç·¨ç·¡ç·£ç¸‰ç¸›ç¸Ÿç¸ç¸«ç¸—ç¸çºç¸­ç¸Šç¸‘ç¹½ç¸¹ç¸µç¸²çº“ç¸®ç¹†ç¹…çºˆç¹šç¹•ç¹’éŸç¹¾ç¹°ç¹¯ç¹³çº˜ç½Œç¶²ç¾…ç½°ç½·ç¾†ç¾ˆç¾¥ç¾¨ç¿¹ç¿½ç¿¬è€®è€¬è³æ¥è¶è¾è·è¹è¯èµè°è‚…è…¸è†šè†è…è…«è„¹è„…è†½å‹æœ§è…–è‡šè„›è† è„ˆè†¾é«’è‡è…¦è†¿è‡ è…³è„«è…¡è‡‰è‡˜é†ƒè†•é½¶è†©é¦è†ƒé¨°è‡è‡¢è¼¿è‰¤è‰¦è‰™è‰«è‰±è±”è‰¸è—ç¯€ç¾‹è–Œè•ªè˜†è“¯è‘¦è—¶è§è‡è’¼è‹§è˜‡æª¾è˜‹è–è˜¢è”¦å¡‹ç…¢ç¹­èŠè–¦è–˜è¢è•˜è“½è•è–ˆè–ºè•©æ¦®è‘·æ»çŠ–ç†’è•è—è“€è”­è•’è‘’è‘¤è—¥è’è“§èŠè“®è’”èµè–Ÿç²è••ç‘©é¶¯è“´è˜€è˜¿è¢ç‡Ÿç¸ˆè•­è–©è”¥è•†è•¢è”£è”è—è–Šè˜ºè•·é£é©€è–”è˜è—ºè—¹è˜„è˜Šè—ªæ§è˜šè™œæ…®è™›èŸ²è™¯èŸ£é›–è¦è †è•èŸ»èè ¶è ”èœ†è ±è £èŸ¶è »èŸ„è›ºèŸ¯è„è è›»è¸è Ÿè …èŸˆèŸ¬è è»è ‘è¿èŸè ¨é‡éŠœè£œè¥¯è¢è¥–å«‹è¤˜è¥ªè¥²è¥è£è¥ è¤Œè¤³è¥è¤²è¥‡è¤¸è¥¤ç¹ˆè¥´è¦‹è§€è¦è¦è¦“è¦–è¦˜è¦½è¦ºè¦¬è¦¡è¦¿è¦¥è¦¦è¦¯è¦²è¦·è§´è§¸è§¶è®‹è­½è¬„è¨è¨ˆè¨‚è¨ƒèªè­è¨è¨Œè¨è®“è¨•è¨–è¨“è­°è¨Šè¨˜è¨’è¬›è«±è¬³è©è¨è¨¥è¨±è¨›è«–è¨©è¨Ÿè«·è¨­è¨ªè¨£è­‰è©è¨¶è©•è©›è­˜è©—è©è¨´è¨ºè©†è¬…è©è©˜è©”è©–è­¯è©’èª†èª„è©¦è©¿è©©è©°è©¼èª èª…è©µè©±èª•è©¬è©®è©­è©¢è©£è«è©²è©³è©«è«¢è©¡è­¸èª¡èª£èªèªšèª¤èª¥èª˜èª¨èª‘èªªèª¦èª’è«‹è«¸è«è«¾è®€è«‘èª¹èª²è«‰è«›èª°è«—èª¿è«‚è«’è«„èª¶è«‡èª¼è¬€è«¶è«œè¬Šè««è«§è¬”è¬è¬‚è«¤è«­è«¼è®’è«®è«³è«ºè«¦è¬è«è«è¬¨è®œè¬–è¬è¬ è¬—è«¡è¬™è¬è¬¹è¬¾è¬«è­¾è¬¬è­šè­–è­™è®•è­œè­è®è­´è­«è®–ç©€è±¶è²è²è² è²Ÿè²¢è²¡è²¬è³¢æ•—è³¬è²¨è³ªè²©è²ªè²§è²¶è³¼è²¯è²«è²³è³¤è³è²°è²¼è²´è²ºè²¸è²¿è²»è³€è²½è³Šè´„è³ˆè³„è²²è³ƒè³‚è´“è³‡è³…è´è³•è³‘è³šè³’è³¦è³­é½è´–è³è³œè´”è³™è³¡è³ è³§è³´è³µè´…è³»è³ºè³½è³¾è´—è®šè´‡è´ˆè´è´è´›èµ¬è¶™è¶•è¶¨è¶²èº‰èºè¹Œè¹ èº’è¸èº‚è¹ºè¹•èºšèº‹è¸´èºŠè¹¤èº“èº‘èº¡è¹£èº•èº¥èºªèº¦è»€è»Šè»‹è»Œè»’è»‘è»”è½‰è»›è¼ªè»Ÿè½Ÿè»²è»»è½¤è»¸è»¹è»¼è»¤è»«è½¢è»ºè¼•è»¾è¼‰è¼Šè½è¼ˆè¼‡è¼…è¼ƒè¼’è¼”è¼›è¼¦è¼©è¼è¼¥è¼è¼¬è¼Ÿè¼œè¼³è¼»è¼¯è½€è¼¸è½¡è½…è½„è¼¾è½†è½è½”è¾­è¾¯è¾®é‚Šé¼é”é·éé‚é‹é‚„é€™é€²é é•é€£é²é‚‡é€•è·¡é©é¸éœéé‚é‚éºé™é„§é„ºé„”éƒµé„’é„´é„°é¬±éƒ¤éƒŸé„¶é„­é„†é…ˆé„–é„²é†é†±é†¬é‡…é‡ƒé‡€é‡‹è£é’œé‘’é‘¾é¨é‡“é‡”é‡é‡˜é‡—é‡™é‡•é‡·é‡ºé‡§é‡¤éˆ’é‡©é‡£é†é‡¹éšé‡µéˆƒéˆ£éˆˆéˆ¦éˆéˆ”é¾éˆ‰é‹‡é‹¼éˆ‘éˆé‘°æ¬½éˆé¢é‰¤éˆ§éˆéˆ¥éˆ„éˆ•éˆ€éˆºéŒ¢é‰¦é‰—éˆ·ç¼½éˆ³é‰•éˆ½éˆ¸é‰é‘½é‰¬é‰­é‰€éˆ¿éˆ¾éµé‰‘éˆ´é‘ é‰›é‰šéˆ°é‰‰é‰ˆé‰éˆ¹é¸é‰¶éŠ¬éŠ é‰ºéŠªé‹é‹£éƒéŠéºéŠ…é‹éŠ±éŠ¦é§é˜éŠ–éŠ‘é‹ŒéŠ©éŠ›éµéŠ“é‰¿éŠšé‰»éŠ˜éŒšéŠ«é‰¸éŠ¥éŸéŠƒé‹éŠ¨éŠ€éŠ£é‘„é’é‹ªé‹™éŒ¸é‹±éˆé—éŠ·é–é‹°é‹¥é‹¤é‹é‹¯é‹¨é½éŠ¼é‹é‹’é‹…é‹¶é¦é§éŠ³éŠ»é‹ƒé‹Ÿé‹¦éŒ’éŒ†éºéŒ¯éŒ¨éŒ¡éŒéŒ•éŒ©éŒ«éŒ®é‘¼éŒ˜éŒéŒ¦ééŒˆéŒ‡éŒŸéŒ éµé‹¸éŒ³éŒ™é¥éˆé‡é˜é¶é”é¤é¬é¾é›éªé é°é„éé‚é¤é¡éŒé®é›é˜é‘·é«é³é¿é¦é¬éŠé°é”é¢éœéé°éé¡é‘éƒé‡éé”é’éé·é‘¥é“é‘­é é‘¹é¹é™é‘Šé³é¶é²é®é¿é‘”é‘£é‘é‘²é•·é–€é–‚é–ƒé–†é–ˆé–‰å•é—–é–é—ˆé–‘é–é–“é–”é–Œæ‚¶é–˜é¬§é–¨èé—¥é–©é–­é—“é–¥é–£é–¡é–«é¬®é–±é–¬é—é–¾é–¹é–¶é¬©é–¿é–½é–»é–¼é—¡é—Œé—ƒé— é—Šé—‹é—”é—é—’é—•é—é—¤éšŠé™½é™°é™£éšéš›é™¸éš´é™³é™˜é™éš‰éš•éšªéš¨éš±éš¸é›‹é›£é››è®é‚éœ§éœ½é»´é„éšéœé¨éŸƒé½éŸ‰éŸéŸ‹éŸŒéŸéŸ“éŸ™éŸéŸœéŸ»é é ‚é ƒé ‡é …é †é ˆé Šé ‘é¡§é “é é ’é Œé é é¡±é ˜é —é ¸é ¡é °é ²é œæ½ç†²é ¦é ¤é »é ®é ¹é ·é ´ç©é¡†é¡Œé¡’é¡é¡“é¡é¡é¡³é¡¢é¡›é¡™é¡¥çº‡é¡«é¡¬é¡°é¡´é¢¨é¢ºé¢­é¢®é¢¯é¢¶é¢¸é¢¼é¢»é£€é£„é£†é£†é£›é¥—é¥œé££é¥‘é£¥é¤³é£©é¤¼é£ªé£«é£­é£¯é£²é¤é£¾é£½é£¼é£¿é£´é¤Œé¥’é¤‰é¤„é¤é¤ƒé¤é¤…é¤‘é¤–é¤“é¤˜é¤’é¤•é¤œé¤›é¤¡é¤¨é¤·é¥‹é¤¶é¤¿é¥é¥é¥ƒé¤ºé¤¾é¥ˆé¥‰é¥…é¥Šé¥Œé¥¢é¦¬é¦­é¦±é¦´é¦³é©…é¦¹é§é©¢é§”é§›é§Ÿé§™é§’é¨¶é§é§é§‘é§•é©›é§˜é©ç½µé§°é©•é©Šé§±é§­é§¢é©«é©ªé¨é©—é¨‚é§¸é§¿é¨é¨é¨é¨…é¨Œé©Œé©‚é¨™é¨­é¨¤é¨·é¨–é©é¨®é¨«é¨¸é©ƒé¨¾é©„é©é©Ÿé©¥é©¦é©¤é«é«–é«•é¬¢é­˜é­é­šé­›é­¢é­·é­¨é­¯é­´é­ºé®é®ƒé¯°é±¸é®‹é®“é®’é®Šé®‘é±Ÿé®é®é®­é®šé®³é®ªé®é®¦é°‚é®œé± é±­é®«é®®é®ºé¯—é±˜é¯é±ºé°±é°¹é¯‰é°£é°·é¯€é¯Šé¯‡é®¶é¯½é¯’é¯–é¯ªé¯•é¯«é¯¡é¯¤é¯§é¯é¯¢é¯°é¯›é¯¨é¯µé¯´é¯”é±é°ˆé°é±¨é¯·é°®é°ƒé°“é±·é°é°’é°‰é°é±‚é¯¿é° é¼‡é°­é°¨é°¥é°©é°Ÿé°œé°³é°¾é±ˆé±‰é°»é°µé±…é°¼é±–é±”é±—é±’é±¯é±¤é±§é±£é³¥é³©é›é³¶é³´é³²é·—é´‰é¶¬é´‡é´†é´£é¶‡é¸•é´¨é´é´¦é´’é´Ÿé´é´›é´¬é´•é·¥é·™é´¯é´°éµ‚é´´éµƒé´¿é¸é´»éµéµ“é¸éµ‘éµ éµéµ’é·³éµœéµ¡éµ²é¶“éµªé¶¤éµ¯éµ¬éµ®é¶‰é¶Šéµ·é·«é¶˜é¶¡é¶šé¶»é¶¿é¶¥é¶©é·Šé·‚é¶²é¶¹é¶ºé·é¶¼é¶´é·–é¸šé·“é·šé·¯é·¦é·²é·¸é·ºé¸‡é·¹é¸Œé¸é¸›é¸˜é¹ºéº¥éº©é»ƒé»Œé»¶é»·é»²é»½";}function Traditionalized(cc) {  let str = "";  const ss = JTPYStr();  const tt = FTPYStr();  for (let i = 0; i < cc.length; i++) {    if (cc.charCodeAt(i) > 10000 && ss.indexOf(cc.charAt(i)) !== -1) {      str += tt.charAt(ss.indexOf(cc.charAt(i)));    } else str += cc.charAt(i);  }  return str;}function Simplized(cc) {  let str = "";  const ss = JTPYStr();  const tt = FTPYStr();  for (let i = 0; i < cc.length; i++) {    if (cc.charCodeAt(i) > 10000 && tt.indexOf(cc.charAt(i)) !== -1) {      str += ss.charAt(tt.indexOf(cc.charAt(i)));    } else str += cc.charAt(i);  }  return str;}function translateInitialization() {  translateButtonObject = document.getElementById("menu-translate");  if (translateButtonObject) {    if (currentEncoding !== targetEncoding) {      setTimeout(translateBody, translateDelay);    }    translateButtonObject.addEventListener("click", translatePage, false);  }}$("#menu-backward").on("click", function () {  window.history.back();});$("#menu-forward").on("click", function () {  window.history.forward();});$("#menu-refresh").on("click", function () {  window.location.reload();});$("#menu-darkmode").on("click", function () {  switchDarkMode();});$("#menu-home").on("click", function () {  window.location.href = window.location.origin;});/* ç®€ä½“ç¹ä½“åˆ‡æ¢ */$("#menu-translate").on("click", function () {  removeRightMenu();  translateInitialization();});$(".menu-link").on("click", function () {  removeRightMenu();});$("#rightmenu-mask").on("click", function () {  removeRightMenu();});$("#rightmenu-mask").contextmenu(function () {  removeRightMenu();  return false;});// æ·»åŠ æ‰“å°åŠŸèƒ½// $("#menu-print").on("click", function () {//   removeRightMenu();//   window.print();// });// æ·»åŠ "éšä¾¿é€›é€›"ç‚¹å‡»äº‹ä»¶$("#menu-radompage").on("click", function () {  var h = [      "http://rugu.space/posts/1434177947.html",         ]  n = Math.floor(Math.random() * h.length), location.href = h[n]  window.href = n  removeRightMenu();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/txmap.js"/>
      <url>/js/txmap.js</url>
      
        <content type="html"><![CDATA[//getè¯·æ±‚$.ajax({    type: 'get',    url: 'https://apis.map.qq.com/ws/location/v1/ip',    data: {        key: 'ZFWBZ-HZQLJ-K2NFA-KDLDC-66TIH-KIBBM',        output: 'jsonp',    },    dataType: 'jsonp',    success: function (res) {        ipLoacation = res;    }})function getDistance(e1, n1, e2, n2) {    const R = 6371    const { sin, cos, asin, PI, hypot } = Math    let getPoint = (e, n) => {        e *= PI / 180        n *= PI / 180        return { x: cos(n) * cos(e), y: cos(n) * sin(e), z: sin(n) }    }    let a = getPoint(e1, n1)    let b = getPoint(e2, n2)    let c = hypot(a.x - b.x, a.y - b.y, a.z - b.z)    let r = asin(c / 2) * 2 * R    return Math.round(r);}function showWelcome() {    let dist = getDistance(113.34499552, 23.15537143, ipLoacation.result.location.lng, ipLoacation.result.location.lat); //è¿™é‡Œæ¢æˆè‡ªå·±çš„ç»çº¬åº¦    let pos = ipLoacation.result.ad_info.nation;    let ip;    let posdesc;    //æ ¹æ®å›½å®¶ã€çœä»½ã€åŸå¸‚ä¿¡æ¯è‡ªå®šä¹‰æ¬¢è¿è¯­    switch (ipLoacation.result.ad_info.nation) {        case "æ—¥æœ¬":            posdesc = "ã‚ˆã‚ã—ãï¼Œä¸€èµ·å»çœ‹æ¨±èŠ±å—";            break;        case "ç¾å›½":            posdesc = "Let us live in peace!";            break;        case "è‹±å›½":            posdesc = "æƒ³åŒä½ ä¸€èµ·å¤œä¹˜ä¼¦æ•¦çœ¼";            break;        case "ä¿„ç½—æ–¯":            posdesc = "å¹²äº†è¿™ç“¶ä¼ç‰¹åŠ ï¼";            break;        case "æ³•å›½":            posdesc = "C'est La Vie";            break;        case "å¾·å›½":            posdesc = "Die Zeit verging im Fluge.";            break;        case "æ¾³å¤§åˆ©äºš":            posdesc = "ä¸€èµ·å»å¤§å ¡ç¤å§ï¼";            break;        case "åŠ æ‹¿å¤§":            posdesc = "æ‹¾èµ·ä¸€ç‰‡æ«å¶èµ äºˆä½ ";            break;        case "ä¸­å›½":            pos = ipLoacation.result.ad_info.province + " " + ipLoacation.result.ad_info.city + " " + ipLoacation.result.ad_info.district;            ip = ipLoacation.result.ip;            switch (ipLoacation.result.ad_info.province) {                case "åŒ—äº¬å¸‚":                    posdesc = "åŒ—â€”â€”äº¬â€”â€”æ¬¢è¿ä½ ~~~";                    break;                case "å¤©æ´¥å¸‚":                    posdesc = "è®²æ®µç›¸å£°å§ã€‚";                    break;                case "æ²³åŒ—çœ":                    posdesc = "å±±åŠ¿å·å·æˆå£å’ï¼Œå¤©ä¸‹é›„å…³ã€‚é“é©¬é‡‘æˆˆç”±æ­¤å‘ï¼Œæ— é™æ±Ÿå±±ã€‚";                    break;                case "å±±è¥¿çœ":                    posdesc = "å±•å¼€åå…·é•¿ä¸‰å°ºï¼Œå·²å å±±æ²³äº”ç™¾ä½™ã€‚";                    break;                case "å†…è’™å¤è‡ªæ²»åŒº":                    posdesc = "å¤©è‹è‹ï¼Œé‡èŒ«èŒ«ï¼Œé£å¹è‰ä½è§ç‰›ç¾Šã€‚";                    break;                case "è¾½å®çœ":                    posdesc = "æˆ‘æƒ³åƒçƒ¤é¸¡æ¶ï¼";                    break;                case "å‰æ—çœ":                    posdesc = "çŠ¶å…ƒé˜å°±æ˜¯ä¸œåŒ—çƒ§çƒ¤ä¹‹ç‹ã€‚";                    break;                case "é»‘é¾™æ±Ÿçœ":                    posdesc = "å¾ˆå–œæ¬¢å“ˆå°”æ»¨å¤§å‰§é™¢ã€‚";                    break;                case "ä¸Šæµ·å¸‚":                    posdesc = "ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸­å›½åªæœ‰ä¸¤ä¸ªåŸå¸‚ã€‚";                    break;                case "æ±Ÿè‹çœ":                    switch (ipLoacation.result.ad_info.city) {                        case "å—äº¬å¸‚":                            posdesc = "è¿™æ˜¯æˆ‘æŒºæƒ³å»çš„åŸå¸‚å•¦ã€‚";                            break;                        case "è‹å·å¸‚":                            posdesc = "ä¸Šæœ‰å¤©å ‚ï¼Œä¸‹æœ‰è‹æ­ã€‚";                            break;                        default:                            posdesc = "æ•£è£…æ˜¯å¿…é¡»è¦æ•£è£…çš„ã€‚";                            break;                    }                    break;                case "æµ™æ±Ÿçœ":                    posdesc = "ä¸œé£æ¸ç»¿è¥¿æ¹–æŸ³ï¼Œé›å·²è¿˜äººæœªå—å½’ã€‚";                    break;                case "æ²³å—çœ":                    switch (ipLoacation.result.ad_info.city) {                        case "éƒ‘å·å¸‚":                            posdesc = "è±«å·ä¹‹åŸŸï¼Œå¤©åœ°ä¹‹ä¸­ã€‚";                            break;                        case "å—é˜³å¸‚":                            posdesc = "è‡£æœ¬å¸ƒè¡£ï¼Œèº¬è€•äºå—é˜³ã€‚æ­¤å—é˜³éå½¼å—é˜³ï¼";                            break;                        case "é©»é©¬åº—å¸‚":                            posdesc = "å³°å³°æœ‰å¥‡çŸ³ï¼ŒçŸ³çŸ³æŒŸä»™æ°”ã€‚åµ–å²ˆå±±çš„èŠ±å¾ˆç¾å“¦ï¼";                            break;                        case "å¼€å°å¸‚":                            posdesc = "åˆšæ­£ä¸é˜¿åŒ…é’å¤©ã€‚";                            break;                        case "æ´›é˜³å¸‚":                            posdesc = "æ´›é˜³ç‰¡ä¸¹ç”²å¤©ä¸‹ã€‚";                            break;                        default:                            posdesc = "å¯å¦å¸¦æˆ‘å“å°æ²³å—çƒ©é¢å•¦ï¼Ÿ";                            break;                    }                    break;                case "å®‰å¾½çœ":                    posdesc = "èšŒåŸ ä½äº†ï¼ŒèŠœæ¹–èµ·é£ã€‚";                    break;                case "ç¦å»ºçœ":                    posdesc = "äº•é‚‘ç™½äº‘é—´ï¼Œå²©åŸè¿œå¸¦å±±ã€‚";                    break;                case "æ±Ÿè¥¿çœ":                    posdesc = "è½éœä¸å­¤é¹œé½é£ï¼Œç§‹æ°´å…±é•¿å¤©ä¸€è‰²ã€‚";                    break;                case "å±±ä¸œçœ":                    posdesc = "é¥æœ›é½å·ä¹ç‚¹çƒŸï¼Œä¸€æ³“æµ·æ°´æ¯ä¸­æ³»ã€‚";                    break;                case "æ¹–åŒ—çœ":                    posdesc = "æ¥ç¢—çƒ­å¹²é¢ï¼";                    break;                case "æ¹–å—çœ":                    posdesc = "74751ï¼Œé•¿æ²™æ–¯å¡”å…‹ã€‚";                    break;                case "å¹¿ä¸œçœ":                    posdesc = "è€æ¿æ¥ä¸¤æ–¤ç¦å»ºäººã€‚";                    break;                case "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº":                    posdesc = "æ¡‚æ—å±±æ°´ç”²å¤©ä¸‹ã€‚";                    break;                case "æµ·å—çœ":                    posdesc = "æœè§‚æ—¥å‡ºé€ç™½æµªï¼Œå¤•çœ‹äº‘èµ·æ”¶éœå…‰ã€‚";                    break;                case "å››å·çœ":                    posdesc = "åº·åº·å·å¦¹å­ã€‚";                    break;                case "è´µå·çœ":                    posdesc = "èŒ…å°ï¼Œå­¦ç”Ÿï¼Œå†å¡200ã€‚";                    break;                case "äº‘å—çœ":                    posdesc = "ç‰é¾™é£èˆäº‘ç¼ ç»•ï¼Œä¸‡ä»å†°å·ç›´è€¸å¤©ã€‚";                    break;                case "è¥¿è—è‡ªæ²»åŒº":                    posdesc = "èººåœ¨èŒ«èŒ«è‰åŸä¸Šï¼Œä»°æœ›è“å¤©ã€‚";                    break;                case "é™•è¥¿çœ":                    posdesc = "æ¥ä»½è‡Šå­é¢åŠ é¦ã€‚";                    break;                case "ç”˜è‚ƒçœ":                    posdesc = "ç¾Œç¬›ä½•é¡»æ€¨æ¨æŸ³ï¼Œæ˜¥é£ä¸åº¦ç‰é—¨å…³ã€‚";                    break;                case "é’æµ·çœ":                    posdesc = "ç‰›è‚‰å¹²å’Œè€é…¸å¥¶éƒ½å¥½å¥½åƒã€‚";                    break;                case "å®å¤å›æ—è‡ªæ²»åŒº":                    posdesc = "å¤§æ¼ å­¤çƒŸç›´ï¼Œé•¿æ²³è½æ—¥åœ†ã€‚";                    break;                case "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº":                    posdesc = "é©¼é“ƒå¤é“ä¸ç»¸è·¯ï¼Œèƒ¡é©¬çŠ¹é—»å”æ±‰é£ã€‚";                    break;                case "å°æ¹¾çœ":                    posdesc = "æˆ‘åœ¨è¿™å¤´ï¼Œå¤§é™†åœ¨é‚£å¤´ã€‚";                    break;                case "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº":                    posdesc = "æ°¸å®šè´¼æœ‰æ®‹ç•™åœ°é¬¼åšï¼Œè¿å‡»å…‰éå²ç‰ã€‚";                    break;                case "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº":                    posdesc = "æ€§æ„Ÿè·å®˜ï¼Œåœ¨çº¿å‘ç‰Œã€‚";                    break;                default:                    posdesc = "å¸¦æˆ‘å»ä½ çš„åŸå¸‚é€›é€›å§ï¼";                    break;            }            break;        default:            posdesc = "å¸¦æˆ‘å»ä½ çš„å›½å®¶é€›é€›å§ã€‚";            break;    }    //æ ¹æ®æœ¬åœ°æ—¶é—´åˆ‡æ¢æ¬¢è¿è¯­    let timeChange;    let date = new Date();    if (date.getHours() >= 5 && date.getHours() < 11) timeChange = "<span>ä¸Šåˆå¥½</span>ï¼Œä¸€æ—¥ä¹‹è®¡åœ¨äºæ™¨ï¼";    else if (date.getHours() >= 11 && date.getHours() < 13) timeChange = "<span>ä¸­åˆå¥½</span>ï¼Œè¯¥æ‘¸é±¼åƒåˆé¥­äº†ã€‚";    else if (date.getHours() >= 13 && date.getHours() < 15) timeChange = "<span>ä¸‹åˆå¥½</span>ï¼Œæ‡’æ‡’åœ°ç¡ä¸ªåˆè§‰å§ï¼";    else if (date.getHours() >= 15 && date.getHours() < 16) timeChange = "<span>ä¸‰ç‚¹å‡ å•¦</span>ï¼Œä¸€èµ·é¥®èŒ¶å‘€ï¼";    else if (date.getHours() >= 16 && date.getHours() < 19) timeChange = "<span>å¤•é˜³æ— é™å¥½ï¼</span>";    else if (date.getHours() >= 19 && date.getHours() < 24) timeChange = "<span>æ™šä¸Šå¥½</span>ï¼Œå¤œç”Ÿæ´»å—¨èµ·æ¥ï¼";    else timeChange = "å¤œæ·±äº†ï¼Œæ—©ç‚¹ä¼‘æ¯ï¼Œå°‘ç†¬å¤œã€‚";    try {        //è‡ªå®šä¹‰æ–‡æœ¬å’Œéœ€è¦æ”¾çš„ä½ç½®        document.getElementById("welcome-info").innerHTML =            `<b><center>ğŸ‰ æ¬¢è¿ä¿¡æ¯ ğŸ‰</center>&emsp;&emsp;æ¬¢è¿æ¥è‡ª <span style="color:var(--theme-color)">${pos}</span> çš„å°ä¼™ä¼´ï¼Œ${timeChange}æ‚¨ç°åœ¨è·ç¦»ç«™é•¿çº¦ <span style="color:var(--theme-color)">${dist}</span> å…¬é‡Œï¼Œå½“å‰çš„IPåœ°å€ä¸ºï¼š <span style="color:var(--theme-color)">${ip}</span>ï¼Œ ${posdesc}</b>`;    } catch (err) {         //console.log("Pjaxæ— æ³•è·å–#welcome-infoå…ƒç´ ğŸ™„ğŸ™„ğŸ™„")    }}window.onload = showWelcome;// å¦‚æœä½¿ç”¨äº†pjaxåœ¨åŠ ä¸Šä¸‹é¢è¿™è¡Œä»£ç document.addEventListener('pjax:complete', showWelcome);document.addEventListener('pjax:complete', showWelcome);document.addEventListener('pjax:complete', showWelcome);document.addEventListener('pjax:complete', showWelcome);// æ£€æµ‹æŒ‰é”®window.onkeydown = function (e) {    if (e.keyCode === 123) {        new Vue({            data: function () {                this.$notify({                    title: "ä½ å·²è¢«å‘ç°ğŸ˜œ",                    message: "å°ä¼™å­ï¼Œæ‰’æºè®°ä½è¦éµå¾ªGPLåè®®ï¼",                    position: 'top-left',                    offset: 50,                    showClose: true,                    type: "warning",                    duration: 5000                });            }        })            }  }  ]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/utill.js"/>
      <url>/js/utill.js</url>
      
        <content type="html"><![CDATA[class Util {    constructor() {        if (Util.instance) return Util.instance;        return this.getInstance(...arguments);    }    getInstance() {        var instance = {            /*             *   formatTime æ ¼å¼åŒ–æ—¶é—´ï¼ˆsï¼‰ä¸º hour:minutes:seconds             *   @params  time  required number (s)             *                *   return hour:minutes:seconds string             */            formatTime(time) {                //æ²¡æœ‰ä¼ timeçš„æ—¶å€™                if (time === undefined) {                    this.handlerError(123, {                        method: 'formate',                        param: 'time'                    });                    return false;                }                let _time = Math.floor(time);                let _minutes = Math.floor(_time / 60);                let _hours = Math.floor(_minutes / 60);                let _seconds = _time - (_minutes * 60);                return (_hours ? this.fillZero(_hours) + ':' : '') + this.fillZero(_minutes - (_hours * 60)) + ':' + this.fillZero(_seconds);            },            /*             *   fillZero ä¸ºå°äº10çš„æ•°å­—è¡¥0             *   @params  num  required number             *   return '01'.. string             */            fillZero(num) {                //å½“æ²¡æœ‰ä¼ timeçš„æ—¶å€™                if (num === undefined) {                    this.handlerError(123, {                        method: 'fillZero',                        param: 'num'                    });                    return false;                }                //è¿™ä¸ªå‡½æ•°åªæ˜¯è®©æˆ‘ä»¬åœ¨æ¸²æŸ“/æ˜¾ç¤ºçš„æ—¶å€™æœ‰ä¸€ä¸ªä¸åŒçš„æ•ˆæœï¼Œä¸è¦æ“ä½œåŸæ•°æ®                return num > 9 ? num : '0' + num;            },            errors: {                123: ({                    method,                    param                }) => {                    return method + 'function need a param ' + param;                }            },            handlerError(code, options) { //å¤„ç†æŠ¥é”™                console.error('[until error] message' + this.errors[code](options));            }        }        Util.instance = instance;        return instance;    }}//ä¸ºäº†è¿™ä¸ªå·¥å…·ä»¥ååœ¨æ¨¡å—åŒ–ç¯å¢ƒä¸­ä¾ç„¶å¯ä»¥ä½¿ç”¨ï¼Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯åœ¨æ¨¡å—åŒ–ç¯å¢ƒï¼Œå°±å°†å…¶æš´éœ²å‡ºå»//commonJsif (typeof module === 'object' && typeof module.exports === 'object') {    module.exports = Util;}//AMDif (typeof define === 'function' && define.amd) {    define('util', [], function () {        return Util;    });}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/runtime.js"/>
      <url>/js/runtime.js</url>
      
        <content type="html"><![CDATA[var now = new Date();function createtime() {  now.setTime(now.getTime() + 1e3);  var e = new Date("11/01/2022 00:00:00"),    t = Math.trunc(234e8 + ((now - e) / 1e3) * 17),    a = (t / 1496e5).toFixed(6),    n = new Date("11/01/2022 00:00:00"),    s = (now - n) / 1e3 / 60 / 60 / 24,    o = Math.floor(s),    r = (now - n) / 1e3 / 60 / 60 - 24 * o,    i = Math.floor(r);  1 == String(i).length && (i = "0" + i);  var l = (now - n) / 1e3 / 60 - 1440 * o - 60 * i,    b = Math.floor(l);  1 == String(b).length && (b = "0" + b);  var d = (now - n) / 1e3 - 86400 * o - 3600 * i - 60 * b,    c = Math.round(d);  1 == String(c).length && (c = "0" + c);  let g = "";  (g =    i < 18 && i >= 9      ? `<img class='boardsign' src='https://img.shields.io/badge/Rå°å±‹-ä¸Šç­æ‘¸é±¼ä¸­-6adea8?style=social&logo=cakephp' title='ä¸Šç­æ—¶é—´è¿˜æ˜¯å¾—æ˜ç¡®è‡ªå·±çš„ç›®æ ‡å‘¢'><span class='textTip'> <br> <b>æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${o} å¤©</span><span id='runtime'> ${i} å°æ—¶ ${b} åˆ† ${c} ç§’ </b></span> <i id="heartbeat" class='fas fa-heartbeat' style='color:red'></i> <br> <b>æ—…è¡Œè€… 1 å·å½“å‰è·ç¦»åœ°çƒ ${t} åƒç±³ï¼Œçº¦ä¸º ${a} ä¸ªå¤©æ–‡å•ä½ ğŸš€</b> <br> <b><font size=2px>è¿™é‡Œæœ‰ä¸€é¢—æ˜Ÿæ˜Ÿï¼Œå®ƒç­‰è¿‡æ˜¥å¤ç§‹å†¬çš„æµè½¬ï¼Œç­‰è¿‡å±±å·æ¹–æ³Šçš„æ™¨æš®ï¼Œç­‰è¿‡æ¼«æ¼«å­¤ç¯çš„é•¿å¤œï¼Œå®ƒåœ¨ç­‰ä½ ï¼Œç­‰ä½ æŠ«æ˜Ÿæˆ´æœˆè½½ç€å²æœˆçš„æ™¨å…‰è€Œæ¥ç‚¹äº®å®ƒçš„ä¸–ç•Œâœ¨</font></b> `      : `<img class='boardsign' src='https://img.shields.io/badge/Rå°å±‹-æ‰“çƒŠä¼‘æ¯å•¦-6adea8?style=social&logo=coffeescript' title='ä¸‹ç­äº†å°±è¯¥æ‚ é—²ä¸€äº›å•¦ï¼Œé™ªé™ªå¥³æœ‹å‹ï¼Œæ’¸æ’¸çŒ«~'><span class='textTip'> <br> <b>æœ¬ç«™å±…ç„¶è¿è¡Œäº† ${o} å¤©</span><span id='runtime'> ${i} å°æ—¶ ${b} åˆ† ${c} ç§’ </b></span> <i id="heartbeat" class='fas fa-heartbeat' style='color:red'></i> <br> <b>æ—…è¡Œè€… 1 å·å½“å‰è·ç¦»åœ°çƒ ${t} åƒç±³ï¼Œçº¦ä¸º ${a} ä¸ªå¤©æ–‡å•ä½ ğŸš€</b> <br> <b><font size=2px>è¿™é‡Œæœ‰ä¸€é¢—æ˜Ÿæ˜Ÿï¼Œå®ƒç­‰è¿‡æ˜¥å¤ç§‹å†¬çš„æµè½¬ï¼Œç­‰è¿‡å±±å·æ¹–æ³Šçš„æ™¨æš®ï¼Œç­‰è¿‡æ¼«æ¼«å­¤ç¯çš„é•¿å¤œï¼Œå®ƒåœ¨ç­‰ä½ ï¼Œç­‰ä½ æŠ«æ˜Ÿæˆ´æœˆè½½ç€å²æœˆçš„æ™¨å…‰è€Œæ¥ç‚¹äº®å®ƒçš„ä¸–ç•Œâœ¨</font></b> `),    document.getElementById("workboard") &&      (document.getElementById("workboard").innerHTML = g);}setInterval(() => {  createtime();}, 1e3);]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/waterfall.js"/>
      <url>/js/waterfall.js</url>
      
        <content type="html"><![CDATA[function waterfall(a) {    function b(a, b) {      var c = window.getComputedStyle(b);      return parseFloat(c["margin" + a]) || 0;    }    function c(a) {      return a + "px";    }    function d(a) {      return parseFloat(a.style.top);    }    function e(a) {      return parseFloat(a.style.left);    }    function f(a) {      return a.clientWidth;    }    function g(a) {      return a.clientHeight;    }    function h(a) {      return d(a) + g(a) + b("Bottom", a);    }    function i(a) {      return e(a) + f(a) + b("Right", a);    }    function j(a) {      a = a.sort(function (a, b) {        return h(a) === h(b) ? e(b) - e(a) : h(b) - h(a);      });    }    function k(b) {      f(a) != t && (b.target.removeEventListener(b.type, arguments.callee), waterfall(a));    }    "string" == typeof a && (a = document.querySelector(a));    var l = [].map.call(a.children, function (a) {      return (a.style.position = "absolute"), a;    });    a.style.position = "relative";    var m = [];    l.length && ((l[0].style.top = "0px"), (l[0].style.left = c(b("Left", l[0]))), m.push(l[0]));    for (var n = 1; n < l.length; n++) {      var o = l[n - 1],        p = l[n],        q = i(o) + f(p) <= f(a);      if (!q) break;      (p.style.top = o.style.top), (p.style.left = c(i(o) + b("Left", p))), m.push(p);    }    for (; n < l.length; n++) {      j(m);      var p = l[n],        r = m.pop();      (p.style.top = c(h(r) + b("Top", p))), (p.style.left = c(e(r))), m.push(p);    }    j(m);    var s = m[0];    a.style.height = c(h(s) + b("Bottom", s));    var t = f(a);    window.addEventListener ? window.addEventListener("resize", k) : (document.body.onresize = k);  }  ]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>withğŸ’–å°å±‹</title>
      <link href="/lover/index.html"/>
      <url>/lover/index.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="d2531601e071dbfb89f16e031fee899896291fa2143ba1732a831db2016d112b">c5e815d020635826c7fa81835d3e2dba27a4e793839d62f2495d74c8f6ee3dccb9316b1814ff0cc6a47e1cc479c1ceb10010268bdc3bbcc235490e8e36291c25a0965f0425055af08d52476d7d547aeccc6c492bfee26499264c16b8bedff83e72070e2d41418819ad3a862629906fd0baae14b09bbd05ac94a60c1690036e60c5726598a2d4b0c9b95769af700537632e254e89faf50c501acfb926d60ef0cc38519c207daa7501d19224013773e1d8b8d948e65959dcd33185da99b34c17ee81a7788639217407e85c162a772dc8931d7a3db62ab7dadec6a93cf8d3050ed43e390e3be657000c6db97ed097fbd78a62e6640a1b25a3e9ea84c24e509e462f28db83add32ea69fc753882dc8f59d57b3dd23fdd5cfb5af78193f4e53cef05b1b7a934b4cebe449eda330f139d7baee05c13cb1cb625964acff7149f0511c030bafdeb02174bc81763b41a9a7adce868b6ab0422c94966e66f39f03e1a8d8816b807d0e26f6ac96cf7711dad23f8dbaa4dd61f354f6f611c2349b846c781d843abde75c61d7a325d6ca138dfb5ec79c0239e1441a9b32ad3fa838c131ec412825f5801a47dfe50dc4035d47aba50ca32410e3541fecdfc1ab30ecbeab2ae4d50ffba9325ff150530f35123ce0a3946f22c5a2b1d61e87ef2f60f569d86cf9bc9c3f9f562f7833f37da99d499db7f9cbf5f32917fa707428888cce9975db8b662ad8819b39d8ca6babec75a7ab08ca4941b71201afc4708c67a876f3b89d589c9788f92fb5e94b6baef9028dc33bbd1859c35aa098559bb9fd70d75efd2dfd390d95f88e1281a6d51e96fe20e818e3a1ab6acdc2f07df2667e361e978192c32daf4d025f4552e1f73f7109e449018392c993dca387853c773eb3c847bbb7d41517bd1893d19af5e10d194ec47abe359d931e8a65b54386b66b99fbad57af107d6e8722b5002d4421ce21dd7c5c9388cfe5b1ff844aacb2a3286c37a15c1fec378408d00179ebd48a59c491f68ca10f23a56514766757d4def02c9009d339da0c27ca2289a0a7526d1d9a50080e1c46f1d4e86f52e57adb5154b026097985e1eaa84b6496e729818e744890f14d01a114213698371651d95b7d09818c001c7214b9d5e100c3a0c6bb222c9626a9ec251251f79ca470272beb35adf808f66795fb5124bfd126faa446767d37397361e8ec44b7df9369a4d5d3946fce769237e124307b0c4d838236247158b1ce3802d18a614387de3b1c38189d7a9608d4899b4a0d806e8481f2f81f8c9b41f96d8816f79c965dd4fd688ec3721c61e37f89de0bf0b5f736769c8007568a43433e9dc5a7a8fd2c326dddd2ea71e0ead01aebed10fbfdb7320f86039bd5984942c8a1ec17444c048f232f286025bf4e4f83a4a277608454b8882f50378e042c98825e26e5</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ­¤å¤„é—²äººå‹¿æ‰°å“¦ï¼Œä¼‘æƒ³çª¥æ¢ (æœ‰å¯†ç é™¤å¤–)</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/js/weather.js"/>
      <url>/js/weather.js</url>
      
        <content type="html"><![CDATA[WIDGET = {    "CONFIG": {      "modules": "01234",      "background": "5",      "tmpColor": "FF9900",      "tmpSize": "16",      "cityColor": "CCCCCC",      "citySize": "16",      "aqiColor": "D9D9D9",      "aqiSize": "16",      "weatherIconSize": "24",      "alertIconSize": "18",      "padding": "15px 10px 10px 20px",      "shadow": "0",      "language": "auto",      "borderRadius": "5",      "fixed": "false",      "vertical": "top",      "horizontal": "left",      "key": "...."    }  }]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[<!-- æ’­æ”¾å™¨ --><div class="music-player"><!-- audioæ ‡ç­¾ --><audio class="music-player__audio" ></audio><!-- æ’­æ”¾å™¨ä¸»ä½“ --><div class="music-player__main"><!-- æ¨¡ç³ŠèƒŒæ™¯ --><div class="music-player__blur"></div><!-- å”±ç‰‡ --><div class="music-player__disc"><!-- å”±ç‰‡å›¾ç‰‡ --><div class="music-player__image"><img width="100%" src="" alt=""></div><!-- æŒ‡é’ˆ --><div class="music-player__pointer"><img width="100%" src="/img/cd_tou.png" alt=""></div></div><!-- æ§ä»¶ä¸»ä½“ --><div class="music-player__controls"><!-- æ­Œæ›²ä¿¡æ¯ --><div class="music__info"><h3 class="music__info--title">...</h3></div><!-- æ§ä»¶... --><div class="player-control"><div class="player-control__content"><div class="player-control__btns"><div class="player-control__btn player-control__btn--prev"><i class="iconfont icon-prev"></i></div><div class="player-control__btn player-control__btn--play"><i class="iconfont icon-play"></i></div><div class="player-control__btn player-control__btn--next"><i class="iconfont icon-next"></i></div><div class="player-control__btn player-control__btn--mode"><i class="iconfont icon-random"></i></div></div><div class="player-control__volume"><div class="control__volume--icon player-control__btn"><i class="iconfont icon-volume"></i></div><div class="control__volume--progress progress"></div></div></div><div class="player-control__content"><div class="player__song--progress progress"></div><div class="player__song--timeProgess nowTime">00:00</div><div class="player__song--timeProgess totalTime">00:00</div></div></div></div></div><!-- æ­Œæ›²åˆ—è¡¨ --><div class="music-player__list"><ul class="music__list_content"></ul></div></div><script src="/js/utill.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.slim.min.js"></script><script src="/js/player.js?10"></script><div style="text-align:center;margin:-100px 0; font:normal 14px/24px 'MicroSoft YaHei';color:#ffffff"></div>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>ç”µå½±</title>
      <link href="/movies/index.html"/>
      <url>/movies/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡ç­¾</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
